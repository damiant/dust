import{a as ct}from"./chunk-K32ZFYDX.js";import{a as mt}from"./chunk-HSD7DC6Q.js";import{a as dt}from"./chunk-RAA3KX6C.js";import{a as st}from"./chunk-IWMP2PAE.js";import"./chunk-TUKQZ63R.js";import{A as ot,H as rt,Y as lt,a as nt,f as at}from"./chunk-IKEGAJLW.js";import{E as tt,F as it,e as Z,j as b}from"./chunk-CP2LIZQM.js";import{a as et}from"./chunk-MIGJGGKJ.js";import{A as g,B as C,Bc as X,Ca as l,Da as v,Fc as Y,Ga as k,S as n,T as w,Va as E,Xb as V,Y as T,Yb as L,Za as D,Zb as N,_b as R,aa as _,dc as $,ea as d,eb as B,fb as O,ha as c,ia as F,ib as U,ja as I,jc as j,ka as S,kc as H,la as a,lc as z,ma as o,mc as W,na as m,nc as q,pa as y,qa as x,ra as s,tc as J,uc as K,vc as Q,w as M,xb as G}from"./chunk-PHUHKYQ4.js";import"./chunk-ATW7DGUS.js";import"./chunk-7KGURMOZ.js";import"./chunk-UXWCR2YA.js";import"./chunk-QYFQMV2H.js";import"./chunk-ORVKXEJA.js";import"./chunk-KBMMZLX2.js";import"./chunk-5J6JP6Q2.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as P,b as A,h}from"./chunk-LNJ3S2LQ.js";function _t(i,e){i&1&&(a(0,"ion-button",2),m(1,"ion-icon",6),o())}function ht(i,e){i&1&&m(0,"app-spinner")}function vt(i,e){if(i&1){let t=y();a(0,"ion-toolbar")(1,"ion-searchbar",11),x("ionInput",function(p){g(t);let u=s(2);return C(u.handleSearch(p))}),o(),a(2,"ion-button",12),x("click",function(){g(t);let p=s(2);return C(p.toggleGrid())}),m(3,"ion-icon",13),o()()}if(i&2){let t=s(2);n(),d("debounce",600)("placeholder","Search burns"),n(2),d("name",t.isGrid?"list-outline":"grid-outline")}}function ft(i,e){i&1&&(a(0,"div",9)(1,"h1"),l(2,"Getting Started"),o(),a(3,"h4",14),l(4," As a regional organizer you can click the button below to create a new regional burn. "),o()())}function ut(i,e){if(i&1&&m(0,"app-img",17),i&2){let t=s().$implicit;d("height","100%")("src",t.imageUrl)}}function gt(i,e){if(i&1){let t=y();a(0,"div",15)(1,"ion-card",16),x("click",function(){let p=g(t).$implicit,u=s(3);return C(u.open("/"+p.vanity))}),_(2,ut,1,2,"app-img",17),a(3,"ion-card-content",18)(4,"h1"),l(5),o()()(),a(6,"ion-text",19),l(7),o()()}if(i&2){let t=e.$implicit;n(2),c(t.imageUrl?2:-1),n(3),v(t.name),n(2),v(t.name)}}function Ct(i,e){if(i&1&&I(0,gt,8,3,"div",15,F),i&2){let t=s(2);S(t.festivals)}}function xt(i,e){i&1&&(a(0,"p"),l(1,"Dates are not known"),o())}function yt(i,e){if(i&1&&(a(0,"p"),l(1),o()),i&2){let t=s().$implicit;n(),k(" ",t.start," - ",t.end," (in ",t.daysUntil," days) ")}}function bt(i,e){if(i&1){let t=y();a(0,"ion-item",21),x("click",function(){let p=g(t).$implicit,u=s(3);return C(u.open("/"+p.vanity))}),m(1,"app-img",22),a(2,"ion-label")(3,"span"),l(4),o(),_(5,xt,2,0,"p")(6,yt,2,3,"p"),o(),a(7,"ion-note",1),l(8),o(),a(9,"ion-note",1),l(10),o()()}if(i&2){let t=e.$implicit,r=s(3);d("ngClass",r.classFor(t)),n(),d("width","45px")("height","45px")("src",t.imageUrl),n(3),v(t.name),n(),c(t.unknown_dates?5:6),n(3),v(t.note),n(2),v(t.active?"In Dust":"Hidden")}}function wt(i,e){if(i&1&&(a(0,"div",10)(1,"ion-card")(2,"ion-list"),I(3,bt,11,8,"ion-item",20,F),o()()()),i&2){let t=s(2);d("ngClass",t.festivals.length>0?"":"pad-vertical"),n(3),S(t.festivals)}}function Ft(i,e){if(i&1&&(_(0,vt,4,3,"ion-toolbar"),a(1,"div",7)(2,"div",8),_(3,ft,5,0,"div",9)(4,Ct,2,0)(5,wt,5,1,"div",10),o()()),i&2){let t=s();c(t.festivals.length>1||t.filteredBySearch?0:-1),n(3),c(t.noData?3:-1),n(),c(t.isGrid?4:5)}}function It(i,e){i&1&&m(0,"app-footer",5)}var f=class f{constructor(e,t){this.api=e;this.router=t;this.store=M(tt);this.publishing=!1;this.busy=!0;this.addAllowed=!1;this.noData=!1;this.isGrid=!0;this.listArchived=!1;this.buttons=[];this.isNative=et.isNativePlatform();this.filteredBySearch=!1;this.festivals=[];lt({add:nt,listOutline:rt,gridOutline:ot,bookOutline:at})}ngOnInit(){this.isGrid=this.store.get("isFestivalList")!=="false"}ionViewWillEnter(){return h(this,null,function*(){if(!this.api.signedIn()){this.router.navigateByUrl("/auth");return}try{this.busy=!0;let e=sessionStorage.openburn;if(!Z(e)){this.router.navigateByUrl(`/${e}`);return}let t=this.api.getAccessInfo(void 0);this.addAllowed=!1,t.hasAdmin&&(this.addAllowed=!0),!t.hasAdmin&&!t.hasCamps&&!t.hasMusic&&!t.hasArt&&!t.hasCamps&&(this.addAllowed=!0),this.buttons=t.hasAdmin&&!this.listArchived?[{title:"Show Archived",method:this.showArchived(),icon:"book-outline"}]:[],yield this.getData(),this.sort(),this.noData=this.addAllowed&&this.festivals.length==0}finally{this.busy=!1}})}showArchived(){return()=>h(this,null,function*(){this.listArchived=!0,this.buttons=[],yield this.getData(),this.sort()})}handleSearch(e){return h(this,null,function*(){let t=e.target.value.toLowerCase();yield this.getData(t),this.filteredBySearch=t.length>0,this.sort()})}getData(e){return h(this,null,function*(){let t=!this.isGrid;this.festivals=this.asFestivalModels(yield this.api.getFestivals(t)),e&&(this.festivals=this.festivals.filter(r=>r.name.toLowerCase().includes(e))),this.listArchived||(this.festivals=this.festivals.filter(r=>!r.archived)),this.festivals.map(r=>{r.imageUrl=this.api.imageURL(r.imageUrl)}),this.addAllowed})}toggleGrid(){return h(this,null,function*(){this.isGrid=!this.isGrid,this.store.set("isFestivalList",this.isGrid.toString()),yield this.getData(),this.sort()})}open(e){if(e=="new"){this.router.navigateByUrl("../new");return}this.api.clearCache(),this.router.navigateByUrl(e)}asFestivalModels(e){return e.map(t=>A(P({},t),{daysUntil:b(t.start_time),start:this.niceFormat(t.start_time),end:this.niceFormat(t.end_time),note:b(t.start_time)>0?b(t.start_time)+" days":t.archived?"Archived":"Past"}))}niceFormat(e){return new Date(e).toLocaleDateString()}classFor(e){return e.active?"":e.daysUntil<0?"past":"hidden"}sort(){this.isGrid?this.filteredBySearch?this.festivals.sort((e,t)=>e.name.localeCompare(t.name)):(console.log(this.isGrid,this.festivals),this.festivals.sort((e,t)=>e.distance-t.distance)):this.festivals.sort((e,t)=>new Date(e.start_time)>new Date(t.start_time)?-1:1)}};f.\u0275fac=function(t){return new(t||f)(w(it),w(B))},f.\u0275cmp=T({type:f,selectors:[["app-festivals"]],decls:11,vars:5,consts:[["color","primary"],["slot","end"],["routerLink","../new"],[3,"buttons"],[3,"fullscreen"],["title","New Regional Burn","routeTo","../new"],["name","add"],[1,"large-border"],[1,"container"],[2,"display","flex","align-items","center","flex-direction","column","justify-content","center","height","70vh"],[1,"ion-text-center",3,"ngClass"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],["color","dark","fill","clear","slot","end",3,"click"],[3,"name"],[1,"ion-padding","ion-text-center"],[1,"ion-text-center","ion-padding"],["color","light",1,"card",3,"click"],[3,"height","src"],[1,"xcenter"],["color","medium"],[1,"clickable","hoverable",3,"ngClass"],[1,"clickable","hoverable",3,"click","ngClass"],[2,"min-width","45px",3,"width","height","src"]],template:function(t,r){t&1&&(a(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),l(3,"dust"),o(),a(4,"ion-buttons",1),_(5,_t,2,0,"ion-button",2),m(6,"app-side",3),o()()(),a(7,"ion-content",4),_(8,ht,1,0,"app-spinner")(9,Ft,6,3)(10,It,1,0,"app-footer",5),o()),t&2&&(n(5),c(r.isNative?-1:5),n(),d("buttons",r.buttons),n(),d("fullscreen",!0),n(),c(r.busy?8:9),n(2),c(r.addAllowed?10:-1))},dependencies:[Y,z,q,H,W,J,D,E,mt,st,dt,G,U,O,j,Q,K,L,V,$,X,N,R,ct],styles:[".container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex-wrap:wrap}.card[_ngcontent-%COMP%]{width:300px;height:300px;border-radius:10px;flex-basis:40%;cursor:pointer}.hoverable[_ngcontent-%COMP%]:hover{--background: var(--ion-color-light)}.xcenter[_ngcontent-%COMP%]{text-align:center;display:flex;justify-content:center;align-items:center;height:300px}app-img[_ngcontent-%COMP%]{--border-radius: 5px;padding-right:1rem;width:60px}ion-item[_ngcontent-%COMP%]{width:600px;max-width:100vw}.hidden[_ngcontent-%COMP%]{opacity:.5}.past[_ngcontent-%COMP%]{opacity:.75}app-footer[_ngcontent-%COMP%]{--footer-width: 130px}"]});var pt=f;export{pt as FestivalsPage};
