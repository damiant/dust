import{a as ke}from"./chunk-PAS4HQSU.js";import{a as ze}from"./chunk-XQO4ZLWR.js";import{a as Be}from"./chunk-NE5K7VVL.js";import{a as Le}from"./chunk-YRL4OT5W.js";import{a as Ve}from"./chunk-HSBV6RIN.js";import{a as be}from"./chunk-KCPLCCSF.js";import{a as Te}from"./chunk-5EUBO754.js";import{a as k}from"./chunk-OZ2IKH4J.js";import"./chunk-ZHFJF7NS.js";import"./chunk-A5RC3O7B.js";import"./chunk-CVA27SDO.js";import"./chunk-U5OWWBBZ.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-L4IPHJNS.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-ZMJ3RQA5.js";import"./chunk-MCRJI3T3.js";import"./chunk-QDGYTOUC.js";import"./chunk-VLNXCBKY.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import{W as Me,Z as Ee,aa as Ie,t as we}from"./chunk-TF5OT4X3.js";import{C as Ce,I as Se}from"./chunk-CXIDEVKY.js";import"./chunk-PFLI22GG.js";import{$ as G,$a as J,Aa as V,Ba as A,D as R,Dc as fe,Ea as b,Ec as ve,F as D,Fa as w,Fc as ye,G as p,Ga as M,Ha as H,Hc as Pe,Ic as xe,Ka as Q,La as S,Na as X,O as N,Ra as Z,Rb as ie,S as z,Sb as ne,W as P,Wa as Y,X as x,Xa as j,Yb as ae,Z as L,Zb as oe,_ as B,_b as le,aa as c,ba as n,ca as a,cb as K,da as C,ec as re,ia as y,ka as f,kc as se,lc as pe,ma as d,mc as ce,nc as de,ob as $,p as I,qa as O,ra as W,rb as ee,rc as me,s as u,sa as F,sc as ue,t as g,uc as ge,va as U,vc as he,wa as q,wc as _e,yb as te,za as l}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var Oe=["map"],We=["fileUpload"],Fe=r=>({title:"Upload Map Image",method:r,icon:"cloud-upload-outline"}),Ue=r=>({title:"Generate Map",method:r,icon:"map-outline"}),Ae=r=>({title:"Settings",method:r,icon:"settings-outline"}),Re=r=>({title:"Clear Camp Locations",method:r,icon:"trash-bin-outline"}),De=r=>({title:"Clear Art Locations",method:r,icon:"trash-bin-outline"}),Ne=r=>({title:"Clear Other Locations",method:r,icon:"trash-bin-outline"}),qe=(r,t,e,o,i,s)=>[r,t,e,o,i,s],He=()=>["1","2","3","4","5"];function Qe(r,t){if(r&1){let e=y();n(0,"ion-toolbar")(1,"ion-list")(2,"ion-item",17)(3,"ion-text"),l(4,"Click on the map to place a"),a(),n(5,"ion-select",18),f("ionChange",function(i){u(e);let s=d();return g(s.typeChange(i))}),M("ngModelChange",function(i){u(e);let s=d();return w(s.pinType,i)||(s.pinType=i),g(i)}),n(6,"ion-select-option",19),l(7,"Restroom"),a(),n(8,"ion-select-option",20),l(9,"Gate"),a(),n(10,"ion-select-option",21),l(11,"Greeter Station"),a(),n(12,"ion-select-option",22),l(13,"Shuttle Stop"),a(),n(14,"ion-select-option",23),l(15,"Ice"),a(),n(16,"ion-select-option",24),l(17,"Medical Station"),a(),n(18,"ion-select-option",25),l(19,"GPS"),a()()()(),n(20,"ion-buttons",5),C(21,"app-side",26),a()()}if(r&2){let e=d(),o=U(18);p(5),b("ngModel",e.pinType),c("value",e.pinType),p(16),c("hideProfile",!0)("buttons",X(16,qe,S(4,Fe,e.uploadMap(o)),S(6,Ue,e.generateMap()),S(8,Ae,e.openSettings()),S(10,Re,e.clearCamps()),S(12,De,e.clearArt()),S(14,Ne,e.clearPins())))}}function Xe(r,t){r&1&&C(0,"app-spinner",8)}function Ze(r,t){if(r&1){let e=y();n(0,"ion-content",15)(1,"div",15)(2,"h1"),l(3,"Map Settings"),a(),n(4,"p"),l(5,"Choose the direction that North is point on the map."),C(6,"br"),l(7,"This is used to ensure a persons pin on the map is facing the correct direction."),a(),n(8,"ion-radio-group",27),M("ngModelChange",function(i){u(e);let s=d();return w(s.mapDirection,i)||(s.mapDirection=i),g(i)}),n(9,"div",28)(10,"ion-radio",29),l(11,"Top Left"),a(),n(12,"ion-radio",29),l(13,"Top"),a(),n(14,"ion-radio",30),l(15,"Top Right"),a()(),n(16,"div",28)(17,"ion-radio",29),l(18,"Left"),a(),C(19,"div"),n(20,"ion-radio",30),l(21,"Right"),a()(),n(22,"div",28)(23,"ion-radio",29),l(24,"Bottom Right"),a(),n(25,"ion-radio",29),l(26,"Bottom"),a(),n(27,"ion-radio",30),l(28,"Bottom Left"),a()(),n(29,"div",28)(30,"ion-input",31),M("ngModelChange",function(i){u(e);let s=d();return w(s.pinSizeMultiplier,i)||(s.pinSizeMultiplier=i),g(i)}),a()()()()(),n(31,"ion-toolbar",32)(32,"ion-button",33),f("click",function(){u(e);let i=d();return g(i.applySettings())}),l(33,"Apply"),a()()}if(r&2){let e=d();p(8),b("ngModel",e.mapDirection),p(2),c("value",270),p(2),c("value",0),p(2),c("value",45),p(3),c("value",240),p(3),c("value",90),p(3),c("value",120),p(2),c("value",180),p(2),c("value",210),p(3),b("ngModel",e.pinSizeMultiplier)}}function Ye(r,t){if(r&1&&(n(0,"ion-segment-button",41)(1,"ion-label"),l(2),a()()),r&2){let e=t.$implicit;c("value",H(e)),p(2),V(e)}}function je(r,t){if(r&1){let e=y();n(0,"ion-content",15)(1,"div",15)(2,"h1"),l(3,"Generate Map"),a(),n(4,"p"),l(5),a()(),n(6,"ion-list",17)(7,"ion-item"),l(8,"Map Type"),a(),n(9,"ion-segment",34),M("ngModelChange",function(i){u(e);let s=d();return w(s.mapStyle,i)||(s.mapStyle=i),g(i)}),n(10,"ion-segment-button",35)(11,"ion-label"),l(12,"Outdoors"),a()(),n(13,"ion-segment-button",36)(14,"ion-label"),l(15,"Satellite"),a()(),n(16,"ion-segment-button",37)(17,"ion-label"),l(18,"Full"),a()(),n(19,"ion-segment-button",38)(20,"ion-label"),l(21,"Street"),a()(),n(22,"ion-segment-button",39)(23,"ion-label"),l(24,"Light"),a()(),n(25,"ion-segment-button",40)(26,"ion-label"),l(27,"Dark"),a()()()(),n(28,"ion-list",17)(29,"ion-item"),l(30,"Zoom Level"),a(),n(31,"ion-segment",34),M("ngModelChange",function(i){u(e);let s=d();return w(s.zoom,i)||(s.zoom=i),g(i)}),B(32,Ye,3,3,"ion-segment-button",41,L),a()()(),n(34,"ion-toolbar",32)(35,"ion-button",33),f("click",function(){u(e);let i=d();return g(i.createMap(i.mapStyle))}),l(36,"Create"),a()()}if(r&2){let e=d();p(5),A("Create an image of a map centered at the latitude and longitude of ",e.festivalTitle,"."),p(4),b("ngModel",e.mapStyle),c("value",e.mapStyle),p(22),b("ngModel",e.zoom),c("value",e.zoom),p(),G(Q(5,He))}}function Je(r,t){if(r&1){let e=y();n(0,"div",11)(1,"ion-button",33),f("click",function(){u(e),d();let i=U(18);return g(i.click())}),l(2,"Upload Map Image"),a()()}}function Ke(r,t){if(r&1){let e=y();n(0,"div",42),f("click",function(i){u(e);let s=d();return g(s.mapPoint(i,!1))}),n(1,"div",43),l(2),a()()}if(r&2){let e=t.$implicit;q("left",e.px+"px")("top",e.py+"px"),c("title",e.label)("ngClass",e.class+" "+e.visible),p(2),V(e.label)}}function $e(r,t){if(r&1&&(n(0,"app-note"),l(1),a()),r&2){let e=d();p(),V(e.mapNote)}}function et(r,t){if(r&1){let e=y();n(0,"app-gps",45),f("gpsChange",function(i){u(e);let s=d(2);return g(s.applyGPS(i))}),a(),n(1,"app-note")(2,"b"),l(3,"Tip"),a(),l(4,": Right click in Google Maps to copy lat/long and paste here."),a()}if(r&2){let e=d(2);c("lat",e.selected.gpsLat)("lng",e.selected.gpsLng)}}function tt(r,t){if(r&1){let e=y();n(0,"app-footer",16)(1,"ion-card",15)(2,"ion-title"),l(3),a(),n(4,"ion-list"),P(5,et,5,2),a(),n(6,"ion-button",44),f("click",function(){u(e);let i=d();return g(i.delete())}),l(7,"Delete"),a()()()}if(r&2){let e=d();p(3),V(e.selected.label),p(2),x(e.selected&&e.selected.label==="GPS"?5:-1)}}var E=class E{constructor(){this.api=I(Se);this.sanitizer=I(K);this.location=I(Y);this.alert=I(Ve);this.vanity=Z();this.mapUri="";this.pinType="Restrooms";this.pins=[];this.title="";this.busy=!1;this.showGenMap=!1;this.showSettings=!1;this.uploading=!1;this.zoom="1";this.mapStyle="outdoors-v12";this.mapNote="";this.hasMap=!0;this.festivalTitle="";this.mapDirection=0;this.pinSizeMultiplier=1;Ie({trashBinOutline:Ee,cloudUploadOutline:we,settingsOutline:Me})}generateMap(){return()=>_(this,null,function*(){this.api.isAdmin(this.api.festivalId)?this.showGenMap=!0:this.api.sendMessage("This feature is not available to you.")})}openSettings(){return()=>_(this,null,function*(){this.api.isAdmin(this.api.festivalId)?(this.showSettings=!0,console.log(this.mapDirection)):this.api.sendMessage("This feature is not available to you.")})}clearCamps(){return()=>_(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield k(this.alert,"Are you sure you want to clear the locations of all theme camps?","Clear")))return;this.api.clearCamps(),this.api.sendMessage("Camp locations have been cleared from the map"),this.api.clearCache()}})}clearArt(){return()=>_(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield k(this.alert,"Are you sure you want to clear the locations of all art?","Clear")))return;this.api.clearArtLocations(),this.api.sendMessage("Art locations have been cleared from the map"),this.api.clearCache()}})}clearPins(){return()=>_(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield k(this.alert,"Are you sure you want to clear the locations of all other items (restrooms, gate etc)?","Clear")))return;yield this.api.clearPinLocations(),this.ionViewWillEnter(),this.api.sendMessage("Other locations have been cleared from the map"),this.api.clearCache()}})}uploadMap(t){return()=>_(null,null,function*(){console.log(t),t.click()})}onFileSelected(t){return _(this,null,function*(){let e=t.target.files[0];if(!e)return;let i=10*1024*1024;try{this.uploading=!0;let s=e;if(e.size>i){let m=[.85,.5,.3],v=!1;try{for(let T of m)if(s=yield be(e,{quality:T}),s.size<=i){v=!0;break}else console.log(`Conversion at quality ${T} resulted in size ${s.size}, still too large.`);if(!v){this.api.sendMessage("The maximum image size is 10mb. Please try uploading a smaller image size");return}}catch{this.api.sendMessage("The maximum image size is 10mb. Please try uploading a smaller image size");return}}let h=yield Ce(s);yield this.api.setMap(h),this.api.sendMessage("Map was uploaded"),this.ionViewWillEnter()}catch(s){console.error("Error uploading map:",s),this.api.sendMessage("Error uploading map. Please try again.")}finally{this.uploading=!1}})}createMap(t){return _(this,null,function*(){this.showGenMap=!1,yield this.api.generateMap(t,parseInt(this.zoom)+12),this.ionViewWillEnter()})}applySettings(){return _(this,null,function*(){this.showSettings=!1;let t=yield this.api.getFestival(this.api.festivalId,{cached:!1});t.map_direction=this.mapDirection,t.pin_size_multiplier=this.pinSizeMultiplier,yield this.api.addFestival(t),this.api.clearCache(),this.ionViewWillEnter()})}ionViewWillEnter(){return _(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity());let t=yield this.api.getFestival(this.api.festivalId,{cached:!0});this.title="Map",this.festivalTitle=this.api.festivalTitle(),this.mapDirection=t.map_direction;let e=yield this.api.getMap();if(this.hasMap=!0,e.base64)this.mapUri=e?this.sanitizer.bypassSecurityTrustUrl(e.base64):"";else if(e.filename)this.mapUri=this.api.imageURL(`${this.vanity()}/${e.filename}`);else{this.hasMap=!1,this.fileUpload.click();return}this.mapDirection=t.map_direction,this.pinSizeMultiplier=t.pin_size_multiplier,this.pins=yield this.api.getPins(),this.recalculate()})}typeChange(t){this.filter(t.detail.value)}filter(t){for(let e of this.pins)e.visible=e.label==t?"":"hidden"}mapPoint(t,e){console.log("clicked",t,e);let o=t.clientX,i=t.clientY,h=this.map.nativeElement.getBoundingClientRect(),m=(o-h.x)*1e4/h.width,v=(i-h.y)*1e4/h.height;if(!(this.selectPin(m,v)||!e)){if(this.selected){this.selected=void 0;return}this.pins.push({x:Math.ceil(m),y:Math.ceil(v),px:Math.ceil(m)*this.width()/1e4,py:Math.ceil(v)*this.height()/1e4,label:this.pinType,gpsLat:void 0,gpsLng:void 0}),this.setMapNote()}}delete(){this.pins=this.pins.filter(t=>t.class!=="selected"),this.selected=void 0}applyGPS(t){this.pins.map(e=>{e.class==="selected"&&this.selected&&(e.gpsLat=t.lat,e.gpsLng=t.lng)})}recalculate(){for(let t of this.pins)t.px=Math.ceil(t.x)*this.width()/1e4,t.py=Math.ceil(t.y)*this.height()/1e4;this.setMapNote()}setMapNote(){let t=this.pins.filter(e=>e.label=="GPS").length;this.mapNote=t>=3?"":'You will need to add at least 3 Pins of type "GPS" with GPS coordinates for the dust app to show distances.'}save(){return _(this,null,function*(){try{this.busy=!0;for(let t of this.pins)t.class=void 0,t.px=void 0,t.py=void 0,t.visible=void 0,t.gpsLat==0&&t.gpsLng==0&&(t.gpsLat=void 0,t.gpsLng=void 0);yield this.api.placePins(this.pins),this.location.back()}finally{this.busy=!1}})}width(){return this.map.nativeElement.getBoundingClientRect().width}height(){return this.map.nativeElement.getBoundingClientRect().height}selectPin(t,e){var s,h;console.log("selectPin",t,e);let o,i=-30;for(let m of this.pins){let v=this.dist(m,t+i,e+i),T=50;console.log("d",v,T,JSON.stringify(m)),v<T?(this.selected=m,this.selected.label==="GPS"&&(m.gpsLat=(s=m.gpsLat)!=null?s:0,m.gpsLng=(h=m.gpsLng)!=null?h:0),m.class="selected",o=m,console.log(`Selected ${m.label}`)):m.class=void 0}return o}dist(t,e,o){let i=e-t.x,s=o-t.y;return Math.sqrt(i*i+s*s)}};E.\u0275fac=function(e){return new(e||E)},E.\u0275cmp=N({type:E,selectors:[["app-pins"]],viewQuery:function(e,o){if(e&1&&(O(Oe,5),O(We,5)),e&2){let i;W(i=F())&&(o.map=i.first),W(i=F())&&(o.fileUpload=i.first)}},inputs:{vanity:[1,"vanity"]},decls:28,vars:11,consts:[["fileUpload",""],["map",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],["title","Uploading map image..."],[3,"isOpen"],["type","file",1,"file-input",3,"change"],[1,"ion-text-center",2,"padding-top","45vh"],[1,"map"],[1,"pin",3,"title","ngClass","left","top"],[3,"resize","click","src"],[1,"ion-padding"],["width","300px"],["lines","none"],["labelPlacement","fixed","interface","popover","placeholder","Pin Types",3,"ionChange","ngModelChange","ngModel","value"],["value","Restrooms"],["value","Gate"],["value","Greeters"],["value","Shuttle Stop"],["value","Ice"],["value","Medical"],["value","GPS"],[3,"hideProfile","buttons"],[3,"ngModelChange","ngModel"],[1,"row"],["labelPlacement","end",3,"value"],["labelPlacement","start",3,"value"],["labelPlacement","stacked","label","Pin Size Multiplier","type","number",3,"ngModelChange","ngModel"],[1,"ion-text-center","ion-padding"],[3,"click"],["mode","ios",3,"ngModelChange","ngModel","value"],["value","outdoors-v12"],["value","satellite-v9"],["value","satellite-streets-v12"],["value","streets-v12"],["value","light-v11"],["value","dark-v11"],[3,"value"],[1,"pin",3,"click","title","ngClass"],[1,"label"],["shape","round","color","primary","mode","md",3,"click"],[3,"gpsChange","lat","lng"]],template:function(e,o){if(e&1){let i=y();n(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3),C(3,"ion-back-button"),a(),n(4,"ion-title",4),l(5),a(),n(6,"ion-buttons",5)(7,"ion-button",6),f("click",function(){return u(i),g(o.save())}),l(8,"Save"),a()()(),P(9,Qe,22,23,"ion-toolbar"),a(),n(10,"ion-content",7),P(11,Xe,1,0,"app-spinner",8),n(12,"ion-modal",9),z(13,Ze,34,10,"ng-template"),a(),n(14,"ion-modal",9),z(15,je,37,6,"ng-template"),a(),n(16,"div")(17,"input",10,0),f("change",function(h){return u(i),g(o.onFileSelected(h))}),a(),P(19,Je,3,0,"div",11),n(20,"div",12),B(21,Ke,3,7,"div",13,L),a(),n(23,"img",14,1),f("resize",function(){return u(i),g(o.recalculate())},D)("click",function(h){return u(i),g(o.mapPoint(h,!0))}),a()(),C(25,"div",15),P(26,$e,2,1,"app-note"),P(27,tt,8,2,"app-footer",16),a()}e&2&&(p(5),A(" ",o.title," "),p(2),c("disabled",o.busy),p(2),x(o.hasMap?9:-1),p(),c("fullscreen",!0),p(),x(o.uploading?11:-1),p(),c("isOpen",o.showSettings),p(2),c("isOpen",o.showGenMap),p(5),x(o.hasMap?-1:19),p(2),G(o.pins),p(2),c("src",o.mapUri,R),p(3),x(o.hasMap?26:-1),p(),x(o.selected?27:-1))},dependencies:[fe,ge,me,Pe,ye,ve,ne,ce,ke,le,J,j,te,$,ee,se,_e,oe,ie,he,ae,de,pe,xe,ue,re,ze,Le,Be,Te],styles:["img[_ngcontent-%COMP%]{user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-drag:none;-webkit-user-select:none;-ms-user-select:none}.placed[_ngcontent-%COMP%]{background-color:red!important;border:2px solid white!important;width:var(--pin-size-placed);height:var(--pin-size-placed);border-radius:var(--pin-size-placed)}.selected[_ngcontent-%COMP%]{background-color:#ff9191!important;border:3px solid red!important}.pin[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{visibility:hidden;width:100px;margin-left:var(--pin-size);margin-top:calc(var(---pin-size/2));color:#fff;background:#000;border-radius:10px;padding:3px;text-align:center}.pin[_ngcontent-%COMP%]:hover   .label[_ngcontent-%COMP%]{visibility:visible}.pin[_ngcontent-%COMP%]{width:var(--pin-size);height:var(--pin-size);border-radius:var(--pin-size);background-color:#fff;border:2px solid red;position:absolute;cursor:pointer}.hidden[_ngcontent-%COMP%]{opacity:.5}.map[_ngcontent-%COMP%]{position:absolute;--pin-size: 10px;--pin-size-placed: 15px}ion-select[_ngcontent-%COMP%]{margin-left:.5rem;padding-left:1rem;border:2px solid var(--ion-color-medium);border-radius:1rem;max-width:200px}.row[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between}ion-radio[_ngcontent-%COMP%]{padding:1rem}"]});var Ge=E;export{Ge as PinsPage};
