import{a as Ee}from"./chunk-STTPR6U4.js";import{a as Te}from"./chunk-K32ZFYDX.js";import{a as Ve}from"./chunk-HSD7DC6Q.js";import{a as Ie}from"./chunk-ZWPJAP2G.js";import{a as Me}from"./chunk-L3JJEUF3.js";import{a as V}from"./chunk-KVSZYKJC.js";import"./chunk-5W5FH4VE.js";import"./chunk-2RWSG5RW.js";import"./chunk-G3CKXV7X.js";import"./chunk-5FZVM2DH.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-4JPLRTL2.js";import"./chunk-NPRM7GGH.js";import"./chunk-52VTL4OE.js";import"./chunk-VBU7NMPV.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-3GGVU3XB.js";import"./chunk-MCRJI3T3.js";import"./chunk-5ZNPFCKO.js";import"./chunk-46PQVYTJ.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import{T as Ce,V as be,Y as we,t as Se}from"./chunk-IKEGAJLW.js";import{A as Pe,F as xe}from"./chunk-CP2LIZQM.js";import"./chunk-MIGJGGKJ.js";import{A as m,B as u,Ba as F,Ca as l,Cc as he,Da as I,Dc as _e,Ea as W,Ec as fe,Gc as ve,Ha as b,Hc as ye,Ia as w,Ja as M,La as Q,Ma as P,Oa as j,P as U,Qb as ee,R,Rb as te,S as p,T,Ua as q,Va as Y,Xb as ie,Y as D,Yb as ne,Za as J,Zb as oe,aa as y,bb as X,dc as ae,ea as c,fa as N,ha as S,ia as L,ja as k,jc as le,ka as z,kc as re,la as n,lc as se,ma as o,mc as pe,na as C,nb as Z,pa as v,qa as f,qb as K,qc as ce,ra as d,rc as de,tc as me,ua as H,uc as ue,vc as ge,wa as G,xa as O,xb as $,ya as B}from"./chunk-PHUHKYQ4.js";import"./chunk-ATW7DGUS.js";import"./chunk-7KGURMOZ.js";import"./chunk-UXWCR2YA.js";import"./chunk-QYFQMV2H.js";import"./chunk-ORVKXEJA.js";import"./chunk-KBMMZLX2.js";import"./chunk-5J6JP6Q2.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h}from"./chunk-LNJ3S2LQ.js";var ke=["map"],ze=["fileUpload"],Ge=r=>({title:"Upload Map Image",method:r,icon:"cloud-upload-outline"}),Oe=r=>({title:"Generate Map",method:r,icon:"map-outline"}),Be=r=>({title:"Settings",method:r,icon:"settings-outline"}),Fe=r=>({title:"Clear Camp Locations",method:r,icon:"trash-bin-outline"}),We=r=>({title:"Clear Art Locations",method:r,icon:"trash-bin-outline"}),Ae=r=>({title:"Clear Other Locations",method:r,icon:"trash-bin-outline"}),Ue=(r,t,e,a,i,s)=>[r,t,e,a,i,s],Re=()=>["1","2","3","4","5"];function De(r,t){if(r&1){let e=v();n(0,"ion-toolbar")(1,"ion-list")(2,"ion-item",16)(3,"ion-text"),l(4,"Click on the map to place a"),o(),n(5,"ion-select",17),f("ionChange",function(i){m(e);let s=d();return u(s.typeChange(i))}),M("ngModelChange",function(i){m(e);let s=d();return w(s.pinType,i)||(s.pinType=i),u(i)}),n(6,"ion-select-option",18),l(7,"Restroom"),o(),n(8,"ion-select-option",19),l(9,"Gate"),o(),n(10,"ion-select-option",20),l(11,"Greeter Station"),o(),n(12,"ion-select-option",21),l(13,"Shuttle Stop"),o(),n(14,"ion-select-option",22),l(15,"Ice"),o(),n(16,"ion-select-option",23),l(17,"Medical Station"),o(),n(18,"ion-select-option",24),l(19,"GPS"),o()()()(),n(20,"ion-buttons",5),C(21,"app-side",25),o()()}if(r&2){let e=d(),a=F(17);p(5),b("ngModel",e.pinType),c("value",e.pinType),p(16),c("hideProfile",!0)("buttons",j(16,Ue,P(4,Ge,e.uploadMap(a)),P(6,Oe,e.generateMap()),P(8,Be,e.openSettings()),P(10,Fe,e.clearCamps()),P(12,We,e.clearArt()),P(14,Ae,e.clearPins())))}}function Ne(r,t){if(r&1){let e=v();n(0,"ion-content",14)(1,"div",14)(2,"h1"),l(3,"Map Settings"),o(),n(4,"p"),l(5,"Choose the direction that North is point on the map."),C(6,"br"),l(7,"This is used to ensure a persons pin on the map is facing the correct direction."),o(),n(8,"ion-radio-group",26),M("ngModelChange",function(i){m(e);let s=d();return w(s.mapDirection,i)||(s.mapDirection=i),u(i)}),n(9,"div",27)(10,"ion-radio",28),l(11,"Top Left"),o(),n(12,"ion-radio",28),l(13,"Top"),o(),n(14,"ion-radio",29),l(15,"Top Right"),o()(),n(16,"div",27)(17,"ion-radio",28),l(18,"Left"),o(),C(19,"div"),n(20,"ion-radio",29),l(21,"Right"),o()(),n(22,"div",27)(23,"ion-radio",28),l(24,"Bottom Right"),o(),n(25,"ion-radio",28),l(26,"Bottom"),o(),n(27,"ion-radio",29),l(28,"Bottom Left"),o()(),n(29,"div",27)(30,"ion-input",30),M("ngModelChange",function(i){m(e);let s=d();return w(s.pinSizeMultiplier,i)||(s.pinSizeMultiplier=i),u(i)}),o()()()()(),n(31,"ion-toolbar",31)(32,"ion-button",32),f("click",function(){m(e);let i=d();return u(i.applySettings())}),l(33,"Apply"),o()()}if(r&2){let e=d();p(8),b("ngModel",e.mapDirection),p(2),c("value",270),p(2),c("value",0),p(2),c("value",45),p(3),c("value",240),p(3),c("value",90),p(3),c("value",120),p(2),c("value",180),p(2),c("value",210),p(3),b("ngModel",e.pinSizeMultiplier)}}function He(r,t){if(r&1&&(n(0,"ion-segment-button",40)(1,"ion-label"),l(2),o()()),r&2){let e=t.$implicit;H("value",e),p(2),I(e)}}function Qe(r,t){if(r&1){let e=v();n(0,"ion-content",14)(1,"div",14)(2,"h1"),l(3,"Generate Map"),o(),n(4,"p"),l(5),o()(),n(6,"ion-list",16)(7,"ion-item"),l(8,"Map Type"),o(),n(9,"ion-segment",33),M("ngModelChange",function(i){m(e);let s=d();return w(s.mapStyle,i)||(s.mapStyle=i),u(i)}),n(10,"ion-segment-button",34)(11,"ion-label"),l(12,"Outdoors"),o()(),n(13,"ion-segment-button",35)(14,"ion-label"),l(15,"Satellite"),o()(),n(16,"ion-segment-button",36)(17,"ion-label"),l(18,"Full"),o()(),n(19,"ion-segment-button",37)(20,"ion-label"),l(21,"Street"),o()(),n(22,"ion-segment-button",38)(23,"ion-label"),l(24,"Light"),o()(),n(25,"ion-segment-button",39)(26,"ion-label"),l(27,"Dark"),o()()()(),n(28,"ion-list",16)(29,"ion-item"),l(30,"Zoom Level"),o(),n(31,"ion-segment",33),M("ngModelChange",function(i){m(e);let s=d();return w(s.zoom,i)||(s.zoom=i),u(i)}),k(32,He,3,2,"ion-segment-button",40,L),o()()(),n(34,"ion-toolbar",31)(35,"ion-button",32),f("click",function(){m(e);let i=d();return u(i.createMap(i.mapStyle))}),l(36,"Create"),o()()}if(r&2){let e=d();p(5),W("Create an image of a map centered at the latitude and longitude of ",e.festivalTitle,"."),p(4),b("ngModel",e.mapStyle),c("value",e.mapStyle),p(22),b("ngModel",e.zoom),c("value",e.zoom),p(),z(Q(5,Re))}}function je(r,t){if(r&1){let e=v();n(0,"div",10)(1,"ion-button",32),f("click",function(){m(e),d();let i=F(17);return u(i.click())}),l(2,"Upload Map Image"),o()()}}function qe(r,t){if(r&1){let e=v();n(0,"div",41),f("click",function(i){m(e);let s=d();return u(s.mapPoint(i,!1))}),n(1,"div",42),l(2),o()()}if(r&2){let e=t.$implicit;N("left",e.px+"px")("top",e.py+"px"),c("title",e.label)("ngClass",e.class+" "+e.visible),p(2),I(e.label)}}function Ye(r,t){if(r&1&&(n(0,"app-note"),l(1),o()),r&2){let e=d();p(),I(e.mapNote)}}function Je(r,t){if(r&1){let e=v();n(0,"app-gps",44),f("gpsChange",function(i){m(e);let s=d(2);return u(s.applyGPS(i))}),o(),n(1,"app-note")(2,"b"),l(3,"Tip"),o(),l(4,": Right click in Google Maps to copy lat/long and paste here."),o()}if(r&2){let e=d(2);c("lat",e.selected.gpsLat)("lng",e.selected.gpsLng)}}function Xe(r,t){if(r&1){let e=v();n(0,"app-footer",15)(1,"ion-card",14)(2,"ion-title"),l(3),o(),n(4,"ion-list"),y(5,Je,5,2),o(),n(6,"ion-button",43),f("click",function(){m(e);let i=d();return u(i.delete())}),l(7,"Delete"),o()()()}if(r&2){let e=d();p(3),I(e.selected.label),p(2),S(e.selected&&e.selected.label==="GPS"?5:-1)}}var E=class E{constructor(t,e,a,i){this.api=t;this.sanitizer=e;this.location=a;this.alert=i;this.mapUri="";this.pinType="Restrooms";this.pins=[];this.title="";this.busy=!1;this.showGenMap=!1;this.showSettings=!1;this.uploading=!1;this.zoom="1";this.mapStyle="outdoors-v12";this.mapNote="";this.hasMap=!0;this.festivalTitle="";this.mapDirection=0;this.pinSizeMultiplier=1;we({trashBinOutline:be,cloudUploadOutline:Se,settingsOutline:Ce})}generateMap(){return()=>h(this,null,function*(){this.api.isAdmin(this.api.festivalId)?this.showGenMap=!0:this.api.sendMessage("This feature is not available to you.")})}openSettings(){return()=>h(this,null,function*(){this.api.isAdmin(this.api.festivalId)?(this.showSettings=!0,console.log(this.mapDirection)):this.api.sendMessage("This feature is not available to you.")})}clearCamps(){return()=>h(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield V(this.alert,"Are you sure you want to clear the locations of all theme camps?","Clear")))return;this.api.clearCamps(),this.api.sendMessage("Camp locations have been cleared from the map"),this.api.clearCache()}})}clearArt(){return()=>h(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield V(this.alert,"Are you sure you want to clear the locations of all art?","Clear")))return;this.api.clearArtLocations(),this.api.sendMessage("Art locations have been cleared from the map"),this.api.clearCache()}})}clearPins(){return()=>h(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield V(this.alert,"Are you sure you want to clear the locations of all other items (restrooms, gate etc)?","Clear")))return;yield this.api.clearPinLocations(),this.ionViewWillEnter(),this.api.sendMessage("Other locations have been cleared from the map"),this.api.clearCache()}})}uploadMap(t){return()=>h(this,null,function*(){console.log(t),t.click()})}onFileSelected(t){return h(this,null,function*(){let e=t.target.files[0];if(e)try{this.uploading=!0;let a=yield Pe(e);yield this.api.setMap(a),this.api.sendMessage("Map was uploaded"),this.ionViewWillEnter()}finally{this.uploading=!1}})}createMap(t){return h(this,null,function*(){this.showGenMap=!1,yield this.api.generateMap(t,parseInt(this.zoom)+12),this.ionViewWillEnter()})}applySettings(){return h(this,null,function*(){this.showSettings=!1;let t=yield this.api.getFestival(this.api.festivalId,{cached:!1});t.map_direction=this.mapDirection,t.pin_size_multiplier=this.pinSizeMultiplier,yield this.api.addFestival(t),this.api.clearCache(),this.ionViewWillEnter()})}ionViewWillEnter(){return h(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity);let t=yield this.api.getFestival(this.api.festivalId,{cached:!0});this.title="Map",this.festivalTitle=this.api.festivalTitle(),this.mapDirection=t.map_direction;let e=yield this.api.getMap();if(this.hasMap=!0,e.base64)this.mapUri=e?this.sanitizer.bypassSecurityTrustUrl(e.base64):"";else if(e.filename)this.mapUri=this.api.imageURL(`${this.vanity}/${e.filename}`);else{this.hasMap=!1,this.fileUpload.click();return}this.mapDirection=t.map_direction,this.pinSizeMultiplier=t.pin_size_multiplier,this.pins=yield this.api.getPins(),this.recalculate()})}typeChange(t){this.filter(t.detail.value)}filter(t){for(let e of this.pins)e.visible=e.label==t?"":"hidden"}mapPoint(t,e){console.log("clicked",t,e);let a=t.clientX,i=t.clientY,_=this.map.nativeElement.getBoundingClientRect(),g=(a-_.x)*1e4/_.width,x=(i-_.y)*1e4/_.height;if(!(this.selectPin(g,x)||!e)){if(this.selected){this.selected=void 0;return}this.pins.push({x:Math.ceil(g),y:Math.ceil(x),px:Math.ceil(g)*this.width()/1e4,py:Math.ceil(x)*this.height()/1e4,label:this.pinType,gpsLat:void 0,gpsLng:void 0}),this.setMapNote()}}delete(){this.pins=this.pins.filter(t=>t.class!=="selected"),this.selected=void 0}applyGPS(t){this.pins.map(e=>{e.class==="selected"&&this.selected&&(e.gpsLat=t.lat,e.gpsLng=t.lng)})}recalculate(){for(let t of this.pins)t.px=Math.ceil(t.x)*this.width()/1e4,t.py=Math.ceil(t.y)*this.height()/1e4;this.setMapNote()}setMapNote(){let t=this.pins.filter(e=>e.label=="GPS").length;this.mapNote=t>=3?"":'You will need to add at least 3 Pins of type "GPS" with GPS coordinates for the dust app to show distances.'}save(){return h(this,null,function*(){try{this.busy=!0;for(let t of this.pins)t.class=void 0,t.px=void 0,t.py=void 0,t.visible=void 0,t.gpsLat==0&&t.gpsLng==0&&(t.gpsLat=void 0,t.gpsLng=void 0);yield this.api.placePins(this.pins),this.location.back()}finally{this.busy=!1}})}width(){return this.map.nativeElement.getBoundingClientRect().width}height(){return this.map.nativeElement.getBoundingClientRect().height}selectPin(t,e){var s,_;console.log("selectPin",t,e);let a,i=-80;for(let g of this.pins){let x=this.dist(g,t+i,e+i),A=this.height()/5;console.log("d",x,A,JSON.stringify(g)),x<A?(this.selected=g,this.selected.label==="GPS"&&(g.gpsLat=(s=g.gpsLat)!=null?s:0,g.gpsLng=(_=g.gpsLng)!=null?_:0),g.class="selected",a=g,console.log(`Selected ${g.label}`)):g.class=void 0}return a}dist(t,e,a){let i=e-t.x,s=a-t.y;return Math.sqrt(i*i+s*s)}};E.\u0275fac=function(e){return new(e||E)(T(xe),T(X),T(q),T(Me))},E.\u0275cmp=D({type:E,selectors:[["app-pins"]],viewQuery:function(e,a){if(e&1&&(G(ke,5),G(ze,5)),e&2){let i;O(i=B())&&(a.map=i.first),O(i=B())&&(a.fileUpload=i.first)}},inputs:{vanity:"vanity"},decls:27,vars:10,consts:[["fileUpload",""],["map",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[3,"isOpen"],["type","file",1,"file-input",3,"change"],[1,"ion-text-center",2,"padding-top","45vh"],[1,"map"],[1,"pin",3,"title","ngClass","left","top"],[3,"resize","click","src"],[1,"ion-padding"],["width","300px"],["lines","none"],["labelPlacement","fixed","interface","popover","placeholder","Pin Types",3,"ionChange","ngModelChange","ngModel","value"],["value","Restrooms"],["value","Gate"],["value","Greeters"],["value","Shuttle Stop"],["value","Ice"],["value","Medical"],["value","GPS"],[3,"hideProfile","buttons"],[3,"ngModelChange","ngModel"],[1,"row"],["labelPlacement","end",3,"value"],["labelPlacement","start",3,"value"],["labelPlacement","stacked","label","Pin Size Multiplier","type","number",3,"ngModelChange","ngModel"],[1,"ion-text-center","ion-padding"],[3,"click"],["mode","ios",3,"ngModelChange","ngModel","value"],["value","outdoors-v12"],["value","satellite-v9"],["value","satellite-streets-v12"],["value","streets-v12"],["value","light-v11"],["value","dark-v11"],[3,"value"],[1,"pin",3,"click","title","ngClass"],[1,"label"],["shape","round","color","primary","mode","md",3,"click"],[3,"gpsChange","lat","lng"]],template:function(e,a){if(e&1){let i=v();n(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3),C(3,"ion-back-button"),o(),n(4,"ion-title",4),l(5),o(),n(6,"ion-buttons",5)(7,"ion-button",6),f("click",function(){return m(i),u(a.save())}),l(8,"Save"),o()()(),y(9,De,22,23,"ion-toolbar"),o(),n(10,"ion-content",7)(11,"ion-modal",8),y(12,Ne,34,10,"ng-template"),o(),n(13,"ion-modal",8),y(14,Qe,37,6,"ng-template"),o(),n(15,"div")(16,"input",9,0),f("change",function(_){return m(i),u(a.onFileSelected(_))}),o(),y(18,je,3,0,"div",10),n(19,"div",11),k(20,qe,3,7,"div",12,L),o(),n(22,"img",13,1),f("resize",function(){return m(i),u(a.recalculate())},!1,R)("click",function(_){return m(i),u(a.mapPoint(_,!0))}),o()(),C(24,"div",14),y(25,Ye,2,1,"app-note")(26,Xe,8,2,"app-footer",15),o()}e&2&&(p(5),W(" ",a.title," "),p(2),c("disabled",a.busy),p(2),S(a.hasMap?9:-1),p(),c("fullscreen",!0),p(),c("isOpen",a.showSettings),p(2),c("isOpen",a.showGenMap),p(5),S(a.hasMap?-1:18),p(2),z(a.pins),p(2),c("src",a.mapUri,U),p(3),S(a.hasMap?25:-1),p(),S(a.selected?26:-1))},dependencies:[he,me,ce,ve,fe,_e,te,se,Ee,oe,J,Y,$,Z,K,le,ge,ne,ee,ue,ie,pe,re,ye,de,ae,Te,Ie,Ve],styles:["img[_ngcontent-%COMP%]{user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-drag:none;-webkit-user-select:none;-ms-user-select:none}.placed[_ngcontent-%COMP%]{background-color:red!important;border:2px solid white!important;width:var(--pin-size-placed);height:var(--pin-size-placed);border-radius:var(--pin-size-placed)}.selected[_ngcontent-%COMP%]{background-color:#ff9191!important;border:3px solid red!important}.pin[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{visibility:hidden;width:100px;margin-left:var(--pin-size);margin-top:calc(var(---pin-size/2));color:#fff;background:#000;border-radius:10px;padding:3px;text-align:center}.pin[_ngcontent-%COMP%]:hover   .label[_ngcontent-%COMP%]{visibility:visible}.pin[_ngcontent-%COMP%]{width:var(--pin-size);height:var(--pin-size);border-radius:var(--pin-size);background-color:#fff;border:2px solid red;position:absolute;cursor:pointer}.hidden[_ngcontent-%COMP%]{opacity:.5}.map[_ngcontent-%COMP%]{position:absolute;--pin-size: 10px;--pin-size-placed: 15px}ion-select[_ngcontent-%COMP%]{margin-left:.5rem;padding-left:1rem;border:2px solid var(--ion-color-medium);border-radius:1rem;max-width:200px}.row[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between}ion-radio[_ngcontent-%COMP%]{padding:1rem}"]});var Le=E;export{Le as PinsPage};
