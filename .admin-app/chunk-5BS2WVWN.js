import{F as q}from"./chunk-MPA3GIYF.js";import"./chunk-XMQYHBKU.js";import{$ as m,D as w,F as M,G as a,I as u,Kb as F,L as k,Pa as L,Rb as j,Sb as H,V as y,W as b,Xa as O,Y as S,Z as E,Zb as Q,_ as I,_a as U,aa as p,ba as s,bc as A,ca as P,dc as N,ea as x,fa as g,ga as v,ka as T,la as V,ma as R,oc as $,pc as W,qa as C,rb as D,s as l,sa as h,t as c,ta as z,ua as B}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as f}from"./chunk-LNJ3S2LQ.js";var Y=["map"];function G(o,t){if(o&1&&(p(0,"div",12)(1,"div",13),h(2),s()()),o&2){let e=t.$implicit;C("left",e.x+"px")("top",e.y+"px"),m("title",e.label),a(2),z(e.label)}}function K(o,t){if(o&1&&P(0,"div",14),o&2){let e=v();C("left",e.pin.x+"px")("top",e.pin.y+"px"),m("title",e.pin.label)}}function Z(o,t){if(o&1){let e=x();p(0,"ion-footer",11)(1,"ion-button",15),g("click",function(){l(e);let n=v();return c(n.removePin())}),h(2,"Remove Pin"),s()()}if(o&2){let e=v();a(),m("disabled",e.busy)}}var d=class d{constructor(t,e,i,n){this.api=t;this.router=e;this.sanitizer=i;this.location=n;this.camp={name:"",description:"",pin:"",id:void 0,contact_email:"",camp_type:"",publicEvents:!1};this.mapUri="";this.pt={x:0,y:0};this.busy=!1;this.pins=[];this.camps=[]}ionViewWillEnter(){return f(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.camp=yield this.api.getCamp(this.id);let t=yield this.api.getMap();t.base64?this.mapUri=this.sanitizer.bypassSecurityTrustUrl(t.base64):this.mapUri=this.api.imageURL(`${this.vanity}/${t.filename}`),this.camps=yield this.api.camps({cached:!0})})}onResize(){this.pins=this.getPins(this.camps)}onMapLoad(){this.pins=this.getPins(this.camps)}mapPoint(t){let e=t.clientX,i=t.clientY,r=this.map.nativeElement.getBoundingClientRect(),_=(e-r.x)*1e4/r.width,X=(i-r.y)*1e4/r.height;return this.pt={x:Math.ceil(_),y:Math.ceil(X)},this.pin={x:this.pt.x*this.width()/1e4,y:this.pt.y*this.height()/1e4,label:this.camp.name},!1}width(){return this.map.nativeElement.getBoundingClientRect().width}height(){return this.map.nativeElement.getBoundingClientRect().height}getPins(t){let e=[];for(let i of t)if(i.pin&&i.pin.trim()!=""){let n=JSON.parse(i.pin);e.push({x:n.x*this.width()/1e4,y:n.y*this.height()/1e4,label:i.name})}return e}save(){return f(this,null,function*(){yield this.api.placeCamp(this.id,this.pt),this.api.clearCache(),this.location.back()})}removePin(){return f(this,null,function*(){this.busy=!0;try{yield this.api.placeCamp(this.id,void 0),this.api.clearCache(),this.location.back()}finally{this.busy=!1}})}};d.\u0275fac=function(e){return new(e||d)(u(q),u(U),u(O),u(L))},d.\u0275cmp=k({type:d,selectors:[["app-map"]],viewQuery:function(e,i){if(e&1&&T(Y,5),e&2){let n;V(n=R())&&(i.map=n.first)}},inputs:{vanity:"vanity",id:"id"},decls:18,vars:5,consts:[["map",""],["color","primary"],["slot","start"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"page2"],[1,"map"],[1,"pin",3,"title","left","top"],[1,"placed","pin",3,"title","left","top"],[3,"load","resize","click","src"],[1,"ion-padding","ion-text-center"],[1,"pin",3,"title"],[1,"label"],[1,"placed","pin",3,"title"],[3,"click","disabled"]],template:function(e,i){if(e&1){let n=x();p(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),P(3,"ion-back-button"),s(),p(4,"ion-title"),h(5),s(),p(6,"ion-buttons",3)(7,"ion-button",4),g("click",function(){return l(n),c(i.save())}),h(8,"Save"),s()()()(),p(9,"ion-content",5)(10,"div",6)(11,"div",7),E(12,G,3,6,"div",8,S),y(14,K,1,5,"div",9),s(),p(15,"img",10,0),g("load",function(){return l(n),c(i.onMapLoad())})("resize",function(){return l(n),c(i.onResize())},M)("click",function(_){return l(n),c(i.mapPoint(_))}),s()()(),y(17,Z,3,1,"ion-footer",11)}e&2&&(a(5),B("Place ",i.camp.name," on Map"),a(4),m("fullscreen",!0),a(3),I(i.pins),a(2),b(i.pin?14:-1),a(),m("src",i.mapUri,w),a(2),b(i.camp.pin&&i.camp.pin.length>0?17:-1))},dependencies:[A,D,N,W,H,F,$,j,Q],styles:["img[_ngcontent-%COMP%]{user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-drag:none;-webkit-user-select:none;-ms-user-select:none}.placed[_ngcontent-%COMP%]{background-color:red!important;border:2px solid white!important;width:15px;height:15px;border-radius:15px}.pin[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:10px;background-color:#fff;border:2px solid red;position:absolute}.pin[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{visibility:hidden;width:200px;margin-left:10px;margin-top:-5px}.pin[_ngcontent-%COMP%]:hover   .label[_ngcontent-%COMP%]{visibility:visible}.map[_ngcontent-%COMP%]{position:absolute}"]});var J=d;export{J as MapPage};
