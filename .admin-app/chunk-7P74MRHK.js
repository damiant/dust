import{a as ne}from"./chunk-MJQX2BRQ.js";import"./chunk-ZDD63VW5.js";import{a as te}from"./chunk-WENQGBHZ.js";import"./chunk-TUKQZ63R.js";import{V as ie,c as X,d as $,o as ee}from"./chunk-2QPEVPNK.js";import{E as Q,e as G,g as M}from"./chunk-GUYT2OMO.js";import{a as J}from"./chunk-MIGJGGKJ.js";import{$b as W,A as c,B as d,Ca as p,Da as b,Ea as w,Ha as I,Ia as A,Ja as T,L as P,Ra as S,S as a,T as x,Tb as N,Ub as z,Vb as F,Wb as U,Y as V,aa as u,ea as C,eb as k,fc as j,gc as L,ha as m,ic as D,la as r,ma as l,na as _,nb as E,ob as R,pa as y,qa as f,qc as H,ra as s,rc as Z,sb as O,tb as B,tc as K,xc as Y,yc as q}from"./chunk-6CV35SS5.js";import"./chunk-ATW7DGUS.js";import"./chunk-7KGURMOZ.js";import"./chunk-UXWCR2YA.js";import"./chunk-QYFQMV2H.js";import"./chunk-ORVKXEJA.js";import"./chunk-KBMMZLX2.js";import"./chunk-5J6JP6Q2.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as g}from"./chunk-LNJ3S2LQ.js";function ae(i,t){if(i&1){let e=y();r(0,"ion-buttons",1)(1,"ion-button",12),f("click",function(){c(e);let n=s();return d(n.clear())}),_(2,"ion-icon",13),l()()}}function re(i,t){if(i&1){let e=y();r(0,"ion-button",12),f("click",function(){c(e);let n=s();return d(n.close())}),_(1,"ion-icon",14),l()}}function le(i,t){i&1&&_(0,"app-spinner")}function se(i,t){if(i&1&&(r(0,"div",6)(1,"h1"),p(2),l()()),i&2){let e=s();a(2),b(e.title())}}function ce(i,t){if(i&1&&(_(0,"app-festival-header",15),r(1,"p",7),p(2),l()),i&2){let e=s();C("festival",e.festival),a(2),w("Sign in using your email address to register or manage camps, art and events of ",e.festival==null?null:e.festival.name,"")}}function de(i,t){if(i&1&&(r(0,"div",7)(1,"p"),p(2),l()()),i&2){let e=s();a(2),b(e.redirectMessage())}}function me(i,t){if(i&1){let e=y();r(0,"ion-item")(1,"ion-input",16),f("keyup.enter",function(){c(e);let n=s();return d(n.next())}),T("ngModelChange",function(n){c(e);let v=s();return A(v.email,n)||(v.email=n),d(n)}),l()(),r(2,"p",17),p(3,"You will be emailed a verification code."),l()}if(i&2){let e=s();a(),I("ngModel",e.email)}}function pe(i,t){if(i&1){let e=y();r(0,"ion-item")(1,"ion-input",18),f("keyup.enter",function(){c(e);let n=s();return d(n.next())})("ionInput",function(){c(e);let n=s();return d(n.changed())}),T("ngModelChange",function(n){c(e);let v=s();return A(v.code,n)||(v.code=n),d(n)}),l()(),r(2,"p",17),p(3),l()}if(i&2){let e=s();a(),I("ngModel",e.code),a(2),w("Enter the verification code that was emailed to ",e.email,".")}}function ue(i,t){i&1&&_(0,"ion-icon",11)}var h=class h{constructor(t,e,o){this.alert=t;this.api=e;this.router=o;this.email="";this.code="";this.vanity=P("");this.busy=!1;this.redirecting=P(!1);this.redirectType="none";this.emailPage=!0;this.isNative=J.isNativePlatform();this.title=S(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"Register a camp";case"event":return"Register an event";default:return"Sign In"}return"Sign In"});this.redirectMessage=S(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"To register a camp we first need an email address.";case"event":return"To register a event we first need an email address.";default:return""}return""});ie({arrowBack:X,close:ee,arrowForwardOutline:$})}ionViewWillEnter(){return g(this,null,function*(){var e;this.vanity.set((e=sessionStorage.sendVanity)!=null?e:""),this.vanity()!==""&&(this.festival=yield this.api.getUnAuthedFestivalByVanity(this.vanity()));let t=this.api.getRedirectionUrl();this.redirectType="none",t&&t.includes("/camps")&&(this.redirectType="camp"),t&&t.includes("/events")&&(this.redirectType="event"),this.redirecting.set(!!t&&t!=="")})}close(){return g(this,null,function*(){document.location.href="index.html"})}next(){return g(this,null,function*(){if(this.emailPage){if(!this.validateEmail(this.email)){this.presentAlert("The email address is invalid");return}try{this.busy=!0,yield this.api.signIn(this.email),this.emailPage=!1}finally{this.busy=!1}}else{let t=this.code.toString().padStart(6,"0");if(!this.code||t.length!==6){this.presentAlert("The verification code is incorrect");return}this.signIn(t)}})}signIn(t){return g(this,null,function*(){try{this.busy=!0,yield M(1e3),yield this.api.verify(t),yield M(1e3),this.emailPage=!0,this.code="",this.email="";let e=this.api.getRedirectionUrl();if(this.api.clearCache(),!e||e==""){let o=sessionStorage.sendVanity,n="/all";G(o)||(n=`/${o}`,console.log("sendVanity",n)),this.router.navigateByUrl(n,{replaceUrl:!0})}else{if(e=="none"){this.api.setRedirection("");return}console.log(`Redirect to ${e}`),this.api.setRedirection("none"),this.router.navigateByUrl(e,{replaceUrl:!0})}}finally{this.busy=!1}})}changed(){setTimeout(()=>{let t=`${this.code}`;t.length==6&&this.signIn(t)},500)}presentAlert(t){return g(this,null,function*(){yield(yield this.alert.create({header:"Message",message:t,buttons:["OK"]})).present()})}clear(){this.code="",this.emailPage=!0}validateEmail(t){return!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}};h.\u0275fac=function(e){return new(e||h)(x(K),x(Q),x(k))},h.\u0275cmp=V({type:h,selectors:[["app-auth"]],decls:23,vars:10,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"fullscreen"],[1,"border"],[1,"ion-text-center"],[1,"h1-container"],[1,"ion-padding"],["lines","none"],[1,"row-center","ion-padding"],["size","large","shape","round","color","primary",3,"click","disabled"],["name","arrow-forward-outline"],[3,"click"],["name","arrow-back"],["size","small","name","close",1,"close"],[3,"festival"],["name","emailAddress","id","emailAddress","type","email","label","Email Address","labelPlacement","stacked",3,"keyup.enter","ngModelChange","ngModel"],[1,"helper"],["type","number","inputMode","numeric","pattern","[0-9]*","label","Verification Code","labelPlacement","stacked",3,"keyup.enter","ionInput","ngModelChange","ngModel"]],template:function(e,o){e&1&&(r(0,"ion-header")(1,"ion-toolbar",0),u(2,ae,3,0,"ion-buttons",1),r(3,"ion-title"),p(4,"dust"),l(),r(5,"ion-buttons",2),u(6,re,2,0,"ion-button"),l()()(),r(7,"ion-content",3),u(8,le,1,0,"app-spinner"),r(9,"div",4)(10,"ion-card")(11,"ion-card-content",5),u(12,se,3,1,"div",6)(13,ce,3,2)(14,de,3,1,"div",7),r(15,"ion-list",8),u(16,me,4,1)(17,pe,4,2),r(18,"ion-item")(19,"div",9)(20,"ion-button",10),f("click",function(){return o.next()}),p(21),u(22,ue,1,0,"ion-icon",11),l()()()()()()()()),e&2&&(a(2),m(o.emailPage?-1:2),a(4),m(o.isNative?6:-1),a(),C("fullscreen",!0),a(),m(o.busy?8:-1),a(4),m(o.vanity()===""?12:13),a(2),m(o.redirecting()?14:-1),a(2),m(o.emailPage?16:17),a(4),C("disabled",o.busy),a(),w("",o.emailPage?"Next":"Sign In"," "),a(),m(o.emailPage?22:-1))},dependencies:[z,Y,B,E,O,R,j,Z,H,W,ne,F,U,D,L,q,N,te],styles:["h1[_ngcontent-%COMP%]{font-size:var(--fr2);color:var(--ion-color-primary);padding-top:2rem}.h1-container[_ngcontent-%COMP%]{width:100%;border-radius:.5rem;display:flex;align-items:center;justify-content:center;margin-left:auto;margin-right:auto}p[_ngcontent-%COMP%]{font-size:var(--fr3)}@media (min-width: 801px){ion-card[_ngcontent-%COMP%]{margin-left:100px;margin-right:100px}}.helper[_ngcontent-%COMP%]{font-size:var(--fs5);color:var(--ion-text-color)}ion-button[_ngcontent-%COMP%]{width:200px}.close[_ngcontent-%COMP%]{color:#fff!important}"]});var oe=h;export{oe as AuthPage};
