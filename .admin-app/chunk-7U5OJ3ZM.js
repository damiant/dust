import{a as ke,b as Le}from"./chunk-6EZPDH6L.js";import{a as Oe}from"./chunk-XGEMISMR.js";import"./chunk-HSBV6RIN.js";import{a as Te}from"./chunk-KCPLCCSF.js";import{a as Ve}from"./chunk-GKO5FLMM.js";import{a as Pe}from"./chunk-5EUBO754.js";import{a as Ie,c as m}from"./chunk-OZ2IKH4J.js";import"./chunk-ZHFJF7NS.js";import"./chunk-A5RC3O7B.js";import"./chunk-CVA27SDO.js";import"./chunk-U5OWWBBZ.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-L4IPHJNS.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-ZMJ3RQA5.js";import"./chunk-MCRJI3T3.js";import"./chunk-QDGYTOUC.js";import"./chunk-VLNXCBKY.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import{aa as Me,b as Ee,q as Se}from"./chunk-TF5OT4X3.js";import{F as xe,I as we,c as ye,e as be,l as f,m as V,o as F,p as R,q as D,r as z,t as W,u as B,v as Ce}from"./chunk-CXIDEVKY.js";import"./chunk-PFLI22GG.js";import{$ as L,$b as oe,Aa as A,Cc as ue,D as N,Dc as ve,Ea as T,Fa as E,G as r,Ga as S,Ic as ge,Jc as fe,O as $,Ra as Z,Rb as te,W as y,Wa as G,X as b,Yb as ie,Z as O,Zb as ne,_ as k,_b as ae,aa as _,ba as s,ca as l,da as x,db as H,ec as re,ia as w,jb as J,ka as v,kc as se,lc as le,ma as c,nc as ce,ob as K,oc as de,p as M,rb as Y,s as d,sc as pe,t as p,va as j,vc as he,wb as Q,wc as _e,ya as q,yb as X,yc as me,za as u,zb as ee}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as C}from"./chunk-LNJ3S2LQ.js";function We(o,t){if(o&1&&(s(0,"ion-select-option",12),u(1),l()),o&2){let e=t.$implicit;_("value",e.id),r(),A(e.name)}}function Ae(o,t){if(o&1){let e=w();s(0,"ion-item",9)(1,"ion-select",25),v("ionChange",function(i){d(e);let a=c(2);return p(a.locationChange(i))}),S("ngModelChange",function(i){d(e);let a=c(2);return E(a.eventLocation,i)||(a.eventLocation=i),p(i)}),k(2,We,2,2,"ion-select-option",12,O),l()()}if(o&2){let e=c(2);r(),_("value",e.eventLocation),T("ngModel",e.eventLocation),r(),L(e.locations)}}function Fe(o,t){if(o&1){let e=w();s(0,"ion-item",9)(1,"ion-input",26),S("ngModelChange",function(i){d(e);let a=c(2);return E(a.event.other_location,i)||(a.event.other_location=i),p(i)}),l()()}if(o&2){let e=c(2);r(),T("ngModel",e.event.other_location)}}function Re(o,t){o&1&&(s(0,"ion-item")(1,"ion-note",27),u(2," Please describe the location of your event. If your event is at a theme camp or art then it is best to coordinate with the camp/art lead to have them add your event. If you are a theme camp / art lead then be sure to register your camp before adding events."),l()())}function ze(o,t){if(o&1&&(s(0,"ion-select-option",12),u(1),l()),o&2){let e=t.$implicit;_("value",e),r(),A(e)}}function Be(o,t){if(o&1&&x(0,"img",16),o&2){let e=c(2);_("src",e.imageUrl,N)}}function Ue(o,t){o&1&&(s(0,"p"),u(1,"Click to choose an optional image for this event"),l())}function Ne(o,t){if(o&1){let e=w();s(0,"div",18)(1,"div",28)(2,"app-date-range",29),v("allDayChanged",function(i){let a=d(e).$implicit,g=c(2);return p(g.allDayChanged(a,i))})("endChanged",function(i){let a=d(e).$implicit,g=c(2);return p(g.endChanged(a,i))})("startChanged",function(i){let a=d(e).$implicit,g=c(2);return p(g.startChanged(a,i))}),l()(),s(3,"div",30)(4,"app-tooltip",31)(5,"ion-button",32),v("click",function(){let i=d(e).$implicit,a=c(2);return p(a.deleteItem(i))}),x(6,"ion-icon",33),l()()()()}if(o&2){let e=t.$implicit,n=t.$index,i=c(2);r(2),_("label",n===0?"":"Repeats")("minTime",i.minTime)("maxTime",i.maxTime)("id",e.id.toString())("startTime",e.start)("endTime",e.end),r(3),_("hidden",i.occurrences.length===1)}}function $e(o,t){if(o&1){let e=w();s(0,"ion-button",23),v("click",function(){d(e);let i=c(2);return p(i.delete())}),u(1,"Delete"),l(),u(2,"\xA0 ")}}function je(o,t){o&1&&(s(0,"ion-button",20),u(1,"\xA0"),l())}function qe(o,t){if(o&1){let e=w();s(0,"div",6)(1,"ion-card",7)(2,"ion-card-content",8)(3,"ion-list"),y(4,Ae,4,2,"ion-item",9),y(5,Fe,2,1,"ion-item",9),y(6,Re,3,0,"ion-item"),s(7,"ion-item",10)(8,"ion-select",11),S("ngModelChange",function(i){d(e);let a=c();return E(a.event.event_type,i)||(a.event.event_type=i),p(i)}),k(9,ze,2,2,"ion-select-option",12,O),l()(),s(11,"ion-item",9)(12,"ion-input",13),S("ngModelChange",function(i){d(e);let a=c();return E(a.event.title,i)||(a.event.title=i),p(i)}),l()(),s(13,"ion-item",9)(14,"ion-textarea",14),v("ionInput",function(){d(e);let i=c();return p(i.descriptionChanged())}),S("ngModelChange",function(i){d(e);let a=c();return E(a.event.description,i)||(a.event.description=i),p(i)}),l()(),s(15,"div",15),v("click",function(){d(e);let i=j(30);return p(i.click())}),y(16,Be,1,1,"img",16),y(17,Ue,2,0,"p"),l(),x(18,"div",17),k(19,Ne,7,7,"div",18,O),l(),s(21,"div",19),y(22,$e,3,0)(23,je,2,0,"ion-button",20),s(24,"ion-button",21),v("click",function(){d(e);let i=c();return p(i.save())}),u(25,"Save"),l(),s(26,"app-tooltip",22)(27,"ion-button",23),v("click",function(){d(e);let i=c();return p(i.addItem())}),u(28,"Add Occurrence"),l()()(),s(29,"input",24,0),v("change",function(i){d(e);let a=c();return p(a.onFileSelected(i))}),l()()()()}if(o&2){let e=c();r(),_("disabled",!(e.isOwner||e.isAdmin)),r(3),b(e.openRegistration?-1:4),r(),b(!e.event.hosted_by_camp&&!e.event.located_at_art?5:-1),r(),b(e.openRegistration?6:-1),r(2),_("multiple",!0)("value",e.event.event_type),T("ngModel",e.event.event_type),r(),L(e.eventTypes),r(3),T("ngModel",e.event.title),r(2),_("spellcheck",!0)("rows",6)("autoGrow",!0),T("ngModel",e.event.description),_("maxlength",1e3)("helperText",e.helperText),r(),q(e.uploading?"disabled":""),r(),b(e.imageUrl?16:-1),r(),b(e.imageUrl?-1:17),r(2),L(e.occurrences),r(3),b(e.id?22:23),r(2),_("disabled",e.busy)}}function Ze(o,t){o&1&&x(0,"app-spinner")}var P=class P{constructor(){this.api=M(we);this.alert=M(me);this.location=M(G);this.route=M(H);this.vanity=Z();this.busy=!0;this.helperText="";this.event={description:"",title:"",occurrence_set:"[]",hosted_by_camp:void 0,id:void 0,event_type:"Event"};this.minTime=new Date().toISOString();this.maxTime=new Date().toISOString();this.locations=[];this.uploading=!1;this.isOwner=!1;this.isAdmin=!1;this.atArt=!1;this.openRegistration=!1;this.imageChanged=!1;this.beforeDescription="";this.occurrences=[];this.eventTypes=[];this.musicTypes=[];this.timezone=this.api.currentTimeZone();Me({addOutline:Ee,closeOutline:Se})}ionViewWillEnter(){return C(this,null,function*(){var g,I,U;this.busy=!0,yield this.api.setFestivalByVanity(this.vanity()),this.id=f(this.id);let t=yield this.api.camps({cached:!0},!0),e=yield this.api.art({cached:!0});this.locations=[],t.map(h=>this.locations.push({id:"c-"+h.id,name:`${h.name}`,type:"camp"})),e.map(h=>this.locations.push({id:"a-"+h.id,name:`${h.name} \u{1F3A8}`,type:"art"})),this.locations.push({id:"o-1",name:"Open Camping / Other",type:"other"}),this.openRegistration=!1,t.length==0&&e.length==0&&(this.openRegistration=!0);let n=yield this.api.getFestival(this.api.festivalId,{cached:!0});this.timezone=n.timezone,this.eventTypes=n.event_types?n.event_types.split(`
`):ke,this.musicTypes=n.music_types?n.music_types.split(`
`):Le,this.timezone||(this.timezone=this.api.currentTimeZone());let i=!this.id;i?(this.event=yield this.api.newEvent(),this.event.hosted_by_camp=this.route.snapshot.queryParams.camp,this.event.located_at_art=this.route.snapshot.queryParams.art,!this.event.hosted_by_camp&&!this.event.located_at_art&&(t.length>0?this.event.hosted_by_camp=t[0].id:e.length>0&&(this.event.located_at_art=`${e[0].id}`))):this.event=yield this.api.getEvent(this.id),this.event.hosted_by_camp&&(this.event.hosted_by_camp=Math.trunc(this.event.hosted_by_camp)),this.event.event_type=this.event.event_type.split(","),this.isOwner=this.api.isCampOwner(n.id,this.event.hosted_by_camp)||this.api.isArtOwner(n.id,f(this.event.located_at_art))||(yield this.api.isEventOwner(f(this.event.id)))||i,this.isAdmin=this.api.isAdmin(n.id),this.isAdmin&&this.event.contact&&(this.helperText=`Created by ${this.event.contact}`),this.event.hosted_by_camp?this.eventLocation=(g=this.locations.find(h=>h.id===`c-${f(this.event.hosted_by_camp)}`))==null?void 0:g.id:this.event.located_at_art?this.eventLocation=(I=this.locations.find(h=>h.id===`a-${f(this.event.located_at_art)}`))==null?void 0:I.id:this.eventLocation=(U=this.locations.find(h=>h.type==="other"))==null?void 0:U.id;let a=JSON.parse(this.event.occurrence_set);if(this.occurrences=[],a.length>0)for(let h of a)this.occurrences.push({start:W(h.start_time),end:W(h.end_time),id:this.occurrences.length+1});this.imageUrl=this.api.imageURL(this.event.imageUrl),this.minTime=n.start_time,this.maxTime=W(F(V(n.end_time),12).toISOString()),this.id||this.occurrences.push({start:n.start_time,end:D(R(V(n.start_time),60)),id:1}),this.busy=!1})}locationChange(t){let e=t.detail.value.startsWith("c-")?f(t.detail.value.substring(2)):void 0,n=t.detail.value.startsWith("a-")?f(t.detail.value.substring(2)):void 0;e?this.event.hosted_by_camp=e:n?(this.event.located_at_art=`${n}`,this.event.hosted_by_camp=void 0):(this.event.hosted_by_camp=void 0,this.event.located_at_art=void 0)}startChanged(t,e){if(t.start=e,t.end.endsWith("23:59:59")){t.start=t.start.substring(0,10)+"T00:00:00",t.end=t.start.substring(0,10)+"T23:59:59";return}t.end=D(F(V(e),1))}endChanged(t,e){t.end=e}allDayChanged(t,e){e&&(t.end=t.start.substring(0,10)+"T23:59:59",t.start=t.start.substring(0,10)+"T00:00:00")}addItem(){let t=this.occurrences[this.occurrences.length-1].end;this.occurrences.push({id:this.occurrences.length+1,start:t,end:D(R(V(t),60))})}deleteItem(t){this.occurrences.length!=1&&(this.occurrences=this.occurrences.filter(e=>e.id!==t.id))}save(){return C(this,null,function*(){Ce(this.event);let t=[];for(let e of this.occurrences){let n=new Date(e.start+B(this.timezone)),i=new Date(e.end+B(this.timezone)),a=Math.round((i-n)/1e3/60);if(a<0){yield m(this.alert,"The end time must be after the start time");return}if(a<15){yield m(this.alert,"The event must be at least 15 minutes long");return}if(a>1440&&!this.isAllDay(e)){yield m(this.alert,"The event cannot be longer than 12 hours. For longer events consider adding to your camp description.");return}if(this.event.event_type==""||this.event.event_type.length==0){yield m(this.alert,"The event type must be selected.");return}else if(Array.isArray(this.event.event_type)){let g=yield this.api.getFestival(this.api.festivalId,{cached:!0}),I=ye(g.max_event_types,2);if(this.event.event_type.length>I){yield m(this.alert,`You can choose at most ${I} event types.`);return}this.event.event_type=this.event.event_type.join(",")}if(this.event.title.length<4){yield m(this.alert,"The event title must be set (and longer than 4 characters).");return}if(this.event.event_type==="Event"){yield m(this.alert,"Select at least one event type.");return}if(this.event.description.length<20){yield m(this.alert,"The event description must be set (and longer than 20 characters).");return}if(this.event.description=z(this.event.description),this.event.title=z(this.event.title),this.applyLocation(),!this.event.hosted_by_camp||isNaN(this.event.hosted_by_camp)){if(!this.event.located_at_art&&!this.openRegistration&&!this.event.other_location){yield m(this.alert,"Select the location of the event");return}if(this.openRegistration&&be(this.event.other_location)){yield m(this.alert,"Describe the location of the event");return}this.openRegistration}t.push({start_time:e.start,end_time:e.end})}this.event.occurrence_set=JSON.stringify(t),this.busy=!0;try{let e=yield this.api.addEvent(this.event);this.api.clearCache(),e.message?(this.busy=!1,m(this.alert,e.message)):(e.id&&this.imageChanged&&(yield this.uploadImage(e.id)),this.event.id,this.isAdmin||(yield this.api.setKey(),yield m(this.alert,`The changes you have made will be reviewed by ${this.api.festivalTitle()} prior to publishing in the app.`,"Note")),this.location.back())}finally{this.busy=!1}})}applyLocation(){let t=this.locations.find(e=>e.id===this.eventLocation);t&&t.id&&(t.type==="camp"?(this.event.hosted_by_camp=f(t.id.substring(2)),this.event.other_location=void 0,this.event.located_at_art=void 0):t.type==="art"?(this.event.located_at_art=`${f(t.id.substring(2))}`,this.event.other_location=void 0,this.event.hosted_by_camp=void 0):(this.event.hosted_by_camp=void 0,this.event.located_at_art=void 0))}isAllDay(t){return t.start.endsWith("00:00:00")&&t.end.endsWith("23:59:59")}delete(){return C(this,null,function*(){(yield Ie(this.alert,"Are you sure you want to delete this event?"))&&(yield this.api.deleteEvent(this.event.id),this.api.clearCache(),this.location.back())})}uploadImage(t){return C(this,null,function*(){if(this.blob)try{this.uploading=!0,this.event.imageUrl=yield this.api.setImage(this.blob,t),yield this.api.addEvent(this.event)}finally{this.uploading=!1,this.imageChanged=!1}})}descriptionChanged(){this.event.description.length-this.beforeDescription.length>10&&(this.event.description=xe(this.event.description)),this.beforeDescription=this.event.description}onFileSelected(t){return C(this,null,function*(){let e=t.target.files[0];if(!e)return;this.blob=yield Te(e,{quality:75,width:300});let n=URL.createObjectURL(this.blob);this.imageUrl=n,this.imageChanged=!0})}};P.\u0275fac=function(e){return new(e||P)},P.\u0275cmp=$({type:P,selectors:[["app-event"]],inputs:{id:"id",vanity:[1,"vanity"]},decls:12,vars:2,consts:[["fileUpload",""],["color","primary"],["slot","start"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"border"],[1,"form",3,"disabled"],[1,"form"],["lines","none"],["lines","none",1,"app-select","ion-padding-top"],["labelPlacement","stacked","label","Type","interface","popover","placeholder","Select the type of event",1,"app-select",3,"ngModelChange","multiple","value","ngModel"],[3,"value"],["label","Title","labelPlacement","stacked","placeholder","Title of the event",3,"ngModelChange","ngModel"],["lines","none","labelPlacement","stacked","label","Description","placeholder","Description of the event",3,"ionInput","ngModelChange","spellcheck","rows","autoGrow","ngModel","maxlength","helperText"],[1,"image-container","center",3,"click"],[3,"src"],[1,"ion-padding-top"],[2,"display","flex","border-bottom","1px solid var(--ion-color-light)","margin-bottom","8px"],[1,"horizontal",2,"padding-left","1rem","padding-right","1rem"],["fill","clear"],[3,"click","disabled"],["text","Add occurrence"],["color","secondary",3,"click"],["type","file",1,"file-input",3,"change"],["label","Location","labelPlacement","stacked","interface","popover","placeholder","Select location of event",1,"app-select",3,"ionChange","ngModelChange","value","ngModel"],["labelPlacement","stacked","label","Location Description","placeholder","Description of the location",3,"ngModelChange","ngModel"],[1,"ion-padding-start","ion-padding-end","ion-padding-bottom"],[1,"wide","range"],["size","wide",3,"allDayChanged","endChanged","startChanged","label","minTime","maxTime","id","startTime","endTime"],[2,"width","60px","padding-top","32px"],["position","right","text","Remove this occurrence"],["color","secondary",3,"click","hidden"],["size","small","name","close-outline"]],template:function(e,n){e&1&&(s(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),x(3,"ion-back-button"),l(),s(4,"ion-title"),u(5,"Event"),l(),s(6,"ion-buttons",3)(7,"ion-button",4),v("click",function(){return n.save()}),u(8,"Save"),l()()()(),s(9,"ion-content",5),y(10,qe,31,20,"div",6)(11,Ze,1,0,"app-spinner"),l()),e&2&&(r(9),_("fullscreen",!0),r(),b(n.busy?11:10))},dependencies:[de,ue,X,K,Q,Y,J,se,_e,ne,te,he,re,ae,oe,ce,le,ge,pe,ve,fe,Ve,Oe,ie,Pe,ee],styles:[".horizontal[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.bottom-line[_ngcontent-%COMP%]{border-bottom:1px solid var(--ion-color-light)}.range[_ngcontent-%COMP%]{padding-left:1.5rem}"]});var De=P;export{De as EventPage};
