import{a as ze}from"./chunk-VDXUCHAY.js";import{a as Oe}from"./chunk-Q7SRVC5Z.js";import{a as Le}from"./chunk-NIJZXRAZ.js";import{a as Ge}from"./chunk-MTVNVIRQ.js";import{a as Be}from"./chunk-Z5HZYXFK.js";import{a as ke}from"./chunk-GPVDUW6Q.js";import{a as we}from"./chunk-KCPLCCSF.js";import{a as Ie}from"./chunk-5B2MUMUK.js";import{a as k}from"./chunk-OZ2IKH4J.js";import"./chunk-ZHFJF7NS.js";import"./chunk-A5RC3O7B.js";import"./chunk-CVA27SDO.js";import"./chunk-U5OWWBBZ.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-L4IPHJNS.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-ZMJ3RQA5.js";import"./chunk-MCRJI3T3.js";import"./chunk-QDGYTOUC.js";import"./chunk-VLNXCBKY.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import{ca as Ee,fa as Te,ja as Ve,y as Me}from"./chunk-LIWDDRYP.js";import{C as xe,K as Se}from"./chunk-OQVFSD37.js";import"./chunk-PFLI22GG.js";import{$ as B,Aa as r,Ac as ue,Ba as V,Bc as ge,Ca as A,Db as ie,Dc as he,E as D,Ec as _e,Fa as S,Fc as fe,G as N,Ga as w,H as p,Ha as M,Ia as Q,La as X,Ma as x,Nc as ve,Oa as Z,Oc as ye,P as q,Pc as Pe,Rc as Ce,Sc as be,T as z,Ua as Y,Wb as ne,X as P,Xb as ae,Y as C,Za as j,_ as L,_a as J,aa as G,ba as c,ca as n,cc as oe,da as a,db as K,dc as le,ea as b,ec as re,gb as $,ja as y,la as f,lc as se,na as d,p as I,ra as O,rc as pe,s as u,sa as W,sc as ce,t as g,ta as F,tb as ee,uc as de,vc as me,w as R,wa as U,wb as te,xa as H}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var Fe=["map"],Ue=["fileUpload"],Ae=o=>({title:"Upload Map Image",method:o,icon:"cloud-upload-outline"}),Re=o=>({title:"Generate Map",method:o,icon:"map-outline"}),De=o=>({title:"Settings",method:o,icon:"settings-outline"}),Ne=o=>({title:"Clear Camp Locations",method:o,icon:"trash-bin-outline"}),qe=o=>({title:"Clear Art Locations",method:o,icon:"trash-bin-outline"}),He=o=>({title:"Clear Other Locations",method:o,icon:"trash-bin-outline"}),Qe=(o,t,e,l,i,s)=>[o,t,e,l,i,s],Xe=()=>["1","2","3","4","5"];function Ze(o,t){if(o&1){let e=y();n(0,"ion-toolbar")(1,"ion-list")(2,"ion-item",18)(3,"ion-text"),r(4,"Click on the map to place a"),a(),n(5,"ion-select",19),f("ionChange",function(i){u(e);let s=d();return g(s.typeChange(i))}),M("ngModelChange",function(i){u(e);let s=d();return w(s.pinType,i)||(s.pinType=i),g(i)}),n(6,"ion-select-option",20),r(7,"Restroom"),a(),n(8,"ion-select-option",21),r(9,"Gate"),a(),n(10,"ion-select-option",22),r(11,"Greeter Station"),a(),n(12,"ion-select-option",23),r(13,"Shuttle Stop"),a(),n(14,"ion-select-option",24),r(15,"Ice"),a(),n(16,"ion-select-option",25),r(17,"Medical Station"),a(),n(18,"ion-select-option",26),r(19,"GPS"),a()()()(),n(20,"ion-buttons",5),b(21,"app-side",27),a()()}if(o&2){let e=d(),l=U(19);p(5),S("ngModel",e.pinType),c("value",e.pinType),p(16),c("hideProfile",!0)("buttons",Z(16,Qe,x(4,Ae,e.uploadMap(l)),x(6,Re,e.generateMap()),x(8,De,e.openSettings()),x(10,Ne,e.clearCamps()),x(12,qe,e.clearArt()),x(14,He,e.clearPins())))}}function Ye(o,t){o&1&&b(0,"app-spinner",8)}function je(o,t){o&1&&b(0,"app-progress-overlay",9)}function Je(o,t){if(o&1){let e=y();n(0,"ion-content",16)(1,"div",16)(2,"h1"),r(3,"Map Settings"),a(),n(4,"p"),r(5," Choose the direction that North is point on the map."),b(6,"br"),r(7,"This is used to ensure a persons pin on the map is facing the correct direction. "),a(),n(8,"ion-radio-group",28),M("ngModelChange",function(i){u(e);let s=d();return w(s.mapDirection,i)||(s.mapDirection=i),g(i)}),n(9,"div",29)(10,"ion-radio",30),r(11,"Top Left"),a(),n(12,"ion-radio",30),r(13,"Top"),a(),n(14,"ion-radio",31),r(15,"Top Right"),a()(),n(16,"div",29)(17,"ion-radio",30),r(18,"Left"),a(),b(19,"div"),n(20,"ion-radio",31),r(21,"Right"),a()(),n(22,"div",29)(23,"ion-radio",30),r(24,"Bottom Right"),a(),n(25,"ion-radio",30),r(26,"Bottom"),a(),n(27,"ion-radio",31),r(28,"Bottom Left"),a()(),n(29,"div",29)(30,"ion-input",32),M("ngModelChange",function(i){u(e);let s=d();return w(s.pinSizeMultiplier,i)||(s.pinSizeMultiplier=i),g(i)}),a()()()()(),n(31,"ion-toolbar",33)(32,"ion-button",34),f("click",function(){u(e);let i=d();return g(i.applySettings())}),r(33,"Apply"),a()()}if(o&2){let e=d();p(8),S("ngModel",e.mapDirection),p(2),c("value",270),p(2),c("value",0),p(2),c("value",45),p(3),c("value",240),p(3),c("value",90),p(3),c("value",120),p(2),c("value",180),p(2),c("value",210),p(3),S("ngModel",e.pinSizeMultiplier)}}function Ke(o,t){if(o&1&&(n(0,"ion-segment-button",42)(1,"ion-label"),r(2),a()()),o&2){let e=t.$implicit;c("value",Q(e)),p(2),V(e)}}function $e(o,t){if(o&1){let e=y();n(0,"ion-content",16)(1,"div",16)(2,"h1"),r(3,"Generate Map"),a(),n(4,"p"),r(5),a()(),n(6,"ion-list",18)(7,"ion-item"),r(8,"Map Type"),a(),n(9,"ion-segment",35),M("ngModelChange",function(i){u(e);let s=d();return w(s.mapStyle,i)||(s.mapStyle=i),g(i)}),n(10,"ion-segment-button",36)(11,"ion-label"),r(12,"Outdoors"),a()(),n(13,"ion-segment-button",37)(14,"ion-label"),r(15,"Satellite"),a()(),n(16,"ion-segment-button",38)(17,"ion-label"),r(18,"Full"),a()(),n(19,"ion-segment-button",39)(20,"ion-label"),r(21,"Street"),a()(),n(22,"ion-segment-button",40)(23,"ion-label"),r(24,"Light"),a()(),n(25,"ion-segment-button",41)(26,"ion-label"),r(27,"Dark"),a()()()(),n(28,"ion-list",18)(29,"ion-item"),r(30,"Zoom Level"),a(),n(31,"ion-segment",35),M("ngModelChange",function(i){u(e);let s=d();return w(s.zoom,i)||(s.zoom=i),g(i)}),B(32,Ke,3,3,"ion-segment-button",42,L),a()()(),n(34,"ion-toolbar",33)(35,"ion-button",34),f("click",function(){u(e);let i=d();return g(i.createMap(i.mapStyle))}),r(36,"Create"),a()()}if(o&2){let e=d();p(5),A(" Create an image of a map centered at the latitude and longitude of ",e.festivalTitle,". "),p(4),S("ngModel",e.mapStyle),c("value",e.mapStyle),p(22),S("ngModel",e.zoom),c("value",e.zoom),p(),G(X(5,Xe))}}function et(o,t){if(o&1){let e=y();n(0,"div",12)(1,"ion-button",34),f("click",function(){u(e),d();let i=U(19);return g(i.click())}),r(2,"Upload Map Image"),a()()}}function tt(o,t){if(o&1){let e=y();n(0,"div",43),f("click",function(i){u(e);let s=d();return g(s.mapPoint(i,!1))}),n(1,"div",44),r(2),a()()}if(o&2){let e=t.$implicit;H("left",e.px+"px")("top",e.py+"px"),c("title",e.label)("ngClass",e.class+" "+e.visible),p(2),V(e.label)}}function it(o,t){if(o&1&&(n(0,"app-note"),r(1),a()),o&2){let e=d();p(),V(e.mapNote)}}function nt(o,t){if(o&1){let e=y();n(0,"app-gps",46),f("gpsChange",function(i){u(e);let s=d(2);return g(s.applyGPS(i))}),a(),n(1,"app-note")(2,"b"),r(3,"Tip"),a(),r(4,": Right click in Google Maps to copy lat/long and paste here."),a()}if(o&2){let e=d(2);c("lat",e.selected.gpsLat)("lng",e.selected.gpsLng)}}function at(o,t){if(o&1){let e=y();n(0,"app-footer",17)(1,"ion-card",16)(2,"ion-title"),r(3),a(),n(4,"ion-list"),P(5,nt,5,2),a(),n(6,"ion-button",45),f("click",function(){u(e);let i=d();return g(i.delete())}),r(7,"Delete"),a()()()}if(o&2){let e=d();p(3),V(e.selected.label),p(2),C(e.selected&&e.selected.label==="GPS"?5:-1)}}var E=class E{constructor(){this.api=I(Se);this.sanitizer=I($);this.location=I(j);this.alert=I(ke);this.vanity=Y();this.mapUri="";this.pinType="Restrooms";this.pins=[];this.title="";this.busy=!1;this.showGenMap=!1;this.showSettings=!1;this.uploading=!1;this.generating=R(!1);this.zoom="1";this.mapStyle="outdoors-v12";this.mapNote="";this.hasMap=!0;this.festivalTitle="";this.mapDirection=0;this.pinSizeMultiplier=1;Ve({trashBinOutline:Te,cloudUploadOutline:Me,settingsOutline:Ee})}generateMap(){return()=>_(this,null,function*(){this.api.isAdmin(this.api.festivalId)?this.showGenMap=!0:this.api.sendMessage("This feature is not available to you.")})}openSettings(){return()=>_(this,null,function*(){this.api.isAdmin(this.api.festivalId)?(this.showSettings=!0,console.log(this.mapDirection)):this.api.sendMessage("This feature is not available to you.")})}clearCamps(){return()=>_(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield k(this.alert,"Are you sure you want to clear the locations of all theme camps?","Clear")))return;this.api.clearCamps(),this.api.sendMessage("Camp locations have been cleared from the map"),this.api.clearCache()}})}clearArt(){return()=>_(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield k(this.alert,"Are you sure you want to clear the locations of all art?","Clear")))return;this.api.clearArtLocations(),this.api.sendMessage("Art locations have been cleared from the map"),this.api.clearCache()}})}clearPins(){return()=>_(this,null,function*(){if(!this.api.isAdmin(this.api.festivalId))this.api.sendMessage("This feature is not available to you.");else{if(!(yield k(this.alert,"Are you sure you want to clear the locations of all other items (restrooms, gate etc)?","Clear")))return;yield this.api.clearPinLocations(),this.ionViewWillEnter(),this.api.sendMessage("Other locations have been cleared from the map"),this.api.clearCache()}})}uploadMap(t){return()=>_(null,null,function*(){console.log(t),t.click()})}onFileSelected(t){return _(this,null,function*(){let e=t.target.files[0];if(!e)return;let i=10*1024*1024;try{this.uploading=!0;let s=e;if(e.size>i){let m=[.85,.5,.3],v=!1;try{for(let T of m)if(s=yield we(e,{quality:T}),s.size<=i){v=!0;break}else console.log(`Conversion at quality ${T} resulted in size ${s.size}, still too large.`);if(!v){this.api.sendMessage("The maximum image size is 10mb. Please try uploading a smaller image size");return}}catch{this.api.sendMessage("The maximum image size is 10mb. Please try uploading a smaller image size");return}}let h=yield xe(s);yield this.api.setMap(h),this.api.sendMessage("Map was uploaded"),this.ionViewWillEnter()}catch(s){console.error("Error uploading map:",s),this.api.sendMessage("Error uploading map. Please try again.")}finally{this.uploading=!1}})}createMap(t){return _(this,null,function*(){this.showGenMap=!1,this.generating.set(!0);try{yield this.api.generateMap(t,parseInt(this.zoom)+12),this.ionViewWillEnter()}finally{this.generating.set(!1)}})}applySettings(){return _(this,null,function*(){this.showSettings=!1;let t=yield this.api.getFestival(this.api.festivalId,{cached:!1});t.map_direction=this.mapDirection,t.pin_size_multiplier=this.pinSizeMultiplier,yield this.api.addFestival(t),this.api.clearCache(),this.ionViewWillEnter()})}ionViewWillEnter(){return _(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity());let t=yield this.api.getFestival(this.api.festivalId,{cached:!0});this.title="Map",this.festivalTitle=this.api.festivalTitle(),this.mapDirection=t.map_direction;let e=yield this.api.getMap();if(this.hasMap=!0,e.base64)this.mapUri=e?this.sanitizer.bypassSecurityTrustUrl(e.base64):"";else if(e.filename)this.mapUri=this.api.imageURL(`${this.vanity()}/${e.filename}`);else{this.hasMap=!1,this.fileUpload.click();return}this.mapDirection=t.map_direction,this.pinSizeMultiplier=t.pin_size_multiplier,this.pins=yield this.api.getPins(),this.recalculate()})}typeChange(t){this.filter(t.detail.value)}filter(t){for(let e of this.pins)e.visible=e.label==t?"":"hidden"}mapPoint(t,e){console.log("clicked",t,e);let l=t.clientX,i=t.clientY,h=this.map.nativeElement.getBoundingClientRect(),m=(l-h.x)*1e4/h.width,v=(i-h.y)*1e4/h.height;if(!(this.selectPin(m,v)||!e)){if(this.selected){this.selected=void 0;return}this.pins.push({x:Math.ceil(m),y:Math.ceil(v),px:Math.ceil(m)*this.width()/1e4,py:Math.ceil(v)*this.height()/1e4,label:this.pinType,gpsLat:void 0,gpsLng:void 0}),this.setMapNote()}}delete(){this.pins=this.pins.filter(t=>t.class!=="selected"),this.selected=void 0}applyGPS(t){this.pins.map(e=>{e.class==="selected"&&this.selected&&(e.gpsLat=t.lat,e.gpsLng=t.lng)})}recalculate(){for(let t of this.pins)t.px=Math.ceil(t.x)*this.width()/1e4,t.py=Math.ceil(t.y)*this.height()/1e4;this.setMapNote()}setMapNote(){let t=this.pins.filter(e=>e.label=="GPS").length;this.mapNote=t>=3?"":'You will need to add at least 3 Pins of type "GPS" with GPS coordinates for the dust app to show distances.'}save(){return _(this,null,function*(){try{this.busy=!0;for(let t of this.pins)t.class=void 0,t.px=void 0,t.py=void 0,t.visible=void 0,t.gpsLat==0&&t.gpsLng==0&&(t.gpsLat=void 0,t.gpsLng=void 0);yield this.api.placePins(this.pins),this.location.back()}finally{this.busy=!1}})}width(){return this.map.nativeElement.getBoundingClientRect().width}height(){return this.map.nativeElement.getBoundingClientRect().height}selectPin(t,e){var s,h;console.log("selectPin",t,e);let l,i=-30;for(let m of this.pins){let v=this.dist(m,t+i,e+i),T=50;console.log("d",v,T,JSON.stringify(m)),v<T?(this.selected=m,this.selected.label==="GPS"&&(m.gpsLat=(s=m.gpsLat)!=null?s:0,m.gpsLng=(h=m.gpsLng)!=null?h:0),m.class="selected",l=m,console.log(`Selected ${m.label}`)):m.class=void 0}return l}dist(t,e,l){let i=e-t.x,s=l-t.y;return Math.sqrt(i*i+s*s)}};E.\u0275fac=function(e){return new(e||E)},E.\u0275cmp=q({type:E,selectors:[["app-pins"]],viewQuery:function(e,l){if(e&1&&(O(Fe,5),O(Ue,5)),e&2){let i;W(i=F())&&(l.map=i.first),W(i=F())&&(l.fileUpload=i.first)}},inputs:{vanity:[1,"vanity"]},decls:29,vars:12,consts:[["fileUpload",""],["map",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],["title","Uploading map image..."],["title","Generating..."],[3,"isOpen"],["type","file",1,"file-input",3,"change"],[1,"ion-text-center",2,"padding-top","45vh"],[1,"map"],[1,"pin",3,"title","ngClass","left","top"],[3,"resize","click","src"],[1,"ion-padding"],["width","300px"],["lines","none"],["labelPlacement","fixed","interface","popover","placeholder","Pin Types",3,"ionChange","ngModelChange","ngModel","value"],["value","Restrooms"],["value","Gate"],["value","Greeters"],["value","Shuttle Stop"],["value","Ice"],["value","Medical"],["value","GPS"],[3,"hideProfile","buttons"],[3,"ngModelChange","ngModel"],[1,"row"],["labelPlacement","end",3,"value"],["labelPlacement","start",3,"value"],["labelPlacement","stacked","label","Pin Size Multiplier","type","number",3,"ngModelChange","ngModel"],[1,"ion-text-center","ion-padding"],[3,"click"],["mode","ios",3,"ngModelChange","ngModel","value"],["value","outdoors-v12"],["value","satellite-v9"],["value","satellite-streets-v12"],["value","streets-v12"],["value","light-v11"],["value","dark-v11"],[3,"value"],[1,"pin",3,"click","title","ngClass"],[1,"label"],["shape","round","color","primary","mode","md",3,"click"],[3,"gpsChange","lat","lng"]],template:function(e,l){if(e&1){let i=y();n(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3),b(3,"ion-back-button"),a(),n(4,"ion-title",4),r(5),a(),n(6,"ion-buttons",5)(7,"ion-button",6),f("click",function(){return u(i),g(l.save())}),r(8,"Save"),a()()(),P(9,Ze,22,23,"ion-toolbar"),a(),n(10,"ion-content",7),P(11,Ye,1,0,"app-spinner",8),P(12,je,1,0,"app-progress-overlay",9),n(13,"ion-modal",10),z(14,Je,34,10,"ng-template"),a(),n(15,"ion-modal",10),z(16,$e,37,6,"ng-template"),a(),n(17,"div")(18,"input",11,0),f("change",function(h){return u(i),g(l.onFileSelected(h))}),a(),P(20,et,3,0,"div",12),n(21,"div",13),B(22,tt,3,7,"div",14,L),a(),n(24,"img",15,1),f("resize",function(){return u(i),g(l.recalculate())},N)("click",function(h){return u(i),g(l.mapPoint(h,!0))}),a()(),b(26,"div",16),P(27,it,2,1,"app-note"),P(28,at,8,2,"app-footer",17),a()}e&2&&(p(5),A(" ",l.title," "),p(2),c("disabled",l.busy),p(2),C(l.hasMap?9:-1),p(),c("fullscreen",!0),p(),C(l.uploading?11:-1),p(),C(l.generating()?12:-1),p(),c("isOpen",l.showSettings),p(2),c("isOpen",l.showGenMap),p(5),C(l.hasMap?-1:20),p(2),G(l.pins),p(2),c("src",l.mapUri,D),p(3),C(l.hasMap?27:-1),p(),C(l.selected?28:-1))},dependencies:[ve,he,ue,Ce,Pe,ye,ae,de,ze,re,K,J,ie,ee,te,pe,fe,le,ne,_e,oe,me,ce,be,ge,se,Le,Be,Ge,Ie,Oe],styles:["img[_ngcontent-%COMP%]{user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-drag:none;-webkit-user-select:none;-ms-user-select:none}.placed[_ngcontent-%COMP%]{background-color:red!important;border:2px solid white!important;width:var(--pin-size-placed);height:var(--pin-size-placed);border-radius:var(--pin-size-placed)}.selected[_ngcontent-%COMP%]{background-color:#ff9191!important;border:3px solid red!important}.pin[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{visibility:hidden;width:100px;margin-left:var(--pin-size);margin-top:calc(var(---pin-size/2));color:#fff;background:#000;border-radius:var(--br-xl);padding:var(--spacing-sm);text-align:center}.pin[_ngcontent-%COMP%]:hover   .label[_ngcontent-%COMP%]{visibility:visible}.pin[_ngcontent-%COMP%]{width:var(--pin-size);height:var(--pin-size);border-radius:var(--pin-size);background-color:#fff;border:2px solid red;position:absolute;cursor:pointer}.hidden[_ngcontent-%COMP%]{opacity:.5}.map[_ngcontent-%COMP%]{position:absolute;--pin-size: 10px;--pin-size-placed: 15px}ion-select[_ngcontent-%COMP%]{margin-left:var(--spacing-base);padding-left:var(--spacing-lg);border:2px solid var(--ion-color-medium);border-radius:var(--br-lg);max-width:200px}.row[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between}ion-radio[_ngcontent-%COMP%]{padding:var(--spacing-lg)}"]});var We=E;export{We as PinsPage};
