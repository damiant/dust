import{a as Te}from"./chunk-WUGLYCQ5.js";import{a as Ee}from"./chunk-OI5ZMPLQ.js";import{b as F}from"./chunk-QTBNLBDF.js";import{a as we}from"./chunk-TOSLD3EX.js";import{a as Pe}from"./chunk-26YF7LCF.js";import{a as Se}from"./chunk-WVEW2PMG.js";import{a as be}from"./chunk-2ESKF5AC.js";import{a as ve}from"./chunk-55PDQDPP.js";import{b as xe}from"./chunk-LADCEZG6.js";import"./chunk-5Z4O26VQ.js";import"./chunk-FJQ4E5GO.js";import"./chunk-7FPDBCWT.js";import"./chunk-JYXYGJZQ.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-YRQXWVV7.js";import"./chunk-NPRM7GGH.js";import"./chunk-52VTL4OE.js";import"./chunk-VBU7NMPV.js";import"./chunk-2GEO6OXL.js";import"./chunk-MCRJI3T3.js";import"./chunk-74YXDZAV.js";import"./chunk-YYXGO6RB.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-TUKQZ63R.js";import{A as ge,C as _e,R as ye,a as fe,w as Ce}from"./chunk-OAPJ7RFL.js";import{d as ue,u as V,w as he,x as T}from"./chunk-SNNE7GZP.js";import{$ as C,A as S,Aa as f,B as w,Ca as E,Ka as v,L as O,Lb as W,Qa as K,Qb as J,Rb as X,S as a,Sb as Z,T as _,Ta as q,Tb as ee,Ub as te,Wb as ie,X as $,Xa as Y,Yb as ne,cb as D,cc as ae,da as r,db as Q,dc as oe,fc as re,ga as h,gb as z,hc as se,ia as R,ja as A,ka as s,la as p,ma as m,mc as pe,nc as ce,oa as M,oc as le,pa as P,qa as l,s as U,sb as H,uc as me,w as b,wa as N,xa as j,ya as G,yc as de}from"./chunk-SLKJQVFW.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as u}from"./chunk-LNJ3S2LQ.js";var g=class g{constructor(){this.api=b(T)}exportCampsToCSV(i,e){let n=[];for(let c of e)n.push({id:c.id,name:c.name,description:c.description,email:c.contact_email,placed:c.pin!=""?"Yes":"No"});let o=V(i.toLowerCase()," ","-");F(`${o}-camps.csv`,n)}exportCampsEmail(i,e){let n=[];for(let c of e)ue(c.contact_email)||n.push({email:c.contact_email});if(n.length==0){this.api.sendMessage("No Camps have email addresses to be exported.");return}let o=V(i.toLowerCase()," ","-");F(`${o}-camp-email.txt`,n,{stripQuotes:!0,hideHeaders:!0})}};g.\u0275fac=function(e){return new(e||g)},g.\u0275prov=U({token:g,factory:g.\u0275fac,providedIn:"root"});var I=g;var Me=["kmlUpload"],ke=(t,i)=>i.id,Ve=t=>[t],k=t=>({camp:t});function Fe(t,i){if(t&1){let e=M();s(0,"ion-toolbar")(1,"ion-searchbar",13),P("ionInput",function(o){S(e);let c=l();return w(c.handleSearch(o))}),p(),s(2,"ion-button",14),P("click",function(){S(e);let o=l();return w(o.toggleGrid())}),m(3,"ion-icon",15),p()()}if(t&2){let e=l();a(),r("debounce",600)("placeholder","Search camps at "+e.title),a(2),r("name",e.isGrid?"list-outline":"grid-outline")}}function Be(t,i){if(t&1&&m(0,"ion-progress-bar",9),t&2){let e=l();r("value",e.progress)}}function Ue(t,i){if(t&1&&m(0,"app-card",17),t&2){let e=l(3);r("title",e.filteredBySearch?"No Camps Found":"No Camps")("description",e.filteredBySearch?"No camps found matching that search":"There are no theme camps registered for "+e.festivalTitle)}}function Oe(t,i){if(t&1&&C(0,Ue,1,2,"app-card",17),t&2){let e=l(2);h(e.camps.length===0?0:-1)}}function $e(t,i){if(t&1&&(s(0,"app-card",18),m(1,"app-img",20),s(2,"ion-button",21),f(3," Register Camp "),p()()),t&2){let e=l(3);r("description","Camp registration for "+e.festivalTitle+" is open."),a(),r("width","100px")("height","100px")("src",e.imageUrl),a(),r("routerLink",e.newRoute())}}function Ne(t,i){if(t&1&&m(0,"app-card",19),t&2){let e=l(3);r("description",e.camps.length===0?"Registration for camps at "+e.festivalTitle+" have been disabled. You cannot register a camp at this time.":"Changes to camps at "+e.festivalTitle+" have been disabled. You cannot make any changes at this time.")}}function je(t,i){if(t&1&&C(0,$e,4,5,"app-card",18)(1,Ne,1,1,"app-card",19),t&2){let e=l(2);h(e.camps.length===0&&e.api.campRegistration()?0:!e.api.campRegistration()&&!e.api.campEditing()?1:-1)}}function Ge(t,i){t&1&&(s(0,"ion-button",27),m(1,"ion-icon",31),p())}function Ke(t,i){if(t&1&&(s(0,"div",23)(1,"ion-card",24),m(2,"app-img",25),s(3,"ion-card-header",26)(4,"ion-card-title"),f(5),C(6,Ge,2,0,"ion-button",27),p()(),s(7,"ion-card-content"),f(8),s(9,"div",28)(10,"ion-button",29),f(11,"Edit"),p(),s(12,"ion-button",30),f(13,"Events"),p(),s(14,"ion-button",30),f(15,"Music"),p()()()()()),t&2){let e=i.$implicit,n=l(4);a(2),r("routerLink",n.editRoute(e))("src",n.image(e)),a(),r("routerLink",n.editRoute(e)),a(2),E("",e.name," "),a(),h(e.pin?6:-1),a(2),E(" ",e.description," "),a(2),r("disabled",!n.canEditCamp)("routerLink","../camp/"+v(14,Ve,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",v(16,k,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../music")("queryParams",v(18,k,e.id))}}function qe(t,i){if(t&1&&(s(0,"div",22),R(1,Ke,16,20,"div",23,ke),p()),t&2){let e=l(3);r("ngClass",e.camps.length>1?"grid":"grid1"),a(),A(e.camps)}}function Ye(t,i){t&1&&m(0,"ion-icon",31)}function De(t,i){if(t&1&&(s(0,"ion-item"),m(1,"app-img",34),s(2,"ion-text",35),f(3),C(4,Ye,1,0,"ion-icon",31),p(),s(5,"div",4)(6,"ion-button",30),f(7,"Events"),p(),s(8,"ion-button",30),f(9,"Music"),p()()()),t&2){let e=i.$implicit,n=l(4);a(),r("width","45px")("height","45px")("routerLink",n.editRoute(e))("src",n.image(e)),a(),r("routerLink",n.editRoute(e)),a(),E(" ",e.name," "),a(),h(e.pin?4:-1),a(2),r("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",v(13,k,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../music")("queryParams",v(15,k,e.id))}}function Qe(t,i){if(t&1&&(s(0,"div",32)(1,"ion-card")(2,"ion-list"),R(3,De,10,17,"ion-item",null,ke),p()()(),m(5,"div",33)(6,"div",33)),t&2){let e=l(3);a(3),A(e.camps)}}function ze(t,i){if(t&1&&C(0,qe,3,1,"div",22)(1,Qe,7,0),t&2){let e=l(2);h(e.isGrid?0:1)}}function He(t,i){if(t&1&&(s(0,"div",10)(1,"div",16),C(2,Oe,1,1)(3,je,2,1),p(),C(4,ze,2,1),p()),t&2){let e=l();a(),r("ngClass",e.camps.length>0?"":"pad-vertical"),a(),h(e.isAdmin?2:3),a(2),h(e.camps.length>0?4:-1)}}function We(t,i){t&1&&m(0,"app-spinner")}function Je(t,i){if(t&1&&m(0,"app-footer",11),t&2){let e=l();r("routeTo",e.newRoute())}}var x=class x{constructor(i,e,n,o,c){this.api=i;this.router=e;this.campService=n;this.store=o;this.kml=c;this.camps=[];this.busy=!0;this.isAdmin=!1;this.title="";this.festivalTitle="";this.canRegister=!1;this.canEditCamp=!1;this.canAddCamp=!1;this.canEditEvent=!1;this.filteredBySearch=!1;this.imageUrl="";this.isGrid=!1;this.buttons=[];this.alert=b(be);this.mapChanges=O({camps:[],art:[],pins:[],newCamps:[],newArt:[]});ye({add:fe,locationSharp:_e,listOutline:ge,gridOutline:Ce}),K(()=>u(this,null,function*(){let d=this.mapChanges();if(d.camps.length==0&&d.newCamps.length==0&&d.pins.length==0)return;this.busy=!0;let y=d.camps.length,B=0;for(let L of d.camps)B++,yield this.api.addCamp(L),this.progress=B/y;if(d.pins.length>0){let L=yield this.api.getPins();yield this.api.placePins(this.deduplicate(L,d.pins))}this.busy=!1,console.log(d);let Le=yield this.importNewCamps(d.newCamps);this.message(`${d.camps.length} camp changes made. ${d.pins.length} restrooms added. ${Le} new camps added.`),this.api.clearCache(),this.ionViewDidEnter()}))}deduplicate(i,e){let n=i;for(let o of e)i.find(c=>c.label==o.label&&c.gpsLat==o.gpsLat&&c.gpsLng==o.gpsLng)||n.push(o);return n}message(i){setTimeout(()=>{this.api.sendMessage(i)},1)}importCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.router.navigateByUrl("./import")})}importKML(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.kmlUpload.nativeElement.click()})}exportCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.exportToCSV()})}toggleGrid(){this.isGrid=!this.isGrid,this.store.set("isGrid",`${!this.isGrid}`)}ngOnInit(){return u(this,null,function*(){var i;yield this.api.setFestivalByVanity(this.vanity,!0),this.title=`${this.api.festivalTitle()}`,this.festivalTitle=this.api.festivalTitle(),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.imageUrl=(i=this.api.imageURL(this.api.festivalImage()))!=null?i:"",this.canAddCamp=this.api.campRegistration()||this.isAdmin,this.canEditCamp=this.api.campRegistration()||this.api.campEditing()||this.isAdmin,this.canEditEvent=this.api.campRegistration()||this.api.eventEditing()||this.isAdmin,this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"},{title:"Export Email Addresses",method:this.exportEmail(),icon:"mail-outline"},{title:"Import KML",method:this.importKML(),icon:"cloud-upload-outline"}]:[],this.isGrid=this.store.get("isGrid")!=="true"})}exportEmail(){return()=>u(this,null,function*(){this.campService.exportCampsEmail(this.festivalTitle,this.camps)})}ionViewDidEnter(){return u(this,null,function*(){this.camps=yield this.api.camps({cached:!0}),this.filteredBySearch=!1,this.busy=!1})}handleSearch(i){return u(this,null,function*(){let e=i.target.value.toLowerCase(),n=yield this.api.camps({cached:!0});this.camps=n.filter(o=>o.name.toLowerCase().includes(e)),this.filteredBySearch=e.length>0})}editRoute(i){return this.canEditCamp?"../camp/"+i.id:void 0}newRoute(){return this.canEditCamp?"../camp/new":void 0}image(i){return i.imageUrl?this.api.imageURL(i.imageUrl):"./assets/camp.svg"}exportToCSV(){this.campService.exportCampsToCSV(this.festivalTitle,this.camps)}onKMLSelected(i){return u(this,null,function*(){if(!this.isAdmin){this.api.sendMessage("You do not have access rights to this feature.");return}let e=i.target.files[0];if(!e)return;let n=new FileReader;n.onload=o=>u(this,null,function*(){var y;let c=(y=o.target)==null?void 0:y.result,d=this.kml.parse(c,this.camps);this.mapChanges.set(d)}),n.readAsText(e)})}importNewCamps(i){return u(this,null,function*(){let e=0;if(i.length==0)return 0;for(let n of i){let o=yield xe(this.alert,`Create Camp "${n.name}" ?`,"Create");if(o=="Create"&&(yield this.api.addCamp(n),e++),o=="Cancel")return e}return e})}};x.\u0275fac=function(e){return new(e||x)(_(T),_(D),_(I),_(he),_(Te))},x.\u0275cmp=$({type:x,selectors:[["app-camps"]],viewQuery:function(e,n){if(e&1&&N(Me,7),e&2){let o;j(o=G())&&(n.kmlUpload=o.first)}},inputs:{vanity:"vanity"},decls:18,vars:7,consts:[["kmlUpload",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../camp/new",3,"hidden"],["name","add"],[3,"buttons"],[3,"fullscreen"],[3,"value"],[1,"large-border"],["title","Add Camp",3,"routeTo"],["type","file",1,"file-input",3,"change"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],["color","dark","fill","clear","slot","end",3,"click"],[3,"name"],[1,"ion-text-center",3,"ngClass"],[3,"title","description"],["title","Registration",3,"description"],["title","Camp Registration",3,"description"],["logo","",1,"logo","ion-padding",3,"width","height","src"],["shape","round",3,"routerLink"],[1,"pad-below",3,"ngClass"],[1,"grid-item"],[1,"clickable"],[3,"routerLink","src"],[3,"routerLink"],["fill","clear","color","light",2,"position","absolute","margin-top","-3px"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["color","secondary",3,"disabled","routerLink"],["color","secondary",3,"disabled","routerLink","queryParams"],["size","small","name","location-sharp",1,"pin"],[1,"border"],[1,"ion-padding"],[1,"clickable",2,"min-width","45px",3,"width","height","routerLink","src"],[1,"clickable",2,"width","100%","padding","1rem",3,"routerLink"]],template:function(e,n){if(e&1){let o=M();s(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),m(3,"ion-back-button"),p(),s(4,"ion-title",3),f(5,"Camps"),p(),s(6,"ion-buttons",4)(7,"ion-button",5),m(8,"ion-icon",6),p(),m(9,"app-side",7),p()()(),s(10,"ion-content",8),C(11,Fe,4,3,"ion-toolbar")(12,Be,1,1,"ion-progress-bar",9)(13,He,5,3,"div",10)(14,We,1,0,"app-spinner")(15,Je,1,1,"app-footer",11),s(16,"input",12,0),P("change",function(d){return S(o),w(n.onKMLSelected(d))}),p()()}e&2&&(a(7),r("hidden",!n.canAddCamp),a(2),r("buttons",n.buttons),a(),r("fullscreen",!0),a(),h(n.camps.length>1||n.filteredBySearch?11:-1),a(),h(n.progress?12:-1),a(),h(n.busy?14:13),a(2),h(n.isAdmin?15:-1))},dependencies:[pe,de,se,Se,Y,q,H,z,Q,ae,le,X,W,ce,J,ne,me,Z,te,ie,ee,Ee,re,oe,ve,Pe,we],styles:["ion-card-title[_ngcontent-%COMP%]{font-size:1.5rem!important}ion-card-content[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:var(--fs4)}h1[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.pin[_ngcontent-%COMP%]{color:var(--ion-color-primary);opacity:.5}.logo[_ngcontent-%COMP%]{--app-background-color: transparent;--border-radius: .5rem}app-img[_ngcontent-%COMP%]{--border-radius: 5px}ion-text[_ngcontent-%COMP%]{font-size:var(--fs4)}"]});var Ie=x;export{Ie as CampsPage};
