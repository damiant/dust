import{a as It}from"./chunk-4IGEIIOR.js";import{a as wt}from"./chunk-67ONBALU.js";import{a as Lt}from"./chunk-ALTFHMWK.js";import"./chunk-A7RCF4AZ.js";import{a as Y}from"./chunk-CXPPFZMD.js";import"./chunk-DUKSTT3K.js";import{a as Tt,ea as bt}from"./chunk-MQOPPKG3.js";import{J as U,e as j,x as Ct,y as K,z as V}from"./chunk-2K4NO5ZT.js";import"./chunk-PFLI22GG.js";import{$ as A,Aa as B,Ba as P,Cb as dt,Da as tt,Dc as xt,Ea as et,Ec as _t,Fa as it,G as a,Ga as nt,Kc as St,La as ot,O as N,Pc as Mt,Qa as rt,Ta as F,Vb as pt,W as x,X as _,Z as E,_ as R,aa as S,ba as c,bc as ft,ca as u,cc as ht,da as y,gb as st,ia as X,ib as at,jb as ct,ka as z,kc as gt,l as O,ma as h,mb as ut,p as d,qc as yt,rc as G,s as Z,sb as mt,t as H,tc as J,uc as $,vb as lt,wc as k,za as p,zc as vt}from"./chunk-OCTOJKK3.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as l}from"./chunk-LNJ3S2LQ.js";var M=class M{constructor(){this.api=d(U)}occurrences(e){let t=JSON.parse(e!=null?e:"[]");for(let i of t)i.timeRange=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(i.startTime)),i.time=Ct[new Date(i.startTime).getDay()],i.startTime=K(new Date(i.startTime),this.api.currentTimeZone()),i.endTime=K(new Date(i.endTime),this.api.currentTimeZone());return t}occurrencesRSL(e){let t=JSON.parse(e!=null?e:"[]");return{date:V(new Date(t[0].startTime)),start_date:V(new Date(t[0].startTime)),end_date:V(new Date(t[t.length-1].endTime)),start_time:new Date(t[0].startTime).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),end_time:new Date(t[t.length-1].endTime).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}}dayNumber(e){let t=JSON.parse(e!=null?e:"[]");return t.length>0?new Date(t[0].startTime).getTime():0}dayTitle(e){let t=this.occurrences(e);return t.length>0&&t[0].timeRange?`${t[0].time} ${t[0].timeRange} ${t[0].startTime}`:""}};M.\u0275fac=function(t){return new(t||M)},M.\u0275prov=O({token:M,factory:M.\u0275fac,providedIn:"root"});var v=M;function Nt(r,e){if(r&1&&(c(0,"ion-item")(1,"ion-label"),p(2),u(),c(3,"ion-note",1),p(4),u()()),r&2){let t=e.$implicit;a(2),P(" ",t.who," "),a(2),tt(" ",t.time," ",t.startTime,"-",t.endTime," ")}}var T=class T{constructor(){this.music=F();this.party=d(v);this.occurrences=rt(()=>{var e;return this.party.occurrences((e=this.music())==null?void 0:e.occurrences)})}};T.\u0275fac=function(t){return new(t||T)},T.\u0275cmp=N({type:T,selectors:[["app-party-list"]],inputs:{music:[1,"music"]},decls:3,vars:0,consts:[["lines","inset"],["slot","end"]],template:function(t,i){t&1&&(c(0,"ion-list",0),R(1,Nt,5,4,"ion-item",null,E),u()),t&2&&(a(),A(i.occurrences()))},dependencies:[k,$,G,J],styles:["@media (max-width: 391px){ion-note[_ngcontent-%COMP%]{width:100px}}"]});var W=T;var C=class C{constructor(){this.ttitdService=d(Y);this.partyService=d(v)}exportMusicJSON(e){return l(this,null,function*(){let t=yield this.exportMusic(e);this.exportJSON("rsl.json",t)})}exportMusicRSL(e){return l(this,null,function*(){let t=yield this.exportRSLStyle(e);this.sortByDayAndName(t),this.exportJSON("raw-event-data.json",t)})}sortByDayAndName(e){e.sort((t,i)=>{let n=new Date(`${t.start_date}`).getTime()-new Date(`${i.start_date}`).getTime();return n!==0?n:t.location_name.localeCompare(i.location_name)})}exportMusicDetails(e){return l(this,null,function*(){let t=yield this.exportRSLStyle(e);this.sortByDayAndName(t);let i=[];for(let n of t){i.push(`${n.location_name} ${n.address} ${n.start_date} ${n.start_time}`);for(let o of n.performances)i.push(`  ${o.time} - ${o.artists.map(s=>s.name).join(", ")}`);i.push("")}this.exportCSV("details.txt",i.join(`
`))})}exportMusicians(e){return l(this,null,function*(){var i;let t=[];for(let n of e){let o=JSON.parse((i=n.occurrences)!=null?i:[]);for(let s of o)s.who&&(t.includes(s.who.trim())||t.push(s.who.trim()))}t.sort((n,o)=>n.localeCompare(o)),this.exportCSV("musicians.csv",t.join(`
`))})}exportEmailList(e){return l(this,null,function*(){var i;let t=[];for(let n of e){let o=(i=n.contact)!=null?i:"";for(let s of o.split(",")){let m=s.trim();m&&!t.includes(m)&&t.push(m)}}t.sort((n,o)=>n.localeCompare(o)),this.exportCSV("email-list.csv",t.join(`
`))})}exportCSV(e,t,i="text/csv"){let n=new Blob([t],{type:`${i};charset=utf-8;`}),o=document.createElement("a");if(o.download!==void 0){let s=URL.createObjectURL(n);o.setAttribute("href",s),o.setAttribute("download",e),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}exportJSON(e,t){let i=JSON.stringify(t,null,2),n=new Blob([i],{type:"text/json;charset=utf-8;"}),o=document.createElement("a");if(o.download!==void 0){let s=URL.createObjectURL(n);o.setAttribute("href",s),o.setAttribute("download",e),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}isMutantVehicle(e){var t,i;return(i=(t=e.musicType)==null?void 0:t.includes("Mutant Vehicle"))!=null?i:!1}exportRSLStyle(e){return l(this,null,function*(){return yield this.ttitdService.init(),e.map(t=>{var i,n,o,s,m,g,w,L,I,D;return{location_name:this.extractTitle(t),address:this.extractLocation(t),attributes:{wcf:(n=(i=t.musicType)==null?void 0:i.includes("Wheelchair Accessible"))!=null?n:!1,mv:this.isMutantVehicle(t),bpal:(s=(o=t.musicType)==null?void 0:o.includes("_BIPOC"))!=null?s:!1,lm:(g=(m=t.musicType)==null?void 0:m.includes("Live Music"))!=null?g:!1,rr:(L=(w=t.musicType)==null?void 0:w.includes("_Recommended"))!=null?L:!1},camp_uuid:this.extractLocationUid(t),theme:(I=t.title)!=null?I:"",date:this.extractDates(t).date,start_date:this.extractDates(t).start_date,end_date:this.extractDates(t).end_date,start_time:this.extractDates(t).start_time,end_time:this.extractDates(t).end_time,performances:JSON.parse((D=t.occurrences)!=null?D:[]).map(f=>({time:f.time,artists:[{name:f.who||""}]}))||[]}})})}exportMusic(e){return l(this,null,function*(){yield this.ttitdService.init();let t="-07:00";return e.map((i,n)=>{var o,s,m,g,w,L,I,D;return{id:`rsl-${n+1}`,uid:`rsl-${n+1}`,title:(o=i.title)!=null?o:`${i.camp} (${new Date(i.day).toLocaleDateString("en-US",{weekday:"short"})})`,camp:this.extractTitle(i),day:i.day||"",location:this.extractLocation(i),wa:(m=(s=i.musicType)==null?void 0:s.includes("Wheelchair Friendly"))!=null?m:!1,lm:(w=(g=i.musicType)==null?void 0:g.includes("Live Music"))!=null?w:!1,rr:(I=(L=i.musicType)==null?void 0:L.includes("_Recommended"))!=null?I:!1,waNotes:i.waNotes||void 0,distance:0,distanceInfo:"",artCar:this.extractLocationArtCar(i),campId:this.extractLocationUid(i),occurrences:JSON.parse((D=i.occurrences)!=null?D:[]).map((f,Pt)=>({who:f.who||"",startTime:f.startTime+t||"",endTime:f.endTime+t||"",timeRange:f.timeRange||f.time||"",time:f.time||f.timeRange||"",id:Pt.toString()}))||[]}})})}extractLocationArtCar(e){try{let t=JSON.parse(e.location);return t.type==="mutant"?t.artCar:void 0}catch{return}}extractDates(e){return this.partyService.occurrencesRSL(e.occurrences)}extractTitle(e){let t=JSON.parse(e.location);return t.type==="mutant"||this.isMutantVehicle(e)||!j(t.artCar)?t.artCar.trim():t.name.trim()}extractLocation(e){var t,i;try{let n=JSON.parse(e.location),o=this.ttitdService.camps.find(m=>m.uid==n.uid);if(o)return(t=o.location)!=null?t:"";let s=this.ttitdService.art.find(m=>m.uid==n.uid);return s?(i=s.name)!=null?i:"":n.type==="mutant"?n.name:""}catch{return""}}extractLocationUid(e){try{let t=JSON.parse(e.location);return t.type!=="mutant"?t.uid:void 0}catch{return}}};C.\u0275fac=function(t){return new(t||C)},C.\u0275prov=O({token:C,factory:C.\u0275fac,providedIn:"root"});var q=C;var Et=r=>[r];function Rt(r,e){if(r&1&&(y(0,"ion-item"),c(1,"ion-item",19)(2,"h3"),p(3),u()()),r&2){let t=h().$implicit;a(3),B(t.group)}}function At(r,e){if(r&1&&p(0),r&2){let t=h().$implicit;P(" ",t.dayTitle,"\xA0 ")}}function Bt(r,e){if(r&1&&(c(0,"div",17)(1,"ion-note",3),p(2),u()()),r&2){let t=h().$implicit;a(2),B(t.dayTitle)}}function Ft(r,e){if(r&1&&(c(0,"div",18),y(1,"app-party-list",20),u()),r&2){let t=h().$implicit;a(),S("music",t)}}function Gt(r,e){if(r&1&&(x(0,Rt,4,1),c(1,"ion-item",16)(2,"ion-label"),p(3),c(4,"p"),x(5,At,1,1),c(6,"i"),p(7),u()()(),x(8,Bt,3,1,"div",17),u(),x(9,Ft,2,1,"div",18)),r&2){let t=e.$implicit,i=h(3);_(t.group?0:-1),a(),S("routerLink","../music/"+ot(7,Et,t.id)),a(2),P("",t.viewTitle," "),a(2),_(i.groupBy==="location"?5:-1),a(2),B(t.title),a(),_(i.groupBy!=="location"?8:-1),a(),_(i.groupBy==="location"?9:-1)}}function Jt(r,e){if(r&1&&(c(0,"ion-list"),R(1,Gt,10,9,null,null,E),u()),r&2){let t=h(2);a(),A(t.music)}}function $t(r,e){r&1&&y(0,"ion-item")}function kt(r,e){if(r&1){let t=X();c(0,"div",9)(1,"ion-buttons",10)(2,"ion-segment",11),nt("ngModelChange",function(n){Z(t);let o=h();return it(o.groupBy,n)||(o.groupBy=n),H(n)}),z("ionChange",function(){Z(t);let n=h();return H(n.refresh())}),c(3,"ion-segment-button",12)(4,"ion-label"),p(5,"Summary"),u()(),c(6,"ion-segment-button",13)(7,"ion-label"),p(8,"Details"),u()()()(),c(9,"app-image-card",14),x(10,Jt,3,0,"ion-list")(11,$t,1,0,"ion-item"),u()(),y(12,"div",15)}if(r&2){let t=h();a(2),et("ngModel",t.groupBy),S("value",t.groupBy),a(7),S("url",t.camp?t.image(t.camp):t.festivalImage())("title",t.title)("description",t.description),a(),_(t.music.length>0?10:11)}}var b=class b{constructor(){this.router=d(at);this.route=d(st);this.vanity=F();this.music=[];this.busy=!0;this.groupBy="title";this.title="";this.description="";this.isAdmin=!1;this.buttons=[];this.ttitdService=d(Y);this.rslService=d(q);this.partyService=d(v);this.api=d(U);bt({add:Tt})}image(e){return this.api.imageURL(e.imageUrl)}festivalImage(){return this.api.imageURL(this.api.festivalImage())}getTitle(e,t){let i=t.length>0?t[0].location:"",n=!0;for(let o of t)if(o.location!=i){n=!1;break}if(n)try{return JSON.parse(i).name}catch{return e}return e}ionViewWillEnter(){return l(this,null,function*(){var e;yield this.api.setFestivalByVanity(this.vanity()),this.campId=this.route.snapshot.queryParams.camp,this.camp=this.campId?yield this.api.getCamp(this.campId):void 0,this.title=this.camp?`${this.camp.name}`:`${this.api.festivalTitle()}`,this.music=this.filter(yield this.api.music()),this.title=this.getTitle(this.title,this.music),this.music.map(t=>{t.camp=="Unknown"?t.viewTitle=this.extractLocation(t):t.viewTitle=t.camp}),this.festival=yield this.api.getFestivalByVanity(this.vanity(),!0,!1),this.access=this.api.getAccessInfo((e=this.festival)==null?void 0:e.id),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.description=this.music.length>0?"":`There are no parties for ${this.title}.`,this.buttons=this.isAdmin||this.access.hasFestivals?[{title:"Export JSON",method:this.exportJSON(),icon:"cloud-download-outline"},{title:"Export RSL JSON",method:this.exportRSLStyle(),icon:"cloud-download-outline"},{title:"Export Musician List",method:this.exportMusicians(),icon:"cloud-download-outline"},{title:"Export Email List",method:this.exportEmailList(),icon:"cloud-download-outline"},{title:"Export Detailed List",method:this.exportDetailedList(),icon:"cloud-download-outline"}]:[],this.refresh(),this.busy=!1})}sortIndex(e){return this.partyService.dayNumber(e.occurrences)}sortMusic(){for(let e of this.music)e.index=this.sortIndex(e);this.music.sort((e,t)=>{let i=this.extractLocation(e,!1),n=this.extractLocation(t,!1),o=i.localeCompare(n);return o===0&&e.index&&t.index?e.index-t.index:o})}refresh(){if(console.time("MusicPage.refresh"),this.groupBy=="location"){this.sortMusic();let e="";for(let t of this.music)this.extractLocation(t,!1)!=e&&(t.group=this.extractLocation(t,!1),e=this.extractLocation(t,!1)),t.dayTitle=this.partyService.dayTitle(t.occurrences)}else{this.sortMusic();for(let e of this.music)e.group=void 0,e.dayTitle=this.partyService.dayTitle(e.occurrences)}console.timeEnd("MusicPage.refresh")}filter(e){return this.campId?e.filter(t=>t.campId==this.campId):e}extractLocation(e,t=!0){try{let i=JSON.parse(e.location);return j(i.artCar)||(i.type="mutant"),i.type=="mutant"?`${i.artCar}`+(t?`(@ ${i.name})`:""):i.name}catch{return"Unknown"}}exportJSON(){return()=>l(this,null,function*(){var e;if(!this.isAdmin&&!((e=this.access)!=null&&e.hasFestivals)){this.message("You do not have access rights to this feature.");return}this.rslService.exportMusicJSON(this.exportPrep(this.music))})}exportPrep(e){return JSON.parse(JSON.stringify(e))}exportRSLStyle(){return()=>l(this,null,function*(){var e;if(!this.isAdmin&&!((e=this.access)!=null&&e.hasFestivals)){this.message("You do not have access rights to this feature.");return}this.rslService.exportMusicRSL(this.exportPrep(this.music))})}exportDetailedList(){return()=>l(this,null,function*(){var e;if(!this.isAdmin&&!((e=this.access)!=null&&e.hasFestivals)){this.message("You do not have access rights to this feature.");return}this.rslService.exportMusicDetails(this.exportPrep(this.music))})}exportMusicians(){return()=>l(this,null,function*(){var e;if(!this.isAdmin&&!((e=this.access)!=null&&e.hasFestivals)){this.message("You do not have access rights to this feature.");return}this.rslService.exportMusicians(this.exportPrep(this.music))})}exportEmailList(){return()=>l(this,null,function*(){var e;if(!this.isAdmin&&!((e=this.access)!=null&&e.hasFestivals)){this.message("You do not have access rights to this feature.");return}this.rslService.exportEmailList(this.exportPrep(this.music))})}message(e){setTimeout(()=>{this.api.sendMessage(e)},1)}newMusic(){this.router.navigate(["./new"],{queryParams:{camp:this.campId,nextDay:this.nextDay(this.music)},relativeTo:this.route})}nextDay(e){try{if(e.length==0)return;let t;for(let o of e){let s=JSON.parse(o.occurrences);for(let m of s){let g=new Date(m.startTime);(!t||g>t)&&(t=g)}}if(!t)return;let i=new Date(t);i.setDate(i.getDate()+1);let n=i.toISOString().split("T")[0];return console.log(n),n}catch{return}}};b.\u0275fac=function(t){return new(t||b)},b.\u0275cmp=N({type:b,selectors:[["app-music"]],inputs:{vanity:[1,"vanity"]},decls:13,vars:3,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../music/new"],["name","add"],[3,"buttons"],[3,"fullscreen"],["title","Add Party",3,"press"],[1,"border"],["slot","start",1,"segment"],["mode","ios",3,"ngModelChange","ionChange","ngModel","value"],["value","title"],["value","location"],["routeTo","../music/new",3,"url","title","description"],[1,"ion-padding"],["lines","none",3,"routerLink"],[1,"indent1"],[1,"indent2"],["lines","none"],[3,"music"]],template:function(t,i){t&1&&(c(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),y(3,"ion-back-button"),u(),c(4,"ion-title",2),p(5,"Music"),u(),c(6,"ion-buttons",3)(7,"ion-button",4),y(8,"ion-icon",5),u(),y(9,"app-side",6),u()()(),c(10,"ion-content",7),x(11,kt,13,6),c(12,"app-footer",8),z("press",function(){return i.newMusic()}),u()()),t&2&&(a(9),S("buttons",i.buttons),a(),S("fullscreen",!0),a(),_(i.busy?-1:11))},dependencies:[It,dt,mt,lt,ut,ct,yt,_t,ht,J,k,pt,xt,ft,gt,St,$,G,wt,Mt,vt,W,Lt],styles:["ion-fab[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:20px}ion-fab-button[_ngcontent-%COMP%]{margin-top:-35px;padding:5px}ion-item[_ngcontent-%COMP%]{cursor:pointer}.indent1[_ngcontent-%COMP%]{margin-left:1rem}.indent2[_ngcontent-%COMP%]{margin-left:2rem}.segment[_ngcontent-%COMP%]{position:absolute;margin-left:2rem;margin-top:2rem}h3[_ngcontent-%COMP%]{font-family:Gelion Bold}@media (max-width: 391px){.segment[_ngcontent-%COMP%]{position:relative;margin-left:0;margin-top:0}}"]});var Dt=b;export{Dt as MusicPage};
