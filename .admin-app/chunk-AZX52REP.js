import{a as Pe}from"./chunk-OFUZW7PB.js";import{a as we}from"./chunk-D4LRBUQX.js";import{b as A}from"./chunk-QTBNLBDF.js";import{a as be}from"./chunk-XQO4ZLWR.js";import{a as Se}from"./chunk-NE5K7VVL.js";import{a as ye}from"./chunk-EB7ZKUPJ.js";import{a as xe}from"./chunk-HSBV6RIN.js";import{a as fe}from"./chunk-5EUBO754.js";import{b as _e}from"./chunk-OZ2IKH4J.js";import"./chunk-ZHFJF7NS.js";import"./chunk-A5RC3O7B.js";import"./chunk-CVA27SDO.js";import"./chunk-U5OWWBBZ.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-L4IPHJNS.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-ZMJ3RQA5.js";import"./chunk-MCRJI3T3.js";import"./chunk-QDGYTOUC.js";import"./chunk-VLNXCBKY.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-DUKSTT3K.js";import{A as he,I as Ce,K as ge,a as ue,aa as ve}from"./chunk-TF5OT4X3.js";import{E as R,H as me,I as w,e as de}from"./chunk-CXIDEVKY.js";import"./chunk-PFLI22GG.js";import{$ as I,$a as D,$b as X,Ba as S,Cc as pe,G as a,Gc as le,La as _,O as B,Pa as $,Ra as G,Rb as z,W as u,X as h,Xa as q,Yb as H,Zb as W,_ as k,_b as J,aa as r,ac as Z,ba as s,ca as p,cc as ee,da as d,ec as te,fb as Y,gb as K,ia as L,jb as Q,ka as b,kc as ie,l as V,lc as ne,ma as l,nc as ae,p as g,pc as oe,qa as U,ra as N,s as x,sa as O,t as y,uc as re,vc as se,w as F,wc as ce,yb as j,za as C}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as m}from"./chunk-LNJ3S2LQ.js";var f=class f{constructor(){this.api=g(w)}exportCampsToCSV(t,e){let n=[];for(let c of e)n.push({id:c.id,name:c.name,description:c.description,email:c.contact_email,placed:c.pin!=""?"Yes":"No"});let o=R(t.toLowerCase()," ","-");A(`${o}-camps.csv`,n)}exportCampsEmail(t,e){let n=[];for(let c of e)de(c.contact_email)||n.push({email:c.contact_email});if(n.length==0){this.api.sendMessage("No Camps have email addresses to be exported.");return}let o=R(t.toLowerCase()," ","-");A(`${o}-camp-email.txt`,n,{stripQuotes:!0,hideHeaders:!0})}};f.\u0275fac=function(e){return new(e||f)},f.\u0275prov=V({token:f,factory:f.\u0275fac,providedIn:"root"});var P=f;var Ie=["kmlUpload"],Le=i=>[i],E=i=>({camp:i}),Te=(i,t)=>t.id;function Re(i,t){if(i&1){let e=L();s(0,"ion-toolbar")(1,"ion-searchbar",13),b("ionInput",function(o){x(e);let c=l();return y(c.handleSearch(o))}),p(),s(2,"ion-button",14),b("click",function(){x(e);let o=l();return y(o.toggleGrid())}),d(3,"ion-icon",15),p()()}if(i&2){let e=l();a(),r("debounce",600)("placeholder","Search camps at "+e.title),a(2),r("name",e.isGrid?"list-outline":"grid-outline")}}function Ae(i,t){if(i&1&&d(0,"ion-progress-bar",9),i&2){let e=l();r("value",e.progress)}}function Me(i,t){if(i&1&&d(0,"app-card",17),i&2){let e=l(3);r("title",e.filteredBySearch?"No Camps Found":"No Camps")("description",e.filteredBySearch?"No camps found matching that search":"There are no theme camps registered for "+e.festivalTitle)}}function Ve(i,t){if(i&1&&u(0,Me,1,2,"app-card",17),i&2){let e=l(2);h(e.camps.length===0?0:-1)}}function Fe(i,t){if(i&1&&(s(0,"app-card",18),d(1,"app-img",20),s(2,"ion-button",21),C(3," Register Camp "),p()()),i&2){let e=l(3);r("description","Camp registration for "+e.festivalTitle+" is open."),a(),r("width","100px")("height","100px")("src",e.imageUrl),a(),r("routerLink",e.newRoute())}}function Be(i,t){if(i&1&&d(0,"app-card",19),i&2){let e=l(3);r("description",e.camps.length===0?"Registration for camps at "+e.festivalTitle+" have been disabled. You cannot register a camp at this time.":"Changes to camps at "+e.festivalTitle+" have been disabled. You cannot make any changes at this time.")}}function Ue(i,t){if(i&1&&u(0,Fe,4,5,"app-card",18)(1,Be,1,1,"app-card",19),i&2){let e=l(2);h(e.camps.length===0&&e.api.campRegistration()?0:!e.api.campRegistration()&&!e.api.campEditing()?1:-1)}}function Ne(i,t){i&1&&(s(0,"ion-button",27),d(1,"ion-icon",31),p())}function Oe(i,t){if(i&1&&(s(0,"div",23)(1,"ion-card",24),d(2,"app-img",25),s(3,"ion-card-header",26)(4,"ion-card-title"),C(5),u(6,Ne,2,0,"ion-button",27),p()(),s(7,"ion-card-content"),C(8),s(9,"div",28)(10,"ion-button",29),C(11,"Edit"),p(),s(12,"ion-button",30),C(13,"Events"),p(),s(14,"ion-button",30),C(15,"Music"),p()()()()()),i&2){let e=t.$implicit,n=l(4);a(2),r("routerLink",n.editRoute(e))("src",n.image(e)),a(),r("routerLink",n.editRoute(e)),a(2),S("",e.name," "),a(),h(e.pin?6:-1),a(2),S(" ",e.description," "),a(2),r("disabled",!n.canEditCamp)("routerLink","../camp/"+_(14,Le,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",_(16,E,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../music")("queryParams",_(18,E,e.id))}}function $e(i,t){if(i&1&&(s(0,"div",22),k(1,Oe,16,20,"div",23,Te),p()),i&2){let e=l(3);r("ngClass",e.camps.length>1?"grid":"grid1"),a(),I(e.camps)}}function Ge(i,t){i&1&&d(0,"ion-icon",31)}function qe(i,t){if(i&1&&(s(0,"ion-item"),d(1,"app-img",34),s(2,"ion-text",35),C(3),u(4,Ge,1,0,"ion-icon",31),p(),s(5,"div",4)(6,"ion-button",30),C(7,"Events"),p(),s(8,"ion-button",30),C(9,"Music"),p()()()),i&2){let e=t.$implicit,n=l(4);a(),r("width","45px")("height","45px")("routerLink",n.editRoute(e))("src",n.image(e)),a(),r("routerLink",n.editRoute(e)),a(),S(" ",e.name," "),a(),h(e.pin?4:-1),a(2),r("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",_(13,E,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../music")("queryParams",_(15,E,e.id))}}function De(i,t){if(i&1&&(s(0,"div",32)(1,"ion-card")(2,"ion-list"),k(3,qe,10,17,"ion-item",null,Te),p()()(),d(5,"div",33)(6,"div",33)),i&2){let e=l(3);a(3),I(e.camps)}}function Ye(i,t){if(i&1&&u(0,$e,3,1,"div",22)(1,De,7,0),i&2){let e=l(2);h(e.isGrid?0:1)}}function Ke(i,t){if(i&1&&(s(0,"div",10)(1,"div",16),u(2,Ve,1,1)(3,Ue,2,1),p(),u(4,Ye,2,1),p()),i&2){let e=l();a(),r("ngClass",e.camps.length>0?"":"pad-vertical"),a(),h(e.isAdmin?2:3),a(2),h(e.camps.length>0?4:-1)}}function Qe(i,t){i&1&&d(0,"app-spinner")}function je(i,t){if(i&1&&d(0,"app-footer",11),i&2){let e=l();r("routeTo",e.newRoute())}}var v=class v{constructor(){this.api=g(w);this.router=g(Y);this.campService=g(P);this.store=g(me);this.kml=g(Pe);this.vanity=G();this.camps=[];this.busy=!0;this.isAdmin=!1;this.title="";this.festivalTitle="";this.canRegister=!1;this.canEditCamp=!1;this.canAddCamp=!1;this.canEditEvent=!1;this.filteredBySearch=!1;this.imageUrl="";this.isGrid=!1;this.buttons=[];this.alert=g(xe);this.mapChanges=F({camps:[],art:[],pins:[],newCamps:[],newArt:[]});ve({add:ue,locationSharp:ge,listOutline:Ce,gridOutline:he}),$(()=>m(this,null,function*(){let t=this.mapChanges();if(t.camps.length==0&&t.newCamps.length==0&&t.pins.length==0)return;this.busy=!0;let e=t.camps.length,n=0;for(let c of t.camps)n++,yield this.api.addCamp(c,!0),this.progress=n/e;if(t.pins.length>0){let c=yield this.api.getPins();yield this.api.placePins(this.deduplicate(c,t.pins))}this.busy=!1,console.log(t);let o=yield this.importNewCamps(t.newCamps);this.message(`${t.camps.length} camp changes made. ${t.pins.length} restrooms added. ${o} new camps added.`),this.api.clearCache(),this.ionViewDidEnter()}))}deduplicate(t,e){let n=t;for(let o of e)t.find(c=>c.label==o.label&&c.gpsLat==o.gpsLat&&c.gpsLng==o.gpsLng)||n.push(o);return n}message(t){setTimeout(()=>{this.api.sendMessage(t)},1)}importCSV(){return()=>m(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.router.navigateByUrl("./import")})}importKML(){return()=>m(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.kmlUpload.nativeElement.click()})}exportCSV(){return()=>m(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.exportToCSV()})}toggleGrid(){this.isGrid=!this.isGrid,this.store.set("isGrid",`${!this.isGrid}`)}ngOnInit(){return m(this,null,function*(){var t;yield this.api.setFestivalByVanity(this.vanity(),!0),this.title=`${this.api.festivalTitle()}`,this.festivalTitle=this.api.festivalTitle(),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.imageUrl=(t=this.api.imageURL(this.api.festivalImage()))!=null?t:"",this.canAddCamp=this.api.campRegistration()||this.isAdmin,this.canEditCamp=this.api.campRegistration()||this.api.campEditing()||this.isAdmin,this.canEditEvent=this.api.campRegistration()||this.api.eventEditing()||this.isAdmin,this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"},{title:"Export Email Addresses",method:this.exportEmail(),icon:"mail-outline"},{title:"Import KML",method:this.importKML(),icon:"cloud-upload-outline"}]:[],this.isGrid=this.store.get("isGrid")!=="true"})}exportEmail(){return()=>m(this,null,function*(){this.campService.exportCampsEmail(this.festivalTitle,this.camps)})}ionViewDidEnter(){return m(this,null,function*(){this.camps=yield this.api.camps({cached:!0}),this.filteredBySearch=!1,this.busy=!1})}handleSearch(t){return m(this,null,function*(){let e=t.target.value.toLowerCase(),n=yield this.api.camps({cached:!0});this.camps=n.filter(o=>o.name.toLowerCase().includes(e)),this.filteredBySearch=e.length>0})}editRoute(t){return this.canEditCamp?"../camp/"+t.id:void 0}newRoute(){return this.canEditCamp?"../camp/new":void 0}image(t){return t.imageUrl?this.api.imageURL(t.imageUrl):"./assets/camp.svg"}exportToCSV(){this.campService.exportCampsToCSV(this.festivalTitle,this.camps)}onKMLSelected(t){return m(this,null,function*(){if(!this.isAdmin){this.api.sendMessage("You do not have access rights to this feature.");return}let e=t.target.files[0];if(!e)return;let n=new FileReader;n.onload=o=>m(this,null,function*(){var M;let c=(M=o.target)==null?void 0:M.result,T=this.kml.parse(c,this.camps);this.mapChanges.set(T)}),n.readAsText(e)})}importNewCamps(t){return m(this,null,function*(){let e=0;if(t.length==0)return 0;for(let n of t){let o=yield _e(this.alert,`Create Camp "${n.name}" ?`,"Create");if(o=="Create"&&(yield this.api.addCamp(n,!0),e++),o=="Cancel")return e}return e})}};v.\u0275fac=function(e){return new(e||v)},v.\u0275cmp=B({type:v,selectors:[["app-camps"]],viewQuery:function(e,n){if(e&1&&U(Ie,7),e&2){let o;N(o=O())&&(n.kmlUpload=o.first)}},inputs:{vanity:[1,"vanity"]},decls:18,vars:7,consts:[["kmlUpload",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../camp/new",3,"hidden"],["name","add"],[3,"buttons"],[3,"fullscreen"],[3,"value"],[1,"large-border"],["title","Add Camp",3,"routeTo"],["type","file",1,"file-input",3,"change"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],["color","dark","fill","clear","slot","end",3,"click"],[3,"name"],[1,"ion-text-center",3,"ngClass"],[3,"title","description"],["title","Registration",3,"description"],["title","Camp Registration",3,"description"],["logo","",1,"logo","ion-padding",3,"width","height","src"],["shape","round",3,"routerLink"],[1,"pad-below",3,"ngClass"],[1,"grid-item"],[1,"clickable"],[3,"routerLink","src"],[3,"routerLink"],["fill","clear","color","light",2,"position","absolute","margin-top","-3px"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["color","secondary",3,"disabled","routerLink"],["color","secondary",3,"disabled","routerLink","queryParams"],["size","small","name","location-sharp",1,"pin"],[1,"border"],[1,"ion-padding"],[1,"clickable",2,"min-width","45px",3,"width","height","routerLink","src"],[1,"clickable",2,"width","100%","padding","1rem",3,"routerLink"]],template:function(e,n){if(e&1){let o=L();s(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),d(3,"ion-back-button"),p(),s(4,"ion-title",3),C(5,"Camps"),p(),s(6,"ion-buttons",4)(7,"ion-button",5),d(8,"ion-icon",6),p(),d(9,"app-side",7),p()()(),s(10,"ion-content",8),u(11,Re,4,3,"ion-toolbar"),u(12,Ae,1,1,"ion-progress-bar",9),u(13,Ke,5,3,"div",10)(14,Qe,1,0,"app-spinner"),u(15,je,1,1,"app-footer",11),s(16,"input",12,0),b("change",function(T){return x(o),y(n.onKMLSelected(T))}),p()()}e&2&&(a(7),r("hidden",!n.canAddCamp),a(2),r("buttons",n.buttons),a(),r("fullscreen",!0),a(),h(n.camps.length>1||n.filteredBySearch?11:-1),a(),h(n.progress?12:-1),a(),h(n.busy?14:13),a(2),h(n.isAdmin?15:-1))},dependencies:[re,le,oe,ye,D,q,j,Q,K,ie,ce,W,z,se,H,te,pe,J,Z,ee,X,we,ae,ne,fe,Se,be],styles:["ion-card-title[_ngcontent-%COMP%]{font-size:1.5rem!important}ion-card-content[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:var(--fs4)}h1[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.pin[_ngcontent-%COMP%]{color:var(--ion-color-primary);opacity:.5}.logo[_ngcontent-%COMP%]{--app-background-color: transparent;--border-radius: .5rem}app-img[_ngcontent-%COMP%]{--border-radius: 5px}ion-text[_ngcontent-%COMP%]{font-size:var(--fs4)}"]});var Ee=v;export{Ee as CampsPage};
