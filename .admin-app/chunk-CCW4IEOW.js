import{a as Kt}from"./chunk-K3UGTFX7.js";import{a as kt}from"./chunk-67ONBALU.js";import{b as Oe}from"./chunk-OZ2IKH4J.js";import{G as Dt,L as Lt,S as Tt,ca as Nt,d as Ot,ea as Bt,h as St,w as Ft}from"./chunk-MQOPPKG3.js";import{J as ge}from"./chunk-2K4NO5ZT.js";import"./chunk-PFLI22GG.js";import{$ as j,Aa as E,Ba as D,Bc as yt,Ca as Me,Cb as at,Cc as Et,Dc as Pt,Ea as Je,Ec as Mt,Fa as Ze,G as m,Ga as qe,Gc as bt,O as ce,Oa as U,Pa as G,Sa as oe,Ta as be,Ua as de,Va as et,W as O,X as S,Yb as lt,Zb as ct,_ as W,aa as F,ac as ut,ba as h,bb as tt,bc as mt,ca as p,cb as pe,cc as dt,da as Pe,dc as pt,ec as ht,fc as gt,gb as nt,hc as ft,ia as re,ib as it,ic as Ct,ka as ee,kc as he,l as le,ma as I,p as K,pb as rt,qc as _t,rc as wt,s as Z,sb as ot,t as q,ta as ue,tc as vt,ua as me,uc as At,vb as st,vc as It,w as L,wc as xt,za as _}from"./chunk-OCTOJKK3.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{a as B,b as Xe,h as k}from"./chunk-LNJ3S2LQ.js";function $t(i){let t=i.split(`
`),e=[];for(let n of t){let r=n.split(",");r.length>=2&&e.push({lat:parseFloat(r[1].trim()),lng:parseFloat(r[0].trim())})}return e.length==0?{lat:-1,lng:-1}:(e[e.length-1].lng==e[0].lng&&e[e.length-1].lat==e[0].lat&&e.length>1&&e.pop(),e.length==1?e[0]:rn(e))}function Rt(i,t){let e=t.map(o=>i=="lat"?o.lat:o.lng),n=Math.min(...e),r=Math.max(...e);i==="lng"&&r-n>180&&(e=e.map(o=>o<r-180?o+360:o),n=Math.min(...e),r=Math.max(...e));let s=(n+r)/2;return i==="lng"&&s>180&&(s-=360),s}function rn(i){return{lat:Rt("lat",i),lng:Rt("lng",i)}}function R(i){return Array.isArray?Array.isArray(i):Qt(i)==="[object Array]"}var on=1/0;function sn(i){if(typeof i=="string")return i;let t=i+"";return t=="0"&&1/i==-on?"-0":t}function an(i){return i==null?"":sn(i)}function T(i){return typeof i=="string"}function Ht(i){return typeof i=="number"}function ln(i){return i===!0||i===!1||cn(i)&&Qt(i)=="[object Boolean]"}function Yt(i){return typeof i=="object"}function cn(i){return Yt(i)&&i!==null}function P(i){return i!=null}function Se(i){return!i.trim().length}function Qt(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}var un="Incorrect 'index' type",mn=i=>`Invalid value for key ${i}`,dn=i=>`Pattern length exceeds max of ${i}.`,pn=i=>`Missing ${i} property in key`,hn=i=>`Property 'weight' in key '${i}' must be a positive integer`,Vt=Object.prototype.hasOwnProperty,Fe=class{constructor(t){this._keys=[],this._keyMap={};let e=0;t.forEach(n=>{let r=Xt(n);this._keys.push(r),this._keyMap[r.id]=r,e+=r.weight}),this._keys.forEach(n=>{n.weight/=e})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function Xt(i){let t=null,e=null,n=null,r=1,s=null;if(T(i)||R(i))n=i,t=Wt(i),e=De(i);else{if(!Vt.call(i,"name"))throw new Error(pn("name"));let o=i.name;if(n=o,Vt.call(i,"weight")&&(r=i.weight,r<=0))throw new Error(hn(o));t=Wt(o),e=De(o),s=i.getFn}return{path:t,id:e,weight:r,src:n,getFn:s}}function Wt(i){return R(i)?i:i.split(".")}function De(i){return R(i)?i.join("."):i}function gn(i,t){let e=[],n=!1,r=(s,o,a)=>{if(P(s))if(!o[a])e.push(s);else{let c=o[a],l=s[c];if(!P(l))return;if(a===o.length-1&&(T(l)||Ht(l)||ln(l)))e.push(an(l));else if(R(l)){n=!0;for(let u=0,g=l.length;u<g;u+=1)r(l[u],o,a+1)}else o.length&&r(l,o,a+1)}};return r(i,T(t)?t.split("."):t,0),n?e:e[0]}var fn={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},Cn={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(i,t)=>i.score===t.score?i.idx<t.idx?-1:1:i.score<t.score?-1:1},_n={location:0,threshold:.6,distance:100},wn={useExtendedSearch:!1,getFn:gn,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},C=B(B(B(B({},Cn),fn),_n),wn),vn=/[^ ]+/g;function An(i=1,t=3){let e=new Map,n=Math.pow(10,t);return{get(r){let s=r.match(vn).length;if(e.has(s))return e.get(s);let o=1/Math.pow(s,.5*i),a=parseFloat(Math.round(o*n)/n);return e.set(s,a),a},clear(){e.clear()}}}var se=class{constructor({getFn:t=C.getFn,fieldNormWeight:e=C.fieldNormWeight}={}){this.norm=An(e,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((e,n)=>{this._keysMap[e.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,T(this.docs[0])?this.docs.forEach((t,e)=>{this._addString(t,e)}):this.docs.forEach((t,e)=>{this._addObject(t,e)}),this.norm.clear())}add(t){let e=this.size();T(t)?this._addString(t,e):this._addObject(t,e)}removeAt(t){this.records.splice(t,1);for(let e=t,n=this.size();e<n;e+=1)this.records[e].i-=1}getValueForItemAtKeyId(t,e){return t[this._keysMap[e]]}size(){return this.records.length}_addString(t,e){if(!P(t)||Se(t))return;let n={v:t,i:e,n:this.norm.get(t)};this.records.push(n)}_addObject(t,e){let n={i:e,$:{}};this.keys.forEach((r,s)=>{let o=r.getFn?r.getFn(t):this.getFn(t,r.path);if(P(o)){if(R(o)){let a=[],c=[{nestedArrIndex:-1,value:o}];for(;c.length;){let{nestedArrIndex:l,value:u}=c.pop();if(P(u))if(T(u)&&!Se(u)){let g={v:u,i:l,n:this.norm.get(u)};a.push(g)}else R(u)&&u.forEach((g,d)=>{c.push({nestedArrIndex:d,value:g})})}n.$[s]=a}else if(T(o)&&!Se(o)){let a={v:o,n:this.norm.get(o)};n.$[s]=a}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}};function jt(i,t,{getFn:e=C.getFn,fieldNormWeight:n=C.fieldNormWeight}={}){let r=new se({getFn:e,fieldNormWeight:n});return r.setKeys(i.map(Xt)),r.setSources(t),r.create(),r}function In(i,{getFn:t=C.getFn,fieldNormWeight:e=C.fieldNormWeight}={}){let{keys:n,records:r}=i,s=new se({getFn:t,fieldNormWeight:e});return s.setKeys(n),s.setIndexRecords(r),s}function fe(i,{errors:t=0,currentLocation:e=0,expectedLocation:n=0,distance:r=C.distance,ignoreLocation:s=C.ignoreLocation}={}){let o=t/i.length;if(s)return o;let a=Math.abs(n-e);return r?o+a/r:a?1:o}function xn(i=[],t=C.minMatchCharLength){let e=[],n=-1,r=-1,s=0;for(let o=i.length;s<o;s+=1){let a=i[s];a&&n===-1?n=s:!a&&n!==-1&&(r=s-1,r-n+1>=t&&e.push([n,r]),n=-1)}return i[s-1]&&s-n>=t&&e.push([n,s-1]),e}var H=32;function yn(i,t,e,{location:n=C.location,distance:r=C.distance,threshold:s=C.threshold,findAllMatches:o=C.findAllMatches,minMatchCharLength:a=C.minMatchCharLength,includeMatches:c=C.includeMatches,ignoreLocation:l=C.ignoreLocation}={}){if(t.length>H)throw new Error(dn(H));let u=t.length,g=i.length,d=Math.max(0,Math.min(n,g)),f=s,w=d,A=a>1||c,v=A?Array(g):[],x;for(;(x=i.indexOf(t,w))>-1;){let M=fe(t,{currentLocation:x,expectedLocation:d,distance:r,ignoreLocation:l});if(f=Math.min(M,f),w=x+u,A){let $=0;for(;$<u;)v[x+$]=1,$+=1}}w=-1;let y=[],X=1,z=u+g,nn=1<<u-1;for(let M=0;M<u;M+=1){let $=0,V=z;for(;$<V;)fe(t,{errors:M,currentLocation:d+V,expectedLocation:d,distance:r,ignoreLocation:l})<=f?$=V:z=V,V=Math.floor((z-$)/2+$);z=V;let Ye=Math.max(1,d-V+1),Ee=o?g:Math.min(d+V,g)+u,J=Array(Ee+2);J[Ee+1]=(1<<M)-1;for(let b=Ee;b>=Ye;b-=1){let ae=b-1,Qe=e[i.charAt(ae)];if(A&&(v[ae]=+!!Qe),J[b]=(J[b+1]<<1|1)&Qe,M&&(J[b]|=(y[b+1]|y[b])<<1|1|y[b+1]),J[b]&nn&&(X=fe(t,{errors:M,currentLocation:ae,expectedLocation:d,distance:r,ignoreLocation:l}),X<=f)){if(f=X,w=ae,w<=d)break;Ye=Math.max(1,2*d-w)}}if(fe(t,{errors:M+1,currentLocation:d,expectedLocation:d,distance:r,ignoreLocation:l})>f)break;y=J}let ye={isMatch:w>=0,score:Math.max(.001,X)};if(A){let M=xn(v,a);M.length?c&&(ye.indices=M):ye.isMatch=!1}return ye}function En(i){let t={};for(let e=0,n=i.length;e<n;e+=1){let r=i.charAt(e);t[r]=(t[r]||0)|1<<n-e-1}return t}var Ce=String.prototype.normalize?i=>i.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):i=>i,_e=class{constructor(t,{location:e=C.location,threshold:n=C.threshold,distance:r=C.distance,includeMatches:s=C.includeMatches,findAllMatches:o=C.findAllMatches,minMatchCharLength:a=C.minMatchCharLength,isCaseSensitive:c=C.isCaseSensitive,ignoreDiacritics:l=C.ignoreDiacritics,ignoreLocation:u=C.ignoreLocation}={}){if(this.options={location:e,threshold:n,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:c,ignoreDiacritics:l,ignoreLocation:u},t=c?t:t.toLowerCase(),t=l?Ce(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;let g=(f,w)=>{this.chunks.push({pattern:f,alphabet:En(f),startIndex:w})},d=this.pattern.length;if(d>H){let f=0,w=d%H,A=d-w;for(;f<A;)g(this.pattern.substr(f,H),f),f+=H;if(w){let v=d-H;g(this.pattern.substr(v),v)}}else g(this.pattern,0)}searchIn(t){let{isCaseSensitive:e,ignoreDiacritics:n,includeMatches:r}=this.options;if(t=e?t:t.toLowerCase(),t=n?Ce(t):t,this.pattern===t){let A={isMatch:!0,score:0};return r&&(A.indices=[[0,t.length-1]]),A}let{location:s,distance:o,threshold:a,findAllMatches:c,minMatchCharLength:l,ignoreLocation:u}=this.options,g=[],d=0,f=!1;this.chunks.forEach(({pattern:A,alphabet:v,startIndex:x})=>{let{isMatch:y,score:X,indices:z}=yn(t,A,v,{location:s+x,distance:o,threshold:a,findAllMatches:c,minMatchCharLength:l,includeMatches:r,ignoreLocation:u});y&&(f=!0),d+=X,y&&z&&(g=[...g,...z])});let w={isMatch:f,score:f?d/this.chunks.length:1};return f&&r&&(w.indices=g),w}},N=class{constructor(t){this.pattern=t}static isMultiMatch(t){return zt(t,this.multiRegex)}static isSingleMatch(t){return zt(t,this.singleRegex)}search(){}};function zt(i,t){let e=i.match(t);return e?e[1]:null}var Le=class extends N{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){let e=t===this.pattern;return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}},Te=class extends N{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){let n=t.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}},Ne=class extends N{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){let e=t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}},Be=class extends N{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){let e=!t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}},ke=class extends N{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){let e=t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[t.length-this.pattern.length,t.length-1]}}},Ke=class extends N{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){let e=!t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}},we=class extends N{constructor(t,{location:e=C.location,threshold:n=C.threshold,distance:r=C.distance,includeMatches:s=C.includeMatches,findAllMatches:o=C.findAllMatches,minMatchCharLength:a=C.minMatchCharLength,isCaseSensitive:c=C.isCaseSensitive,ignoreDiacritics:l=C.ignoreDiacritics,ignoreLocation:u=C.ignoreLocation}={}){super(t),this._bitapSearch=new _e(t,{location:e,threshold:n,distance:r,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:c,ignoreDiacritics:l,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}},ve=class extends N{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let e=0,n,r=[],s=this.pattern.length;for(;(n=t.indexOf(this.pattern,e))>-1;)e=n+s,r.push([n,e-1]);let o=!!r.length;return{isMatch:o,score:o?0:1,indices:r}}},Re=[Le,ve,Ne,Be,Ke,ke,Te,we],Ut=Re.length,Pn=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Mn="|";function bn(i,t={}){return i.split(Mn).map(e=>{let n=e.trim().split(Pn).filter(s=>s&&!!s.trim()),r=[];for(let s=0,o=n.length;s<o;s+=1){let a=n[s],c=!1,l=-1;for(;!c&&++l<Ut;){let u=Re[l],g=u.isMultiMatch(a);g&&(r.push(new u(g,t)),c=!0)}if(!c)for(l=-1;++l<Ut;){let u=Re[l],g=u.isSingleMatch(a);if(g){r.push(new u(g,t));break}}}return r})}var On=new Set([we.type,ve.type]),$e=class{constructor(t,{isCaseSensitive:e=C.isCaseSensitive,ignoreDiacritics:n=C.ignoreDiacritics,includeMatches:r=C.includeMatches,minMatchCharLength:s=C.minMatchCharLength,ignoreLocation:o=C.ignoreLocation,findAllMatches:a=C.findAllMatches,location:c=C.location,threshold:l=C.threshold,distance:u=C.distance}={}){this.query=null,this.options={isCaseSensitive:e,ignoreDiacritics:n,includeMatches:r,minMatchCharLength:s,findAllMatches:a,ignoreLocation:o,location:c,threshold:l,distance:u},t=e?t:t.toLowerCase(),t=n?Ce(t):t,this.pattern=t,this.query=bn(this.pattern,this.options)}static condition(t,e){return e.useExtendedSearch}searchIn(t){let e=this.query;if(!e)return{isMatch:!1,score:1};let{includeMatches:n,isCaseSensitive:r,ignoreDiacritics:s}=this.options;t=r?t:t.toLowerCase(),t=s?Ce(t):t;let o=0,a=[],c=0;for(let l=0,u=e.length;l<u;l+=1){let g=e[l];a.length=0,o=0;for(let d=0,f=g.length;d<f;d+=1){let w=g[d],{isMatch:A,indices:v,score:x}=w.search(t);if(A){if(o+=1,c+=x,n){let y=w.constructor.type;On.has(y)?a=[...a,...v]:a.push(v)}}else{c=0,o=0,a.length=0;break}}if(o){let d={isMatch:!0,score:c/o};return n&&(d.indices=a),d}}return{isMatch:!1,score:1}}},Ve=[];function Sn(...i){Ve.push(...i)}function We(i,t){for(let e=0,n=Ve.length;e<n;e+=1){let r=Ve[e];if(r.condition(i,t))return new r(i,t)}return new _e(i,t)}var Ae={AND:"$and",OR:"$or"},je={PATH:"$path",PATTERN:"$val"},ze=i=>!!(i[Ae.AND]||i[Ae.OR]),Fn=i=>!!i[je.PATH],Dn=i=>!R(i)&&Yt(i)&&!ze(i),Gt=i=>({[Ae.AND]:Object.keys(i).map(t=>({[t]:i[t]}))});function Jt(i,t,{auto:e=!0}={}){let n=r=>{let s=Object.keys(r),o=Fn(r);if(!o&&s.length>1&&!ze(r))return n(Gt(r));if(Dn(r)){let c=o?r[je.PATH]:s[0],l=o?r[je.PATTERN]:r[c];if(!T(l))throw new Error(mn(c));let u={keyId:De(c),pattern:l};return e&&(u.searcher=We(l,t)),u}let a={children:[],operator:s[0]};return s.forEach(c=>{let l=r[c];R(l)&&l.forEach(u=>{a.children.push(n(u))})}),a};return ze(i)||(i=Gt(i)),n(i)}function Ln(i,{ignoreFieldNorm:t=C.ignoreFieldNorm}){i.forEach(e=>{let n=1;e.matches.forEach(({key:r,norm:s,score:o})=>{let a=r?r.weight:null;n*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(t?1:s))}),e.score=n})}function Tn(i,t){let e=i.matches;t.matches=[],P(e)&&e.forEach(n=>{if(!P(n.indices)||!n.indices.length)return;let{indices:r,value:s}=n,o={indices:r,value:s};n.key&&(o.key=n.key.src),n.idx>-1&&(o.refIndex=n.idx),t.matches.push(o)})}function Nn(i,t){t.score=i.score}function Bn(i,t,{includeMatches:e=C.includeMatches,includeScore:n=C.includeScore}={}){let r=[];return e&&r.push(Tn),n&&r.push(Nn),i.map(s=>{let{idx:o}=s,a={item:t[o],refIndex:o};return r.length&&r.forEach(c=>{c(s,a)}),a})}var Ue=(()=>{class i{constructor(e,n={},r){this.options=B(B({},C),n),this.options.useExtendedSearch,this._keyStore=new Fe(this.options.keys),this.setCollection(e,r)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof se))throw new Error(un);this._myIndex=n||jt(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){P(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){let n=[];for(let r=0,s=this._docs.length;r<s;r+=1){let o=this._docs[r];e(o,r)&&(this.removeAt(r),r-=1,s-=1,n.push(o))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){let{includeMatches:r,includeScore:s,shouldSort:o,sortFn:a,ignoreFieldNorm:c}=this.options,l=T(e)?T(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Ln(l,{ignoreFieldNorm:c}),o&&l.sort(a),Ht(n)&&n>-1&&(l=l.slice(0,n)),Bn(l,this._docs,{includeMatches:r,includeScore:s})}_searchStringList(e){let n=We(e,this.options),{records:r}=this._myIndex,s=[];return r.forEach(({v:o,i:a,n:c})=>{if(!P(o))return;let{isMatch:l,score:u,indices:g}=n.searchIn(o);l&&s.push({item:o,idx:a,matches:[{score:u,value:o,norm:c,indices:g}]})}),s}_searchLogical(e){let n=Jt(e,this.options),r=(c,l,u)=>{if(!c.children){let{keyId:d,searcher:f}=c,w=this._findMatches({key:this._keyStore.get(d),value:this._myIndex.getValueForItemAtKeyId(l,d),searcher:f});return w&&w.length?[{idx:u,item:l,matches:w}]:[]}let g=[];for(let d=0,f=c.children.length;d<f;d+=1){let w=c.children[d],A=r(w,l,u);if(A.length)g.push(...A);else if(c.operator===Ae.AND)return[]}return g},s=this._myIndex.records,o={},a=[];return s.forEach(({$:c,i:l})=>{if(P(c)){let u=r(n,c,l);u.length&&(o[l]||(o[l]={idx:l,item:c,matches:[]},a.push(o[l])),u.forEach(({matches:g})=>{o[l].matches.push(...g)}))}}),a}_searchObjectList(e){let n=We(e,this.options),{keys:r,records:s}=this._myIndex,o=[];return s.forEach(({$:a,i:c})=>{if(!P(a))return;let l=[];r.forEach((u,g)=>{l.push(...this._findMatches({key:u,value:a[g],searcher:n}))}),l.length&&o.push({idx:c,item:a,matches:l})}),o}_findMatches({key:e,value:n,searcher:r}){if(!P(n))return[];let s=[];if(R(n))n.forEach(({v:o,i:a,n:c})=>{if(!P(o))return;let{isMatch:l,score:u,indices:g}=r.searchIn(o);l&&s.push({score:u,key:e,value:o,idx:a,norm:c,indices:g})});else{let{v:o,n:a}=n,{isMatch:c,score:l,indices:u}=r.searchIn(o);c&&s.push({score:l,key:e,value:o,norm:a,indices:u})}return s}}return i.version="7.1.0",i.createIndex=jt,i.parseIndex=In,i.config=C,i})();Ue.parseQuery=Jt;Sn($e);function Zt(i,t){let e=[],n=[],r=0;if(!i||i.trim().length===0)return e.push({type:"EMPTY_FILE",message:"The selected file is empty.",details:"Please select a KML file that contains geographic data."}),{isValid:!1,errors:e,warnings:n,placemarkCount:r};if(t!==void 0&&t>10485760)return e.push({type:"FILE_TOO_LARGE",message:"The file is too large to process.",details:`Maximum file size is ${10485760/(1024*1024)}MB. Your file is ${(t/(1024*1024)).toFixed(2)}MB.`}),{isValid:!1,errors:e,warnings:n,placemarkCount:r};let s=i.includes("<kml")||i.includes("<KML"),o=i.includes("<Document")||i.includes("<Folder")||i.includes("<document")||i.includes("<folder");if(!s&&!o)return i.includes("<?xml")&&!s?e.push({type:"INVALID_FORMAT",message:"The file appears to be XML but not a valid KML file.",details:"Please ensure you are uploading a KML file with geographic placemarks."}):e.push({type:"INVALID_FORMAT",message:"The file does not appear to be a valid KML file.",details:"KML files should contain <kml> or <Document> tags."}),{isValid:!1,errors:e,warnings:n,placemarkCount:r};let a=i.match(/<Placemark>/gi);return r=a?a.length:0,r===0?(e.push({type:"NO_PLACEMARKS",message:"No placemarks found in the KML file.",details:"The file must contain at least one <Placemark> element with coordinates."}),{isValid:!1,errors:e,warnings:n,placemarkCount:r}):{isValid:!0,errors:e,warnings:n,placemarkCount:r}}function qt(i){if(!i||i.trim().length===0)return;let e=i.trim().split(`
`);for(let n of e){let r=n.split(",");if(r.length>=2){let s=parseFloat(r[0].trim()),o=parseFloat(r[1].trim());if(!isNaN(o)&&!isNaN(s)&&isFinite(o)&&isFinite(s)&&o>=-90&&o<=90&&s>=-180&&s<=180)return{lat:o,lng:s}}}}var Y=class Y{constructor(){}validate(t,e){return Zt(t,e)}parseWithValidation(t,e,n=!1,r){let s=[],o=[],a={camps:[],art:[],pins:[],newCamps:[],newArt:[]},c=this.validate(t,r);if(!c.isValid)return{changes:a,validation:c,errors:c.errors,warnings:c.warnings,success:!1};if(!e)return s.push({type:"DATA_UNAVAILABLE",message:"Unable to load existing data for comparison.",details:"Please try again or contact support if the issue persists."}),{changes:a,validation:c,errors:s,warnings:o,success:!1};try{let l=this.parse(t,e,n),u=t.split("<Placemark>");for(let g of u){let d=this.extractBetweenTags(g,"name").replace("<![CDATA[","").replace("]]>","").trim();if(d.length>0){let f=this.extractBetweenTags(g,"coordinates");!qt(f)&&f.trim().length>0&&o.push({type:"MALFORMED_COORDINATES",message:`Coordinates could not be parsed for "${d}".`,placemarkName:d,details:"This placemark will be skipped."})}}return{changes:l,validation:c,errors:s,warnings:o,success:!0}}catch(l){return s.push({type:"INVALID_FORMAT",message:"An error occurred while parsing the KML file.",details:l instanceof Error?l.message:"Unknown error"}),{changes:a,validation:c,errors:s,warnings:o,success:!1}}}parse(t,e,n=!1){var l;let r={camps:[],art:[],pins:[],newCamps:[],newArt:[]},s=t.split("<Placemark>"),o=0,a=[],c=0;for(let u of s){c++;let g=this.extractBetweenTags(u,"name").replace(" sc","").replace("<![cdata[","").replace("<![CDATA[","").replace("]]>","").replace(/\r/g,"").replace(/\n/g,"").trim(),d=g.toLowerCase(),f=this.extractBetweenTags(u,"description").replace(" sc","").replace("<![CDATA[","").replace("]]>","").replace(/\r/g,"").replace(/\n/g,"").replace(/<br>/g,`\r
`).trim(),w=$t(this.extractBetweenTags(u,"coordinates")),A;for(let v of e){if(v.externalId&&d.endsWith(v.externalId)){A=v;break}if(this.campNameMatch(d,v.name)){A=v;break}if(this.matchWithoutNumbers(d,v.name)){A=v;break}v.ref=this.cleanString(v.name)}if(A==null){let x=new Ue(e,{keys:["ref"],ignoreLocation:!0,includeScore:!0}).search(this.cleanString(d),{limit:1});if(x.length>0){A=x[0].item;let y=(l=x[0].score)!=null?l:0;y<.2?console.warn(`"${d}" close match is ${x[0].item.name} score ${y}`):A=void 0}}if(A){let v=Xe(B({},A),{pin:JSON.stringify(w)});(n?r.art.find(y=>y.id==v.id):r.camps.find(y=>y.id==v.id))||(n?r.art.push(v):r.camps.push(v)),o++}else d.includes("shuttle stop")?r.pins.push({label:"Shuttle Stop",gpsLat:w.lat,gpsLng:w.lng,x:0,y:0}):d.includes("porto")||d.includes("restroom")||d.includes("toilet")||d.includes("potty")||d.includes("potties")||d.includes("port-o")?r.pins.push({label:"Restrooms",gpsLat:w.lat,gpsLng:w.lng,x:0,y:0}):(a.push(`"${d}" at ${JSON.stringify(w)} does not match. (${this.withoutCamp(d)})`),f==""&&(f=`${g} does not have a description.`),g.length>0&&(n?r.newArt.push({id:void 0,contact_email:"",art_type:"Art",category:"Art",name:g,description:f,pin:JSON.stringify(w),imageUrl:void 0,externalId:void 0}):r.newCamps.push({id:void 0,contact_email:"",camp_type:"Theme Camp",name:g,description:f,pin:JSON.stringify(w),imageUrl:void 0,externalId:void 0,publicEvents:!1})))}console.log(`Found ${o} of ${c} matches`,r);for(let u of a)console.error(u);return r}withoutCamp(t){return this.cleanString(t).replace("camp ","").replace(" camp","")}cleanString(t){let e=this.noEmojis(t.toLowerCase()).trim();return e=e.replace(" - ","-"),e=e.replace(/[^\x00-\x7F]/g,""),e=e.replace(/[-.]/g,""),e=e.replace(/\d/g,"").trim(),e}noEmojis(t){return t.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"").replace(/'/g,"").replace(/`/g,"").replace(/&/g,"and").replace("/-/g","").replace(/the/g,"")}campNameMatch(t,e){return this.withoutCamp(t)===this.withoutCamp(e)}matchWithoutNumbers(t,e){return t===e?!0:e?!isNaN(parseInt(t.charAt(0)))&&this.removeFirstWord(t).trim().toLowerCase()===e.trim().toLowerCase():!1}removeFirstWord(t){let e=t.trim().split(/\s+/);return e.shift(),e.join(" ")}extractBetweenTags(t,e){let n=`<${e}>`,r=`</${e}>`,s=t.indexOf(n);if(s===-1)return"";let o=t.indexOf(r,s);return o===-1?"":t.substring(s+n.length,o)}};Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275prov=le({token:Y,factory:Y.\u0275fac,providedIn:"root"});var Ie=Y;var Kn=1e3,Q=class Q{constructor(){this.COORDINATE_PRECISION=6}categorizeResultsWithValidation(t,e,n){let r=[],s=[],o={locationChanges:[],noChanges:[],newItems:[],unmatchedItems:[],specialPins:[],summary:{totalPlacemarks:0,locationChanges:0,noChanges:0,newItems:0,unmatchedItems:0,specialPins:0}};if(!e)return r.push({type:"DATA_UNAVAILABLE",message:`Unable to load existing ${n} data.`,details:"The preview cannot be generated without existing data to compare against."}),{data:o,errors:r,warnings:s,success:!1};e.length===0&&s.push({type:"DATA_UNAVAILABLE",message:`No existing ${n} found.`,details:"All placemarks will be treated as new items."});try{let a=this.categorizeResults(t,e,n),c=a.summary.totalPlacemarks+a.summary.unmatchedItems;c>Kn&&s.push({type:"FILE_TOO_LARGE",message:`Large file detected (${c} items).`,details:"Processing may take longer than usual."});let l=n==="camps"?t.camps:t.art;for(let u of l)!this.parseCoordinates(u.pin)&&u.pin&&u.pin!==""&&u.pin!=="undefined"&&s.push({type:"MALFORMED_COORDINATES",message:`Could not parse coordinates for "${u.name}" (${u.pin}).`,placemarkName:u.name});return{data:a,errors:r,warnings:s,success:!0}}catch(a){return r.push({type:"INVALID_FORMAT",message:"An error occurred while categorizing the import results.",details:a instanceof Error?a.message:"Unknown error"}),{data:o,errors:r,warnings:s,success:!1}}}categorizeResults(t,e,n){let r=[],s=[],o=[],a=[],c=n==="camps"?t.camps:t.art,l=n==="camps"?t.newCamps:t.newArt,u=new Set;for(let f of c){f.id!==void 0&&u.add(f.id);let w=e.find(y=>y.id===f.id),A=w?this.parseCoordinates(w.pin):void 0,v=this.parseCoordinates(f.pin),x={id:f.id,name:f.name,type:n==="camps"?"camp":"art",currentCoordinates:A,newCoordinates:v};A&&v?this.compareCoordinates(A,v)?s.push(x):r.push(x):v?r.push(x):s.push(x)}for(let f of l){let w=this.parseCoordinates(f.pin);o.push({id:void 0,name:f.name,type:n==="camps"?"camp":"art",newCoordinates:w,description:f.description})}for(let f of t.pins)a.push({id:void 0,name:f.label,type:"pin",newCoordinates:f.gpsLat!==void 0&&f.gpsLng!==void 0?{lat:f.gpsLat,lng:f.gpsLng}:void 0,pinType:f.label});let g=this.identifyUnmatchedItems(e,u,n),d=this.calculateSummary(r,s,o,g,a);return{locationChanges:r,noChanges:s,newItems:o,unmatchedItems:g,specialPins:a,summary:d}}compareCoordinates(t,e){let n=this.roundToPrecision(t.lat),r=this.roundToPrecision(t.lng),s=this.roundToPrecision(e.lat),o=this.roundToPrecision(e.lng);return n===s&&r===o}formatCoordinates(t){let e=t.lat.toFixed(this.COORDINATE_PRECISION),n=t.lng.toFixed(this.COORDINATE_PRECISION);return`${e}, ${n}`}identifyUnmatchedItems(t,e,n){let r=[];for(let s of t)if(s.id!==void 0&&!e.has(s.id)){let o=this.parseCoordinates(s.pin);r.push({id:s.id,name:s.name,type:n==="camps"?"camp":"art",currentCoordinates:o})}return r}parseCoordinates(t){if(!(!t||t===""||t==="undefined"))try{let e=JSON.parse(t);return typeof e.lat=="number"&&typeof e.lng=="number"?e.lat===-1&&e.lng===-1||!this.isValidCoordinate(e.lat,e.lng)?void 0:{lat:e.lat,lng:e.lng}:void 0}catch{return}}isValidCoordinate(t,e){return!isFinite(t)||!isFinite(e)||isNaN(t)||isNaN(e)?!1:t>=-90&&t<=90&&e>=-180&&e<=180}roundToPrecision(t){let e=Math.pow(10,this.COORDINATE_PRECISION);return Math.round(t*e)/e}calculateSummary(t,e,n,r,s){return{totalPlacemarks:t.length+e.length+n.length+s.length,locationChanges:t.length,noChanges:e.length,newItems:n.length,unmatchedItems:r.length,specialPins:s.length}}};Q.\u0275fac=function(e){return new(e||Q)},Q.\u0275prov=le({token:Q,factory:Q.\u0275fac,providedIn:"root"});var xe=Q;var $n=["fileInput"],He=(i,t)=>{var e;return(e=t.id)!=null?e:t.name},Vn=(i,t)=>{var e,n;return(n=t.id)!=null?n:t.name+((e=t.newCoordinates==null?null:t.newCoordinates.lat)!=null?e:0)},Wn=(i,t)=>{var e;return t.name+((e=t.newCoordinates==null?null:t.newCoordinates.lat)!=null?e:0)},en=(i,t)=>t.message;function jn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),p(),h(3,"ion-note",14),_(4),p()()),i&2){let e=t.$implicit,n=I(4);m(2),E(e.name),m(2),E(n.formatCoordinates(e))}}function zn(i,t){if(i&1&&(h(0,"p",22),_(1),U(2,"lowercase"),p(),h(3,"ion-list",23),W(4,jn,5,2,"ion-item",null,He),p()),i&2){let e=I(),n=I(2);m(),D(" These ",G(2,2,n.getItemTypeLabelPlural())," were found in the KML file with updated locations. "),m(2),F("inset",!0),m(),j(e.locationChanges)}}function Un(i,t){if(i&1&&(h(0,"p"),_(1),U(2,"lowercase"),p()),i&2){let e=I(3);m(),D(" No location changes for ",G(2,1,e.getItemTypeLabelPlural())," were found. ")}}function Gn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),p(),h(3,"ion-note",14),_(4),p()()),i&2){let e=t.$implicit,n=I(4);m(2),E(e.name),m(2),E(n.formatCoordinates(e))}}function Hn(i,t){if(i&1&&(h(0,"ion-accordion",17)(1,"ion-item",24)(2,"ion-label"),_(3,"No Changes"),p(),h(4,"ion-note",14),_(5),p()(),h(6,"div",15)(7,"p",22),_(8),U(9,"lowercase"),p(),h(10,"ion-list",23),W(11,Gn,5,2,"ion-item",null,He),p()()()),i&2){let e=I(),n=I(2);m(5),E(e.noChanges.length),m(3),D(" These are ",G(9,3,n.getItemTypeLabelPlural())," were found in the KML file but had no changes to location. "),m(2),F("inset",!0),m(),j(e.noChanges)}}function Yn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),p(),h(3,"ion-note",14),_(4),p()()),i&2){let e=t.$implicit,n=I(4);m(2),D(" ",e.name," "),m(2),E(n.formatCoordinates(e))}}function Qn(i,t){if(i&1){let e=re();h(0,"ion-accordion",18)(1,"ion-item",25)(2,"ion-label"),_(3),p(),h(4,"ion-badge",26),_(5),p()(),h(6,"div",15)(7,"p",22),_(8),U(9,"lowercase"),p(),h(10,"div")(11,"ion-item")(12,"ion-label")(13,"input",27),qe("ngModelChange",function(r){Z(e);let s=I(3);return Ze(s.importNewItems,r)||(s.importNewItems=r),q(r)}),p(),_(14),p()()(),h(15,"ion-list",23),W(16,Yn,5,2,"ion-item",null,Vn),p()()()}if(i&2){let e=I(),n=I(2);m(3),E(n.getNewItemsLabel()),m(2),E(e.newItems.length),m(3),D(" These are placemarks in the KML that do not match existing ",G(9,6,n.getItemTypeLabelPlural()),". They may be named differently (in which case you should fix Google Maps to match). "),m(5),Je("ngModel",n.importNewItems),m(),D(" Import as New ",n.getItemTypeLabelPlural()),m(),F("inset",!0),m(),j(e.newItems)}}function Xn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),h(3,"p"),_(4),p()(),h(5,"ion-note",14),_(6),p()()),i&2){let e=t.$implicit,n=I(4);m(2),D(" ",e.name," "),m(2),E(n.getUnmatchedDescription()),m(2),E(n.formatCoordinates(e))}}function Jn(i,t){if(i&1&&(h(0,"ion-accordion",19)(1,"ion-item",28)(2,"ion-label"),_(3),p(),h(4,"ion-note",14),_(5),p()(),h(6,"div",15)(7,"p",22),_(8),U(9,"lowercase"),p(),h(10,"ion-list",23),W(11,Xn,7,3,"ion-item",null,He),p()()()),i&2){let e=I(),n=I(2);m(3),E(n.getUnmatchedItemsLabel()),m(2),E(e.unmatchedItems.length),m(3),D(" These are ",G(9,4,n.getItemTypeLabelPlural())," that were not found in the KML file. These may be missing from your Google Map or may need to be removed from dust because they have cancelled. They may also be unplaced or their location deliberately not shown. They may also have different names from what is in Google Maps in which case you should fix the name in Google Maps. "),m(2),F("inset",!0),m(),j(e.unmatchedItems)}}function Zn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),p(),h(3,"ion-note",14),_(4),p()()),i&2){let e=t.$implicit,n=I(4);m(2),D(" ",e.name||n.getPinTypeLabel(e.pinType)," "),m(2),E(n.formatCoordinates(e))}}function qn(i,t){if(i&1&&(h(0,"ion-accordion",20)(1,"ion-item",29)(2,"ion-label"),_(3,"Restrooms and Other Placemarks"),p(),h(4,"ion-badge",30),_(5),p()(),h(6,"div",15)(7,"p",22),_(8," These are special location markers found in the KML file such as restrooms and shuttle stops. "),p(),h(9,"ion-list",23),W(10,Zn,5,2,"ion-item",null,Wn),p()()()),i&2){let e=I();m(5),E(e.specialPins.length),m(4),F("inset",!0),m(),j(e.specialPins)}}function ei(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-chip",31),_(2),p()()),i&2){let e=t.$implicit;m(2),Me(" ",e.message," ",e.details," ")}}function ti(i,t){if(i&1&&(h(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),_(3,"Errors"),p()(),W(4,ei,3,2,"ion-item",null,en),p()),i&2){let e=I(3);m(4),j(e.errors())}}function ni(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-chip",32),_(2),p()()),i&2){let e=t.$implicit;m(2),Me(" ",e.message," ",e.details," ")}}function ii(i,t){if(i&1&&(h(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),_(3,"Warnings"),p()(),W(4,ni,3,2,"ion-item",null,en),p()),i&2){let e=I(3);m(4),j(e.warnings())}}function ri(i,t){if(i&1){let e=re();h(0,"div",8)(1,"ion-card",9)(2,"ion-card-header")(3,"ion-card-title"),_(4," Import KML "),p(),h(5,"p",10),_(6),U(7,"lowercase"),p()(),h(8,"ion-card-content")(9,"ion-accordion-group",11)(10,"ion-accordion",12)(11,"ion-item",13)(12,"ion-label"),_(13,"Total Placemarks"),p(),h(14,"ion-note",14),_(15),p()(),h(16,"div",15)(17,"p"),_(18," This is the total number of placemarks found in the KML file. "),p()()(),h(19,"ion-accordion",16)(20,"ion-item",13)(21,"ion-label"),_(22,"Location Changes"),p(),h(23,"ion-note",14),_(24),p()(),h(25,"div",15),O(26,zn,6,4)(27,Un,3,3,"p"),p()(),O(28,Hn,13,5,"ion-accordion",17),O(29,Qn,18,8,"ion-accordion",18),O(30,Jn,13,6,"ion-accordion",19),O(31,qn,12,2,"ion-accordion",20),p(),O(32,ti,6,0,"ion-list"),O(33,ii,6,0,"ion-list"),p()()(),h(34,"app-footer",21),ee("press",function(){Z(e);let r=I(2);return q(r.confirmImport())}),p()}if(i&2){let e=t,n=I(2);m(6),D(" The KML file contains the following placemarks and matching ",G(7,12,n.getItemTypeLabelPlural()),'. Review and click "Begin Import" to apply the map locations. '),m(3),F("multiple",!0),m(6),E(e.summary.totalPlacemarks),m(9),E(e.locationChanges.length),m(2),S(e.locationChanges.length>0?26:27),m(2),S(e.noChanges.length>0?28:-1),m(),S(e.newItems.length>0?29:-1),m(),S(e.unmatchedItems.length>0?30:-1),m(),S(e.specialPins.length>0?31:-1),m(),S(n.errors().length>0?32:-1),m(),S(n.warnings().length>0?33:-1),m(),F("icon","arrow-forward-outline")}}function oi(i,t){i&1&&(h(0,"div",6),Pe(1,"ion-spinner",33),h(2,"ion-text",34),_(3,"Loading preview data..."),p()())}function si(i,t){if(i&1&&Pe(0,"app-progress-overlay",7),i&2){let e=I(2);F("title","Importing...")("progress",e.progress())}}function ai(i,t){if(i&1){let e=re();h(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-button",4),ee("click",function(){Z(e);let r=I();return q(r.cancelImport())}),_(4," Cancel "),p()(),h(5,"ion-title"),_(6),p()()(),h(7,"ion-content",5),O(8,ri,35,14)(9,oi,4,0,"div",6),O(10,si,1,2,"app-progress-overlay",7),p()}if(i&2){let e,n=I();m(6),E(n.getTitle()),m(2),S((e=n.previewData())?8:n.hasErrors()?-1:9,e),m(2),S(n.isImporting()?10:-1)}}var te=class te{constructor(){this.fileInput=de.required("fileInput");this.type=be.required();this.existingItems=be.required();this.isOpen=et(!1);this.previewData=L(null);this.importType=L("camps");this.originalChanges=L(null);this.importComplete=oe();this.cancelled=oe();this.fileError=oe();this.progressChange=oe();this.errors=L([]);this.warnings=L([]);this.hasErrors=L(!1);this.isImporting=L(!1);this.progress=L(0);this.importNewItems=L(!1);this.previewService=K(xe);this.kmlService=K(Ie);this.api=K(ge);this.alert=K(bt);Bt({locationOutline:Lt,busOutline:St,waterOutline:Nt,arrowDown:Ot,navigate:Tt,homeOutline:Dt,colorPaletteOutline:Ft})}openFilePicker(){this.isOpen.set(!0),this.fileInput().nativeElement.click()}onFileSelected(t){var s;let e=t.target,n=(s=e.files)==null?void 0:s[0];if(console.log("File to import",n),!n){console.log("Cancelling import"),this.cancelled.emit();return}let r=new FileReader;r.onload=o=>{var c;let a=(c=o.target)==null?void 0:c.result;this.processKmlFile(a,n.size)},r.onerror=()=>{this.fileError.emit("Failed to read the file. Please try again.")},r.readAsText(n),e.value=""}onFileSelectionCancelled(){console.log("File picker cancelled"),this.cancelled.emit()}processKmlFile(t,e){let n=this.type(),r=this.existingItems(),s=this.kmlService.validate(t,e);if(!s.isValid){this.showError(s.errors,n);return}let o=n==="art",a=this.kmlService.parse(t,r,o);this.showPreview(a,r,n)}showPreview(t,e,n){this.originalChanges.set(t),this.importType.set(n);let r=this.previewService.categorizeResultsWithValidation(t,e,n);this.previewData.set(r.data),this.errors.set(r.errors),this.warnings.set(r.warnings),this.hasErrors.set(!r.success),this.isOpen.set(!0)}showError(t,e){this.originalChanges.set(null),this.importType.set(e),this.previewData.set(null),this.errors.set(t),this.warnings.set([]),this.hasErrors.set(!0),this.isOpen.set(!0)}confirmImport(){return k(this,null,function*(){let t=this.originalChanges();if(t){this.isImporting.set(!0),this.progress.set(0),this.progressChange.emit(0);try{this.importType()==="camps"?yield this.processCampChanges(t):yield this.processArtChanges(t)}finally{this.isImporting.set(!1),this.progress.set(0),this.progressChange.emit(void 0),this.isOpen.set(!1),this.onWillDismiss()}}})}processCampChanges(t){return k(this,null,function*(){let e=t.camps.filter(o=>{let a=this.existingItems().find(u=>u.id===o.id);if(!a)return!0;let c=this.previewService.parseCoordinates(a.pin),l=this.previewService.parseCoordinates(o.pin);return console.log(`[KML Import] Camp: ${o.name}`,{id:o.id,currentLocation:c,newLocation:l,currentPin:a.pin,newPin:o.pin,hasChange:c&&l?!this.previewService.compareCoordinates(c,l):!1}),!c||!l?!1:!this.previewService.compareCoordinates(c,l)}),n=e.length+(t.pins.length>0?1:0),r=0;for(let o of e){yield this.api.addCamp(o,!0),r++;let a=n>0?r/n:0;this.progress.set(a),this.progressChange.emit(a)}if(t.pins.length>0){let o=yield this.api.getPins();yield this.api.placePins(this.deduplicatePins(o,t.pins)),r++;let a=n>0?r/n:0;this.progress.set(a),this.progressChange.emit(a)}let s=yield this.importNewCamps(t.newCamps);this.api.clearCache(),this.importComplete.emit(`${e.length} camp changes made. ${t.pins.length} restrooms added. ${s} new camps added.`)})}processArtChanges(t){return k(this,null,function*(){let e=t.art.filter(o=>{let a=this.existingItems().find(u=>u.id===o.id);if(!a)return!0;let c=this.previewService.parseCoordinates(a.pin),l=this.previewService.parseCoordinates(o.pin);return console.log(`[KML Import] Art: ${o.name}`,{id:o.id,currentLocation:c,newLocation:l,currentPin:a.pin,newPin:o.pin,hasChange:c&&l?!this.previewService.compareCoordinates(c,l):!1}),!c||!l?!1:!this.previewService.compareCoordinates(c,l)}),n=e.length,r=0;for(let o of e){try{yield this.api.addArt(o)}catch(c){throw console.error(`Unable to apply art change ${o.name}`,o),c}r++;let a=n>0?r/n:0;this.progress.set(a),this.progressChange.emit(a)}let s=yield this.importNewArt(t.newArt);this.api.clearCache(),this.importComplete.emit(`${e.length} art changes made. ${s} art added.`)})}deduplicatePins(t,e){let n=t;for(let r of e)t.find(s=>s.label===r.label&&s.gpsLat===r.gpsLat&&s.gpsLng===r.gpsLng)||n.push(r);return n}importNewCamps(t){return k(this,null,function*(){let e=0;if(t.length===0||!this.importNewItems())return 0;for(let n of t){let r=yield Oe(this.alert,`Create Camp "${n.name}" ?`,"Create");if(r==="Create"&&(yield this.api.addCamp(n,!0),e++),r==="Cancel")return e}return e})}importNewArt(t){return k(this,null,function*(){let e=0;if(t.length===0||!this.importNewItems())return 0;for(let n of t)if(n.pin.includes("lat")){let r=yield Oe(this.alert,`Add Art "${n.name}" ?`,"Add");if(r==="Add"&&((!n.description||n.description.length<5)&&(n.description=`No description provided for ${n.name}.`),yield this.api.addArt(n),e++),r==="Cancel")return e}return e})}cancelImport(){this.cancelled.emit(),this.isOpen.set(!1),this.onWillDismiss()}onWillDismiss(){this.isOpen.set(!1),this.previewData.set(null),this.originalChanges.set(null),this.errors.set([]),this.warnings.set([]),this.hasErrors.set(!1),this.importNewItems.set(!1)}getTitle(){return this.importType()==="camps"?"Import Camp Locations":"Import Art Locations"}getItemTypeLabel(){return this.importType()==="camps"?"Camp":"Art"}getItemTypeLabelPlural(){return this.importType()==="camps"?"Camps":"Art"}getNewItemsLabel(){return this.importType()==="camps"?"New or Mismatching Camps":"New or Mismatching Art"}getUnmatchedItemsLabel(){return this.importType()==="camps"?"Camps not in File":"Art not in File"}getUnmatchedDescription(){return`This ${this.importType()==="camps"?"camp":"art item"} was not found in the KML file`}getItemIcon(){return this.importType()==="camps"?"home-outline":"color-palette-outline"}formatCoordinates(t){return t.newCoordinates?this.previewService.formatCoordinates(t.newCoordinates):t.currentCoordinates?this.previewService.formatCoordinates(t.currentCoordinates):"No coordinates"}formatCurrentCoordinates(t){return t.currentCoordinates?this.previewService.formatCoordinates(t.currentCoordinates):"No previous location"}formatNewCoordinates(t){return t.newCoordinates?this.previewService.formatCoordinates(t.newCoordinates):"No new location"}getPinIcon(t){if(!t)return"pin-outline";let e=t.toLowerCase();return e.includes("restroom")||e.includes("porto")||e.includes("toilet")||e.includes("potty")?"water-outline":e.includes("shuttle")?"bus-outline":"pin-outline"}getPinTypeLabel(t){if(!t)return"Pin";let e=t.toLowerCase();return e.includes("restroom")||e.includes("porto")||e.includes("toilet")||e.includes("potty")?"Restrooms":e.includes("shuttle")?"Shuttle Stop":t}};te.\u0275fac=function(e){return new(e||te)},te.\u0275cmp=ce({type:te,selectors:[["app-kml-preview"]],viewQuery:function(e,n){e&1&&ue(n.fileInput,$n,5),e&2&&me()},inputs:{type:[1,"type"],existingItems:[1,"existingItems"],isOpen:[1,"isOpen"]},outputs:{isOpen:"isOpenChange",importComplete:"importComplete",cancelled:"cancelled",fileError:"fileError",progressChange:"progressChange"},decls:3,vars:1,consts:[["fileInput",""],["type","file","accept",".kml,.kmz",2,"display","none",3,"change","cancel"],["color","primary"],["slot","start"],[3,"click"],[1,"ion-padding"],[1,"loading-placeholder"],[3,"title","progress"],[1,"border"],[1,"summary-card"],[1,"summary-description"],[3,"multiple"],["value","total-placemarks"],["slot","header",1,"category-header"],["slot","end"],["slot","content",1,"category-content"],["value","location-changes"],["value","no-changes"],["value","new-items"],["value","unmatched"],["value","special-pins"],["title","Begin Import",3,"press","icon"],[2,"margin-right","2rem"],[3,"inset"],["slot","header",1,"category-header","no-changes"],["slot","header",1,"category-header","new-items"],["mode","ios","slot","end","color","danger"],["type","checkbox",3,"ngModelChange","ngModel"],["slot","header",1,"category-header","unmatched"],["slot","header",1,"category-header","special-pins"],["slot","end","color","secondary"],["color","danger"],["color","warning"],["name","crescent"],["color","medium"]],template:function(e,n){if(e&1){let r=re();h(0,"input",1,0),ee("change",function(o){return Z(r),q(n.onFileSelected(o))})("cancel",function(){return Z(r),q(n.onFileSelectionCancelled())}),p(),O(2,ai,11,3)}e&2&&(m(2),S(n.isOpen()?2:-1))},dependencies:[It,Ct,pe,at,rt,ot,st,he,mt,_t,Mt,dt,Pt,wt,vt,ut,lt,ct,pt,ht,gt,ft,Et,xt,yt,At,kt,Kt,tt],styles:["@media (min-width: 801px){ion-modal[_ngcontent-%COMP%]{--width: 80vw;--max-width: 900px;--min-height: 80vh}}p[_ngcontent-%COMP%]{margin-left:1rem;font-size:var(--fs4)}ion-accordion[_ngcontent-%COMP%]   ion-item[slot=header][_ngcontent-%COMP%]{--background: transparent}ion-accordion[_ngcontent-%COMP%]{border:1px solid var(--ion-color-light-shade);border-radius:20px;margin-bottom:10px}ion-accordion[_ngcontent-%COMP%]   ion-item[slot=content][_ngcontent-%COMP%]{--background: transparent}.summary-card[_ngcontent-%COMP%]{margin-bottom:1rem}.summary-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.1rem}input[type=checkbox][_ngcontent-%COMP%]{transform:scale(1.5);margin-left:.5rem;margin-right:.5rem}ion-list-header[_ngcontent-%COMP%]{font-size:var(--fs3);font-weight:700}.category-header[_ngcontent-%COMP%]{--background: var(--ion-color-light);--padding-start: .75rem}.category-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.25rem;margin-right:.5rem}.category-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:.8rem;padding:.25rem .5rem;margin-right:0}.category-header.location-changes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.category-header.no-changes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}.category-header.new-items[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-warning-shade)}.category-header.unmatched[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.category-header.special-pins[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#8a2be2}.category-content[_ngcontent-%COMP%]{padding:.5rem}.preview-item-card[_ngcontent-%COMP%]{margin:.5rem 0}.preview-item-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:.75rem}.item-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem}.item-header[_ngcontent-%COMP%]   .item-type-icon[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--ion-color-primary)}.item-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{flex:1;font-size:.9rem;word-break:break-word}.item-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:.65rem;padding:.2rem .4rem;margin-right:0;white-space:nowrap}.coordinates-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;color:var(--ion-color-medium);font-size:.8rem;padding:.4rem;background:var(--ion-color-light);border-radius:.4rem}.coordinates-display[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1rem;color:var(--ion-color-primary)}.coordinates-change[_ngcontent-%COMP%]{font-size:.8rem;background:var(--ion-color-light);border-radius:.4rem;padding:.5rem}.coordinates-change[_ngcontent-%COMP%]   .coord-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;padding:.2rem 0}.coordinates-change[_ngcontent-%COMP%]   .coord-row[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{min-width:45px}.coordinates-change[_ngcontent-%COMP%]   .coord-row.old[_ngcontent-%COMP%]{color:var(--ion-color-medium);text-decoration:line-through;opacity:.7}.coordinates-change[_ngcontent-%COMP%]   .coord-row.new[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:500}.coordinates-change[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:1rem;margin:.2rem 0;display:block}.special-pin-card[_ngcontent-%COMP%]{border-left:3px solid #8a2be2}.special-pin-card[_ngcontent-%COMP%]   .pin-name-with-icon[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.4rem;flex:1}.special-pin-card[_ngcontent-%COMP%]   .pin-name-with-icon[_ngcontent-%COMP%]   .pin-type-icon[_ngcontent-%COMP%]{color:#8a2be2;font-size:1.1rem}.loading-placeholder[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:150px;flex-direction:column;gap:.75rem}@media (max-width: 500px){.category-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.1rem}.category-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:.7rem}}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0 0;font-size:.8rem;color:var(--ion-color-medium);font-weight:400}"],changeDetection:0});var ne=te;var ie=class ie{constructor(){this.api=K(ge);this.router=K(it);this.route=K(nt);this.kmlPreview=de.required(ne);this.importType="camps";this.existingItems=[];this.isOpen=!0}ngOnInit(){return k(this,null,function*(){this.route.params.subscribe(t=>k(this,null,function*(){this.importType=t.type==="art"?"art":"camps",this.importType==="camps"?this.existingItems=yield this.api.camps({cached:!0}):this.existingItems=yield this.api.art({cached:!0}),setTimeout(()=>{let e=this.kmlPreview();e&&e.openFilePicker()},100)}))})}onImportComplete(t){this.api.sendMessage(t),this.navigateBack()}onPreviewCancelled(){console.log("Preview cancelled, navigating back"),this.navigateBack()}onPreviewError(t){this.api.sendMessage(t)}navigateBack(){let e=this.router.url.split("/")[1];this.importType==="camps"?this.router.navigateByUrl(`/${e}/camps`):this.router.navigateByUrl(`/${e}/art`)}};ie.\u0275fac=function(e){return new(e||ie)},ie.\u0275cmp=ce({type:ie,selectors:[["app-import-kml"]],viewQuery:function(e,n){e&1&&ue(n.kmlPreview,ne,5),e&2&&me()},decls:2,vars:3,consts:[[3,"importComplete","cancelled","fileError","type","existingItems","isOpen"]],template:function(e,n){e&1&&(h(0,"ion-content")(1,"app-kml-preview",0),ee("importComplete",function(s){return n.onImportComplete(s)})("cancelled",function(){return n.onPreviewCancelled()})("fileError",function(s){return n.onPreviewError(s)}),p()()),e&2&&(m(),F("type",n.importType)("existingItems",n.existingItems)("isOpen",n.isOpen))},dependencies:[pe,he,ne],encapsulation:2});var tn=ie;export{tn as ImportKmlPage};
