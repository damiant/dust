import{a as ye}from"./chunk-3PGTX6TC.js";import{a as Ee}from"./chunk-6FMSGD55.js";import"./chunk-YLPHNW7F.js";import{a as we}from"./chunk-36OD2M2C.js";import{a as Ce}from"./chunk-NIJZXRAZ.js";import{a as xe}from"./chunk-6XV5C437.js";import{a as ve}from"./chunk-OIMHMYK4.js";import{a as fe}from"./chunk-5B2MUMUK.js";import"./chunk-DUKSTT3K.js";import{a as ue,ba as _e,ja as ge}from"./chunk-LIWDDRYP.js";import{K as he,a as de,g as me,l as g,n as V,t as k,w as pe}from"./chunk-5GFD3MFK.js";import"./chunk-PFLI22GG.js";import{$ as O,Aa as d,Ac as ne,Ba as b,Ca as I,Da as D,Db as j,Dc as oe,Ec as ae,Fa as U,Fc as re,Ga as B,H as r,Ha as L,Ma as F,Mc as se,P as A,Qc as le,Rc as ce,Ua as R,Wb as G,X as h,Y as u,_a as Z,aa as M,ba as p,ca as s,cc as H,da as l,db as $,dc as K,ea as f,hb as N,ja as S,jb as z,kb as J,la as y,lc as Q,na as c,nb as q,p as E,rc as X,s as C,sc as ee,t as x,tb as W,uc as te,vc as ie,wb as Y}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var be=i=>[i],Ie=(i,t)=>t.id,Te=(i,t)=>t.name;function Pe(i,t){if(i&1){let e=S();s(0,"ion-toolbar")(1,"ion-searchbar",11),y("ionInput",function(n){C(e);let a=c();return x(a.handleSearch(n))}),l()()}if(i&2){let e=c();r(),p("debounce",600)("placeholder","Search events at "+e.title)}}function Oe(i,t){i&1&&f(0,"app-spinner")}function Me(i,t){if(i&1&&(s(0,"div",12)(1,"app-card",15),f(2,"app-img",16),s(3,"ion-button",17),d(4," Register Event "),l()()()),i&2){let e=c(2);p("ngClass",e.events.length>0?"":"pad-vertical"),r(),p("description","You can register your event for "+e.title+"."),r(),p("width","100px")("height","100px")("src",e.imageUrl),r(),p("routerLink",e.newRoute())}}function Ve(i,t){if(i&1&&(s(0,"ion-segment-button",20)(1,"ion-label"),d(2),l()()),i&2){let e=t.$implicit;p("value",e.name),r(2),b(e.title)}}function ke(i,t){if(i&1){let e=S();s(0,"ion-toolbar")(1,"ion-buttons",1)(2,"ion-segment",19),L("ngModelChange",function(n){C(e);let a=c(3);return B(a.showing,n)||(a.showing=n),x(n)}),y("ionChange",function(){C(e);let n=c(3);return x(n.refresh())}),O(3,Ve,3,2,"ion-segment-button",20,Te),l()()()}if(i&2){let e=c(3);r(2),U("ngModel",e.showing),p("value",e.showing),r(),M(e.filters)}}function Ae(i,t){i&1&&(s(0,"ion-item"),d(1," There are no events matching your search. "),l())}function De(i,t){if(i&1){let e=S();s(0,"ion-item",21)(1,"h2"),d(2,"Getting Started"),l()(),s(3,"ion-item"),d(4," Click \xA0"),s(5,"a",22),y("click",function(){C(e);let n=c(5);return x(n.newEvent())}),d(6,"Add Event"),l(),d(7),l()}if(i&2){let e=c(5);r(7),I("\xA0 to create your first event at ",e.title,". ")}}function Ue(i,t){if(i&1&&h(0,De,8,1),i&2){let e=c(4);u(e.isAdmin?0:-1)}}function Be(i,t){if(i&1&&h(0,Ae,2,0,"ion-item")(1,Ue,1,1),i&2){let e=c(3);u(e.filteredBySearch?0:1)}}function Le(i,t){if(i&1&&(s(0,"ion-item")(1,"ion-text",23),d(2),l()()),i&2){let e=c(3);r(2),I("Time Zone ",e.diffTimeZone)}}function Fe(i,t){if(i&1&&(s(0,"p",29),d(1),l(),s(2,"p",30),d(3),l()),i&2){let e=c().$implicit;r(),D("",e.camp,"",e.art),r(2),b(e.other_location)}}function Re(i,t){if(i&1&&(s(0,"ion-item",18),f(1,"app-img",24),s(2,"ion-label",25),h(3,Fe,4,3),d(4),l(),s(5,"ion-label",26)(6,"p",27),d(7),l(),s(8,"p",28),d(9),l()()()),i&2){let e=t.$implicit,o=c(3);p("routerLink","../events/"+F(8,be,e.id)),r(),p("width","45px")("height","45px")("src",o.image(e)),r(2),u(!o.campId&&!o.artId?3:-1),r(),I(" ",e.title," "),r(3),b(e.event_type),r(2),b(e.timeString)}}function Ze(i,t){if(i&1&&(s(0,"app-image-card",13),h(1,ke,5,2,"ion-toolbar"),s(2,"ion-list"),h(3,Be,2,1)(4,Le,3,1,"ion-item"),O(5,Re,10,10,"ion-item",18,Ie),l()()),i&2){let e=c(2);p("url",e.getImageUrl()),r(),u(!e.campId&&!e.artId?1:-1),r(2),u(e.events.length===0?3:e.diffTimeZone?4:-1),r(2),M(e.events)}}function $e(i,t){if(i&1&&(h(0,Me,5,6,"div",12)(1,Ze,7,3,"app-image-card",13),f(2,"div",14)(3,"div",14)),i&2){let e=c();u(e.events.length===0&&!e.filteredBySearch&&!e.isAdmin?0:1)}}function Ne(i,t){if(i&1){let e=S();s(0,"app-footer",31),y("press",function(){C(e);let n=c();return x(n.newEvent())}),l()}}var w=class w{constructor(){this.api=E(he);this.router=E(z);this.eventService=E(Ee);this.route=E(N);this.vanity=R();this.events=[];this.title="Events";this.busy=!0;this.isAdmin=!1;this.imageUrl="";this.newEventUrl="../events/new";this.description="";this.diffTimeZone="";this.showing="all";this.showSearch=!0;this.canEditEvent=!1;this.buttons=[];this.filteredBySearch=!1;this.filters=[];ge({add:ue,printOutline:_e})}filtered(t,e,o,n,a){var v;let m=!0;return t=="mine"?(v=n.contact)!=null&&v.startsWith("***")&&(m=!1):t!=="all"&&(m=this.hasDay(n,t,a)),e&&g(n.hosted_by_camp)!==g(e)&&(m=!1),o&&g(n.located_at_art)!==g(o)&&(m=!1),m}importCSV(){return()=>_(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.router.navigateByUrl("./import-events")})}exportCSV(){return()=>_(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.exportToCSV()})}ngOnInit(){return _(this,null,function*(){var t;try{this.busy=!0,yield this.api.setFestivalByVanity(this.vanity(),!0),this.campId=g(this.route.snapshot.queryParams.camp),this.artId=g(this.route.snapshot.queryParams.art),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.imageUrl=(t=this.api.imageURL(this.api.festivalImage()))!=null?t:"",this.camp=this.campId?yield this.api.getCamp(this.campId):void 0,this.art=this.artId?yield this.api.getArt(this.artId):void 0,this.title=this.camp?this.camp.name:this.api.festivalTitle(),this.canEditEvent=this.api.eventEditing()||this.isAdmin,this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"}]:[],this.art&&(this.title=this.art.name),this.diffTimeZone=this.api.currentTimeZone()==this.api.festivalTimeZone()?"":this.api.festivalTimeZone(),yield this.api.setFestivalByVanity(this.vanity()),yield this.refresh(),this.showSearch=this.events.length>1,this.description=this.events.length==0?`There are no events yet for ${this.title}`:`Events for ${this.title}`}finally{this.busy=!1}})}ionViewDidEnter(){return _(this,null,function*(){for(;this.busy;)yield me(500);yield this.refresh()})}newRoute(){return this.canEditEvent?"../events/new":void 0}message(t){setTimeout(()=>{this.api.sendMessage(t)},1)}handleSearch(t){return _(this,null,function*(){let e=t.target.value.toLowerCase().trim(),o=this.cleanEvents(yield this.api.events({cached:!0}),!1);this.events=o.filter(n=>{var a;return n.title.toLowerCase().includes(e)||((a=n.camp)==null?void 0:a.toLowerCase().includes(e))}),this.filteredBySearch=e.length>0})}image(t){return this.api.imageURL(t.imageUrl)}newEvent(){this.router.navigate(["./new"],{queryParams:{camp:this.campId,art:this.artId},relativeTo:this.route})}festivalImage(){return this.api.imageURL(this.api.festivalImage())}refresh(){return _(this,null,function*(){this.filters=[],this.events=this.cleanEvents(yield this.api.events({cached:!0}),!1),this.filteredBySearch=!1,this.filters.find(t=>t.name=="mine")||this.filters.unshift({title:"All",name:"all"},{title:"Mine",name:"mine"})})}exportToCSV(){return _(this,null,function*(){let t=this.showing!=="all",e=this.cleanEvents(yield this.api.events({cached:!0}),t);yield this.eventService.exportEventsToCSV(this.api.festivalTitle(),e,this.api.currentTimeZone(),this.showing)})}getImageUrl(){var t;return this.camp&&this.camp.imageUrl?this.api.imageURL(this.camp.imageUrl):this.art&&((t=this.art)!=null&&t.imageUrl)?this.api.imageURL(this.art.imageUrl):this.festivalImage()}addFiltersForDays(t){let e=new Date(t.start_time),o=`${e.getDate()} (${pe[e.getDay()]})`;this.filters.find(a=>a.title==o)||(this.filters.push({title:o,name:this.nameOf(e)}),this.filters.sort((a,m)=>a.name>m.name?1:-1))}hasDay(t,e,o){let n=JSON.parse(t.occurrence_set);if(o){let a=[];for(let m of n)e==this.nameOf(new Date(m.start_time))&&a.push(m);if(a.length>0)return t.occurrence_set=JSON.stringify(a),!0}else for(let a of n)if(e==this.nameOf(new Date(a.start_time)))return!0;return!1}nameOf(t){return`${t.getDate()}-${t.getMonth()}-${t.getFullYear()}`}cleanEvents(t,e){var o;for(let n of t){let a=JSON.parse(n.occurrence_set);this.goodDates(a)||console.error(`${n.title} has bad dates`);let m=V(a[0].start_time),v=V(a[0].end_time),T=this.api.currentTimeZone();n.timeString=(o=de(m,v,void 0,T))==null?void 0:o.long,a.length>1&&(n.timeString+=` (+${a.length-1} other occurrence)`);for(let P of a)this.addFiltersForDays(P)}return t.sort((n,a)=>{let m=JSON.parse(n.occurrence_set),v=JSON.parse(a.occurrence_set),T=new Date(m[0].start_time),P=new Date(v[0].start_time);return T-P}),t.filter(n=>this.filtered(this.showing,this.campId,this.artId,n,e))}signOut(){return _(this,null,function*(){this.api.signOut(),this.router.navigateByUrl("/auth")})}goodDates(t){for(let e of t)if(k(e.start_time)!=e.start_time||k(e.end_time)!=e.end_time)return!1;return!0}};w.\u0275fac=function(e){return new(e||w)},w.\u0275cmp=A({type:w,selectors:[["app-events"]],inputs:{vanity:[1,"vanity"]},decls:17,vars:7,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../events/new"],["name","add"],[3,"buttons"],[3,"fullscreen"],[1,"border"],["title","Add Event"],["title","Add Event",3,"click"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],[1,"ion-text-center",3,"ngClass"],["routeTo","../events/new",3,"url"],[1,"ion-padding"],["title","Event Registration",3,"description"],["logo","",1,"logo","ion-padding",3,"width","height","src"],["shape","round",3,"routerLink"],[3,"routerLink"],["mode","ios",2,"float","right","margin-right","0.5rem","margin-top","0.5rem","width","100%",3,"ngModelChange","ionChange","ngModel","value"],[3,"value"],["lines","none"],[3,"click"],["color","medium","slot","end",2,"text-transform","uppercase","font-size","small"],[1,"clickable","pad-right",3,"width","height","src"],[1,"ion-text-wrap"],[1,"ion-text-right","ion-text-wrap","last-col"],[1,"one-line","sz-large"],["color","medium",1,"time"],[1,"title"],[1,"title","highlight"],["title","Add Event",3,"press"]],template:function(e,o){e&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),f(3,"ion-back-button"),l(),s(4,"ion-title",2),d(5),l(),s(6,"ion-buttons",3)(7,"ion-button",4),f(8,"ion-icon",5),l(),f(9,"app-side",6),l()()(),s(10,"ion-content",7),h(11,Pe,2,2,"ion-toolbar"),h(12,Oe,1,0,"app-spinner"),s(13,"div",8),h(14,$e,4,1),h(15,Ne,1,0,"app-footer",9),l(),s(16,"app-footer",10),y("click",function(){return o.newEvent()}),l()()),e&2&&(r(5),I("Events at ",o.title),r(4),p("buttons",o.buttons),r(),p("fullscreen",!0),r(),u(o.showSearch?11:-1),r(),u(o.busy?12:-1),r(2),u(o.busy?-1:14),r(),u(o.events.length!==0&&!o.filteredBySearch?15:-1))},dependencies:[oe,le,we,fe,ce,ne,$,Z,j,W,Y,q,J,X,re,K,G,ae,H,Q,se,ie,ee,te,xe,Ce,ve,ye],styles:["ion-fab[_ngcontent-%COMP%]{padding-top:var(--spacing-md);padding-bottom:var(--spacing-md)}ion-fab-button[_ngcontent-%COMP%]{margin-top:calc(-2 * var(--spacing-1xl));padding:var(--spacing-sm)}ion-item[_ngcontent-%COMP%]{cursor:pointer}.title[_ngcontent-%COMP%]{font-size:var(--font-size-base)}.highlight[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.one-line[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}app-img[_ngcontent-%COMP%]{--border-radius: var(--br-xl)}.last-col[_ngcontent-%COMP%]{max-width:25%}@media (width < 500px){.sz-large[_ngcontent-%COMP%]{display:none}}.pad-right[_ngcontent-%COMP%]{width:55px}"]});var Se=w;export{Se as EventsPage};
