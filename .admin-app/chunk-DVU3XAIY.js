import{a as ce}from"./chunk-VK7KZFPY.js";import"./chunk-ISEFS2E5.js";import{a as se}from"./chunk-ROJXBKDX.js";import"./chunk-W4BNGQYG.js";import{Y as le,c as oe,d as ae,p as re}from"./chunk-IKEGAJLW.js";import{F as ne,e as te,g as R}from"./chunk-MPA3GIYF.js";import{a as ie}from"./chunk-XMQYHBKU.js";import{$ as x,G as r,Ha as k,I,Ia as F,L as U,Rb as L,Sb as Q,Tb as j,Ub as q,V as d,W as m,Zb as H,_a as B,aa as a,ba as s,ca as c,dc as Z,ea as y,ec as J,fa as h,ga as l,gc as K,hb as N,ka as b,kb as z,la as S,ma as T,oc as Y,p as O,pc as G,qb as W,rb as D,rc as X,s as p,sa as g,t as u,ta as A,ua as w,vc as $,w as P,wc as ee,xa as M,ya as V,za as E}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var me=["iEmail"],pe=["iCode"];function ue(o,t){if(o&1){let e=y();a(0,"ion-buttons",3)(1,"ion-button",13),h("click",function(){p(e);let i=l();return u(i.clear())}),c(2,"ion-icon",14),s()()}}function ge(o,t){if(o&1){let e=y();a(0,"ion-button",13),h("click",function(){p(e);let i=l();return u(i.close())}),c(1,"ion-icon",15),s()}}function fe(o,t){o&1&&c(0,"app-spinner")}function _e(o,t){if(o&1&&(c(0,"img",16),a(1,"div",17)(2,"h1"),g(3),s()()),o&2){let e=l();r(3),A(e.title())}}function he(o,t){if(o&1&&(c(0,"app-festival-header",18),a(1,"p",8),g(2),s()),o&2){let e=l();x("festival",e.festival),r(2),w(" Sign in using your email address to register or manage camps, art and events of ",e.festival==null?null:e.festival.name," ")}}function ve(o,t){if(o&1&&(a(0,"div",8)(1,"p"),g(2),s()()),o&2){let e=l();r(2),A(e.redirectMessage())}}function ye(o,t){if(o&1){let e=y();a(0,"ion-item")(1,"ion-input",19,0),h("keyup.enter",function(){p(e);let i=l();return u(i.next())}),E("ngModelChange",function(i){p(e);let f=l();return V(f.email,i)||(f.email=i),u(i)}),s()(),a(3,"p",20),g(4,"You will be emailed a verification code."),s()}if(o&2){let e=l();r(),M("ngModel",e.email)}}function Ce(o,t){if(o&1){let e=y();a(0,"ion-item")(1,"ion-input",21,1),h("keyup.enter",function(){p(e);let i=l();return u(i.next())})("ionInput",function(){p(e);let i=l();return u(i.changed())}),E("ngModelChange",function(i){p(e);let f=l();return V(f.code,i)||(f.code=i),u(i)}),s()(),a(3,"p",20),g(4),s()}if(o&2){let e=l();r(),M("ngModel",e.code),r(3),w(" Enter the verification code that was emailed to ",e.email,". ")}}function xe(o,t){o&1&&c(0,"ion-icon",12)}function we(o,t){o&1&&(a(0,"div",22)(1,"p"),g(2,"Just want to download the app?"),s()(),a(3,"div",23)(4,"a",24),c(5,"img",25),s(),a(6,"a",26),c(7,"img",27),s()())}var v=class v{constructor(t,e){this.api=t;this.router=e;this.email="";this.code="";this.vanity=P("");this.busy=!1;this.redirecting=P(!1);this.redirectType="none";this.emailPage=!0;this.isNative=ie.isNativePlatform();this.alert=O(X);this.title=k(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"Register a camp";case"event":return"Register an event";default:return"Sign In"}return"Sign In"});this.redirectMessage=k(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"To register a camp we first need an email address.";case"event":return"To register a event we first need an email address.";default:return""}return""});le({arrowBack:oe,close:re,arrowForwardOutline:ae}),F(()=>{let n=this.api.openedUrl();if(n=="")return;let i=new URL(n),C=new URLSearchParams(i.search).get("code");(C==null?void 0:C.length)==6&&this.signIn(C)})}ionViewWillEnter(){return _(this,null,function*(){var e;this.vanity.set((e=sessionStorage.sendVanity)!=null?e:""),this.vanity()!==""&&(this.festival=yield this.api.getUnAuthedFestivalByVanity(this.vanity()));let t=this.api.getRedirectionUrl();this.redirectType="none",t&&t.includes("/camps")&&(this.redirectType="camp"),t&&t.includes("/events")&&(this.redirectType="event"),this.redirecting.set(!!t&&t!==""),setTimeout(()=>{this.iUsername.setFocus()},500)})}close(){return _(this,null,function*(){document.location.href="index.html"})}next(){return _(this,null,function*(){if(this.emailPage){if(!this.validateEmail(this.email)){this.presentAlert("The email address is invalid");return}try{this.busy=!0,yield this.api.signIn(this.email),this.emailPage=!1,setTimeout(()=>{this.iCode.setFocus()},500)}finally{this.busy=!1}}else{let t=this.code.toString().padStart(6,"0");if(!this.code||t.length!==6){this.presentAlert("The verification code is incorrect");return}this.signIn(t)}})}signIn(t){return _(this,null,function*(){try{this.busy=!0,yield R(1e3),yield this.api.verify(t),yield R(1e3),this.emailPage=!0,this.code="",this.email="";let e=this.api.getRedirectionUrl();if(this.api.clearCache(),!e||e==""){let n=sessionStorage.sendVanity,i="/all";te(n)||(i=`/${n}`,console.log("sendVanity",i)),this.router.navigateByUrl(i,{replaceUrl:!0})}else{if(e=="none"){this.api.setRedirection("");return}console.log(`Redirect to ${e}`),this.api.setRedirection("none"),this.router.navigateByUrl(e,{replaceUrl:!0})}}finally{this.busy=!1}})}changed(){setTimeout(()=>{let t=`${this.code}`;t.length==6&&this.signIn(t)},500)}presentAlert(t){return _(this,null,function*(){yield(yield this.alert.create({header:"Message",message:t,buttons:["OK"]})).present()})}clear(){this.code="",this.emailPage=!0}validateEmail(t){return!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}};v.\u0275fac=function(e){return new(e||v)(I(ne),I(B))},v.\u0275cmp=U({type:v,selectors:[["app-auth"]],viewQuery:function(e,n){if(e&1&&(b(me,5),b(pe,5)),e&2){let i;S(i=T())&&(n.iUsername=i.first),S(i=T())&&(n.iCode=i.first)}},decls:23,vars:11,consts:[["iEmail",""],["iCode",""],[1,"ion-no-border"],["slot","start"],["slot","end"],[3,"fullscreen"],[1,"border"],[1,"ion-text-center"],[1,"ion-padding"],["lines","none"],[1,"row-center","ion-padding"],["size","large","shape","round","color","primary",1,"wide",3,"click","disabled"],["name","arrow-forward-outline"],[3,"click"],["name","arrow-back"],["size","small","name","close",1,"close"],["src","assets/dust-icon.svg","alt","Dust Icon",1,"icon"],[1,"h1-container"],[3,"festival"],["name","emailAddress","id","emailAddress","type","email","label","Email Address","labelPlacement","stacked",3,"keyup.enter","ngModelChange","ngModel"],[1,"helper"],["type","number","inputMode","numeric","pattern","[0-9]*","label","Verification Code","labelPlacement","stacked",3,"keyup.enter","ionInput","ngModelChange","ngModel"],[1,"footer","pad"],[1,"footer"],["href","https://apps.apple.com/us/app/dust-a-guide-for-burners/id6456943178?itsct=apps_box_badge&itscg=30200"],["src","assets/app-store.svg","alt","Download on the App Store",1,"store"],["href","https://play.google.com/store/apps/details?id=nexus.concepts.dust"],["src","assets/google-play.svg","alt","Download from the Play Store",1,"store"]],template:function(e,n){e&1&&(a(0,"ion-header",2)(1,"ion-toolbar"),d(2,ue,3,0,"ion-buttons",3),c(3,"ion-title"),a(4,"ion-buttons",4),d(5,ge,2,0,"ion-button"),s()()(),a(6,"ion-content",5),d(7,fe,1,0,"app-spinner"),a(8,"div",6)(9,"ion-card")(10,"ion-card-content",7),d(11,_e,4,1)(12,he,3,2),d(13,ve,3,1,"div",8),a(14,"ion-list",9),d(15,ye,5,1)(16,Ce,5,2),a(17,"ion-item")(18,"div",10)(19,"ion-button",11),h("click",function(){return n.next()}),g(20),d(21,xe,1,0,"ion-icon",12),s()()()()()(),d(22,we,8,0),s()()),e&2&&(r(2),m(n.emailPage?-1:2),r(3),m(n.isNative?5:-1),r(),x("fullscreen",!0),r(),m(n.busy?7:-1),r(4),m(n.vanity()===""?11:12),r(2),m(n.redirecting()?13:-1),r(2),m(n.emailPage?15:16),r(4),x("disabled",n.busy),r(),w("",n.emailPage?"Next":"Sign In"," "),r(),m(n.emailPage?21:-1),r(),m(n.vanity()!==""?22:-1))},dependencies:[Q,$,D,N,W,z,Z,G,Y,H,ce,j,q,K,J,ee,L,se],styles:["h1[_ngcontent-%COMP%]{font-size:var(--fr2);color:var(--ion-color-primary)}.h1-container[_ngcontent-%COMP%]{width:100%;border-radius:.5rem;display:flex;align-items:center;justify-content:center;margin-left:auto;margin-right:auto}p[_ngcontent-%COMP%]{font-size:var(--fr3)}@media (min-width: 801px){ion-card[_ngcontent-%COMP%]{margin-left:100px;margin-right:100px}}.helper[_ngcontent-%COMP%]{font-size:var(--fs5);color:var(--ion-text-color)}ion-button.wide[_ngcontent-%COMP%]{width:200px}.close[_ngcontent-%COMP%]{color:#fff!important}.store[_ngcontent-%COMP%]{height:45px}.footer[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1rem}.icon[_ngcontent-%COMP%]{width:100px}.pad[_ngcontent-%COMP%]{padding-top:1rem}"]});var de=v;export{de as AuthPage};
