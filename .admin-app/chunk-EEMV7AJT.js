import{a as k}from"./chunk-VSRM7UBH.js";import"./chunk-5CHPG7GP.js";import{a as Ce}from"./chunk-ROJXBKDX.js";import{a as ye}from"./chunk-XS7NHT5I.js";import{a as fe}from"./chunk-TM3WTZXM.js";import{c as g}from"./chunk-OZ2IKH4J.js";import{M as _e,N as he,Y as ge}from"./chunk-IKEGAJLW.js";import{G as ue,e as S,l as pe,r as me,v as de}from"./chunk-YDFKN7Z7.js";import"./chunk-XMQYHBKU.js";import{$ as p,$a as R,Bc as se,Cc as ce,D as V,Ea as D,G as a,I as P,Kb as q,L as E,Pa as N,Pb as H,Rb as K,Sb as Y,Tb as J,Ub as X,V as _,W as h,Y as M,Z as A,Zb as Z,_ as W,aa as l,ba as r,ca as w,cb as j,dc as $,ea as I,ec as ee,fa as C,ga as s,gc as ie,hb as F,ka as U,kb as Q,la as B,lc as te,ma as L,oc as ne,pb as z,pc as ae,ra as O,rb as G,rc as oe,s as m,sa as u,t as d,ta as T,tc as le,wc as re,xa as y,ya as v,za as b}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as f}from"./chunk-LNJ3S2LQ.js";var be=t=>[t];function xe(t,n){if(t&1&&(l(0,"ion-select-option",11),u(1),r()),t&2){let e=n.$implicit;p("value",e),a(),T(e)}}function we(t,n){if(t&1){let e=I();l(0,"ion-item",12)(1,"ion-checkbox",20),b("ngModelChange",function(i){m(e);let c=s(2);return v(c.camp.publicEvents,i)||(c.camp.publicEvents=i),d(i)}),u(2,"Accept event submissions from the public"),r()()}if(t&2){let e=s(2);a(),y("ngModel",e.camp.publicEvents)}}function Ie(t,n){if(t&1&&w(0,"img",16),t&2){let e=s(2);p("src",e.imageUrl,V)}}function Pe(t,n){t&1&&(l(0,"p"),u(1,"Click to choose an optional image for your camp"),r())}function Te(t,n){if(t&1){let e=I();l(0,"ion-item",7)(1,"app-emails",21),b("emailsChange",function(i){m(e);let c=s(2);return v(c.camp.contact_email,i)||(c.camp.contact_email=i),d(i)}),r()()}if(t&2){let e=s(2);a(),p("isAdmin",e.isAdmin)("isOwner",e.isOwner)("label","Camp Owner(s)")("placeholder","Email address of camp owner"),y("emails",e.camp.contact_email)}}function Se(t,n){if(t&1){let e=I();l(0,"app-tooltip",18)(1,"ion-button",22),C("click",function(){m(e);let i=s(2);return d(i.invite())}),u(2,"Invite"),r()()}if(t&2){let e=s(2);a(),p("disabled",e.inviting)}}function ke(t,n){if(t&1&&(l(0,"app-tooltip",23)(1,"ion-button",24),u(2," Place "),r()(),l(3,"ion-button",25),u(4," Delete "),r(),u(5,"\xA0 "),w(6,"ion-alert",26)),t&2){let e=s(2);a(),p("routerLink","../../map/"+D(2,be,e.camp.id)),a(5),p("buttons",e.deleteButtons)}}function Ve(t,n){if(t&1){let e=I();l(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),b("ngModelChange",function(i){m(e);let c=s();return v(c.camp.name,i)||(c.camp.name=i),d(i)}),r()(),l(6,"ion-item",9)(7,"ion-select",10),b("ngModelChange",function(i){m(e);let c=s();return v(c.camp.camp_type,i)||(c.camp.camp_type=i),d(i)}),A(8,xe,2,2,"ion-select-option",11,M),r()(),_(10,we,3,1,"ion-item",12),l(11,"ion-item",13),C("dblclick",function(){m(e);let i=s();return d(i.fillDescription())}),l(12,"ion-textarea",14),b("ngModelChange",function(i){m(e);let c=s();return v(c.camp.description,i)||(c.camp.description=i),d(i)}),r()(),l(13,"div",15),C("click",function(){m(e);let i=s();return d(i.upload.click())}),_(14,Ie,1,1,"img",16),_(15,Pe,2,0,"p"),r(),_(16,Te,2,5,"ion-item",7),r(),l(17,"div",17),_(18,Se,3,1,"app-tooltip",18),_(19,ke,7,4),l(20,"ion-button",3),C("click",function(){m(e);let i=s();return d(i.save())}),u(21,"Save"),r()(),l(22,"app-upload",19),C("upload",function(i){m(e);let c=s();return d(c.uploaded(i))}),r()()()()}if(t&2){let e=s();a(5),y("ngModel",e.camp.name),a(2),p("value",e.camp.camp_type),y("ngModel",e.camp.camp_type),a(),W(e.campTypes),a(2),h(e.isAdmin||e.isOwner?10:-1),a(2),p("spellcheck",!0)("rows",6)("maxlength",1e3)("autoGrow",!0),y("ngModel",e.camp.description),a(),O(e.uploading?"disabled":""),a(),h(e.imageUrl?14:-1),a(),h(e.imageUrl?-1:15),a(),h(e.isAdmin||e.isOwner?16:-1),a(2),h(e.id&&e.isAdmin?18:-1),a(),h(e.id&&e.canPlace?19:-1),a(),p("disabled",e.busy)}}function Ee(t,n){t&1&&w(0,"app-spinner")}var x=class x{constructor(n,e,o){this.api=n;this.alert=e;this.location=o;this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.isOwner=!1;this.canPlace=!1;this.isNew=!1;this.inviting=!1;this.campTypes=["Theme Camp","Sound Camp","Art Support Camp","Village Camp","Infrastructure"];this.camp={name:"",pin:"",description:"",id:void 0,contact_email:"",camp_type:this.campTypes[0],publicEvents:!1};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];ge({mapOutline:he,mailOutline:_e})}uploaded(n){console.log(n),this.imageUrl=n.url,this.imageChanged=!0,this.blob=n.blob}ionViewWillEnter(){return f(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.id=pe(this.id),this.isNew=!this.id,this.camp=yield this.api.getCamp(this.id),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.isOwner=!!this.id&&this.api.getAccessInfo(this.api.festivalId).camps.includes(this.id),this.imageUrl=this.api.imageURL(this.camp.imageUrl),this.busy=!1})}delete(){return f(this,null,function*(){this.busy=!0,yield this.api.deleteCamp(this.camp),this.api.clearCache(),this.busy=!1,this.location.back()})}fillDescription(){console.log("fillDescription"),S(this.camp.description)&&!S(this.camp.name)&&(this.camp.description=`${this.camp.name} does not have a description yet.`)}save(n=!0){return f(this,null,function*(){this.busy=!0,de(this.camp);try{this.camp.description=me(this.camp.description);let e=yield this.api.addCamp(this.camp);if(this.busy=!1,e.message)g(this.alert,e.message);else{if(e.id&&this.imageChanged){console.log(`Uploaded image for camp ${e.id}`),this.busy=!0;try{yield this.uploadImage(e.id)}finally{this.busy=!1,this.imageChanged=!1}}if(!this.isAdmin){let o=this.isNew?`Thank you for registering your camp at ${this.api.festivalTitle()}.`:`The changes you have made will be reviewed by ${this.api.festivalTitle()} prior to publishing in the app.`;g(this.alert,o,"Note"),yield this.api.setKey()}this.api.clearCache(),n&&this.location.back()}}finally{this.busy=!1}})}invite(){return f(this,null,function*(){if(!this.camp.contact_email){yield g(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let n=yield this.api.inviteCamp(this.camp);n.message?g(this.alert,n.message):g(this.alert,"The camp owner has been invited to manage their camp.","Invitation")})}uploadImage(n){return f(this,null,function*(){if(this.blob)try{this.uploading=!0,this.camp.imageUrl=yield this.api.setImage(this.blob,n);let e=yield this.api.addCamp(this.camp,!0);e.message&&g(this.alert,e.message)}finally{this.uploading=!1}})}};x.\u0275fac=function(e){return new(e||x)(P(ue),P(oe),P(N))},x.\u0275cmp=E({type:x,selectors:[["app-camp"]],viewQuery:function(e,o){if(e&1&&U(k,5),e&2){let i;B(i=L())&&(o.upload=i.first)}},inputs:{id:"id",vanity:"vanity"},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["label","Camp Name","labelPlacement","stacked","placeholder","Name of the theme camp",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["label","Type","labelPlacement","stacked","interface","popover","placeholder","Select the type of camp",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["lines","none",1,"ion-padding-start"],[3,"dblclick"],["labelPlacement","stacked","label","Description","placeholder","Description of the theme camp",3,"ngModelChange","spellcheck","rows","maxlength","autoGrow","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[1,"center"],["text","Invite camp owner via email to manage their camp"],[3,"upload"],["justify","start","labelPlacement","end",3,"ngModelChange","ngModel"],["helperText",`The camp owner(s) can login and alter their camp
              events and details. This is a list of email addresses.`,3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["color","secondary",3,"click","disabled"],["text","Place the camp on the map"],["color","secondary",3,"routerLink"],["id","deleteCamp","color","secondary"],["trigger","deleteCamp","header","Delete Camp?",3,"buttons"]],template:function(e,o){e&1&&(l(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),w(3,"ion-back-button"),r(),l(4,"ion-title"),u(5),r(),l(6,"ion-buttons",2)(7,"ion-button",3),C("click",function(){return o.save()}),u(8,"Save"),r()()()(),l(9,"ion-content",4),_(10,Ve,23,17,"div",5)(11,Ee,1,0,"app-spinner"),r()),e&2&&(a(5),T(o.id||o.camp.id?"Edit Camp":o.isAdmin?"Add Camp":"Register Camp"),a(2),p("disabled",o.busy),a(2),p("fullscreen",!0),a(),h(o.busy?11:10))},dependencies:[H,fe,k,G,F,z,Q,Ce,j,R,$,ae,Y,q,ne,K,Z,J,X,ie,ee,re,ce,se,te,ye,le],encapsulation:2});var ve=x;export{ve as CampPage};
