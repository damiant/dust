import{a as oe}from"./chunk-WFPY2GKG.js";import{a as ae}from"./chunk-4TINRQR4.js";import{a as te}from"./chunk-S6IHJUHU.js";import"./chunk-TUKQZ63R.js";import{B as Z,G as ee,H as ie,R as ne,g as J,p as K,t as Q,x as X,z as Y}from"./chunk-OAPJ7RFL.js";import{y as q}from"./chunk-KCTXO3XO.js";import{$ as g,A as v,Aa as p,B as y,Ba as c,Kb as O,L as m,Pa as w,Pb as M,Qb as F,Rb as A,S as i,Sb as B,T as b,Tb as R,Ub as L,Vb as W,X as _,Xb as D,bc as V,cb as E,cc as $,da as s,db as T,dc as N,ec as j,ga as f,gb as U,gc as G,ha as C,ia as I,ja as x,ka as o,la as n,ma as l,mc as H,nc as z,oa as S,pa as P,qa as u,rb as k}from"./chunk-PNZTRGP7.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h}from"./chunk-LNJ3S2LQ.js";function le(a,t){if(a&1&&l(0,"app-img",13),a&2){let e=u().$implicit,r=u(2);s("width","45px")("height","45px")("src",r.image(e.image))}}function pe(a,t){if(a&1&&(o(0,"ion-item")(1,"ion-label"),p(2),o(3,"p"),p(4),n()(),g(5,le,1,3,"app-img",13),n()),a&2){let e=t.$implicit;i(2),c(e.type),i(2),c(e.text),i(),f(e.image?5:-1)}}function de(a,t){if(a&1){let e=S();o(0,"div",8)(1,"ion-card",10)(2,"ion-card-header")(3,"ion-card-title"),p(4,"Unpublished Changes"),n(),l(5,"ion-card-subtitle"),n(),o(6,"ion-card-content")(7,"ion-list")(8,"ion-item")(9,"ion-label"),p(10),n()(),I(11,pe,6,3,"ion-item",null,C),n(),o(13,"div",11)(14,"ion-button",12),P("click",function(){v(e);let se=u();return y(se.publish())}),p(15,"\xA0Publish"),n()()()()()}if(a&2){let e=u();i(10),c(e.title()),i(),x(e.unpublished()),i(3),s("disabled",e.preparing()||!e.isAdmin())}}function me(a,t){a&1&&l(0,"app-spinner",9)}var d=class d{constructor(t,e){this.api=t;this.router=e;this.isAdmin=m(!1);this.busy=m(!1);this.preparing=m(!1);this.unpublished=m([]);this.title=w(()=>{var t;return this.unpublished().length>0?`These changes have been made to ${(t=this.festival)==null?void 0:t.name} but have not published to dust.`:this.preparing()?"Please wait....":"Publishing will ensure that users in the dust app see these changes when they open the event next time."});ne({homeOutline:X,calendarOutline:J,musicalNotesOutline:ie,mapOutline:ee,locationOutline:Z,linkOutline:Y,createOutline:Q,cloudUploadOutline:K})}ionViewWillEnter(){return h(this,null,function*(){this.update()})}update(){return h(this,null,function*(){if(this.preparing.set(!0),this.vanity){if(this.festival=yield this.api.getFestivalByVanity(this.vanity,!0),!this.festival)return;this.api.setFestival(this.festival),this.isAdmin.set(this.api.isAdmin(this.festival.id)),this.unpublished.set(yield this.api.getUnpublishedChanges())}this.preparing.set(!1)})}publish(){return h(this,null,function*(){try{this.busy.set(!0),this.api.setFestival(this.festival),yield this.api.publish(),this.api.sendMessage("Data has been published to the Dust app",1),this.router.navigateByUrl(`${this.api.vanity()}`)}finally{this.busy.set(!1)}})}image(t){return this.api.imageURL(t)}};d.\u0275fac=function(e){return new(e||d)(b(q),b(E))},d.\u0275cmp=_({type:d,selectors:[["app-unpublished"]],inputs:{vanity:"vanity"},decls:12,vars:7,consts:[["color","primary"],["slot","start"],[3,"disabled"],[3,"routerLink"],["slot","end"],[3,"hidden"],[3,"fullscreen"],["type","indeterminate",3,"hidden"],[1,"border"],["title","Publishing can take some time. Please be patient."],[2,"margin-top","2rem"],[1,"ion-text-center"],["shape","round",2,"margin-top","0rem","margin-right","1rem",3,"click","disabled"],[2,"min-width","45px",3,"width","height","src"]],template:function(e,r){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),l(3,"ion-back-button",2),n(),o(4,"ion-title",3),p(5),n(),o(6,"ion-buttons",4),l(7,"app-side",5),n()()(),o(8,"ion-content",6),l(9,"ion-progress-bar",7),g(10,de,16,2,"div",8)(11,me,1,0,"app-spinner",9),n()),e&2&&(i(3),s("disabled",r.busy()),i(),s("routerLink","/all"),i(),c(r.busy()?"Publishing":"dust"),i(2),s("hidden",r.busy()),i(),s("fullscreen",!0),i(),s("hidden",!r.preparing()),i(),f(r.busy()?11:10))},dependencies:[G,k,oe,te,U,T,V,z,F,O,H,M,D,A,R,W,L,B,N,j,$,ae],styles:["ion-button[_ngcontent-%COMP%]{width:10rem}ion-label[_ngcontent-%COMP%]{font-family:Gelion Medium!important}p[_ngcontent-%COMP%]{font-family:Gelion Regular;font-size:var(--fs4)}"]});var re=d;export{re as UnpublishedPage};
