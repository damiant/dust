import{a as et}from"./chunk-A7RCF4AZ.js";import{a as tt}from"./chunk-5VAIZYUZ.js";import{c as l}from"./chunk-OZ2IKH4J.js";import"./chunk-ZHFJF7NS.js";import"./chunk-A5RC3O7B.js";import"./chunk-CVA27SDO.js";import"./chunk-U5OWWBBZ.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-L4IPHJNS.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-ZMJ3RQA5.js";import"./chunk-MCRJI3T3.js";import"./chunk-QDGYTOUC.js";import"./chunk-VLNXCBKY.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-DUKSTT3K.js";import{M as Q,da as X,ea as Z,i as J}from"./chunk-MQOPPKG3.js";import{J as q,g as Y,l as j}from"./chunk-2K4NO5ZT.js";import{b as w}from"./chunk-PFLI22GG.js";import{Aa as P,Cb as T,Dc as K,Ec as R,G as r,Kc as H,O as E,Vb as M,W as k,X as C,aa as d,ba as o,bc as V,ca as a,cc as $,da as m,dc as L,ec as O,fc as D,gb as N,hc as z,ia as v,jb as A,ka as g,kc as F,ma as c,mb as B,mc as U,nc as W,p as _,qc as G,s as h,t as f,w as I,za as u}from"./chunk-OCTOJKK3.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as p}from"./chunk-LNJ3S2LQ.js";var x=w("Geolocation",{web:()=>import("./chunk-UUUQKWSW.js").then(i=>new i.GeolocationWeb)});var y=w("Network",{web:()=>import("./chunk-FT74B6LB.js").then(i=>new i.NetworkWeb)});var S=w("KeepAwake",{web:()=>import("./chunk-27YGL33L.js").then(i=>new i.KeepAwakeWeb)});function nt(i,t){if(i&1){let e=v();o(0,"ion-fab",9)(1,"ion-buttons")(2,"ion-fab-button",13),g("click",function(){h(e);let s=c();return f(s.checkLocation())}),m(3,"ion-icon",14),a(),o(4,"ion-fab-button",13),g("click",function(){h(e);let s=c();return f(s.checkNetwork())}),m(5,"ion-icon",15),a(),o(6,"ion-fab-button",13),g("click",function(){h(e);let s=c();return f(s.checkAwake())}),m(7,"ion-icon",16),a()()()}if(i&2){let e=c();r(2),d("disabled",!e.running)("color",e.location?"tertiary":e.running?"warning":"light"),r(2),d("disabled",!e.running)("color",e.wifi?"tertiary":e.running?"warning":"light"),r(2),d("disabled",!e.running)("color",e.awake?"tertiary":e.running?"warning":"light")}}function ot(i,t){i&1&&(o(0,"ion-button",12),u(1,"Connecting"),a())}function at(i,t){if(i&1){let e=v();o(0,"ion-button",18),g("click",function(){h(e);let s=c(2);return f(s.start())}),u(1,"Start"),a()}}function rt(i,t){if(i&1){let e=v();o(0,"ion-button",18),g("click",function(){h(e);let s=c(2);return f(s.stop())}),u(1,"Stop"),a()}}function st(i,t){if(i&1&&k(0,at,2,0,"ion-button",17)(1,rt,2,0,"ion-button",17),i&2){let e=c();C(e.running?1:0)}}var b=class b{constructor(){this.running=!1;this.processing=!1;this.wifi=!1;this.location=!1;this.apiError=!1;this.awake=!1;this.message=I("");this.route=_(N);this.api=_(q);this.alert=_(tt);Z({locationSharp:Q,wifiSharp:X,cafeSharp:J})}ngOnInit(){return p(this,null,function*(){this.artId=j(this.route.snapshot.queryParams.art),this.art=this.artId?yield this.api.getArt(this.artId):void 0,this.setMessage(),y.addListener("networkStatusChange",t=>{this.processNetwork(t)}),yield Y(500),this.start()})}start(){return p(this,null,function*(){try{this.processing=!0,this.watchId=yield x.watchPosition({},t=>{if(!t){this.location=!1,console.error("No position");return}this.processPosition(t)}),this.processPosition(yield x.getCurrentPosition()),this.running=!0,this.processNetwork(yield y.getStatus()),yield this.keepAwake(!0)}catch(t){yield l(this.alert,`Unable to start geolocation watching: ${JSON.stringify(t)}`,"Error")}finally{this.processing=!1}})}checkNetwork(){var n;if(!this.connectionStatus){l(this.alert,"Network is disabled.");return}let t="";switch(this.connectionStatus.connectionType){case"wifi":t="WiFi ";break;case"cellular":t="Cellular ";break;case"none":t="";break;default:t="";break}let e=`${t}Network is ${this.connectionStatus.connected?"connected":"disconnected"}.`;this.apiError&&this.connectionStatus.connected&&(e+=`Network appears to be connected but unable to broadcast ${(n=this.art)==null?void 0:n.name}'s location. Possible bad cell service or backend error.`),l(this.alert,e,"Network Status")}checkAwake(){return p(this,null,function*(){(yield S.isSupported()).isSupported?l(this.alert,"Your device supports keeping the screen awake.","Awake Status"):l(this.alert,"Your device does not support keeping the screen awake.","Error")})}checkLocation(){if(!this.position){l(this.alert,"Location is disabled.");return}l(this.alert,`Last location was ${this.position.coords.latitude}, ${this.position.coords.longitude} at ${this.timeStamp()}.`,"Location Status")}image(){let t=this.art;return t?t.imageUrl?this.api.imageURL(t.imageUrl):`./assets/${t.art_type?`${t.art_type}`.toLowerCase().replace(/ /g,"-"):"unknown"}.svg`:"./assets/mutant-vehicle.svg"}processPosition(t){console.log(`Processing position ${t}`),this.position=t,this.broadcast(t),this.setMessage()}processNetwork(t){this.wifi=t.connected,this.connectionStatus=t}timeStamp(){var e;return new Date(((e=this.position)==null?void 0:e.timestamp)||0).toLocaleTimeString()}setMessage(){var t,e,n;this.apiError&&this.message.set(`Error: Unable to broadcast ${(t=this.art)==null?void 0:t.name}'s location to the dust app.`),this.position?(this.message.set(`${(e=this.art)==null?void 0:e.name}'s location is being broadcast to the dust app.`),this.location=!0):(this.message.set(`This will broadcast the location of ${(n=this.art)==null?void 0:n.name} so that users of the dust app can find it on the map.`),this.location=!1)}broadcast(t){return p(this,null,function*(){if(!this.art){console.error("No art");return}try{yield this.api.broadcast(this.art,t),this.apiError=!1,this.setMessage()}catch{this.wifi=!1,this.apiError=!0,this.setMessage()}})}keepAwake(t){return p(this,null,function*(){t?(this.awake=!1,yield S.keepAwake(),this.awake=!0):this.awake&&(yield S.allowSleep(),this.awake=!1)})}stop(){return p(this,null,function*(){this.watchId&&(yield x.clearWatch({id:this.watchId})),this.position=void 0,this.running=!1,this.setMessage(),yield this.keepAwake(!1)})}};b.\u0275fac=function(e){return new(e||b)},b.\u0275cmp=E({type:b,selectors:[["app-broadcast"]],decls:22,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],[3,"fullscreen"],[1,"pad-below","grid1"],[1,"grid-item"],[3,"src"],["horizontal","center",2,"margin-top","-60px"],[1,"message"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["shape","round","size","large","color","light"],[3,"click","disabled","color"],["name","location-sharp"],["name","wifi-sharp"],["name","cafe-sharp"],["shape","round","size","large","color","primary"],["shape","round","size","large","color","primary",3,"click"]],template:function(e,n){e&1&&(o(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),m(3,"ion-back-button"),a(),o(4,"ion-title",3),u(5,"Broadcast Location"),a(),m(6,"ion-buttons",4),a()(),o(7,"ion-content",5)(8,"div",6)(9,"div",7)(10,"ion-card"),m(11,"app-img",8),o(12,"ion-card-header"),k(13,nt,8,6,"ion-fab",9),o(14,"ion-card-title"),u(15),a()(),o(16,"ion-card-content")(17,"div",10),u(18),a(),o(19,"div",11),k(20,ot,2,0,"ion-button",12)(21,st,2,1),a()()()()()()),e&2&&(d("translucent",!0),r(7),d("fullscreen",!0),r(4),d("src",n.image()),r(2),C((n.running,13)),r(2),P(n.art==null?null:n.art.name),r(3),P(n.message()),r(2),C(n.processing?20:21))},dependencies:[U,W,M,H,V,B,A,$,D,z,O,et,L,F,G,K,R,T],styles:[".message[_ngcontent-%COMP%]{min-height:6rem}ion-fab-button[_ngcontent-%COMP%]{margin:.5rem}.img[_ngcontent-%COMP%]{min-height:14rem}ion-card-title[_ngcontent-%COMP%]{text-align:center;font-size:var(--fs2)}ion-card-content[_ngcontent-%COMP%]{font-size:var(--fs3);text-align:center}"]});var it=b;export{it as BroadcastPage};
