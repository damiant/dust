import{a as bt}from"./chunk-WUGLYCQ5.js";import{a as At}from"./chunk-OI5ZMPLQ.js";import{b as B}from"./chunk-QTBNLBDF.js";import{a as xt}from"./chunk-TOSLD3EX.js";import{a as yt}from"./chunk-26YF7LCF.js";import{a as Ct}from"./chunk-WVEW2PMG.js";import{a as ht}from"./chunk-55PDQDPP.js";import{b as gt}from"./chunk-LADCEZG6.js";import"./chunk-TUKQZ63R.js";import{A as ft,C as _t,R as vt,a as mt,w as ut}from"./chunk-OAPJ7RFL.js";import{d as pt,u as V,x as I}from"./chunk-SNNE7GZP.js";import{$ as f,A,Aa as _,B as b,Ca as S,Ka as E,L as F,Lb as H,Qa as j,Qb as Y,Rb as W,S as o,Sb as J,T as x,Ta as G,Tb as X,Ub as Z,Wb as tt,X as $,Xa as K,Yb as et,cb as q,cc as it,da as c,db as D,dc as nt,fc as ot,ga as u,gb as Q,hc as rt,ia as k,ja as L,ka as s,la as l,ma as p,nc as at,oa as M,oc as st,pa as w,qa as d,qc as lt,s as R,sb as z,uc as ct,w as y,wa as N,xa as O,ya as U,yc as dt}from"./chunk-SLKJQVFW.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as m}from"./chunk-LNJ3S2LQ.js";var h=class h{constructor(){this.api=y(I)}exportArtToCSV(i,t){let n=[];for(let r of t)n.push({id:r.id,name:r.name,description:r.description,email:r.contact_email,placed:r.pin!=""?"Yes":"No"});let a=V(i.toLowerCase()," ","-");B(`${a}-art.csv`,n)}exportArtEmail(i,t){let n=[];for(let r of t)pt(r.contact_email)||n.push({email:r.contact_email});if(n.length==0){this.api.sendMessage("No Art has email addresses to be exported.");return}let a=V(i.toLowerCase()," ","-");B(`${a}-art-email.txt`,n,{stripQuotes:!0,hideHeaders:!0})}};h.\u0275fac=function(t){return new(t||h)},h.\u0275prov=R({token:h,factory:h.\u0275fac,providedIn:"root"});var P=h;var Lt=["kmlUpload"],St=(e,i)=>i.id,Mt=e=>[e],Et=e=>({art:e});function Vt(e,i){if(e&1){let t=M();s(0,"ion-toolbar")(1,"ion-searchbar",13),w("ionInput",function(a){A(t);let r=d();return b(r.handleSearch(a))}),l(),s(2,"ion-button",14),w("click",function(){A(t);let a=d();return b(a.toggleGrid())}),p(3,"ion-icon",15),l()()}if(e&2){let t=d();o(),c("debounce",600)("placeholder","Search art at "+t.title),o(2),c("name",t.isGrid?"list-outline":"grid-outline")}}function Bt(e,i){if(e&1&&p(0,"ion-progress-bar",9),e&2){let t=d();c("value",t.progress)}}function Rt(e,i){if(e&1&&p(0,"app-card",17),e&2){let t=d(3);c("title",t.filteredBySearch?"No Art Found":"No Art")("description",t.filteredBySearch?"No art was found matching that search.":"There is no art registered for "+t.festivalTitle)}}function Ft(e,i){if(e&1&&f(0,Rt,1,2,"app-card",17),e&2){let t=d(2);u(t.art.length===0?0:-1)}}function $t(e,i){}function Nt(e,i){e&1&&(s(0,"ion-button",24),p(1,"ion-icon",28),l())}function Ot(e,i){if(e&1&&(s(0,"ion-button",27),_(1,"Broadcast GPS"),l()),e&2){let t=d().$implicit,n=d(4);c("disabled",!n.canBroadcastLocation)("routerLink","../broadcast")("queryParams",E(3,Et,t.id))}}function Ut(e,i){if(e&1&&(s(0,"div",20)(1,"ion-card",21),p(2,"app-img",22),s(3,"ion-card-header",23)(4,"ion-card-title"),_(5),f(6,Nt,2,0,"ion-button",24),l()(),s(7,"ion-card-content"),_(8),s(9,"div",25)(10,"ion-button",26),_(11,"Edit"),l(),s(12,"ion-button",27),_(13,"Events"),l(),f(14,Ot,2,5,"ion-button",27),l()()()()),e&2){let t=i.$implicit,n=d(4);o(2),c("routerLink",n.editRoute(t))("src",n.image(t)),o(),c("routerLink",n.editRoute(t)),o(2),S("",t.name," "),o(),u(t.pin?6:-1),o(2),S(" ",t.description," "),o(2),c("disabled",!n.canEditArt)("routerLink","../art/"+E(12,Mt,t.id)),o(2),c("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",E(14,Et,t.id)),o(2),u(t.art_type==="Mutant Vehicle"?14:-1)}}function jt(e,i){if(e&1&&(s(0,"div",18),k(1,Ut,15,16,"div",20,St),l()),e&2){let t=d(3);c("ngClass",t.art.length>1?"grid":"grid1"),o(),L(t.art)}}function Gt(e,i){e&1&&p(0,"ion-icon",28)}function Kt(e,i){if(e&1&&(s(0,"ion-item"),p(1,"app-img",30),s(2,"ion-text",31),_(3),f(4,Gt,1,0,"ion-icon",28),l()()),e&2){let t=i.$implicit,n=d(4);o(),c("width","45px")("height","45px")("routerLink",n.editRoute(t))("src",n.image(t)),o(),c("routerLink",n.editRoute(t)),o(),S(" ",t.name," "),o(),u(t.pin?4:-1)}}function qt(e,i){if(e&1&&(s(0,"div",19)(1,"ion-card")(2,"ion-list"),k(3,Kt,5,7,"ion-item",null,St),l()(),p(5,"div",29)(6,"div",29),l()),e&2){let t=d(3);o(3),L(t.art)}}function Dt(e,i){if(e&1&&f(0,jt,3,1,"div",18)(1,qt,7,0,"div",19),e&2){let t=d(2);u(t.isGrid?0:1)}}function Qt(e,i){if(e&1&&(s(0,"div",10)(1,"div",16),f(2,Ft,1,1)(3,$t,0,0),l(),f(4,Dt,2,1),l()),e&2){let t=d();o(),c("ngClass",t.art.length>0?"":"pad-vertical"),o(),u(t.isAdmin?2:3),o(2),u(t.art.length>0?4:-1)}}function zt(e,i){e&1&&p(0,"app-spinner")}function Ht(e,i){if(e&1&&p(0,"app-footer",11),e&2){let t=d();c("routeTo",t.newRoute())}}var g=class g{constructor(i,t,n,a){this.api=i;this.artService=t;this.kml=n;this.router=a;this.art=[];this.busy=!0;this.isAdmin=!1;this.canEdit=!1;this.canEditArt=!1;this.canEditEvent=!1;this.canBroadcastLocation=!1;this.isGrid=!0;this.filteredBySearch=!1;this.buttons=[];this.title="";this.festivalTitle="";this.alert=y(lt);this.mapChanges=F({camps:[],art:[],pins:[],newCamps:[],newArt:[]});vt({add:mt,locationSharp:_t,listOutline:ft,gridOutline:ut}),j(()=>m(this,null,function*(){let r=this.mapChanges();if(r.art.length==0&&r.newArt.length==0)return;this.busy=!0;let v=r.art.length,C=0;for(let T of r.art){C++;try{yield this.api.addArt(T)}catch(Pt){throw console.error(`Unable to apply art change ${T.name}`,T),Pt}this.progress=C/v}let It=yield this.importNewArt(r.newArt);this.message(`${r.art.length} art changes made. ${It} art added.`),console.log(r),this.api.clearCache(),this.ionViewDidEnter(),this.busy=!1,this.progress=void 0}))}ngOnInit(){return m(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity,!0),this.title=`${this.api.festivalTitle()}`,this.festivalTitle=this.api.festivalTitle(),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.canEdit=this.api.getAccessInfo(void 0).hasArt||this.isAdmin,this.canEditEvent=this.api.eventEditing()||this.isAdmin,this.canEditArt=this.api.artEditing()||this.isAdmin,this.canBroadcastLocation=this.api.artEditing(),this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"},{title:"Export Email Addresses",method:this.exportEmail(),icon:"mail-outline"},{title:"Import KML",method:this.importKML(),icon:"cloud-upload-outline"}]:[]})}ionViewDidEnter(){return m(this,null,function*(){this.art=yield this.api.art({cached:!0}),this.filteredBySearch=!1,this.busy=!1})}importCSV(){return()=>m(this,null,function*(){this.router.navigateByUrl("./import-art")})}importKML(){return()=>m(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.kmlUpload.nativeElement.click()})}exportCSV(){return()=>m(this,null,function*(){this.artService.exportArtToCSV(this.festivalTitle,this.art)})}exportEmail(){return()=>m(this,null,function*(){this.artService.exportArtEmail(this.festivalTitle,this.art)})}message(i){setTimeout(()=>{this.api.sendMessage(i)},1)}handleSearch(i){return m(this,null,function*(){let t=i.target.value.toLowerCase(),n=yield this.api.art({cached:!0});this.art=n.filter(a=>{var r;return a.name.toLowerCase().includes(t)||((r=a.description)==null?void 0:r.toLowerCase().includes(t))}),this.filteredBySearch=t.length>0})}toggleGrid(){this.isGrid=!this.isGrid}editRoute(i){return this.canEdit?"../art/"+i.id:void 0}image(i){return i.imageUrl?this.api.imageURL(i.imageUrl):`./assets/${i.art_type?`${i.art_type}`.toLowerCase().replace(/ /g,"-"):"unknown"}.svg`}newRoute(){return this.canEdit?"../art/new":void 0}onKMLSelected(i){return m(this,null,function*(){if(!this.isAdmin){this.api.sendMessage("You do not have access rights to this feature.");return}let t=i.target.files[0];if(!t)return;let n=new FileReader;n.onload=a=>m(this,null,function*(){var C;let r=(C=a.target)==null?void 0:C.result,v=this.kml.parse(r,this.art,!0);this.mapChanges.set(v)}),n.readAsText(t)})}importNewArt(i){return m(this,null,function*(){let t=0;if(i.length==0)return 0;for(let n of i)if(n.pin.includes("lat")){let a=yield gt(this.alert,`Add Art "${n.name}" ?`,"Add");if(a=="Add"&&(yield this.api.addArt(n),t++),a=="Cancel")return t}return t})}};g.\u0275fac=function(t){return new(t||g)(x(I),x(P),x(bt),x(q))},g.\u0275cmp=$({type:g,selectors:[["app-art"]],viewQuery:function(t,n){if(t&1&&N(Lt,7),t&2){let a;O(a=U())&&(n.kmlUpload=a.first)}},inputs:{vanity:"vanity"},decls:18,vars:7,consts:[["kmlUpload",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../art/new",3,"disabled"],["name","add"],[3,"buttons"],[3,"fullscreen"],[3,"value"],[1,"large-border"],["title","Add Art",3,"routeTo"],["type","file",1,"file-input",3,"change"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],["color","dark","fill","clear","slot","end",3,"click"],[3,"name"],[1,"ion-text-center",3,"ngClass"],[3,"title","description"],[1,"pad-below",3,"ngClass"],[1,"border"],[1,"grid-item"],[1,"clickable"],[3,"routerLink","src"],[3,"routerLink"],["fill","clear","color","light",2,"position","absolute","margin-top","-3px"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["color","secondary",3,"disabled","routerLink"],["color","secondary",3,"disabled","routerLink","queryParams"],["size","small","name","location-sharp",1,"pin"],[1,"ion-padding"],[1,"clickable",2,"min-width","45px",3,"width","height","routerLink","src"],[1,"clickable",2,"width","100%","padding","1rem",3,"routerLink"]],template:function(t,n){if(t&1){let a=M();s(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),p(3,"ion-back-button"),l(),s(4,"ion-title",3),_(5,"Art"),l(),s(6,"ion-buttons",4)(7,"ion-button",5),p(8,"ion-icon",6),l(),p(9,"app-side",7),l()()(),s(10,"ion-content",8),f(11,Vt,4,3,"ion-toolbar")(12,Bt,1,1,"ion-progress-bar",9)(13,Qt,5,3,"div",10)(14,zt,1,0,"app-spinner")(15,Ht,1,1,"app-footer",11),s(16,"input",12,0),w("change",function(v){return A(a),b(n.onKMLSelected(v))}),l()()}t&2&&(o(7),c("disabled",!n.canEdit),o(2),c("buttons",n.buttons),o(),c("fullscreen",!0),o(),u(n.art.length>1?11:-1),o(),u(n.progress?12:-1),o(),u(n.busy?14:13),o(2),u(n.isAdmin?15:-1))},dependencies:[nt,ot,X,tt,J,Z,rt,dt,ct,xt,yt,ht,Y,H,W,et,it,at,st,K,G,z,At,Ct,Q,D],styles:["ion-card-title[_ngcontent-%COMP%]{font-size:1.5rem!important}ion-card-content[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:var(--fs4)}h1[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.pin[_ngcontent-%COMP%]{color:var(--ion-color-primary);opacity:.5}app-img[_ngcontent-%COMP%]{--border-radius: 5px}"]});var wt=g;export{wt as ArtPage};
