import{a as re}from"./chunk-NE5K7VVL.js";import{a as oe}from"./chunk-EB7ZKUPJ.js";import{a as ne}from"./chunk-5EUBO754.js";import"./chunk-DUKSTT3K.js";import{E as Y,H as Z,J as ee,O as ie,P as te,aa as ae,h as K,t as Q,x as X}from"./chunk-TF5OT4X3.js";import{I as J}from"./chunk-CXIDEVKY.js";import"./chunk-PFLI22GG.js";import{$ as I,$b as B,Aa as c,G as t,O as C,Oa as M,Ra as w,Rb as D,W as b,X as f,Yb as O,Z as _,Zb as F,_ as x,_b as N,aa as s,ac as A,ba as o,bc as L,ca as n,cc as W,da as l,ec as R,fb as E,gb as T,ia as P,jb as U,ka as S,kc as V,lc as $,ma as u,mc as G,nc as H,p as g,pc as j,s as v,t as y,vc as z,w as m,wc as q,yb as k,za as d}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h}from"./chunk-LNJ3S2LQ.js";function de(a,i){if(a&1&&l(0,"app-img",13),a&2){let e=u().$implicit,r=u(2);s("width","45px")("height","45px")("src",r.image(e.image))}}function pe(a,i){if(a&1&&(o(0,"ion-item")(1,"ion-label"),d(2),o(3,"p"),d(4),n()(),b(5,de,1,3,"app-img",13),n()),a&2){let e=i.$implicit;t(2),c(e.type),t(2),c(e.text),t(),f(e.image?5:-1)}}function me(a,i){if(a&1){let e=P();o(0,"div",8)(1,"ion-card",10)(2,"ion-card-header")(3,"ion-card-title"),d(4,"Unpublished Changes"),n(),l(5,"ion-card-subtitle"),n(),o(6,"ion-card-content")(7,"ion-list")(8,"ion-item")(9,"ion-label"),d(10),n()(),x(11,pe,6,3,"ion-item",null,_),n(),o(13,"div",11)(14,"ion-button",12),S("click",function(){v(e);let le=u();return y(le.publish())}),d(15,"\xA0Publish"),n()()()()()}if(a&2){let e=u();t(10),c(e.title()),t(),I(e.unpublished()),t(3),s("disabled",e.preparing()||!e.isAdmin())}}function ue(a,i){a&1&&l(0,"app-spinner",9)}var p=class p{constructor(){this.api=g(J);this.router=g(E);this.vanity=w();this.isAdmin=m(!1);this.busy=m(!1);this.preparing=m(!1);this.unpublished=m([]);this.title=M(()=>{var i;return this.unpublished().length>0?`These changes have been made to ${(i=this.festival)==null?void 0:i.name} but have not published to dust.`:this.preparing()?"Please wait....":"Publishing will ensure that users in the dust app see these changes when they open the event next time."});ae({homeOutline:Y,calendarOutline:K,musicalNotesOutline:te,mapOutline:ie,locationOutline:ee,linkOutline:Z,createOutline:X,cloudUploadOutline:Q})}ionViewWillEnter(){return h(this,null,function*(){this.update()})}update(){return h(this,null,function*(){this.preparing.set(!0);let i=this.vanity();if(i){if(this.festival=yield this.api.getFestivalByVanity(i,!0),!this.festival)return;this.api.setFestival(this.festival),this.isAdmin.set(this.api.isAdmin(this.festival.id)),this.unpublished.set(yield this.api.getUnpublishedChanges())}this.preparing.set(!1)})}publish(){return h(this,null,function*(){try{this.busy.set(!0),this.api.setFestival(this.festival),yield this.api.publish(),this.api.sendMessage("Data has been published to the Dust app",1),this.router.navigateByUrl(`${this.api.vanity()}`)}finally{this.busy.set(!1)}})}image(i){return this.api.imageURL(i)}};p.\u0275fac=function(e){return new(e||p)},p.\u0275cmp=C({type:p,selectors:[["app-unpublished"]],inputs:{vanity:[1,"vanity"]},decls:12,vars:7,consts:[["color","primary"],["slot","start"],[3,"disabled"],[3,"routerLink"],["slot","end"],[3,"hidden"],[3,"fullscreen"],["type","indeterminate",3,"hidden"],[1,"border"],["title","Publishing can take some time. Please be patient."],[2,"margin-top","2rem"],[1,"ion-text-center"],["shape","round",2,"margin-top","0rem","margin-right","1rem",3,"click","disabled"],[2,"min-width","45px",3,"width","height","src"]],template:function(e,r){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),l(3,"ion-back-button",2),n(),o(4,"ion-title",3),d(5),n(),o(6,"ion-buttons",4),l(7,"app-side",5),n()()(),o(8,"ion-content",6),l(9,"ion-progress-bar",7),b(10,me,16,2,"div",8)(11,ue,1,0,"app-spinner",9),n()),e&2&&(t(3),s("disabled",r.busy()),t(),s("routerLink","/all"),t(),c(r.busy()?"Publishing":"dust"),t(2),s("hidden",r.busy()),t(),s("fullscreen",!0),t(),s("hidden",!r.preparing()),t(),f(r.busy()?11:10))},dependencies:[j,k,re,ne,U,T,V,q,F,D,z,O,R,N,A,W,L,B,G,H,$,oe],styles:["ion-button[_ngcontent-%COMP%]{width:10rem}ion-label[_ngcontent-%COMP%]{font-family:Gelion Medium!important}p[_ngcontent-%COMP%]{font-family:Gelion Regular;font-size:var(--fs4)}"]});var se=p;export{se as UnpublishedPage};
