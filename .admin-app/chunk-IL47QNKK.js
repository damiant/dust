import{a as $}from"./chunk-S6IHJUHU.js";import{R as ee,c as Q,l as X}from"./chunk-OAPJ7RFL.js";import{B as J,e as A}from"./chunk-UOBZOUDF.js";import{a as G}from"./chunk-MIGJGGKJ.js";import{$ as m,A as c,Aa as y,B as d,Ba as x,Fa as P,Ga as b,Ha as I,L as S,Pa as T,Pb as W,Qb as z,Rb as U,S as o,Sb as O,T as v,X as M,Xb as j,bc as L,cb as k,cc as D,da as w,ec as F,ga as p,ka as a,la as s,lb as E,ma as C,mb as R,mc as Z,nc as H,oa as f,pa as u,pc as K,qa as l,qb as N,rb as B,tc as Y,ua as V,uc as q}from"./chunk-PNZTRGP7.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h}from"./chunk-LNJ3S2LQ.js";function ie(r,t){if(r&1){let e=f();a(0,"ion-buttons",1)(1,"ion-button",10),u("click",function(){c(e);let i=l();return d(i.clear())}),C(2,"ion-icon",11),s()()}}function ne(r,t){if(r&1){let e=f();a(0,"ion-button",10),u("click",function(){c(e);let i=l();return d(i.close())}),C(1,"ion-icon",12),s()}}function re(r,t){r&1&&C(0,"app-spinner")}function oe(r,t){if(r&1&&(a(0,"div",7)(1,"p"),y(2),s()()),r&2){let e=l();o(2),x(e.redirectMessage())}}function ae(r,t){if(r&1){let e=f();a(0,"ion-item")(1,"ion-input",13),u("keyup.enter",function(){c(e);let i=l();return d(i.next())}),I("ngModelChange",function(i){c(e);let _=l();return b(_.email,i)||(_.email=i),d(i)}),s()()}if(r&2){let e=l();o(),P("ngModel",e.email)}}function le(r,t){if(r&1){let e=f();a(0,"ion-item")(1,"ion-input",14),u("keyup.enter",function(){c(e);let i=l();return d(i.next())})("ionInput",function(){c(e);let i=l();return d(i.changed())}),I("ngModelChange",function(i){c(e);let _=l();return b(_.code,i)||(_.code=i),d(i)}),s()()}if(r&2){let e=l();o(),V("helperText","Enter the verification code that was emailed to ",e.email,""),P("ngModel",e.code)}}var g=class g{constructor(t,e,n){this.alert=t;this.api=e;this.router=n;this.email="";this.code="";this.busy=!1;this.redirecting=S(!1);this.redirectType="none";this.emailPage=!0;this.isNative=G.isNativePlatform();this.title=T(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"Register a camp";case"event":return"Register an event";default:return""}return"Sign In"});this.redirectMessage=T(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"To register a camp we first need an email address.";case"event":return"To register a event we first need an email address.";default:return""}return""});ee({arrowBack:Q,close:X})}ionViewWillEnter(){let t=this.api.getRedirectionUrl();this.redirectType="none",t&&t.includes("/camps")&&(this.redirectType="camp"),t&&t.includes("/events")&&(this.redirectType="event"),this.redirecting.set(!!t&&t!=="")}close(){return h(this,null,function*(){document.location.href="index.html"})}next(){return h(this,null,function*(){if(this.emailPage){if(!this.validateEmail(this.email)){this.presentAlert("The email address is invalid");return}try{this.busy=!0,yield this.api.signIn(this.email),this.emailPage=!1}finally{this.busy=!1}}else{let t=this.code.toString().padStart(6,"0");if(!this.code||t.length!==6){this.presentAlert("The verification code is incorrect");return}this.signIn(t)}})}signIn(t){return h(this,null,function*(){try{this.busy=!0,yield A(1e3),yield this.api.verify(t),yield A(1e3),this.emailPage=!0,this.code="",this.email="";let e=this.api.getRedirectionUrl();if(this.api.clearCache(),!e||e=="")console.log("Redirect but redirect was empty"),this.router.navigateByUrl("/all",{replaceUrl:!0});else{if(e=="none"){this.api.setRedirection("");return}console.log(`Redirect to ${e}`),this.api.setRedirection("none"),this.router.navigateByUrl(e,{replaceUrl:!0})}}finally{this.busy=!1}})}changed(){setTimeout(()=>{let t=`${this.code}`;t.length==6&&this.signIn(t)},500)}presentAlert(t){return h(this,null,function*(){yield(yield this.alert.create({header:"Message",message:t,buttons:["OK"]})).present()})}clear(){this.code="",this.emailPage=!0}validateEmail(t){return!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}};g.\u0275fac=function(e){return new(e||g)(v(K),v(J),v(k))},g.\u0275cmp=M({type:g,selectors:[["app-auth"]],decls:23,vars:9,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"fullscreen"],[1,"border"],[1,"ion-text-center"],[2,"height","3rem","width","100%","border-radius","0.5rem","display","flex","align-items","center","justify-content","center","margin-left","auto","margin-right","auto","color","var(--ion-color-primary)"],[1,"ion-padding"],["lines","none"],["size","medium","shape","round","expand","block","color","primary",3,"click","disabled"],[3,"click"],["name","arrow-back"],["size","small","name","close",1,"close"],["name","emailAddress","id","emailAddress","type","email","label","Email Address","labelPlacement","stacked","helperText","You will be emailed a verification code.",3,"keyup.enter","ngModelChange","ngModel"],["type","number","inputMode","numeric","pattern","[0-9]*","label","Verification Code","labelPlacement","stacked",3,"keyup.enter","ionInput","ngModelChange","helperText","ngModel"]],template:function(e,n){e&1&&(a(0,"ion-header")(1,"ion-toolbar",0),m(2,ie,3,0,"ion-buttons",1),a(3,"ion-title"),y(4,"dust"),s(),a(5,"ion-buttons",2),m(6,ne,2,0,"ion-button"),s()()(),a(7,"ion-content",3),m(8,re,1,0,"app-spinner"),a(9,"div",4)(10,"ion-card")(11,"ion-card-content",5)(12,"div",6)(13,"h1"),y(14),s()(),m(15,oe,3,1,"div",7),a(16,"ion-list",8),m(17,ae,2,1,"ion-item")(18,le,2,3,"ion-item"),a(19,"ion-item")(20,"ion-toolbar",7)(21,"ion-button",9),u("click",function(){return n.next()}),y(22),s()()()()()()()()),e&2&&(o(2),p(n.emailPage?-1:2),o(4),p(n.isNative?6:-1),o(),w("fullscreen",!0),o(),p(n.busy?8:-1),o(6),x(n.title()),o(),p(n.redirecting()?15:-1),o(2),p(n.emailPage?17:18),o(4),w("disabled",n.busy),o(),x(n.emailPage?"Next":"Sign In"))},dependencies:[z,Y,B,E,N,R,L,H,Z,j,U,O,F,D,q,W,$],styles:["h1[_ngcontent-%COMP%]{font-size:var(--fr2)}p[_ngcontent-%COMP%]{font-size:var(--fr3)}@media (min-width: 801px){ion-card[_ngcontent-%COMP%]{margin-left:100px;margin-right:100px}}.close[_ngcontent-%COMP%]{color:#fff!important}"]});var te=g;export{te as AuthPage};
