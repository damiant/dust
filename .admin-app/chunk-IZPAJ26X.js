import{a as re}from"./chunk-Q7SRVC5Z.js";import{a as oe}from"./chunk-6XV5C437.js";import{a as ae}from"./chunk-OIMHMYK4.js";import"./chunk-DUKSTT3K.js";import{D as X,L as Y,O as Z,Q as ee,V as ie,W as te,ja as ne,k as K,y as Q}from"./chunk-LIWDDRYP.js";import{K as J}from"./chunk-5GFD3MFK.js";import"./chunk-PFLI22GG.js";import{$ as I,Aa as d,Ba as c,Db as D,Ec as q,Fc as G,H as t,P as C,Ra as w,Ua as M,Wb as O,X as b,Y as v,_,aa as x,ba as r,ca as o,cc as k,da as n,dc as F,ea as l,ec as N,fc as B,gc as A,hc as L,ic as W,ja as P,jb as E,kb as T,la as S,lc as V,na as m,nb as U,p as g,rc as R,s as f,sc as $,t as y,uc as H,vc as j,w as u,yc as z}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h}from"./chunk-LNJ3S2LQ.js";function de(a,i){if(a&1&&l(0,"app-img",12),a&2){let e=m().$implicit,s=m(2);r("width","45px")("height","45px")("src",s.image(e.image))}}function pe(a,i){if(a&1&&(o(0,"ion-item")(1,"ion-label"),d(2),o(3,"p"),d(4),n()(),b(5,de,1,3,"app-img",12),n()),a&2){let e=i.$implicit;t(2),c(e.type),t(2),c(e.text),t(),v(e.image?5:-1)}}function ue(a,i){if(a&1){let e=P();o(0,"div",8)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),d(4,"Unpublished Changes"),n(),l(5,"ion-card-subtitle"),n(),o(6,"ion-card-content")(7,"ion-list")(8,"ion-item")(9,"ion-label"),d(10),n()(),I(11,pe,6,3,"ion-item",null,_),n(),o(13,"div",10)(14,"ion-button",11),S("click",function(){f(e);let le=m();return y(le.publish())}),d(15,"\xA0Publish"),n()()()()()}if(a&2){let e=m();t(10),c(e.title()),t(),x(e.unpublished()),t(3),r("disabled",e.preparing()||!e.isAdmin())}}function me(a,i){a&1&&l(0,"app-progress-overlay",9),a&2&&r("isIndeterminate",!0)}var p=class p{constructor(){this.api=g(J);this.router=g(E);this.vanity=M();this.isAdmin=u(!1);this.busy=u(!1);this.preparing=u(!1);this.unpublished=u([]);this.title=w(()=>{var i;return this.unpublished().length>0?`These changes have been made to ${(i=this.festival)==null?void 0:i.name} but have not published to dust.`:this.preparing()?"Please wait....":"Publishing will ensure that users in the dust app see these changes when they open the event next time."});ne({homeOutline:Y,calendarOutline:K,musicalNotesOutline:te,mapOutline:ie,locationOutline:ee,linkOutline:Z,createOutline:X,cloudUploadOutline:Q})}ionViewWillEnter(){return h(this,null,function*(){this.update()})}update(){return h(this,null,function*(){this.preparing.set(!0);let i=this.vanity();if(i){if(this.festival=yield this.api.getFestivalByVanity(i,!0),!this.festival)return;this.api.setFestival(this.festival),this.isAdmin.set(this.api.isAdmin(this.festival.id)),this.unpublished.set(yield this.api.getUnpublishedChanges())}this.preparing.set(!1)})}publish(){return h(this,null,function*(){try{this.busy.set(!0),this.api.setFestival(this.festival),yield this.api.publish(),this.api.sendMessage("Data has been published to the Dust app",1),this.router.navigateByUrl(`${this.api.vanity()}`)}finally{this.busy.set(!1)}})}image(i){return this.api.imageURL(i)}};p.\u0275fac=function(e){return new(e||p)},p.\u0275cmp=C({type:p,selectors:[["app-unpublished"]],inputs:{vanity:[1,"vanity"]},decls:12,vars:7,consts:[["color","primary"],["slot","start"],[3,"disabled"],[3,"routerLink"],["slot","end"],[3,"hidden"],[3,"fullscreen"],["type","indeterminate",3,"hidden"],[1,"border"],["title","Publishing...",3,"isIndeterminate"],[1,"ion-text-center"],["size","large","shape","round",3,"click","disabled"],[3,"width","height","src"]],template:function(e,s){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),l(3,"ion-back-button",2),n(),o(4,"ion-title",3),d(5),n(),o(6,"ion-buttons",4),l(7,"app-side",5),n()()(),o(8,"ion-content",6),l(9,"ion-progress-bar",7),b(10,ue,16,2,"div",8)(11,me,1,1,"app-progress-overlay",9),n()),e&2&&(t(3),r("disabled",s.busy()),t(),r("routerLink","/all"),t(),c(s.busy()?"Publishing":"dust"),t(2),r("hidden",s.busy()),t(),r("fullscreen",!0),t(),r("hidden",!s.preparing()),t(),v(s.busy()?11:10))},dependencies:[z,D,oe,re,U,T,R,G,F,O,q,k,V,N,A,W,L,B,H,j,$,ae],styles:["ion-button[_ngcontent-%COMP%]{width:10rem}app-img[_ngcontent-%COMP%]{min-width:45px}"]});var se=p;export{se as UnpublishedPage};
