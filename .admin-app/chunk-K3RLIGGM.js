import{a as ve}from"./chunk-VVJA7NBV.js";import{a as Ce}from"./chunk-Z5HZYXFK.js";import{a as ge}from"./chunk-KCPLCCSF.js";import{a as he}from"./chunk-SVNDKX5K.js";import{a as ue}from"./chunk-WRLAXAJB.js";import{a as fe}from"./chunk-5B2MUMUK.js";import"./chunk-LIWDDRYP.js";import{H as pe,K as _e,e as M,m as me,o as ce,u as V}from"./chunk-OQVFSD37.js";import"./chunk-PFLI22GG.js";import{$ as W,Aa as g,Ba as P,Bc as ie,Db as R,E as k,Ec as ne,Fa as f,Fc as ae,Ga as p,H as c,Ha as u,Kc as se,Lc as oe,Nc as le,P as F,Sc as re,T,Tc as de,Ua as O,Wb as Z,X as y,Xb as A,Y as x,Za as N,_ as I,aa as E,ba as _,ca as a,cc as Q,da as s,dc as Y,ea as v,ec as j,fc as H,ja as b,la as h,lc as J,mc as K,na as l,p as S,ra as L,rc as X,s as r,sa as B,sc as $,t as d,ta as D,tb as q,uc as ee,vc as te,wa as z,wb as G,za as U}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as w}from"./chunk-LNJ3S2LQ.js";var xe=["gps"];function be(m,o){if(m&1&&v(0,"img",12),m&2){let t=l(2);_("src",t.imageUrl,k)}}function Me(m,o){m&1&&(a(0,"p"),g(1,"Click to choose an image"),s())}function Se(m,o){if(m&1){let t=b();a(0,"ion-datetime",29),u("ngModelChange",function(e){r(t);let i=l(2);return p(i.festival.start_time,e)||(i.festival.start_time=e),d(e)}),h("ionChange",function(){r(t);let e=l(2);return d(e.startChanged())}),s()}if(m&2){let t=l(2);_("showDefaultButtons",!0),f("ngModel",t.festival.start_time)}}function Te(m,o){if(m&1){let t=b();a(0,"ion-datetime",30),u("ngModelChange",function(e){r(t);let i=l(2);return p(i.festival.end_time,e)||(i.festival.end_time=e),d(e)}),h("ionChange",function(){r(t);let e=l(2);return d(e.endChanged())}),s()}if(m&2){let t=l(2);_("showDefaultButtons",!0),f("ngModel",t.festival.end_time)}}function Pe(m,o){if(m&1&&(a(0,"ion-select-option",22),g(1),s()),m&2){let t=o.$implicit;_("value",t),c(),P(t)}}function Ve(m,o){if(m&1){let t=b();a(0,"ion-button",31),h("click",function(){r(t);let e=l(2);return d(e.delete())}),g(1,"Delete"),s()}m&2&&_("disabled",!0)}function ke(m,o){if(m&1){let t=b();a(0,"div",7)(1,"ion-card")(2,"ion-card-content")(3,"ion-list",8)(4,"ion-item")(5,"ion-input",9),u("ngModelChange",function(e){r(t);let i=l();return p(i.festival.name,e)||(i.festival.name=e),d(e)}),s()(),a(6,"ion-item")(7,"ion-textarea",10),u("ngModelChange",function(e){r(t);let i=l();return p(i.festival.description,e)||(i.festival.description=e),d(e)}),s()(),a(8,"div",11),h("click",function(){r(t);let e=z(51);return d(e.click())}),y(9,be,1,1,"img",12),y(10,Me,2,0,"p"),s(),a(11,"ion-item")(12,"app-emails",13),u("emailsChange",function(e){r(t);let i=l();return p(i.festival.admins,e)||(i.festival.admins=e),d(e)}),s()(),a(13,"ion-item")(14,"ion-input",14),u("ngModelChange",function(e){r(t);let i=l();return p(i.festival.region,e)||(i.festival.region=e),d(e)}),s()(),a(15,"app-link-input",15),u("modelChange",function(e){r(t);let i=l();return p(i.festival.website,e)||(i.festival.website=e),d(e)}),h("iconClick",function(){r(t);let e=l();return d(e.openWebsite())}),s(),a(16,"ion-item")(17,"ion-checkbox",16),u("ngModelChange",function(e){r(t);let i=l();return p(i.festival.unknown_dates,e)||(i.festival.unknown_dates=e),d(e)}),s(),a(18,"ion-label",17),g(19,"Dates are not known yet"),s()(),a(20,"ion-item")(21,"ion-label"),g(22,"Start"),s(),v(23,"ion-datetime-button",18),s(),a(24,"ion-modal",19),T(25,Se,1,2,"ng-template"),s(),a(26,"ion-item")(27,"ion-label"),g(28,"End"),s(),v(29,"ion-datetime-button",20),s(),a(30,"ion-modal",19),T(31,Te,1,2,"ng-template"),s(),a(32,"ion-item")(33,"ion-select",21),u("ngModelChange",function(e){r(t);let i=l();return p(i.festival.timezone,e)||(i.festival.timezone=e),d(e)}),W(34,Pe,2,2,"ion-select-option",22,I),s()(),a(36,"ion-item")(37,"ion-checkbox",16),u("ngModelChange",function(e){r(t);let i=l();return p(i.festival.active,e)||(i.festival.active=e),d(e)}),s(),a(38,"ion-label",17),g(39,"Display in the Dust app"),s()(),a(40,"ion-item")(41,"ion-label",23),h("click",function(){r(t);let e=l();return d(e.openLocation())}),a(42,"app-tooltip",24),g(43," Location "),s()(),a(44,"app-gps",25,0),u("latChange",function(e){r(t);let i=l();return p(i.festival.gpsLat,e)||(i.festival.gpsLat=e),d(e)})("lngChange",function(e){r(t);let i=l();return p(i.festival.gpsLng,e)||(i.festival.gpsLng=e),d(e)}),h("gpsChange",function(e){r(t);let i=l();return d(i.gpsChanged(e))}),s()()(),a(46,"div",26),y(47,Ve,2,1,"ion-button",27),a(48,"ion-button",5),h("click",function(){r(t);let e=l();return d(e.save())}),g(49,"Save"),s()(),a(50,"input",28,1),h("change",function(e){r(t);let i=l();return d(i.onFileSelected(e))}),s()()()()}if(m&2){let t=l();c(5),f("ngModel",t.festival.name),c(2),_("spellcheck",!0)("rows",6)("autoGrow",!0),f("ngModel",t.festival.description),c(),U(t.uploading?"disabled":""),c(),x(t.imageUrl?9:-1),c(),x(t.imageUrl?-1:10),c(2),_("isAdmin",!0)("isOwner",!0)("label","Administrator Emails")("placeholder","Comma delimited list of email addresses"),f("emails",t.festival.admins),c(2),f("ngModel",t.festival.region),c(),f("model",t.festival.website),c(2),f("ngModel",t.festival.unknown_dates),c(7),_("keepContentsMounted",!0),c(6),_("keepContentsMounted",!0),c(3),_("value",t.festival.timezone),f("ngModel",t.festival.timezone),c(),E(t.timezones),c(3),f("ngModel",t.festival.active),c(7),f("lat",t.festival.gpsLat)("lng",t.festival.gpsLng),c(3),x(t.canDelete?47:-1)}}function Fe(m,o){m&1&&v(0,"app-spinner")}var C=class C{constructor(){this.vanity=O();this.busy=!0;this.canDelete=!1;this.uploading=!1;this.endModified=!1;this.timezones=[];this.imageChanged=!1;this.location=S(N);this.api=S(_e);this.festival={name:"",vanity:"",admins:"",contact:"",description:"",mastodon_handle:"",inbox_email:"",region:"",website:"",pin_size_multiplier:1,max_music_types:2,start_time:new Date().toISOString(),end_time:new Date().toISOString(),music_registration:!1,camp_registration:!1,gpsLat:0,gpsLng:0,camp_editing:!1,music_types:"",event_registration:!1,placement_form_art:"",placement_form_camps:"",approved:!1,event_editing:!1,art_editing:!1,archived:!1,map_direction:0,event_types:"",max_event_types:2,pin:void 0,directions:void 0,unknown_dates:!1,placement_form_cars:"",hidden_features:0,volunteeripate_domain:"",volunteeripate_identifier:"",rss_feed:"",theme:null,id:void 0,active:!1,timezone:this.api.currentTimeZone()}}ionViewWillEnter(){return w(this,null,function*(){let o=this.api.festivalId,t=this.vanity();t?yield this.api.setFestivalByVanity(t):o=void 0,this.festival=yield this.api.getFestival(o,{cached:!1}),this.canDelete=!!this.festival.id,this.festival.timezone||(this.festival.timezone=this.api.currentTimeZone()),this.imageUrl=this.api.imageURL(this.festival.imageUrl),this.busy=!1,this.timezones=Intl.supportedValuesOf("timeZone")})}startChanged(){this.endModified||(this.festival.end_time=ce(me(this.festival.start_time),24).toISOString())}endChanged(){this.endModified=!0}delete(){}gpsChanged(o){this.festival.gpsLat=o.lat,this.festival.gpsLng=o.lng}fixUniqueId(){this.festival.id||(this.festival.vanity=this.festival.name.toLowerCase().trim().replace(/\s+/g,"-").replace(/[.,]/g,""))}onFileSelected(o){return w(this,null,function*(){let t=o.target.files[0];if(!t)return;let n={width:0,height:0};if(this.blob=yield ge(t,{quality:90,width:500},n),n.width!==n.height){this.api.sendMessage("The image needs to be square (width and height must be equal)");return}let e=URL.createObjectURL(this.blob);this.imageUrl=e,this.imageChanged=!0})}setTime(o,t){return o.substring(0,10)+t}save(){return w(this,null,function*(){this.festival.start_time=this.setTime(this.festival.start_time,"T00:00:00"),this.festival.end_time=this.setTime(this.festival.end_time,"T23:59:59");let o=new Date(this.festival.start_time+V(this.festival.timezone)),t=new Date(this.festival.end_time+V(this.festival.timezone)),n=Math.round((t-o)/1e3/60/60);if(isNaN(n)){this.api.sendMessage("The start and end time must be set");return}if(n<0){this.api.sendMessage("The end time must be after the start time");return}if(n<24){this.api.sendMessage("The event must be at least 1 day long");return}if(n>720){this.api.sendMessage("The event cannot be longer than 30 days");return}if(this.festival.name.length<4){this.api.sendMessage("The event name must be set");return}let e=new Date().getFullYear();if((this.festival.name.includes(e.toString())||this.festival.name.includes((e+1).toString())||this.festival.name.includes((e-1).toString()))&&!this.festival.archived){this.api.sendMessage("The event name cannot include the year in it");return}if(this.fixUniqueId(),this.festival.vanity.length<4){this.api.sendMessage("The unique identifier must be set");return}if(this.festival.vanity.includes(" ")){this.api.sendMessage("The unique identifier cannot contain spaces");return}if(this.festival.description.length<4){this.api.sendMessage("The event description must be set");return}if(this.festival.timezone||(this.festival.timezone=this.api.currentTimeZone()),this.festival.active){if(M(this.festival.imageUrl)&&M(this.imageUrl)){this.api.sendMessage("You need an image to display the event in the dust app");return}if(this.festival.gpsLat==0||this.festival.gpsLng==0){this.api.sendMessage("You need to set the GPS location to display the event in the dust app");return}if(M(this.festival.region)){this.api.sendMessage("You need to set the region to display the event in the dust app");return}}if(!M(this.festival.website)&&!this.festival.website.startsWith("https://")){this.api.sendMessage("The website must start with https://");return}this.busy=!0;try{let i=yield this.api.addFestival(this.festival);if(i.message&&i.message!=""){this.api.sendMessage(i.message),this.busy=!1;return}else if(i.id&&this.imageChanged){let ye=yield this.api.getFestival(i.id,{cached:!1});this.api.setFestival(ye),yield this.uploadImage(i.id)}this.api.clearCache(),this.busy=!1,this.location.back()}catch(i){console.error(i),this.busy=!1;return}})}uploadImage(o){return w(this,null,function*(){if(this.blob)try{this.uploading=!0,this.festival.imageUrl=yield this.api.setImage(this.blob,o);let t=yield this.api.addFestival(this.festival);t.message&&this.api.sendMessage(t.message),this.imageChanged=!1}finally{this.uploading=!1}})}openLocation(){let o=`https://www.google.com/maps/search/?api=1&query=${this.festival.gpsLat},${this.festival.gpsLng}`;window.open(o,"_blank")}openWebsite(){if(this.festival.website){let o=pe(this.festival.website);window.open(o,"_blank")}}};C.\u0275fac=function(t){return new(t||C)},C.\u0275cmp=F({type:C,selectors:[["app-festival"]],viewQuery:function(t,n){if(t&1&&L(xe,5),t&2){let e;B(e=D())&&(n.gps=e.first)}},inputs:{vanity:[1,"vanity"]},decls:13,vars:3,consts:[["gps",""],["fileUpload",""],["color","primary"],["slot","start"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"border"],["lines","none"],["label","Burn Name","labelPlacement","stacked","placeholder","Name of the burn",3,"ngModelChange","ngModel"],["labelPlacement","stacked","label","Description","placeholder","Description of the burn",3,"ngModelChange","spellcheck","rows","autoGrow","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],["helperText","",1,"emails",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["label","Region","labelPlacement","stacked","placeholder","City, State/Country",3,"ngModelChange","ngModel"],["label","Website","placeholder","eg https://myburn.com",3,"modelChange","iconClick","model"],[3,"ngModelChange","ngModel"],[1,"label-padding-left"],["datetime","datetime"],[3,"keepContentsMounted"],["datetime","datetimeEnd"],["label","Timezone","interface","popover","placeholder","Select the timezone of the event",3,"ngModelChange","value","ngModel"],[3,"value"],[2,"width","100%",3,"click"],["position","left","text","This is used for the directions button in the app. Right click in Google Maps to copy lat/long and paste here."],[3,"latChange","lngChange","gpsChange","lat","lng"],[1,"center"],["color","secondary",3,"disabled"],["type","file",1,"file-input",3,"change"],["presentation","date","minuteValues","0,15,30,45","id","datetime",3,"ngModelChange","ionChange","showDefaultButtons","ngModel"],["presentation","date","minuteValues","0,15,30,45","id","datetimeEnd",3,"ngModelChange","ionChange","showDefaultButtons","ngModel"],["color","secondary",3,"click","disabled"]],template:function(t,n){t&1&&(a(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-buttons",3),v(4,"ion-back-button"),s()(),a(5,"ion-title"),g(6),s(),a(7,"ion-buttons",4)(8,"ion-button",5),h("click",function(){return n.save()}),g(9,"Save"),s()()()(),a(10,"ion-content",6),y(11,ke,52,25,"div",7)(12,Fe,1,0,"app-spinner"),s()),t&2&&(c(6),P(n.vanity()?"Edit Burn":"New Burn"),c(4),_("fullscreen",!0),c(),x(n.busy?12:11))},dependencies:[R,q,G,X,ae,Y,Z,se,ne,J,j,H,te,$,le,de,ee,K,A,oe,ue,re,ie,Q,Ce,fe,he,ve],styles:[".emails[_ngcontent-%COMP%]{width:100%;padding-right:var(--spacing-base)}"]});var we=C;export{we as FestivalPage};
