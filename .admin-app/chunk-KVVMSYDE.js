import{a as Q}from"./chunk-55PDQDPP.js";import{R as X,c as J}from"./chunk-OAPJ7RFL.js";import{e as A,x as G}from"./chunk-OKHR5JXS.js";import{$ as u,A as c,Aa as _,B as d,Ba as x,Fa as b,Ga as I,Ha as P,L as S,Pa as T,Qb as U,Rb as z,S as o,Sb as N,T as y,Tb as j,X as M,Yb as L,cb as k,cc as O,da as C,dc as D,fc as F,ga as g,ka as a,la as s,ma as w,mb as R,nb as E,nc as Z,oa as v,oc as H,pa as h,qa as l,qc as K,rb as B,sb as W,ua as V,uc as Y,vc as q}from"./chunk-SLKJQVFW.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as f}from"./chunk-LNJ3S2LQ.js";function ee(r,t){if(r&1){let e=v();a(0,"ion-buttons",1)(1,"ion-button",9),h("click",function(){c(e);let i=l();return d(i.clear())}),w(2,"ion-icon",10),s()()}}function te(r,t){r&1&&w(0,"app-spinner")}function ie(r,t){if(r&1&&(a(0,"div",6)(1,"p"),_(2),s()()),r&2){let e=l();o(2),x(e.redirectMessage())}}function ne(r,t){if(r&1){let e=v();a(0,"ion-item")(1,"ion-input",11),h("keyup.enter",function(){c(e);let i=l();return d(i.next())}),P("ngModelChange",function(i){c(e);let p=l();return I(p.email,i)||(p.email=i),d(i)}),s()()}if(r&2){let e=l();o(),b("ngModel",e.email)}}function re(r,t){if(r&1){let e=v();a(0,"ion-item")(1,"ion-input",12),h("keyup.enter",function(){c(e);let i=l();return d(i.next())})("ionInput",function(){c(e);let i=l();return d(i.changed())}),P("ngModelChange",function(i){c(e);let p=l();return I(p.code,i)||(p.code=i),d(i)}),s()()}if(r&2){let e=l();o(),V("helperText","Enter the verification code that was emailed to ",e.email,""),b("ngModel",e.code)}}var m=class m{constructor(t,e,n){this.alert=t;this.api=e;this.router=n;this.email="";this.code="";this.busy=!1;this.redirecting=S(!1);this.redirectType="none";this.emailPage=!0;this.title=T(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"Register a camp";case"event":return"Register an event";default:return""}return"Sign In"});this.redirectMessage=T(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"To register a camp we first need an email address.";case"event":return"To register a event we first need an email address.";default:return""}return""});X({arrowBack:J})}ionViewWillEnter(){let t=this.api.getRedirectionUrl();this.redirectType="none",t&&t.includes("/camps")&&(this.redirectType="camp"),t&&t.includes("/events")&&(this.redirectType="event"),this.redirecting.set(!!t&&t!=="")}next(){return f(this,null,function*(){if(this.emailPage){if(!this.validateEmail(this.email)){this.presentAlert("The email address is invalid");return}try{this.busy=!0,yield this.api.signIn(this.email),this.emailPage=!1}finally{this.busy=!1}}else{let t=this.code.toString().padStart(6,"0");if(!this.code||t.length!==6){this.presentAlert("The verification code is incorrect");return}this.signIn(t)}})}signIn(t){return f(this,null,function*(){try{this.busy=!0,yield A(1e3),yield this.api.verify(t),yield A(1e3),this.emailPage=!0,this.code="",this.email="";let e=this.api.getRedirectionUrl();if(this.api.clearCache(),!e||e=="")console.log("Redirect but redirect was empty"),this.router.navigateByUrl("/all",{replaceUrl:!0});else{if(e=="none"){this.api.setRedirection("");return}console.log(`Redirect to ${e}`),this.api.setRedirection("none"),this.router.navigateByUrl(e,{replaceUrl:!0})}}finally{this.busy=!1}})}changed(){setTimeout(()=>{let t=`${this.code}`;t.length==6&&this.signIn(t)},500)}presentAlert(t){return f(this,null,function*(){yield(yield this.alert.create({header:"Message",message:t,buttons:["OK"]})).present()})}clear(){this.code="",this.emailPage=!0}validateEmail(t){return!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}};m.\u0275fac=function(e){return new(e||m)(y(K),y(G),y(k))},m.\u0275cmp=M({type:m,selectors:[["app-auth"]],decls:21,vars:8,consts:[["color","primary"],["slot","start"],[3,"fullscreen"],[1,"border"],[1,"ion-text-center"],[2,"height","3rem","width","100%","border-radius","0.5rem","display","flex","align-items","center","justify-content","center","margin-left","auto","margin-right","auto","color","var(--ion-color-primary)"],[1,"ion-padding"],["lines","none"],["size","medium","shape","round","expand","block","color","primary",3,"click","disabled"],[3,"click"],["name","arrow-back"],["name","emailAddress","id","emailAddress","type","email","label","Email Address","labelPlacement","stacked","helperText","You will be emailed a verification code.",3,"keyup.enter","ngModelChange","ngModel"],["type","number","inputMode","numeric","pattern","[0-9]*","label","Verification Code","labelPlacement","stacked",3,"keyup.enter","ionInput","ngModelChange","helperText","ngModel"]],template:function(e,n){e&1&&(a(0,"ion-header")(1,"ion-toolbar",0),u(2,ee,3,0,"ion-buttons",1),a(3,"ion-title"),_(4,"dust"),s()()(),a(5,"ion-content",2),u(6,te,1,0,"app-spinner"),a(7,"div",3)(8,"ion-card")(9,"ion-card-content",4)(10,"div",5)(11,"h1"),_(12),s()(),u(13,ie,3,1,"div",6),a(14,"ion-list",7),u(15,ne,2,1,"ion-item")(16,re,2,3,"ion-item"),a(17,"ion-item")(18,"ion-toolbar",6)(19,"ion-button",8),h("click",function(){return n.next()}),_(20),s()()()()()()()()),e&2&&(o(2),g(n.emailPage?-1:2),o(3),C("fullscreen",!0),o(),g(n.busy?6:-1),o(6),x(n.title()),o(),g(n.redirecting()?13:-1),o(2),g(n.emailPage?15:16),o(4),C("disabled",n.busy),o(),x(n.emailPage?"Next":"Sign In"))},dependencies:[z,Y,W,R,B,E,O,H,Z,L,N,j,F,D,q,U,Q],styles:["h1[_ngcontent-%COMP%]{font-size:var(--fr2)}p[_ngcontent-%COMP%]{font-size:var(--fr3)}@media (min-width: 801px){ion-card[_ngcontent-%COMP%]{margin-left:100px;margin-right:100px}}"]});var $=m;export{$ as AuthPage};
