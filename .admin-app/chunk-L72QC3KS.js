import{a as bt}from"./chunk-OFUZW7PB.js";import{a as At}from"./chunk-D4LRBUQX.js";import{b as M}from"./chunk-QTBNLBDF.js";import{a as xt}from"./chunk-XQO4ZLWR.js";import{a as yt}from"./chunk-NE5K7VVL.js";import{a as vt}from"./chunk-EB7ZKUPJ.js";import{a as ft}from"./chunk-5EUBO754.js";import{b as gt}from"./chunk-OZ2IKH4J.js";import"./chunk-DUKSTT3K.js";import{A as ut,I as _t,K as ht,a as mt,aa as Ct}from"./chunk-TF5OT4X3.js";import{E as L,I as S,e as pt}from"./chunk-CXIDEVKY.js";import"./chunk-PFLI22GG.js";import{$ as k,$a as K,$b as X,Ba as w,Cc as dt,G as o,Gc as ct,La as I,O as F,Pa as O,Ra as D,Rb as H,W as u,X as _,Xa as G,Yb as Y,Zb as W,_ as T,_b as J,aa as d,ac as Z,ba as s,ca as l,cc as tt,da as p,ec as et,fb as Q,gb as j,ia as b,jb as q,ka as A,kc as it,l as B,lc as nt,ma as c,nc as ot,p as h,pc as rt,qa as R,ra as N,s as x,sa as U,t as y,vc as at,w as $,wc as st,yb as z,yc as lt,za as f}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as m}from"./chunk-LNJ3S2LQ.js";function E(i){let e=i.replace("u-","");return Et(e)}function Et(i){let e=0;for(let n=0;n<i.length;n++)e=(e<<5)-e+i.charCodeAt(n),e|=0;return(Math.abs(e)%1e4).toString().padStart(4,"0")}var g=class g{constructor(){this.api=h(S)}exportArtToCSV(e,t){let n=[];for(let a of t)n.push({id:a.id,name:a.name,description:a.description,email:a.contact_email,placed:a.pin!=""?"Yes":"No",mvpin:a.art_type=="Mutant Vehicle"?E(`${a.id}`):""});let r=L(e.toLowerCase()," ","-");M(`${r}-art.csv`,n)}exportArtEmail(e,t){let n=[];for(let a of t)pt(a.contact_email)||n.push({email:a.contact_email});if(n.length==0){this.api.sendMessage("No Art has email addresses to be exported.");return}let r=L(e.toLowerCase()," ","-");M(`${r}-art-email.txt`,n,{stripQuotes:!0,hideHeaders:!0})}};g.\u0275fac=function(t){return new(t||g)},g.\u0275prov=B({token:g,factory:g.\u0275fac,providedIn:"root"});var P=g;var Tt=["kmlUpload"],kt=i=>[i],It=i=>({art:i}),St=(i,e)=>e.id;function Lt(i,e){if(i&1){let t=b();s(0,"ion-toolbar")(1,"ion-searchbar",13),A("ionInput",function(r){x(t);let a=c();return y(a.handleSearch(r))}),l(),s(2,"ion-button",14),A("click",function(){x(t);let r=c();return y(r.toggleGrid())}),p(3,"ion-icon",15),l()()}if(i&2){let t=c();o(),d("debounce",600)("placeholder","Search art at "+t.title),o(2),d("name",t.isGrid?"list-outline":"grid-outline")}}function Mt(i,e){if(i&1&&p(0,"ion-progress-bar",9),i&2){let t=c();d("value",t.progress)}}function Vt(i,e){if(i&1&&p(0,"app-card",17),i&2){let t=c(3);d("title",t.filteredBySearch?"No Art Found":"No Art")("description",t.filteredBySearch?"No art was found matching that search.":"There is no art registered for "+t.festivalTitle)}}function Bt(i,e){if(i&1&&u(0,Vt,1,2,"app-card",17),i&2){let t=c(2);_(t.art.length===0?0:-1)}}function $t(i,e){}function Ft(i,e){i&1&&(s(0,"ion-button",24),p(1,"ion-icon",29),l())}function Rt(i,e){if(i&1){let t=b();s(0,"ion-button",30),A("click",function(){x(t);let r=c().$implicit,a=c(4);return y(a.broadcastLocation(r))}),f(1,"Broadcast GPS"),l()}if(i&2){let t=c(5);d("disabled",!t.canBroadcastLocation)}}function Nt(i,e){if(i&1&&(s(0,"div",20)(1,"ion-card",21),p(2,"app-img",22),s(3,"ion-card-header",23)(4,"ion-card-title"),f(5),u(6,Ft,2,0,"ion-button",24),l()(),s(7,"ion-card-content"),f(8),s(9,"div",25)(10,"ion-button",26),f(11,"Edit"),l(),s(12,"ion-button",27),f(13,"Events"),l(),u(14,Rt,2,1,"ion-button",28),l()()()()),i&2){let t=e.$implicit,n=c(4);o(2),d("routerLink",n.editRoute(t))("src",n.image(t)),o(),d("routerLink",n.editRoute(t)),o(2),w("",t.name," "),o(),_(t.pin?6:-1),o(2),w(" ",t.description," "),o(2),d("disabled",!n.canEditArt)("routerLink","../art/"+I(12,kt,t.id)),o(2),d("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",I(14,It,t.id)),o(2),_(t.art_type==="Mutant Vehicle"?14:-1)}}function Ut(i,e){if(i&1&&(s(0,"div",18),T(1,Nt,15,16,"div",20,St),l()),i&2){let t=c(3);d("ngClass",t.art.length>1?"grid":"grid1"),o(),k(t.art)}}function Ot(i,e){i&1&&p(0,"ion-icon",29)}function Dt(i,e){if(i&1&&(s(0,"ion-item"),p(1,"app-img",32),s(2,"ion-text",33),f(3),u(4,Ot,1,0,"ion-icon",29),l()()),i&2){let t=e.$implicit,n=c(4);o(),d("width","45px")("height","45px")("routerLink",n.editRoute(t))("src",n.image(t)),o(),d("routerLink",n.editRoute(t)),o(),w(" ",t.name," "),o(),_(t.pin?4:-1)}}function Gt(i,e){if(i&1&&(s(0,"div",19)(1,"ion-card")(2,"ion-list"),T(3,Dt,5,7,"ion-item",null,St),l()(),p(5,"div",31)(6,"div",31),l()),i&2){let t=c(3);o(3),k(t.art)}}function Kt(i,e){if(i&1&&u(0,Ut,3,1,"div",18)(1,Gt,7,0,"div",19),i&2){let t=c(2);_(t.isGrid?0:1)}}function Qt(i,e){if(i&1&&(s(0,"div",10)(1,"div",16),u(2,Bt,1,1)(3,$t,0,0),l(),u(4,Kt,2,1),l()),i&2){let t=c();o(),d("ngClass",t.art.length>0?"":"pad-vertical"),o(),_(t.isAdmin?2:3),o(2),_(t.art.length>0?4:-1)}}function jt(i,e){i&1&&p(0,"app-spinner")}function qt(i,e){if(i&1&&p(0,"app-footer",11),i&2){let t=c();d("routeTo",t.newRoute())}}var C=class C{constructor(){this.api=h(S);this.artService=h(P);this.kml=h(bt);this.router=h(Q);this.vanity=D();this.art=[];this.busy=!0;this.isAdmin=!1;this.canEdit=!1;this.canEditArt=!1;this.canEditEvent=!1;this.canBroadcastLocation=!1;this.isGrid=!0;this.filteredBySearch=!1;this.buttons=[];this.title="";this.festivalTitle="";this.alert=h(lt);this.mapChanges=$({camps:[],art:[],pins:[],newCamps:[],newArt:[]});Ct({add:mt,locationSharp:ht,listOutline:_t,gridOutline:ut}),O(()=>m(this,null,function*(){let e=this.mapChanges();if(e.art.length==0&&e.newArt.length==0)return;this.busy=!0;let t=e.art.length,n=0;for(let a of e.art){n++;try{yield this.api.addArt(a)}catch(v){throw console.error(`Unable to apply art change ${a.name}`,a),v}this.progress=n/t}let r=yield this.importNewArt(e.newArt);this.message(`${e.art.length} art changes made. ${r} art added.`),console.log(e),this.api.clearCache(),this.ionViewDidEnter(),this.busy=!1,this.progress=void 0}))}ngOnInit(){return m(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity(),!0),this.title=`${this.api.festivalTitle()}`,this.festivalTitle=this.api.festivalTitle(),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.canEdit=this.api.getAccessInfo(void 0).hasArt||this.isAdmin,this.canEditEvent=this.api.eventEditing()||this.isAdmin,this.canEditArt=this.api.artEditing()||this.isAdmin,this.canBroadcastLocation=this.api.artEditing(),this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"},{title:"Export Email Addresses",method:this.exportEmail(),icon:"mail-outline"},{title:"Import KML",method:this.importKML(),icon:"cloud-upload-outline"}]:[]})}broadcastLocation(e){return m(this,null,function*(){let t=E(`${e.id}`);this.api.sendMessage(`Use the PIN ${t} to broadcast your mutant vehicles location. Click the link to read how.`,0,"Broadcast Location","https://dust.events/docs/Mutant%20Vehicles/broadcast-location")})}ionViewDidEnter(){return m(this,null,function*(){this.art=yield this.api.art({cached:!0}),this.filteredBySearch=!1,this.busy=!1})}importCSV(){return()=>m(this,null,function*(){this.router.navigateByUrl("./import-art")})}importKML(){return()=>m(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.kmlUpload.nativeElement.click()})}exportCSV(){return()=>m(this,null,function*(){this.artService.exportArtToCSV(this.festivalTitle,this.art)})}exportEmail(){return()=>m(this,null,function*(){this.artService.exportArtEmail(this.festivalTitle,this.art)})}message(e){setTimeout(()=>{this.api.sendMessage(e)},1)}handleSearch(e){return m(this,null,function*(){let t=e.target.value.toLowerCase(),n=yield this.api.art({cached:!0});this.art=n.filter(r=>{var a;return r.name.toLowerCase().includes(t)||((a=r.description)==null?void 0:a.toLowerCase().includes(t))}),this.filteredBySearch=t.length>0})}toggleGrid(){this.isGrid=!this.isGrid}editRoute(e){return this.canEdit?"../art/"+e.id:void 0}image(e){return e.imageUrl?this.api.imageURL(e.imageUrl):`./assets/${e.art_type?`${e.art_type}`.toLowerCase().replace(/ /g,"-"):"unknown"}.svg`}newRoute(){return this.canEdit?"../art/new":void 0}onKMLSelected(e){return m(this,null,function*(){if(!this.isAdmin){this.api.sendMessage("You do not have access rights to this feature.");return}let t=e.target.files[0];if(!t)return;let n=new FileReader;n.onload=r=>m(this,null,function*(){var V;let a=(V=r.target)==null?void 0:V.result,v=this.kml.parse(a,this.art,!0);this.mapChanges.set(v)}),n.readAsText(t)})}importNewArt(e){return m(this,null,function*(){let t=0;if(e.length==0)return 0;for(let n of e)if(n.pin.includes("lat")){let r=yield gt(this.alert,`Add Art "${n.name}" ?`,"Add");if(r=="Add"&&((!n.description||n.description.length<5)&&(n.description=`No description provided for ${n.name}.`),yield this.api.addArt(n),t++),r=="Cancel")return t}return t})}};C.\u0275fac=function(t){return new(t||C)},C.\u0275cmp=F({type:C,selectors:[["app-art"]],viewQuery:function(t,n){if(t&1&&R(Tt,7),t&2){let r;N(r=U())&&(n.kmlUpload=r.first)}},inputs:{vanity:[1,"vanity"]},decls:18,vars:7,consts:[["kmlUpload",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../art/new",3,"disabled"],["name","add"],[3,"buttons"],[3,"fullscreen"],[3,"value"],[1,"large-border"],["title","Add Art",3,"routeTo"],["type","file",1,"file-input",3,"change"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],["color","dark","fill","clear","slot","end",3,"click"],[3,"name"],[1,"ion-text-center",3,"ngClass"],[3,"title","description"],[1,"pad-below",3,"ngClass"],[1,"border"],[1,"grid-item"],[1,"clickable"],[3,"routerLink","src"],[3,"routerLink"],["fill","clear","color","light",2,"position","absolute","margin-top","-3px"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["color","secondary",3,"disabled","routerLink"],["color","secondary",3,"disabled","routerLink","queryParams"],["color","secondary",3,"disabled"],["size","small","name","location-sharp",1,"pin"],["color","secondary",3,"click","disabled"],[1,"ion-padding"],[1,"clickable",2,"min-width","45px",3,"width","height","routerLink","src"],[1,"clickable",2,"width","100%","padding","1rem",3,"routerLink"]],template:function(t,n){if(t&1){let r=b();s(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),p(3,"ion-back-button"),l(),s(4,"ion-title",3),f(5,"Art"),l(),s(6,"ion-buttons",4)(7,"ion-button",5),p(8,"ion-icon",6),l(),p(9,"app-side",7),l()()(),s(10,"ion-content",8),u(11,Lt,4,3,"ion-toolbar"),u(12,Mt,1,1,"ion-progress-bar",9),u(13,Qt,5,3,"div",10)(14,jt,1,0,"app-spinner"),u(15,qt,1,1,"app-footer",11),s(16,"input",12,0),A("change",function(v){return x(r),y(n.onKMLSelected(v))}),l()()}t&2&&(o(7),d("disabled",!n.canEdit),o(2),d("buttons",n.buttons),o(),d("fullscreen",!0),o(),_(n.art.length>1?11:-1),o(),_(n.progress?12:-1),o(),_(n.busy?14:13),o(2),_(n.isAdmin?15:-1))},dependencies:[nt,ot,X,tt,J,Z,rt,ct,dt,xt,yt,ft,Y,H,W,et,it,at,st,K,G,z,At,vt,q,j],styles:["ion-card-title[_ngcontent-%COMP%]{font-size:1.5rem!important}ion-card-content[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:var(--fs4)}h1[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.pin[_ngcontent-%COMP%]{color:var(--ion-color-primary);opacity:.5}app-img[_ngcontent-%COMP%]{--border-radius: 5px}"]});var wt=C;export{wt as ArtPage};
