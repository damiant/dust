import{a as Vt}from"./chunk-VVJA7NBV.js";import{a as E,b as U}from"./chunk-V6XBM4R7.js";import"./chunk-WHEYUZEY.js";import"./chunk-LKPHKBDT.js";import"./chunk-KCPLCCSF.js";import{a as kt}from"./chunk-SVNDKX5K.js";import{a as Tt}from"./chunk-WRLAXAJB.js";import{a as At}from"./chunk-5B2MUMUK.js";import{c as A}from"./chunk-OZ2IKH4J.js";import{U as wt,V as It,ja as Pt,p as vt,u as bt}from"./chunk-LIWDDRYP.js";import{E as ft,H as yt,K as xt,l as gt,v as Ct}from"./chunk-OQVFSD37.js";import"./chunk-PFLI22GG.js";import{$ as B,$b as Z,Aa as _,Ba as M,Bb as K,Bc as st,Ca as P,Db as Y,E as F,Ec as dt,Fa as y,Fc as pt,Ga as x,H as a,Ha as v,Ic as ct,Ja as T,Ma as N,Mc as mt,Nc as _t,P as W,Sc as ut,Tc as ht,Ua as Q,Wb as X,X as u,Y as h,Za as j,_ as L,aa as O,ba as d,ca as l,cc as $,da as s,dc as tt,ea as f,ec as et,fc as it,hb as q,ja as b,jc as nt,kb as z,la as g,lc as at,na as o,nb as G,p as I,ra as k,rc as ot,s as c,sa as V,sc as rt,t as m,ta as S,tb as J,vc as lt,w as D,wb as H,za as R}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as C}from"./chunk-LNJ3S2LQ.js";var Mt=i=>[i];function Et(i,n){if(i&1&&(l(0,"ion-select-option",13),_(1),s()),i&2){let t=n.$implicit;d("value",t),a(),M(t)}}function Ut(i,n){if(i&1&&f(0,"img",16),i&2){let t=o(2);d("src",t.imageUrl,F)}}function Dt(i,n){if(i&1&&(l(0,"p"),_(1),s()),i&2){let t=o(2);a(),P("Click to choose an optional image for your ",t.title())}}function Ft(i,n){if(i&1){let t=b();l(0,"ion-item")(1,"app-emails",21),v("emailsChange",function(e){c(t);let p=o(2);return x(p.art.contact_email,e)||(p.art.contact_email=e),m(e)}),s()()}if(i&2){let t=o(2);a(),d("isAdmin",t.isAdmin)("isOwner",!1)("label","Art Owner(s)")("placeholder","Email address of Art owner"),y("emails",t.art.contact_email)}}function Wt(i,n){if(i&1&&(l(0,"app-tooltip",22)(1,"ion-chip",24),f(2,"ion-icon",25),_(3),s()()),i&2){let t=o(3);a(3),P(" This ",t.title()," is approved ")}}function Lt(i,n){if(i&1&&(l(0,"app-tooltip",23)(1,"ion-chip",0),f(2,"ion-icon",26),_(3),s()()),i&2){let t=o(3);d("text",T("This ",t.title()," will not appear in the dust app until approved")),a(3),P(" This ",t.title()," is not yet approved ")}}function Bt(i,n){if(i&1&&u(0,Wt,4,1,"app-tooltip",22)(1,Lt,4,3,"app-tooltip",23),i&2){let t=o(2);h(t.isApproved()?0:1)}}function Ot(i,n){if(i&1){let t=b();l(0,"app-tooltip",19)(1,"ion-button",27),g("click",function(){c(t);let e=o(2);return m(e.invite())}),_(2,"Invite"),s()()}if(i&2){let t=o(2);a(),d("disabled",t.inviting)}}function Rt(i,n){if(i&1){let t=b();l(0,"app-tooltip",23)(1,"ion-button",27),g("click",function(){c(t);let e=o(3);return m(e.approve(!1))}),_(2,"Unapprove"),s()()}if(i&2){let t=o(3);d("text",T("Mark this ",t.title()," as unapproved so that it does not appear in the dust app")),a(),d("disabled",t.busy)}}function Nt(i,n){if(i&1){let t=b();l(0,"app-tooltip",23)(1,"ion-button",28),g("click",function(){c(t);let e=o(3);return m(e.approve(!0))}),_(2,"Approve"),s()()}if(i&2){let t=o(3);d("text",T("Approve the ",t.title()," to allow it to be visible in the dust app")),a(),d("disabled",t.busy)}}function Qt(i,n){if(i&1&&u(0,Rt,3,3,"app-tooltip",23)(1,Nt,3,3,"app-tooltip",23),i&2){let t=o(2);h(t.isApproved()?0:1)}}function jt(i,n){if(i&1&&(l(0,"app-tooltip",29)(1,"ion-button",30),_(2," Place "),s()(),l(3,"ion-button",31),_(4," Delete "),s(),_(5,"\xA0 "),f(6,"ion-alert",32)),i&2){let t=o(2);a(),d("routerLink","../../map/art/"+N(2,Mt,t.art.id)),a(5),d("buttons",t.deleteButtons)}}function qt(i,n){if(i&1){let t=b();l(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),v("ngModelChange",function(e){c(t);let p=o();return x(p.art.name,e)||(p.art.name=e),m(e)}),s()(),l(6,"ion-item")(7,"ion-input",9),v("ngModelChange",function(e){c(t);let p=o();return x(p.art.artist,e)||(p.art.artist=e),m(e)}),s()(),l(8,"app-link-input",10),v("modelChange",function(e){c(t);let p=o();return x(p.art.url,e)||(p.art.url=e),m(e)}),g("iconClick",function(){c(t);let e=o();return m(e.openUrl())}),s(),l(9,"ion-item",11)(10,"ion-select",12),g("ngModelChange",function(){c(t);let e=o();return m(e.artTypeChanged())}),v("ngModelChange",function(e){c(t);let p=o();return x(p.art.art_type,e)||(p.art.art_type=e),m(e)}),B(11,Et,2,2,"ion-select-option",13,L),s()(),l(13,"ion-item")(14,"ion-textarea",14),v("ngModelChange",function(e){c(t);let p=o();return x(p.art.description,e)||(p.art.description=e),m(e)}),s()(),l(15,"div",15),g("click",function(){c(t);let e=o();return m(e.upload.click())}),u(16,Ut,1,1,"img",16),u(17,Dt,2,1,"p"),s(),u(18,Ft,2,5,"ion-item"),f(19,"app-internal-fields",17),s(),u(20,Bt,2,1),l(21,"div",18),u(22,Ot,3,1,"app-tooltip",19),u(23,Qt,2,1),u(24,jt,7,4),l(25,"ion-button",3),g("click",function(){c(t);let e=o();return m(e.save())}),_(26,"Save"),s()(),l(27,"app-upload",20),g("upload",function(e){c(t);let p=o();return m(p.uploaded(e))}),s()()()()}if(i&2){let t=o();a(5),d("label",t.title()+" Title")("placeholder","Title of the "+t.title()),y("ngModel",t.art.name),a(2),y("ngModel",t.art.artist),a(),d("placeholder","URL for the "+t.art.art_type+" project"),y("model",t.art.url),a(2),d("value",t.art.art_type),y("ngModel",t.art.art_type),a(),O(t.artTypes),a(3),d("spellcheck",!0)("rows",6)("autoGrow",!0)("maxlength",1e3),y("ngModel",t.art.description),a(),R(t.uploading?"disabled":""),a(),h(t.imageUrl?16:-1),a(),h(t.imageUrl?-1:17),a(),h(t.isAdmin?18:-1),a(),d("schemaType","art")("entityId",t.art.id||0)("currentData",t.internalFieldData),a(),h(t.id&&!t.isAdmin?20:-1),a(2),h(t.id&&t.isAdmin?22:-1),a(),h(t.id&&t.isAdmin?23:-1),a(),h(t.id&&t.canPlace?24:-1),a(),d("disabled",t.busy)}}function zt(i,n){i&1&&f(0,"app-spinner")}var w=class w{constructor(){this.api=I(xt);this.alert=I(ct);this.location=I(j);this.vanity=Q();this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.inviting=!1;this.canPlace=!1;this.title=D("Art");this.artTypes=["Art","Mutant Vehicle"];this.route=I(q);this.internalFieldData=[];this.art={name:"",pin:"",description:"",category:"Open Playa Art",id:void 0,contact_email:"",art_type:this.artTypes[0],url:""};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];Pt({mapOutline:It,mailOutline:wt,checkmarkCircleOutline:vt,closeCircleOutline:bt})}uploaded(n){this.imageUrl=n.url,this.imageChanged=!0,this.blob=n.blob}ionViewWillEnter(){return C(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity()),this.id=gt(this.id),this.art=yield this.api.getArt(this.id),this.art.url||(this.art.url=""),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.imageUrl=this.api.imageURL(this.art.imageUrl);let n=this.route.snapshot.queryParams.type;if(!this.art.id&&n&&(this.art.art_type=n,this.title.set(n)),this.art.internalData)try{this.internalFieldData=JSON.parse(this.art.internalData)}catch(t){console.error("Failed to parse internal data:",t),this.internalFieldData=[]}this.busy=!1})}artTypeChanged(){setTimeout(()=>{this.title.set(this.art.art_type)},10)}presentAlert(n){return C(this,null,function*(){yield(yield this.alert.create({header:"Message",message:n,buttons:["OK"]})).present()})}delete(){return C(this,null,function*(){this.busy=!0,yield this.api.deleteArt(this.art),this.api.clearCache(),this.busy=!1,this.location.back()})}save(n=!0){return C(this,null,function*(){this.busy=!0,Ct(this.art);try{if(this.internalFields){if(!this.internalFields.validate()){this.busy=!1;return}this.internalFieldData=this.internalFields.fieldValues(),this.internalFieldData.length>0&&(this.art.internalData=JSON.stringify(this.internalFieldData))}let t=yield this.api.addArt(this.art);if(this.busy=!1,t.message)this.presentAlert(t.message);else{if(t.id&&this.imageChanged){console.log(`Uploaded image for art ${t.id}`),this.busy=!0;try{yield this.uploadImage(t.id)}finally{this.busy=!1,this.imageChanged=!1}}this.art.id||(yield this.presentAlert("Thank you for your Art submission.")),this.api.clearCache(),n&&this.location.back()}}finally{this.busy=!1}})}uploadImage(n){return C(this,null,function*(){if(this.blob)try{this.uploading=!0,this.art.imageUrl=yield this.api.setImage(this.blob,n);let t=yield this.api.addArt(this.art);t.message&&this.presentAlert(t.message)}finally{this.uploading=!1}})}invite(){return C(this,null,function*(){if(!this.art.contact_email){yield A(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let n=yield this.api.inviteArt(this.art);n.message?A(this.alert,n.message):A(this.alert,"The art owner has been invited to manage their art.","Invitation")})}openUrl(){if(this.art.url){let n=yt(this.art.url);window.open(n,"_blank")}}approve(n){return C(this,null,function*(){this.busy=!0,this.art.status=n?2:1;let t=yield this.api.approveArt(this.art);t.message&&A(this.alert,t.message),this.api.clearCache(),this.busy=!1})}isApproved(){return this.art.status===2||this.art.status===0||ft(this.art.status)}};w.\u0275fac=function(t){return new(t||w)},w.\u0275cmp=W({type:w,selectors:[["app-art"]],viewQuery:function(t,r){if(t&1&&(k(E,5),k(U,5)),t&2){let e;V(e=S())&&(r.upload=e.first),V(e=S())&&(r.internalFields=e.first)}},inputs:{id:"id",vanity:[1,"vanity"]},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["labelPlacement","stacked",3,"ngModelChange","label","placeholder","ngModel"],["label","Artist","labelPlacement","stacked","placeholder","Name of the artist",3,"ngModelChange","ngModel"],["label","URL",3,"modelChange","iconClick","placeholder","model"],["lines","none",1,"app-select"],["labelPlacement","stacked","label","Type","interface","popover","placeholder","Select the type of art",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["labelPlacement","stacked","label","Description","placeholder","Description of the art",3,"ngModelChange","spellcheck","rows","autoGrow","maxlength","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[3,"schemaType","entityId","currentData"],[1,"center"],["text","Invite art owner via email to manage their art"],[3,"upload"],["helperText","The art owner(s) can login and alter the description and events at the art. This is a list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["text","It will be displayed in the dust app"],[3,"text"],["color","secondary"],["name","checkmark-circle-outline"],["name","close-circle-outline"],["color","secondary",3,"click","disabled"],["color","primary",3,"click","disabled"],["text","Place the art on the map"],["color","secondary",3,"routerLink"],["id","deleteArt","color","secondary"],["trigger","deleteArt","header","Delete Art?",3,"buttons"]],template:function(t,r){t&1&&(l(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),f(3,"ion-back-button"),s(),l(4,"ion-title"),_(5),s(),l(6,"ion-buttons",2)(7,"ion-button",3),g("click",function(){return r.save()}),_(8,"Save"),s()()()(),l(9,"ion-content",4),u(10,qt,28,26,"div",5)(11,zt,1,0,"app-spinner"),s()),t&2&&(a(5),M(r.id||r.art.id?"Edit "+r.title():"Add "+r.title()),a(2),d("disabled",r.busy),a(2),d("fullscreen",!0),a(),h(r.busy?11:10))},dependencies:[Z,Tt,E,Y,J,K,H,At,G,z,ot,pt,tt,X,dt,$,at,et,it,lt,kt,rt,_t,ht,ut,st,Vt,U,nt,mt],encapsulation:2});var St=w;export{St as ArtItemPage};
