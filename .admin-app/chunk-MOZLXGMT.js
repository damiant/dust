import{a as wt}from"./chunk-PHV3SCLK.js";import{a as bt}from"./chunk-D3DBSVHX.js";import{b as R}from"./chunk-QTBNLBDF.js";import{a as yt}from"./chunk-VBSH35Y7.js";import{a as At}from"./chunk-SS6IZCJ2.js";import{a as xt}from"./chunk-YNP25RQU.js";import{a as gt}from"./chunk-TRRH6YG6.js";import{b as Ct}from"./chunk-OZ2IKH4J.js";import"./chunk-W4BNGQYG.js";import{A as _t,I as ft,K as ht,Z as vt,a as ut}from"./chunk-2G3SQA7K.js";import{E as B,H as I,e as mt}from"./chunk-5TGYAYRP.js";import"./chunk-XMQYHBKU.js";import{$ as c,$a as Q,Ac as pt,Fa as V,G as r,I as A,Ja as G,L as N,Lb as Y,Ra as K,Sb as W,Tb as J,Ub as X,V as u,Va as D,Vb as Z,W as _,Wb as tt,Yb as et,Z as L,_ as M,_b as it,aa as s,ab as q,ba as l,ca as p,db as z,ea as S,ec as nt,fa as b,fc as ot,ga as d,hc as rt,jc as at,ka as U,l as $,la as O,ma as j,p as w,pc as st,qc as lt,s as x,sb as H,sc as ct,t as y,ta as f,va as E,w as F,wc as dt}from"./chunk-LVKFIXIJ.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as m}from"./chunk-LNJ3S2LQ.js";function P(i){let e=i.replace("u-","");return Tt(e)}function Tt(i){let e=0;for(let n=0;n<i.length;n++)e=(e<<5)-e+i.charCodeAt(n),e|=0;return(Math.abs(e)%1e4).toString().padStart(4,"0")}var h=class h{constructor(){this.api=w(I)}exportArtToCSV(e,t){let n=[];for(let o of t)n.push({id:o.id,name:o.name,description:o.description,email:o.contact_email,placed:o.pin!=""?"Yes":"No",mvpin:o.art_type=="Mutant Vehicle"?P(`${o.id}`):""});let a=B(e.toLowerCase()," ","-");R(`${a}-art.csv`,n)}exportArtEmail(e,t){let n=[];for(let o of t)mt(o.contact_email)||n.push({email:o.contact_email});if(n.length==0){this.api.sendMessage("No Art has email addresses to be exported.");return}let a=B(e.toLowerCase()," ","-");R(`${a}-art-email.txt`,n,{stripQuotes:!0,hideHeaders:!0})}};h.\u0275fac=function(t){return new(t||h)},h.\u0275prov=$({token:h,factory:h.\u0275fac,providedIn:"root"});var T=h;var Mt=["kmlUpload"],Vt=i=>[i],Bt=i=>({art:i}),Et=(i,e)=>e.id;function Rt(i,e){if(i&1){let t=S();s(0,"ion-toolbar")(1,"ion-searchbar",13),b("ionInput",function(a){x(t);let o=d();return y(o.handleSearch(a))}),l(),s(2,"ion-button",14),b("click",function(){x(t);let a=d();return y(a.toggleGrid())}),p(3,"ion-icon",15),l()()}if(i&2){let t=d();r(),c("debounce",600)("placeholder","Search art at "+t.title),r(2),c("name",t.isGrid?"list-outline":"grid-outline")}}function $t(i,e){if(i&1&&p(0,"ion-progress-bar",9),i&2){let t=d();c("value",t.progress)}}function Ft(i,e){if(i&1&&p(0,"app-card",17),i&2){let t=d(3);c("title",t.filteredBySearch?"No Art Found":"No Art")("description",t.filteredBySearch?"No art was found matching that search.":"There is no art registered for "+t.festivalTitle)}}function Nt(i,e){if(i&1&&u(0,Ft,1,2,"app-card",17),i&2){let t=d(2);_(t.art.length===0?0:-1)}}function Ut(i,e){}function Ot(i,e){i&1&&(s(0,"ion-button",24),p(1,"ion-icon",29),l())}function jt(i,e){if(i&1){let t=S();s(0,"ion-button",30),b("click",function(){x(t);let a=d().$implicit,o=d(4);return y(o.broadcastLocation(a))}),f(1,"Broadcast GPS"),l()}if(i&2){let t=d(5);c("disabled",!t.canBroadcastLocation)}}function Gt(i,e){if(i&1&&(s(0,"div",20)(1,"ion-card",21),p(2,"app-img",22),s(3,"ion-card-header",23)(4,"ion-card-title"),f(5),u(6,Ot,2,0,"ion-button",24),l()(),s(7,"ion-card-content"),f(8),s(9,"div",25)(10,"ion-button",26),f(11,"Edit"),l(),s(12,"ion-button",27),f(13,"Events"),l(),u(14,jt,2,1,"ion-button",28),l()()()()),i&2){let t=e.$implicit,n=d(4);r(2),c("routerLink",n.editRoute(t))("src",n.image(t)),r(),c("routerLink",n.editRoute(t)),r(2),E("",t.name," "),r(),_(t.pin?6:-1),r(2),E(" ",t.description," "),r(2),c("disabled",!n.canEditArt)("routerLink","../art/"+V(12,Vt,t.id)),r(2),c("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",V(14,Bt,t.id)),r(2),_(t.art_type==="Mutant Vehicle"?14:-1)}}function Kt(i,e){if(i&1&&(s(0,"div",18),L(1,Gt,15,16,"div",20,Et),l()),i&2){let t=d(3);c("ngClass",t.art.length>1?"grid":"grid1"),r(),M(t.art)}}function Dt(i,e){i&1&&p(0,"ion-icon",29)}function Qt(i,e){if(i&1&&(s(0,"ion-item"),p(1,"app-img",32),s(2,"ion-text",33),f(3),u(4,Dt,1,0,"ion-icon",29),l()()),i&2){let t=e.$implicit,n=d(4);r(),c("width","45px")("height","45px")("routerLink",n.editRoute(t))("src",n.image(t)),r(),c("routerLink",n.editRoute(t)),r(),E(" ",t.name," "),r(),_(t.pin?4:-1)}}function qt(i,e){if(i&1&&(s(0,"div",19)(1,"ion-card")(2,"ion-list"),L(3,Qt,5,7,"ion-item",null,Et),l()(),p(5,"div",31)(6,"div",31),l()),i&2){let t=d(3);r(3),M(t.art)}}function zt(i,e){if(i&1&&u(0,Kt,3,1,"div",18)(1,qt,7,0,"div",19),i&2){let t=d(2);_(t.isGrid?0:1)}}function Ht(i,e){if(i&1&&(s(0,"div",10)(1,"div",16),u(2,Nt,1,1)(3,Ut,0,0),l(),u(4,zt,2,1),l()),i&2){let t=d();r(),c("ngClass",t.art.length>0?"":"pad-vertical"),r(),_(t.isAdmin?2:3),r(2),_(t.art.length>0?4:-1)}}function Yt(i,e){i&1&&p(0,"app-spinner")}function Wt(i,e){if(i&1&&p(0,"app-footer",11),i&2){let t=d();c("routeTo",t.newRoute())}}var g=class g{constructor(e,t,n,a){this.api=e;this.artService=t;this.kml=n;this.router=a;this.art=[];this.busy=!0;this.isAdmin=!1;this.canEdit=!1;this.canEditArt=!1;this.canEditEvent=!1;this.canBroadcastLocation=!1;this.isGrid=!0;this.filteredBySearch=!1;this.buttons=[];this.title="";this.festivalTitle="";this.alert=w(ct);this.mapChanges=F({camps:[],art:[],pins:[],newCamps:[],newArt:[]});vt({add:ut,locationSharp:ht,listOutline:ft,gridOutline:_t}),G(()=>m(this,null,function*(){let o=this.mapChanges();if(o.art.length==0&&o.newArt.length==0)return;this.busy=!0;let C=o.art.length,v=0;for(let k of o.art){v++;try{yield this.api.addArt(k)}catch(Pt){throw console.error(`Unable to apply art change ${k.name}`,k),Pt}this.progress=v/C}let It=yield this.importNewArt(o.newArt);this.message(`${o.art.length} art changes made. ${It} art added.`),console.log(o),this.api.clearCache(),this.ionViewDidEnter(),this.busy=!1,this.progress=void 0}))}ngOnInit(){return m(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity,!0),this.title=`${this.api.festivalTitle()}`,this.festivalTitle=this.api.festivalTitle(),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.canEdit=this.api.getAccessInfo(void 0).hasArt||this.isAdmin,this.canEditEvent=this.api.eventEditing()||this.isAdmin,this.canEditArt=this.api.artEditing()||this.isAdmin,this.canBroadcastLocation=this.api.artEditing(),this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"},{title:"Export Email Addresses",method:this.exportEmail(),icon:"mail-outline"},{title:"Import KML",method:this.importKML(),icon:"cloud-upload-outline"}]:[]})}broadcastLocation(e){return m(this,null,function*(){let t=P(`${e.id}`);this.api.sendMessage(`Use the PIN ${t} to broadcast your mutant vehicles location. Click the link to read how.`,0,"Broadcast Location","https://dust.events/docs/Mutant%20Vehicles/broadcast-location")})}ionViewDidEnter(){return m(this,null,function*(){this.art=yield this.api.art({cached:!0}),this.filteredBySearch=!1,this.busy=!1})}importCSV(){return()=>m(this,null,function*(){this.router.navigateByUrl("./import-art")})}importKML(){return()=>m(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.kmlUpload.nativeElement.click()})}exportCSV(){return()=>m(this,null,function*(){this.artService.exportArtToCSV(this.festivalTitle,this.art)})}exportEmail(){return()=>m(this,null,function*(){this.artService.exportArtEmail(this.festivalTitle,this.art)})}message(e){setTimeout(()=>{this.api.sendMessage(e)},1)}handleSearch(e){return m(this,null,function*(){let t=e.target.value.toLowerCase(),n=yield this.api.art({cached:!0});this.art=n.filter(a=>{var o;return a.name.toLowerCase().includes(t)||((o=a.description)==null?void 0:o.toLowerCase().includes(t))}),this.filteredBySearch=t.length>0})}toggleGrid(){this.isGrid=!this.isGrid}editRoute(e){return this.canEdit?"../art/"+e.id:void 0}image(e){return e.imageUrl?this.api.imageURL(e.imageUrl):`./assets/${e.art_type?`${e.art_type}`.toLowerCase().replace(/ /g,"-"):"unknown"}.svg`}newRoute(){return this.canEdit?"../art/new":void 0}onKMLSelected(e){return m(this,null,function*(){if(!this.isAdmin){this.api.sendMessage("You do not have access rights to this feature.");return}let t=e.target.files[0];if(!t)return;let n=new FileReader;n.onload=a=>m(this,null,function*(){var v;let o=(v=a.target)==null?void 0:v.result,C=this.kml.parse(o,this.art,!0);this.mapChanges.set(C)}),n.readAsText(t)})}importNewArt(e){return m(this,null,function*(){let t=0;if(e.length==0)return 0;for(let n of e)if(n.pin.includes("lat")){let a=yield Ct(this.alert,`Add Art "${n.name}" ?`,"Add");if(a=="Add"&&((!n.description||n.description.length<5)&&(n.description=`No description provided for ${n.name}.`),yield this.api.addArt(n),t++),a=="Cancel")return t}return t})}};g.\u0275fac=function(t){return new(t||g)(A(I),A(T),A(wt),A(Q))},g.\u0275cmp=N({type:g,selectors:[["app-art"]],viewQuery:function(t,n){if(t&1&&U(Mt,7),t&2){let a;O(a=j())&&(n.kmlUpload=a.first)}},inputs:{vanity:"vanity"},decls:18,vars:7,consts:[["kmlUpload",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../art/new",3,"disabled"],["name","add"],[3,"buttons"],[3,"fullscreen"],[3,"value"],[1,"large-border"],["title","Add Art",3,"routeTo"],["type","file",1,"file-input",3,"change"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],["color","dark","fill","clear","slot","end",3,"click"],[3,"name"],[1,"ion-text-center",3,"ngClass"],[3,"title","description"],[1,"pad-below",3,"ngClass"],[1,"border"],[1,"grid-item"],[1,"clickable"],[3,"routerLink","src"],[3,"routerLink"],["fill","clear","color","light",2,"position","absolute","margin-top","-3px"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["color","secondary",3,"disabled","routerLink"],["color","secondary",3,"disabled","routerLink","queryParams"],["color","secondary",3,"disabled"],["size","small","name","location-sharp",1,"pin"],["color","secondary",3,"click","disabled"],[1,"ion-padding"],[1,"clickable",2,"min-width","45px",3,"width","height","routerLink","src"],[1,"clickable",2,"width","100%","padding","1rem",3,"routerLink"]],template:function(t,n){if(t&1){let a=S();s(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),p(3,"ion-back-button"),l(),s(4,"ion-title",3),f(5,"Art"),l(),s(6,"ion-buttons",4)(7,"ion-button",5),p(8,"ion-icon",6),l(),p(9,"app-side",7),l()()(),s(10,"ion-content",8),u(11,Rt,4,3,"ion-toolbar"),u(12,$t,1,1,"ion-progress-bar",9),u(13,Ht,5,3,"div",10)(14,Yt,1,0,"app-spinner"),u(15,Wt,1,1,"app-footer",11),s(16,"input",12,0),b("change",function(C){return x(a),y(n.onKMLSelected(C))}),l()()}t&2&&(r(7),c("disabled",!n.canEdit),r(2),c("buttons",n.buttons),r(),c("fullscreen",!0),r(),_(n.art.length>1?11:-1),r(),_(n.progress?12:-1),r(),_(n.busy?14:13),r(2),_(n.isAdmin?15:-1))},dependencies:[ot,rt,Z,et,X,tt,at,pt,dt,yt,At,gt,W,Y,J,it,nt,st,lt,D,K,H,bt,xt,z,q],styles:["ion-card-title[_ngcontent-%COMP%]{font-size:1.5rem!important}ion-card-content[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:var(--fs4)}h1[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.pin[_ngcontent-%COMP%]{color:var(--ion-color-primary);opacity:.5}app-img[_ngcontent-%COMP%]{--border-radius: 5px}"]});var St=g;export{St as ArtPage};
