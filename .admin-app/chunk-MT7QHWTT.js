import{a as ve}from"./chunk-OYPABFUA.js";import{a as V,b as M}from"./chunk-2HF6EJ75.js";import"./chunk-PNKDLQP2.js";import"./chunk-KCPLCCSF.js";import{a as be}from"./chunk-SAXSOE4W.js";import{a as we}from"./chunk-GKO5FLMM.js";import{a as Ce}from"./chunk-5EUBO754.js";import{c as A}from"./chunk-OZ2IKH4J.js";import{N as fe,O as ye,aa as xe}from"./chunk-TF5OT4X3.js";import{G as he,I as ge,l as ue,v as _e}from"./chunk-CXIDEVKY.js";import"./chunk-PFLI22GG.js";import{$ as L,$b as te,Aa as S,Ba as O,D,Dc as ce,Ea as y,Fa as C,G as n,Ga as x,Ic as pe,Jc as me,La as R,O as F,Ra as N,Rb as Y,W as g,Wa as Q,Wb as X,X as f,Yb as Z,Z as U,Zb as $,_ as W,_b as ee,aa as c,ba as o,ca as l,da as w,db as j,ec as ie,gb as q,ia as I,jb as z,ka as _,kc as ne,lc as ae,ma as d,nc as re,ob as G,p as v,qa as P,ra as T,rb as J,s as p,sa as k,sc as oe,t as m,vc as le,w as E,wb as H,wc as se,ya as B,yb as K,yc as de,za as u}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h}from"./chunk-LNJ3S2LQ.js";var Ae=a=>[a];function Pe(a,i){if(a&1&&(o(0,"ion-select-option",13),u(1),l()),a&2){let e=i.$implicit;c("value",e),n(),S(e)}}function Te(a,i){if(a&1&&w(0,"img",16),a&2){let e=d(2);c("src",e.imageUrl,D)}}function ke(a,i){if(a&1&&(o(0,"p"),u(1),l()),a&2){let e=d(2);n(),O("Click to choose an optional image for your ",e.title())}}function Se(a,i){if(a&1){let e=I();o(0,"ion-item")(1,"app-emails",21),x("emailsChange",function(t){p(e);let s=d(2);return C(s.art.contact_email,t)||(s.art.contact_email=t),m(t)}),l()()}if(a&2){let e=d(2);n(),c("isAdmin",e.isAdmin)("isOwner",!1)("label","Art Owner(s)")("placeholder","Email address of Art owner"),y("emails",e.art.contact_email)}}function Ve(a,i){if(a&1){let e=I();o(0,"app-tooltip",19)(1,"ion-button",22),_("click",function(){p(e);let t=d(2);return m(t.invite())}),u(2,"Invite"),l()()}if(a&2){let e=d(2);n(),c("disabled",e.inviting)}}function Me(a,i){if(a&1&&(o(0,"app-tooltip",23)(1,"ion-button",24),u(2," Place "),l()(),o(3,"ion-button",25),u(4," Delete "),l(),u(5,"\xA0 "),w(6,"ion-alert",26)),a&2){let e=d(2);n(),c("routerLink","../../map/art/"+R(2,Ae,e.art.id)),n(5),c("buttons",e.deleteButtons)}}function Ee(a,i){if(a&1){let e=I();o(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.name,t)||(s.art.name=t),m(t)}),l()(),o(6,"ion-item")(7,"ion-input",9),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.artist,t)||(s.art.artist=t),m(t)}),l()(),o(8,"app-link-input",10),x("modelChange",function(t){p(e);let s=d();return C(s.art.url,t)||(s.art.url=t),m(t)}),_("iconClick",function(){p(e);let t=d();return m(t.openUrl())}),l(),o(9,"ion-item",11)(10,"ion-select",12),_("ngModelChange",function(){p(e);let t=d();return m(t.artTypeChanged())}),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.art_type,t)||(s.art.art_type=t),m(t)}),W(11,Pe,2,2,"ion-select-option",13,U),l()(),o(13,"ion-item")(14,"ion-textarea",14),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.description,t)||(s.art.description=t),m(t)}),l()(),o(15,"div",15),_("click",function(){p(e);let t=d();return m(t.upload.click())}),g(16,Te,1,1,"img",16),g(17,ke,2,1,"p"),l(),g(18,Se,2,5,"ion-item"),w(19,"app-internal-fields",17),l(),o(20,"div",18),g(21,Ve,3,1,"app-tooltip",19),g(22,Me,7,4),o(23,"ion-button",3),_("click",function(){p(e);let t=d();return m(t.save())}),u(24,"Save"),l()(),o(25,"app-upload",20),_("upload",function(t){p(e);let s=d();return m(s.uploaded(t))}),l()()()()}if(a&2){let e=d();n(5),c("label",e.title()+" Title")("placeholder","Title of the "+e.title()),y("ngModel",e.art.name),n(2),y("ngModel",e.art.artist),n(),c("placeholder","URL for the "+e.art.art_type+" project"),y("model",e.art.url),n(2),c("value",e.art.art_type),y("ngModel",e.art.art_type),n(),L(e.artTypes),n(3),c("spellcheck",!0)("rows",6)("autoGrow",!0)("maxlength",1e3),y("ngModel",e.art.description),n(),B(e.uploading?"disabled":""),n(),f(e.imageUrl?16:-1),n(),f(e.imageUrl?-1:17),n(),f(e.isAdmin?18:-1),n(),c("schemaType","art")("entityId",e.art.id||0)("currentData",e.internalFieldData),n(2),f(e.id&&e.isAdmin?21:-1),n(),f(e.id&&e.canPlace?22:-1),n(),c("disabled",e.busy)}}function De(a,i){a&1&&w(0,"app-spinner")}var b=class b{constructor(){this.api=v(ge);this.alert=v(de);this.location=v(Q);this.vanity=N();this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.inviting=!1;this.canPlace=!1;this.title=E("Art");this.artTypes=["Art","Mutant Vehicle"];this.route=v(j);this.internalFieldData=[];this.art={name:"",pin:"",description:"",category:"Open Playa Art",id:void 0,contact_email:"",art_type:this.artTypes[0],url:""};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];xe({mapOutline:ye,mailOutline:fe})}uploaded(i){this.imageUrl=i.url,this.imageChanged=!0,this.blob=i.blob}ionViewWillEnter(){return h(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity()),this.id=ue(this.id),this.art=yield this.api.getArt(this.id),this.art.url||(this.art.url=""),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.imageUrl=this.api.imageURL(this.art.imageUrl);let i=this.route.snapshot.queryParams.type;if(!this.art.id&&i&&(this.art.art_type=i,this.title.set(i)),this.art.internalData)try{this.internalFieldData=JSON.parse(this.art.internalData)}catch(e){console.error("Failed to parse internal data:",e),this.internalFieldData=[]}this.busy=!1})}artTypeChanged(){setTimeout(()=>{this.title.set(this.art.art_type)},10)}presentAlert(i){return h(this,null,function*(){yield(yield this.alert.create({header:"Message",message:i,buttons:["OK"]})).present()})}delete(){return h(this,null,function*(){this.busy=!0,yield this.api.deleteArt(this.art),this.api.clearCache(),this.busy=!1,this.location.back()})}save(i=!0){return h(this,null,function*(){this.busy=!0,_e(this.art);try{if(this.internalFields){if(!this.internalFields.validate()){this.busy=!1;return}this.internalFieldData=this.internalFields.fieldValues(),this.internalFieldData.length>0&&(this.art.internalData=JSON.stringify(this.internalFieldData))}let e=yield this.api.addArt(this.art);if(this.busy=!1,e.message)this.presentAlert(e.message);else{if(e.id&&this.imageChanged){console.log(`Uploaded image for art ${e.id}`),this.busy=!0;try{yield this.uploadImage(e.id)}finally{this.busy=!1,this.imageChanged=!1}}this.art.id||(yield this.presentAlert("Thank you for your Art submission.")),this.api.clearCache(),i&&this.location.back()}}finally{this.busy=!1}})}uploadImage(i){return h(this,null,function*(){if(this.blob)try{this.uploading=!0,this.art.imageUrl=yield this.api.setImage(this.blob,i);let e=yield this.api.addArt(this.art);e.message&&this.presentAlert(e.message)}finally{this.uploading=!1}})}invite(){return h(this,null,function*(){if(!this.art.contact_email){yield A(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let i=yield this.api.inviteArt(this.art);i.message?A(this.alert,i.message):A(this.alert,"The art owner has been invited to manage their art.","Invitation")})}openUrl(){if(this.art.url){let i=he(this.art.url);window.open(i,"_blank")}}};b.\u0275fac=function(e){return new(e||b)},b.\u0275cmp=F({type:b,selectors:[["app-art"]],viewQuery:function(e,r){if(e&1&&(P(V,5),P(M,5)),e&2){let t;T(t=k())&&(r.upload=t.first),T(t=k())&&(r.internalFields=t.first)}},inputs:{id:"id",vanity:[1,"vanity"]},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["labelPlacement","stacked",3,"ngModelChange","label","placeholder","ngModel"],["label","Artist","labelPlacement","stacked","placeholder","Name of the artist",3,"ngModelChange","ngModel"],["label","URL",3,"modelChange","iconClick","placeholder","model"],["lines","none",1,"app-select"],["labelPlacement","stacked","label","Type","interface","popover","placeholder","Select the type of art",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["labelPlacement","stacked","label","Description","placeholder","Description of the art",3,"ngModelChange","spellcheck","rows","autoGrow","maxlength","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[3,"schemaType","entityId","currentData"],[1,"center"],["text","Invite art owner via email to manage their art"],[3,"upload"],["helperText","The art owner(s) can login and alter the description and events at the art. This is a list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["color","secondary",3,"click","disabled"],["text","Place the art on the map"],["color","secondary",3,"routerLink"],["id","deleteArt","color","secondary"],["trigger","deleteArt","header","Delete Art?",3,"buttons"]],template:function(e,r){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),w(3,"ion-back-button"),l(),o(4,"ion-title"),u(5),l(),o(6,"ion-buttons",2)(7,"ion-button",3),_("click",function(){return r.save()}),u(8,"Save"),l()()()(),o(9,"ion-content",4),g(10,Ee,26,24,"div",5)(11,De,1,0,"app-spinner"),l()),e&2&&(n(5),S(r.id||r.art.id?"Edit "+r.title():"Add "+r.title()),n(2),c("disabled",r.busy),n(2),c("fullscreen",!0),n(),f(r.busy?11:10))},dependencies:[X,we,V,K,G,H,J,Ce,z,q,ne,se,$,Y,le,Z,ie,ee,te,re,be,ae,ce,me,pe,oe,ve,M],encapsulation:2});var Ie=b;export{Ie as ArtItemPage};
