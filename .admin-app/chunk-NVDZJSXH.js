import{a as wt}from"./chunk-PM6ABAYG.js";import{a as yt}from"./chunk-RDDDBQCT.js";import{a as xt}from"./chunk-VMYNBILH.js";import"./chunk-QTBNLBDF.js";import{a as gt}from"./chunk-TQS35TTB.js";import{a as Ct}from"./chunk-S2LNLKRW.js";import{a as vt}from"./chunk-4TINRQR4.js";import{a as _t}from"./chunk-S6IHJUHU.js";import"./chunk-TUKQZ63R.js";import{L as ut,R as ft,a as ht}from"./chunk-OAPJ7RFL.js";import{B as pt,a as ct,e as mt,j as v,l as V,r as M,u as dt}from"./chunk-UOBZOUDF.js";import"./chunk-MIGJGGKJ.js";import{$ as _,A as C,Aa as m,B as x,Ba as I,Ca as b,Da as k,Fa as U,Ga as B,Ha as L,Ka as R,Kb as Y,Pb as G,Qb as H,S as r,T as w,Ta as F,X as D,Xa as Z,Xb as K,ab as $,bc as Q,cb as N,cc as X,da as p,db as J,dc as tt,ec as et,ga as h,gb as j,ia as O,ic as it,ja as A,ka as s,la as l,lb as q,lc as nt,ma as f,mb as z,mc as ot,nc as at,oa as S,pa as E,qa as c,rb as W,tc as rt,xc as st,yc as lt}from"./chunk-PNZTRGP7.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as u}from"./chunk-LNJ3S2LQ.js";var Et=(i,e)=>e.id,It=(i,e)=>e.name,bt=i=>[i];function Tt(i,e){if(i&1){let t=S();s(0,"ion-toolbar")(1,"ion-searchbar",10),E("ionInput",function(n){C(t);let a=c();return x(a.handleSearch(n))}),l()()}if(i&2){let t=c();r(),p("debounce",600)("placeholder","Search events at "+t.title)}}function Pt(i,e){i&1&&f(0,"app-spinner")}function Ot(i,e){if(i&1&&(s(0,"div",11)(1,"app-card",14),f(2,"app-img",15),s(3,"ion-button",16),m(4," Register Event "),l()()()),i&2){let t=c(2);p("ngClass",t.events.length>0?"":"pad-vertical"),r(),p("description","You can register your event for "+t.title+"."),r(),p("width","100px")("height","100px")("src",t.imageUrl),r(),p("routerLink",t.newRoute())}}function At(i,e){if(i&1&&(s(0,"ion-segment-button",19)(1,"ion-label"),m(2),l()()),i&2){let t=e.$implicit;p("value",t.name),r(2),I(t.title)}}function Vt(i,e){if(i&1){let t=S();s(0,"ion-toolbar")(1,"ion-buttons",1)(2,"ion-segment",18),L("ngModelChange",function(n){C(t);let a=c(3);return B(a.showing,n)||(a.showing=n),x(n)}),E("ionChange",function(){C(t);let n=c(3);return x(n.refresh())}),O(3,At,3,2,"ion-segment-button",19,It),l()()()}if(i&2){let t=c(3);r(2),U("ngModel",t.showing),p("value",t.showing),r(),A(t.filters)}}function Mt(i,e){i&1&&(s(0,"ion-item"),m(1," There are no events matching your search. "),l())}function Dt(i,e){if(i&1){let t=S();s(0,"ion-item",20)(1,"h2"),m(2,"Getting Started"),l()(),s(3,"ion-item"),m(4," Click \xA0"),s(5,"a",21),E("click",function(){C(t);let n=c(5);return x(n.newEvent())}),m(6,"Add Event"),l(),m(7),l()}if(i&2){let t=c(5);r(7),b("\xA0 to create your first event at ",t.title,". ")}}function kt(i,e){if(i&1&&_(0,Dt,8,1),i&2){let t=c(4);h(t.isAdmin?0:-1)}}function Ut(i,e){if(i&1&&_(0,Mt,2,0,"ion-item")(1,kt,1,1),i&2){let t=c(3);h(t.filteredBySearch?0:1)}}function Bt(i,e){if(i&1&&(s(0,"ion-item")(1,"ion-text",22),m(2),l()()),i&2){let t=c(3);r(2),b("Time Zone ",t.diffTimeZone,"")}}function Lt(i,e){if(i&1&&(s(0,"p",28),m(1),l(),s(2,"p",29),m(3),l()),i&2){let t=c().$implicit;r(),k("",t.camp,"",t.art,""),r(2),I(t.other_location)}}function Rt(i,e){if(i&1&&(s(0,"ion-item",17),f(1,"app-img",23),s(2,"ion-label",24),_(3,Lt,4,3),m(4),l(),s(5,"ion-label",25)(6,"p",26),m(7),l(),s(8,"p",27),m(9),l()()()),i&2){let t=e.$implicit,o=c(3);p("routerLink","../events/"+R(8,bt,t.id)),r(),p("width","45px")("height","45px")("src",o.image(t)),r(2),h(!o.campId&&!o.artId?3:-1),r(),b(" ",t.title," "),r(3),I(t.event_type),r(2),I(t.timeString)}}function Ft(i,e){if(i&1&&(s(0,"app-image-card",12),_(1,Vt,5,2,"ion-toolbar"),s(2,"ion-list"),_(3,Ut,2,1)(4,Bt,3,1,"ion-item"),O(5,Rt,10,10,"ion-item",17,Et),l()()),i&2){let t=c(2);p("url",t.getImageUrl()),r(),h(!t.campId&&!t.artId?1:-1),r(2),h(t.events.length===0?3:t.diffTimeZone?4:-1),r(2),A(t.events)}}function Zt(i,e){if(i&1&&(_(0,Ot,5,6,"div",11)(1,Ft,7,3,"app-image-card",12),f(2,"div",13)(3,"div",13)),i&2){let t=c();h(t.events.length===0&&!t.filteredBySearch&&!t.isAdmin?0:1)}}function $t(i,e){if(i&1){let t=S();s(0,"app-footer",30),E("press",function(){C(t);let n=c();return x(n.newEvent())}),l()}}var y=class y{constructor(e,t,o,n){this.api=e;this.router=t;this.eventService=o;this.route=n;this.events=[];this.title="Events";this.busy=!0;this.isAdmin=!1;this.imageUrl="";this.newEventUrl="../events/new";this.description="";this.diffTimeZone="";this.showing="all";this.showSearch=!0;this.canEditEvent=!1;this.buttons=[];this.filteredBySearch=!1;this.filters=[];ft({add:ht,printOutline:ut})}filtered(e,t,o,n,a){var g;let d=!0;return e=="mine"?(g=n.contact)!=null&&g.startsWith("***")&&(d=!1):e!=="all"&&(d=this.hasDay(n,e,a)),t&&v(n.hosted_by_camp)!==v(t)&&(d=!1),o&&v(n.located_at_art)!==v(o)&&(d=!1),d}importCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.router.navigateByUrl("./import-events")})}exportCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.exportToCSV()})}ngOnInit(){return u(this,null,function*(){var e;try{this.busy=!0,yield this.api.setFestivalByVanity(this.vanity,!0),this.campId=v(this.route.snapshot.queryParams.camp),this.artId=v(this.route.snapshot.queryParams.art),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.imageUrl=(e=this.api.imageURL(this.api.festivalImage()))!=null?e:"",this.camp=this.campId?yield this.api.getCamp(this.campId):void 0,this.art=this.artId?yield this.api.getArt(this.artId):void 0,this.title=this.camp?this.camp.name:this.api.festivalTitle(),this.canEditEvent=this.api.eventEditing()||this.isAdmin,this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"}]:[],this.art&&(this.title=this.art.name),this.diffTimeZone=this.api.currentTimeZone()==this.api.festivalTimeZone()?"":this.api.festivalTimeZone(),yield this.api.setFestivalByVanity(this.vanity),yield this.refresh(),this.showSearch=this.events.length>1,this.description=this.events.length==0?`There are no events yet for ${this.title}`:`Events for ${this.title}`}finally{this.busy=!1}})}ionViewDidEnter(){return u(this,null,function*(){for(;this.busy;)yield mt(500);yield this.refresh()})}newRoute(){return this.canEditEvent?"../events/new":void 0}message(e){setTimeout(()=>{this.api.sendMessage(e)},1)}handleSearch(e){return u(this,null,function*(){let t=e.target.value.toLowerCase().trim(),o=this.cleanEvents(yield this.api.events({cached:!0}),!1);this.events=o.filter(n=>{var a;return n.title.toLowerCase().includes(t)||((a=n.camp)==null?void 0:a.toLowerCase().includes(t))}),this.filteredBySearch=t.length>0})}image(e){return this.api.imageURL(e.imageUrl)}newEvent(){this.router.navigate(["./new"],{queryParams:{camp:this.campId,art:this.artId},relativeTo:this.route})}festivalImage(){return this.api.imageURL(this.api.festivalImage())}refresh(){return u(this,null,function*(){this.filters=[],this.events=this.cleanEvents(yield this.api.events({cached:!0}),!1),this.filteredBySearch=!1,this.filters.find(e=>e.name=="mine")||this.filters.unshift({title:"All",name:"all"},{title:"Mine",name:"mine"})})}exportToCSV(){return u(this,null,function*(){let e=this.showing!=="all",t=this.cleanEvents(yield this.api.events({cached:!0}),e);yield this.eventService.exportEventsToCSV(this.api.festivalTitle(),t,this.api.currentTimeZone(),this.showing)})}getImageUrl(){var e;return this.camp&&this.camp.imageUrl?this.api.imageURL(this.camp.imageUrl):this.art&&((e=this.art)!=null&&e.imageUrl)?this.api.imageURL(this.art.imageUrl):this.festivalImage()}addFiltersForDays(e){let t=new Date(e.start_time),o=`${t.getDate()} (${dt[t.getDay()]})`;this.filters.find(a=>a.title==o)||(this.filters.push({title:o,name:this.nameOf(t)}),this.filters.sort((a,d)=>a.name>d.name?1:-1))}hasDay(e,t,o){let n=JSON.parse(e.occurrence_set);if(o){let a=[];for(let d of n)t==this.nameOf(new Date(d.start_time))&&a.push(d);if(a.length>0)return e.occurrence_set=JSON.stringify(a),!0}else for(let a of n)if(t==this.nameOf(new Date(a.start_time)))return!0;return!1}nameOf(e){return`${e.getDate()}-${e.getMonth()}-${e.getFullYear()}`}cleanEvents(e,t){var o;for(let n of e){let a=JSON.parse(n.occurrence_set);this.goodDates(a)||console.error(`${n.title} has bad dates`);let d=V(a[0].start_time),g=V(a[0].end_time),T=this.api.currentTimeZone();n.timeString=(o=ct(d,g,void 0,T))==null?void 0:o.long,a.length>1&&(n.timeString+=` (+${a.length-1} other occurrence)`);for(let P of a)this.addFiltersForDays(P)}return e.sort((n,a)=>{let d=JSON.parse(n.occurrence_set),g=JSON.parse(a.occurrence_set),T=new Date(d[0].start_time),P=new Date(g[0].start_time);return T-P}),e.filter(n=>this.filtered(this.showing,this.campId,this.artId,n,t))}signOut(){return u(this,null,function*(){this.api.signOut(),this.router.navigateByUrl("/auth")})}goodDates(e){for(let t of e)if(M(t.start_time)!=t.start_time||M(t.end_time)!=t.end_time)return!1;return!0}};y.\u0275fac=function(t){return new(t||y)(w(pt),w(N),w(wt),w($))},y.\u0275cmp=D({type:y,selectors:[["app-events"]],inputs:{vanity:"vanity"},decls:16,vars:7,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../events/new"],["name","add"],[3,"buttons"],[3,"fullscreen"],[1,"border"],["title","Add Event"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],[1,"ion-text-center",3,"ngClass"],["routeTo","../events/new",3,"url"],[1,"ion-padding"],["title","Event Registration",3,"description"],["logo","",1,"logo","ion-padding",3,"width","height","src"],["shape","round",3,"routerLink"],[3,"routerLink"],["mode","ios",2,"float","right","margin-right","0.5rem","margin-top","0.5rem","width","100%",3,"ngModelChange","ionChange","ngModel","value"],[3,"value"],["lines","none"],[3,"click"],["color","medium","slot","end",2,"text-transform","uppercase","font-size","small"],[1,"clickable","pad-right",3,"width","height","src"],[1,"ion-text-wrap"],[1,"ion-text-right","ion-text-wrap","last-col"],[1,"one-line","sz-large"],["color","medium",1,"time"],[1,"title"],[1,"title","highlight"],["title","Add Event",3,"press"]],template:function(t,o){t&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),f(3,"ion-back-button"),l(),s(4,"ion-title",2),m(5),l(),s(6,"ion-buttons",3)(7,"ion-button",4),f(8,"ion-icon",5),l(),f(9,"app-side",6),l()()(),s(10,"ion-content",7),_(11,Tt,2,2,"ion-toolbar")(12,Pt,1,0,"app-spinner"),s(13,"div",8),_(14,Zt,4,1)(15,$t,1,0,"app-footer",9),l()()),t&2&&(r(5),b("Events at ",o.title,""),r(4),p("buttons",o.buttons),r(),p("fullscreen",!0),r(),h(o.showSearch?11:-1),r(),h(o.busy?12:-1),r(2),h(o.busy?-1:14),r(),h(o.events.length!==0&&!o.filteredBySearch?15:-1))},dependencies:[nt,st,yt,_t,lt,it,Z,F,W,q,z,j,J,Q,at,H,Y,ot,G,K,rt,et,X,tt,Ct,gt,vt,xt],styles:["ion-fab[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:20px}ion-fab-button[_ngcontent-%COMP%]{margin-top:-35px;padding:5px}ion-item[_ngcontent-%COMP%]{cursor:pointer}.title[_ngcontent-%COMP%]{font-size:var(--fs4)}.highlight[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.one-line[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}app-img[_ngcontent-%COMP%]{--border-radius: 5px}.last-col[_ngcontent-%COMP%]{max-width:25%}@media (width < 500px){.sz-large[_ngcontent-%COMP%]{display:none}}.pad-right[_ngcontent-%COMP%]{width:55px}"]});var St=y;export{St as EventsPage};
