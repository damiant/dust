import{b as te,c as ie,d as ne,e as oe,f as ae,g as le}from"./chunk-NMA3RVEJ.js";import{a as X}from"./chunk-KCPLCCSF.js";import{c as Z}from"./chunk-OZ2IKH4J.js";import{H as Y,ea as ee}from"./chunk-MQOPPKG3.js";import{J as K}from"./chunk-2K4NO5ZT.js";import{$ as S,Aa as U,Ac as Q,Ba as q,Ca as O,Cb as A,G as l,Gc as j,I as E,Ic as B,Lc as G,O as b,Qc as W,Rc as J,Sa as H,Ta as T,W as d,X as c,Z as M,_ as w,aa as C,ba as u,ca as _,ea as P,fa as $,ia as f,ka as F,la as L,ma as o,p as I,qa as k,ra as N,rc as z,s as p,sa as R,t as m,w as v,za as y}from"./chunk-OCTOJKK3.js";import{h as x}from"./chunk-LNJ3S2LQ.js";var pe=["fileUpload"],g=class g{constructor(){this.upload=new E}click(){this.fileUpload.nativeElement.click()}onFileSelected(i){return x(this,null,function*(){let e=i.target.files[0];if(!e)return;let t=yield X(e,{quality:85,width:400}),a=URL.createObjectURL(t);this.upload.emit({blob:t,url:a})})}};g.\u0275fac=function(e){return new(e||g)},g.\u0275cmp=b({type:g,selectors:[["app-upload"]],viewQuery:function(e,t){if(e&1&&k(pe,5),e&2){let a;N(a=R())&&(t.fileUpload=a.first)}},outputs:{upload:"upload"},decls:2,vars:0,consts:[["fileUpload",""],["type","file",1,"is-hidden",3,"change"]],template:function(e,t){if(e&1){let a=f();P(0,"input",1,0),L("change",function(r){return p(a),m(t.onFileSelected(r))}),$()}},styles:[".is-hidden[_ngcontent-%COMP%]{display:none}"]});var re=g;var me=(n,i)=>i.name;function ue(n,i){var e;if(n&1){let t=f();u(0,"ion-item")(1,"ion-input",3),F("ionChange",function(s){var D;p(t);let r=o(2).$implicit,V=o(2);return m(V.updateFieldValue(r.name,(D=s.detail.value)!=null?D:""))}),_()()}if(n&2){let t=o(2).$implicit,a=o(2);l(),C("helperText",a.getScopeMessage(t))("label",t.name+(a.isFieldRequired(t)?" *":""))("value",a.getFieldValue(t.name))("maxlength",a.getMaxLength(t))("appHoverTooltip",(e=t.helperText)!=null?e:"")("placeholder",t.helperText)}}function _e(n,i){if(n&1){let e=f();u(0,"ion-item")(1,"ion-textarea",4),F("ionChange",function(a){var V;p(e);let s=o(2).$implicit,r=o(2);return m(r.updateFieldValue(s.name,(V=a.detail.value)!=null?V:""))}),_()()}if(n&2){let e=o(2).$implicit,t=o(2);l(),C("label",e.name+(t.isFieldRequired(e)?" *":""))("value",t.getFieldValue(e.name))("rows",t.getTextAreaRows(e))("maxlength",t.getMaxLength(e))("placeholder",e.helperText)("appHoverTooltip",t.getScopeMessage(e))("autoGrow",!0)}}function fe(n,i){if(n&1){let e=f();u(0,"ion-item",0)(1,"ion-checkbox",5),F("ionChange",function(a){p(e);let s=o(2).$implicit,r=o(2);return m(r.updateFieldValue(s.name,a.detail.checked))}),y(2),_()()}if(n&2){let e=o(2).$implicit,t=o(2);l(),C("checked",t.getFieldValue(e.name)===!0)("appHoverTooltip",t.getScopeMessage(e)),l(),O("",e.name,"",t.isFieldRequired(e)?" *":"")}}function Ce(n,i){if(n&1&&(u(0,"ion-select-option",7),y(1),_()),n&2){let e=i.$implicit;C("value",e),l(),U(e)}}function ge(n,i){if(n&1){let e=f();u(0,"ion-item",1)(1,"ion-select",6),F("ionChange",function(a){p(e);let s=o(2).$implicit,r=o(2);return m(r.updateFieldValue(s.name,a.detail.value))}),w(2,Ce,2,2,"ion-select-option",7,M),_()()}if(n&2){let e=o(2).$implicit,t=o(2);l(),C("label",e.name+(t.isFieldRequired(e)?" *":""))("value",t.getFieldValue(e.name))("placeholder","Select an option")("appHoverTooltip",t.getScopeMessage(e)),l(),S(e.values)}}function he(n,i){if(n&1&&(u(0,"div",2),y(1),_()),n&2){let e=o(2).$implicit,t=o(2);l(),q(" ",t.getFieldError(e.name),`
`)}}function xe(n,i){var e;if(n&1&&(d(0,ue,2,6,"ion-item"),d(1,_e,2,7,"ion-item"),d(2,fe,3,4,"ion-item",0),d(3,ge,4,4,"ion-item",1),d(4,he,2,1,"div",2)),n&2){let t=o().$implicit,a=o(2);c(t.type==="string"&&t.maxLines===1?0:-1),l(),c(t.type==="string"&&((e=t.maxLines)!=null?e:1)>1?1:-1),l(),c(t.type==="boolean"?2:-1),l(),c(t.type==="values"?3:-1),l(),c(a.getFieldError(t.name)?4:-1)}}function ve(n,i){if(n&1&&d(0,xe,5,5),n&2){let e=o(2);c(e.isFieldVisible()?0:-1)}}function Fe(n,i){if(n&1&&w(0,ve,1,1,null,null,me),n&2){let e=o();S(e.schema())}}var h=class h{constructor(){this.schemaType=T.required();this.entityId=T.required();this.currentData=T(null);this.dataSaved=H();this.api=I(K);this.alert=I(j);this.schema=v([]);this.fieldValues=v([]);this.validationErrors=v([]);this.isLoading=v(!1);ee({informationCircle:Y})}ngOnInit(){this.loadSchema()}loadSchema(){return x(this,null,function*(){this.isLoading.set(!0);try{let i=this.schemaType()==="camps"?yield this.api.getCampSchema():yield this.api.getArtSchema();if(i.data&&Array.isArray(i.data)){this.schema.set(i.data);let e=this.currentData()||ie(null),t=ae(i.data,e);this.fieldValues.set(t)}else this.schema.set([]),this.fieldValues.set([])}catch(i){console.error("Failed to load schema:",i),this.schema.set([]),this.fieldValues.set([])}finally{this.isLoading.set(!1)}})}validate(){let i=te(this.fieldValues(),this.schema());return this.validationErrors.set(i),i.length===0}save(){return x(this,null,function*(){if(!this.validate())return!1;try{let i=this.fieldValues();return this.dataSaved.emit(i),!0}catch(i){return console.error("Failed to save field values:",i),yield Z(this.alert,`Failed to save field values: ${i}`,"Error"),!1}})}updateFieldValue(i,e){let t=oe(this.fieldValues(),i,e);this.fieldValues.set(t);let s=this.validationErrors().filter(r=>r.fieldName!==i);this.validationErrors.set(s)}getFieldError(i){let e=this.validationErrors().find(t=>t.fieldName===i);return e?e.message:null}getScopeMessage(i){var e;return`${(e=i.helperText)!=null?e:""} (${ne(i.scope,i.name)})`}getFieldValue(i){let e=this.fieldValues().find(t=>t.name===i);return e?e.value:null}isFieldVisible(){return!0}getTextAreaRows(i){return i.maxLines||1}isFieldRequired(i){return i.required}getMaxLength(i){return i.maxLength||1e3}};h.\u0275fac=function(e){return new(e||h)},h.\u0275cmp=b({type:h,selectors:[["app-internal-fields"]],inputs:{schemaType:[1,"schemaType"],entityId:[1,"entityId"],currentData:[1,"currentData"]},outputs:{dataSaved:"dataSaved"},decls:1,vars:1,consts:[[1,"ion-padding-start"],["lines","none",1,"app-select"],[1,"error-message"],["labelPlacement","stacked",3,"ionChange","helperText","label","value","maxlength","appHoverTooltip","placeholder"],["labelPlacement","stacked",3,"ionChange","label","value","rows","maxlength","placeholder","appHoverTooltip","autoGrow"],["justify","start","labelPlacement","end",3,"ionChange","checked","appHoverTooltip"],["labelPlacement","stacked","interface","popover",1,"app-select",3,"ionChange","label","value","placeholder","appHoverTooltip"],[3,"value"]],template:function(e,t){e&1&&d(0,Fe,2,0),e&2&&c(t.schema().length>0?0:-1)},dependencies:[A,le,z,G,J,B,W,Q],styles:[".field-container[_ngcontent-%COMP%]{position:relative;margin-bottom:0}.helper-text[_ngcontent-%COMP%]{font-size:.875rem;color:var(--ion-color-step-500, #808080);padding:.5rem 1rem .75rem;margin-top:-.5rem;line-height:1.4}.error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger, #eb445a);font-size:.875rem;padding:.5rem 1rem;margin-top:.25rem}"]});var se=h;export{re as a,se as b};
