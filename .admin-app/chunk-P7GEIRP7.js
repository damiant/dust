import{a as se}from"./chunk-53CMCBQX.js";import"./chunk-EB7ZKUPJ.js";import{a as ae}from"./chunk-5EUBO754.js";import"./chunk-DUKSTT3K.js";import{aa as re,c as ie,d as ne,p as oe}from"./chunk-TF5OT4X3.js";import{I as te,e as $,g as k}from"./chunk-CXIDEVKY.js";import{a as ee}from"./chunk-PFLI22GG.js";import{$b as Q,Aa as S,Ba as w,Cc as G,Dc as X,Ea as M,Fa as A,G as r,Ga as V,O as R,Oa as E,Pa as O,W as d,X as m,Yb as z,Zb as W,_b as L,aa as x,ba as a,ca as s,da as c,ec as j,fb as U,ia as y,ka as _,kc as q,lc as H,ma as l,nc as Z,ob as N,p as C,qa as b,ra as I,rb as D,s as u,sa as T,t as p,vc as J,w as P,wc as K,xb as F,yb as B,yc as Y,za as g}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as f}from"./chunk-LNJ3S2LQ.js";var ce=["iEmail"],de=["iCode"];function me(o,t){if(o&1){let e=y();a(0,"ion-buttons",3)(1,"ion-button",13),_("click",function(){u(e);let i=l();return p(i.clear())}),c(2,"ion-icon",14),s()()}}function ue(o,t){if(o&1){let e=y();a(0,"ion-button",13),_("click",function(){u(e);let i=l();return p(i.close())}),c(1,"ion-icon",15),s()}}function pe(o,t){o&1&&c(0,"app-spinner")}function ge(o,t){if(o&1&&(c(0,"img",16),a(1,"div",17)(2,"h1"),g(3),s()()),o&2){let e=l();r(3),S(e.title())}}function fe(o,t){if(o&1&&(c(0,"app-festival-header",18),a(1,"p",8),g(2),s()),o&2){let e=l();x("festival",e.festival),r(2),w(" Sign in using your email address to register or manage camps, art and events of ",e.festival==null?null:e.festival.name," ")}}function _e(o,t){if(o&1&&(a(0,"div",8)(1,"p"),g(2),s()()),o&2){let e=l();r(2),S(e.redirectMessage())}}function he(o,t){if(o&1){let e=y();a(0,"ion-item")(1,"ion-input",19,0),_("keyup.enter",function(){u(e);let i=l();return p(i.next())}),V("ngModelChange",function(i){u(e);let v=l();return A(v.email,i)||(v.email=i),p(i)}),s()(),a(3,"p",20),g(4,"You will be emailed a verification code."),s()}if(o&2){let e=l();r(),M("ngModel",e.email)}}function ve(o,t){if(o&1){let e=y();a(0,"ion-item")(1,"ion-input",21,1),_("keyup.enter",function(){u(e);let i=l();return p(i.next())})("ionInput",function(){u(e);let i=l();return p(i.changed())}),V("ngModelChange",function(i){u(e);let v=l();return A(v.code,i)||(v.code=i),p(i)}),s()(),a(3,"p",20),g(4),s()}if(o&2){let e=l();r(),M("ngModel",e.code),r(3),w(" Enter the verification code that was emailed to ",e.email,". ")}}function ye(o,t){o&1&&c(0,"ion-icon",12)}function Ce(o,t){o&1&&(a(0,"div",22)(1,"p"),g(2,"Just want to download the app?"),s()(),a(3,"div",23)(4,"a",24),c(5,"img",25),s(),a(6,"a",26),c(7,"img",27),s()())}var h=class h{constructor(){this.api=C(te);this.router=C(U);this.email="";this.code="";this.vanity=P("");this.busy=!1;this.redirecting=P(!1);this.redirectType="none";this.emailPage=!0;this.isNative=ee.isNativePlatform();this.alert=C(Y);this.title=E(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"Register a camp";case"event":return"Register an event";default:return"Sign In"}return"Sign In"});this.redirectMessage=E(()=>{if(this.redirecting())switch(this.redirectType){case"camp":return"To register a camp we first need an email address.";case"event":return"To register a event we first need an email address.";default:return""}return""});re({arrowBack:ie,close:oe,arrowForwardOutline:ne}),O(()=>{let t=this.api.openedUrl();if(t=="")return;let e=new URL(t),i=new URLSearchParams(e.search).get("code");(i==null?void 0:i.length)==6&&this.signIn(i)})}ionViewWillEnter(){return f(this,null,function*(){var e;this.vanity.set((e=sessionStorage.sendVanity)!=null?e:""),this.vanity()!==""&&(this.festival=yield this.api.getUnAuthedFestivalByVanity(this.vanity()));let t=this.api.getRedirectionUrl();this.redirectType="none",t&&t.includes("/camps")&&(this.redirectType="camp"),t&&t.includes("/events")&&(this.redirectType="event"),this.redirecting.set(!!t&&t!==""),setTimeout(()=>{this.iUsername.setFocus()},500)})}close(){return f(this,null,function*(){document.location.href="index.html"})}next(){return f(this,null,function*(){if(this.emailPage){if(!this.validateEmail(this.email)){this.presentAlert("The email address is invalid");return}try{this.busy=!0,yield this.api.signIn(this.email),this.emailPage=!1,setTimeout(()=>{this.iCode.setFocus()},500)}finally{this.busy=!1}}else{let t=this.code.toString().padStart(6,"0");if(!this.code||t.length!==6){this.presentAlert("The verification code is incorrect");return}this.signIn(t)}})}signIn(t){return f(this,null,function*(){try{this.busy=!0,yield k(1e3),yield this.api.verify(t),yield k(1e3),this.emailPage=!0,this.code="",this.email="";let e=this.api.getRedirectionUrl();if(this.api.clearCache(),!e||e==""){let n=sessionStorage.sendVanity,i="/all";$(n)||(i=`/${n}`,console.log("sendVanity",i)),this.router.navigateByUrl(i,{replaceUrl:!0})}else{if(e=="none"){this.api.setRedirection("");return}console.log(`Redirect to ${e}`),this.api.setRedirection("none"),this.router.navigateByUrl(e,{replaceUrl:!0})}}finally{this.busy=!1}})}changed(){setTimeout(()=>{let t=`${this.code}`;t.length==6&&this.signIn(t)},500)}presentAlert(t){return f(this,null,function*(){yield(yield this.alert.create({header:"Message",message:t,buttons:["OK"]})).present()})}clear(){this.code="",this.emailPage=!0}validateEmail(t){return!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)}};h.\u0275fac=function(e){return new(e||h)},h.\u0275cmp=R({type:h,selectors:[["app-auth"]],viewQuery:function(e,n){if(e&1&&(b(ce,5),b(de,5)),e&2){let i;I(i=T())&&(n.iUsername=i.first),I(i=T())&&(n.iCode=i.first)}},decls:23,vars:11,consts:[["iEmail",""],["iCode",""],[1,"ion-no-border"],["slot","start"],["slot","end"],[3,"fullscreen"],[1,"border"],[1,"ion-text-center"],[1,"ion-padding"],["lines","none"],[1,"row-center","ion-padding"],["size","large","shape","round","color","primary",1,"wide",3,"click","disabled"],["name","arrow-forward-outline"],[3,"click"],["name","arrow-back"],["size","small","name","close",1,"close"],["src","assets/dust-icon.svg","alt","Dust Icon",1,"icon"],[1,"h1-container"],[3,"festival"],["name","emailAddress","id","emailAddress","type","email","label","Email Address","labelPlacement","stacked",3,"keyup.enter","ngModelChange","ngModel"],[1,"helper"],["type","number","inputMode","numeric","pattern","[0-9]*","label","Verification Code","labelPlacement","stacked",3,"keyup.enter","ionInput","ngModelChange","ngModel"],[1,"footer","pad"],[1,"footer"],["href","https://apps.apple.com/us/app/dust-a-guide-for-burners/id6456943178?itsct=apps_box_badge&itscg=30200"],["src","assets/app-store.svg","alt","Download on the App Store",1,"store"],["href","https://play.google.com/store/apps/details?id=nexus.concepts.dust"],["src","assets/google-play.svg","alt","Download from the Play Store",1,"store"]],template:function(e,n){e&1&&(a(0,"ion-header",2)(1,"ion-toolbar"),d(2,me,3,0,"ion-buttons",3),c(3,"ion-title"),a(4,"ion-buttons",4),d(5,ue,2,0,"ion-button"),s()()(),a(6,"ion-content",5),d(7,pe,1,0,"app-spinner"),a(8,"div",6)(9,"ion-card")(10,"ion-card-content",7),d(11,ge,4,1)(12,fe,3,2),d(13,_e,3,1,"div",8),a(14,"ion-list",9),d(15,he,5,1)(16,ve,5,2),a(17,"ion-item")(18,"div",10)(19,"ion-button",11),_("click",function(){return n.next()}),g(20),d(21,ye,1,0,"ion-icon",12),s()()()()()(),d(22,Ce,8,0),s()()),e&2&&(r(2),m(n.emailPage?-1:2),r(3),m(n.isNative?5:-1),r(),x("fullscreen",!0),r(),m(n.busy?7:-1),r(4),m(n.vanity()===""?11:12),r(2),m(n.redirecting()?13:-1),r(2),m(n.emailPage?15:16),r(4),x("disabled",n.busy),r(),w("",n.emailPage?"Next":"Sign In"," "),r(),m(n.emailPage?21:-1),r(),m(n.vanity()!==""?22:-1))},dependencies:[W,G,B,N,F,D,q,K,J,j,se,L,Q,Z,H,X,z,ae],styles:["h1[_ngcontent-%COMP%]{font-size:var(--fr2);color:var(--ion-color-primary)}.h1-container[_ngcontent-%COMP%]{width:100%;border-radius:.5rem;display:flex;align-items:center;justify-content:center;margin-left:auto;margin-right:auto}p[_ngcontent-%COMP%]{font-size:var(--fr3)}@media (min-width: 801px){ion-card[_ngcontent-%COMP%]{margin-left:100px;margin-right:100px}}.helper[_ngcontent-%COMP%]{font-size:var(--fs5);color:var(--ion-text-color)}ion-button.wide[_ngcontent-%COMP%]{width:200px}.close[_ngcontent-%COMP%]{color:#fff!important}.store[_ngcontent-%COMP%]{height:45px}.footer[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1rem}.icon[_ngcontent-%COMP%]{width:100px}.pad[_ngcontent-%COMP%]{padding-top:1rem}"]});var le=h;export{le as AuthPage};
