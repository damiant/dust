import{a as xe}from"./chunk-HMUPGG3O.js";import{a as we}from"./chunk-MUQ6OKB5.js";import"./chunk-QTBNLBDF.js";import{a as Ee}from"./chunk-UI6RM4UC.js";import{a as ge}from"./chunk-K32ZFYDX.js";import{a as Ce}from"./chunk-HSD7DC6Q.js";import{a as ve}from"./chunk-RAA3KX6C.js";import{a as _e}from"./chunk-IWMP2PAE.js";import"./chunk-TUKQZ63R.js";import{S as ue,Y as fe,a as he}from"./chunk-IKEGAJLW.js";import{F as pe,a as ce,g as me,l as v,n as V,t as M,w as de}from"./chunk-CP2LIZQM.js";import"./chunk-MIGJGGKJ.js";import{A as C,B as x,Bc as re,Ca as m,Da as I,Ea as b,Fa as D,Fc as se,Gc as le,Ha as U,Ia as B,Ja as L,Ma as R,Qb as Y,S as r,T as y,Va as F,Xb as G,Y as k,Yb as H,Za as Z,aa as _,cb as $,dc as K,ea as p,eb as N,fb as J,ha as h,ib as j,ja as O,jc as Q,ka as A,kc as X,la as s,lc as ee,ma as l,mc as te,na as f,nb as q,pa as S,qa as E,qb as z,qc as ie,ra as c,tc as ne,uc as oe,vc as ae,xb as W}from"./chunk-PHUHKYQ4.js";import"./chunk-ATW7DGUS.js";import"./chunk-7KGURMOZ.js";import"./chunk-UXWCR2YA.js";import"./chunk-QYFQMV2H.js";import"./chunk-ORVKXEJA.js";import"./chunk-KBMMZLX2.js";import"./chunk-5J6JP6Q2.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as u}from"./chunk-LNJ3S2LQ.js";var Se=(i,t)=>t.id,Ie=(i,t)=>t.name,be=i=>[i];function Te(i,t){if(i&1){let e=S();s(0,"ion-toolbar")(1,"ion-searchbar",11),E("ionInput",function(n){C(e);let a=c();return x(a.handleSearch(n))}),l()()}if(i&2){let e=c();r(),p("debounce",600)("placeholder","Search events at "+e.title)}}function Pe(i,t){i&1&&f(0,"app-spinner")}function Oe(i,t){if(i&1&&(s(0,"div",12)(1,"app-card",15),f(2,"app-img",16),s(3,"ion-button",17),m(4," Register Event "),l()()()),i&2){let e=c(2);p("ngClass",e.events.length>0?"":"pad-vertical"),r(),p("description","You can register your event for "+e.title+"."),r(),p("width","100px")("height","100px")("src",e.imageUrl),r(),p("routerLink",e.newRoute())}}function Ae(i,t){if(i&1&&(s(0,"ion-segment-button",20)(1,"ion-label"),m(2),l()()),i&2){let e=t.$implicit;p("value",e.name),r(2),I(e.title)}}function Ve(i,t){if(i&1){let e=S();s(0,"ion-toolbar")(1,"ion-buttons",1)(2,"ion-segment",19),L("ngModelChange",function(n){C(e);let a=c(3);return B(a.showing,n)||(a.showing=n),x(n)}),E("ionChange",function(){C(e);let n=c(3);return x(n.refresh())}),O(3,Ae,3,2,"ion-segment-button",20,Ie),l()()()}if(i&2){let e=c(3);r(2),U("ngModel",e.showing),p("value",e.showing),r(),A(e.filters)}}function Me(i,t){i&1&&(s(0,"ion-item"),m(1," There are no events matching your search. "),l())}function ke(i,t){if(i&1){let e=S();s(0,"ion-item",21)(1,"h2"),m(2,"Getting Started"),l()(),s(3,"ion-item"),m(4," Click \xA0"),s(5,"a",22),E("click",function(){C(e);let n=c(5);return x(n.newEvent())}),m(6,"Add Event"),l(),m(7),l()}if(i&2){let e=c(5);r(7),b("\xA0 to create your first event at ",e.title,". ")}}function De(i,t){if(i&1&&_(0,ke,8,1),i&2){let e=c(4);h(e.isAdmin?0:-1)}}function Ue(i,t){if(i&1&&_(0,Me,2,0,"ion-item")(1,De,1,1),i&2){let e=c(3);h(e.filteredBySearch?0:1)}}function Be(i,t){if(i&1&&(s(0,"ion-item")(1,"ion-text",23),m(2),l()()),i&2){let e=c(3);r(2),b("Time Zone ",e.diffTimeZone,"")}}function Le(i,t){if(i&1&&(s(0,"p",29),m(1),l(),s(2,"p",30),m(3),l()),i&2){let e=c().$implicit;r(),D("",e.camp,"",e.art,""),r(2),I(e.other_location)}}function Re(i,t){if(i&1&&(s(0,"ion-item",18),f(1,"app-img",24),s(2,"ion-label",25),_(3,Le,4,3),m(4),l(),s(5,"ion-label",26)(6,"p",27),m(7),l(),s(8,"p",28),m(9),l()()()),i&2){let e=t.$implicit,o=c(3);p("routerLink","../events/"+R(8,be,e.id)),r(),p("width","45px")("height","45px")("src",o.image(e)),r(2),h(!o.campId&&!o.artId?3:-1),r(),b(" ",e.title," "),r(3),I(e.event_type),r(2),I(e.timeString)}}function Fe(i,t){if(i&1&&(s(0,"app-image-card",13),_(1,Ve,5,2,"ion-toolbar"),s(2,"ion-list"),_(3,Ue,2,1)(4,Be,3,1,"ion-item"),O(5,Re,10,10,"ion-item",18,Se),l()()),i&2){let e=c(2);p("url",e.getImageUrl()),r(),h(!e.campId&&!e.artId?1:-1),r(2),h(e.events.length===0?3:e.diffTimeZone?4:-1),r(2),A(e.events)}}function Ze(i,t){if(i&1&&(_(0,Oe,5,6,"div",12)(1,Fe,7,3,"app-image-card",13),f(2,"div",14)(3,"div",14)),i&2){let e=c();h(e.events.length===0&&!e.filteredBySearch&&!e.isAdmin?0:1)}}function $e(i,t){if(i&1){let e=S();s(0,"app-footer",31),E("press",function(){C(e);let n=c();return x(n.newEvent())}),l()}}var w=class w{constructor(t,e,o,n){this.api=t;this.router=e;this.eventService=o;this.route=n;this.events=[];this.title="Events";this.busy=!0;this.isAdmin=!1;this.imageUrl="";this.newEventUrl="../events/new";this.description="";this.diffTimeZone="";this.showing="all";this.showSearch=!0;this.canEditEvent=!1;this.buttons=[];this.filteredBySearch=!1;this.filters=[];fe({add:he,printOutline:ue})}filtered(t,e,o,n,a){var g;let d=!0;return t=="mine"?(g=n.contact)!=null&&g.startsWith("***")&&(d=!1):t!=="all"&&(d=this.hasDay(n,t,a)),e&&v(n.hosted_by_camp)!==v(e)&&(d=!1),o&&v(n.located_at_art)!==v(o)&&(d=!1),d}importCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.router.navigateByUrl("./import-events")})}exportCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.exportToCSV()})}ngOnInit(){return u(this,null,function*(){var t;try{this.busy=!0,yield this.api.setFestivalByVanity(this.vanity,!0),this.campId=v(this.route.snapshot.queryParams.camp),this.artId=v(this.route.snapshot.queryParams.art),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.imageUrl=(t=this.api.imageURL(this.api.festivalImage()))!=null?t:"",this.camp=this.campId?yield this.api.getCamp(this.campId):void 0,this.art=this.artId?yield this.api.getArt(this.artId):void 0,this.title=this.camp?this.camp.name:this.api.festivalTitle(),this.canEditEvent=this.api.eventEditing()||this.isAdmin,this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"}]:[],this.art&&(this.title=this.art.name),this.diffTimeZone=this.api.currentTimeZone()==this.api.festivalTimeZone()?"":this.api.festivalTimeZone(),yield this.api.setFestivalByVanity(this.vanity),yield this.refresh(),this.showSearch=this.events.length>1,this.description=this.events.length==0?`There are no events yet for ${this.title}`:`Events for ${this.title}`}finally{this.busy=!1}})}ionViewDidEnter(){return u(this,null,function*(){for(;this.busy;)yield me(500);yield this.refresh()})}newRoute(){return this.canEditEvent?"../events/new":void 0}message(t){setTimeout(()=>{this.api.sendMessage(t)},1)}handleSearch(t){return u(this,null,function*(){let e=t.target.value.toLowerCase().trim(),o=this.cleanEvents(yield this.api.events({cached:!0}),!1);this.events=o.filter(n=>{var a;return n.title.toLowerCase().includes(e)||((a=n.camp)==null?void 0:a.toLowerCase().includes(e))}),this.filteredBySearch=e.length>0})}image(t){return this.api.imageURL(t.imageUrl)}newEvent(){this.router.navigate(["./new"],{queryParams:{camp:this.campId,art:this.artId},relativeTo:this.route})}festivalImage(){return this.api.imageURL(this.api.festivalImage())}refresh(){return u(this,null,function*(){this.filters=[],this.events=this.cleanEvents(yield this.api.events({cached:!0}),!1),this.filteredBySearch=!1,this.filters.find(t=>t.name=="mine")||this.filters.unshift({title:"All",name:"all"},{title:"Mine",name:"mine"})})}exportToCSV(){return u(this,null,function*(){let t=this.showing!=="all",e=this.cleanEvents(yield this.api.events({cached:!0}),t);yield this.eventService.exportEventsToCSV(this.api.festivalTitle(),e,this.api.currentTimeZone(),this.showing)})}getImageUrl(){var t;return this.camp&&this.camp.imageUrl?this.api.imageURL(this.camp.imageUrl):this.art&&((t=this.art)!=null&&t.imageUrl)?this.api.imageURL(this.art.imageUrl):this.festivalImage()}addFiltersForDays(t){let e=new Date(t.start_time),o=`${e.getDate()} (${de[e.getDay()]})`;this.filters.find(a=>a.title==o)||(this.filters.push({title:o,name:this.nameOf(e)}),this.filters.sort((a,d)=>a.name>d.name?1:-1))}hasDay(t,e,o){let n=JSON.parse(t.occurrence_set);if(o){let a=[];for(let d of n)e==this.nameOf(new Date(d.start_time))&&a.push(d);if(a.length>0)return t.occurrence_set=JSON.stringify(a),!0}else for(let a of n)if(e==this.nameOf(new Date(a.start_time)))return!0;return!1}nameOf(t){return`${t.getDate()}-${t.getMonth()}-${t.getFullYear()}`}cleanEvents(t,e){var o;for(let n of t){let a=JSON.parse(n.occurrence_set);this.goodDates(a)||console.error(`${n.title} has bad dates`);let d=V(a[0].start_time),g=V(a[0].end_time),T=this.api.currentTimeZone();n.timeString=(o=ce(d,g,void 0,T))==null?void 0:o.long,a.length>1&&(n.timeString+=` (+${a.length-1} other occurrence)`);for(let P of a)this.addFiltersForDays(P)}return t.sort((n,a)=>{let d=JSON.parse(n.occurrence_set),g=JSON.parse(a.occurrence_set),T=new Date(d[0].start_time),P=new Date(g[0].start_time);return T-P}),t.filter(n=>this.filtered(this.showing,this.campId,this.artId,n,e))}signOut(){return u(this,null,function*(){this.api.signOut(),this.router.navigateByUrl("/auth")})}goodDates(t){for(let e of t)if(M(e.start_time)!=e.start_time||M(e.end_time)!=e.end_time)return!1;return!0}};w.\u0275fac=function(e){return new(e||w)(y(pe),y(N),y(we),y($))},w.\u0275cmp=k({type:w,selectors:[["app-events"]],inputs:{vanity:"vanity"},decls:17,vars:7,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../events/new"],["name","add"],[3,"buttons"],[3,"fullscreen"],[1,"border"],["title","Add Event"],["title","Add Event",3,"click"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],[1,"ion-text-center",3,"ngClass"],["routeTo","../events/new",3,"url"],[1,"ion-padding"],["title","Event Registration",3,"description"],["logo","",1,"logo","ion-padding",3,"width","height","src"],["shape","round",3,"routerLink"],[3,"routerLink"],["mode","ios",2,"float","right","margin-right","0.5rem","margin-top","0.5rem","width","100%",3,"ngModelChange","ionChange","ngModel","value"],[3,"value"],["lines","none"],[3,"click"],["color","medium","slot","end",2,"text-transform","uppercase","font-size","small"],[1,"clickable","pad-right",3,"width","height","src"],[1,"ion-text-wrap"],[1,"ion-text-right","ion-text-wrap","last-col"],[1,"one-line","sz-large"],["color","medium",1,"time"],[1,"title"],[1,"title","highlight"],["title","Add Event",3,"press"]],template:function(e,o){e&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),f(3,"ion-back-button"),l(),s(4,"ion-title",2),m(5),l(),s(6,"ion-buttons",3)(7,"ion-button",4),f(8,"ion-icon",5),l(),f(9,"app-side",6),l()()(),s(10,"ion-content",7),_(11,Te,2,2,"ion-toolbar")(12,Pe,1,0,"app-spinner"),s(13,"div",8),_(14,Ze,4,1)(15,$e,1,0,"app-footer",9),l(),s(16,"app-footer",10),E("click",function(){return o.newEvent()}),l()()),e&2&&(r(5),b("Events at ",o.title,""),r(4),p("buttons",o.buttons),r(),p("fullscreen",!0),r(),h(o.showSearch?11:-1),r(),h(o.busy?12:-1),r(2),h(o.busy?-1:14),r(),h(o.events.length!==0&&!o.filteredBySearch?15:-1))},dependencies:[ne,se,Ee,_e,le,ie,Z,F,W,q,z,j,J,Q,ae,H,Y,oe,G,K,re,te,X,ee,Ce,ge,ve,xe],styles:["ion-fab[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:20px}ion-fab-button[_ngcontent-%COMP%]{margin-top:-35px;padding:5px}ion-item[_ngcontent-%COMP%]{cursor:pointer}.title[_ngcontent-%COMP%]{font-size:var(--fs4)}.highlight[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.one-line[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}app-img[_ngcontent-%COMP%]{--border-radius: 5px}.last-col[_ngcontent-%COMP%]{max-width:25%}@media (width < 500px){.sz-large[_ngcontent-%COMP%]{display:none}}.pad-right[_ngcontent-%COMP%]{width:55px}"]});var ye=w;export{ye as EventsPage};
