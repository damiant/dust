import{F as $}from"./chunk-MPA3GIYF.js";import"./chunk-XMQYHBKU.js";import{$ as d,D as _,F as P,G as a,I as h,Kb as U,L as w,Pa as L,Rb as D,Sb as F,V as x,W as M,Xa as O,Y as C,Z as I,Zb as H,_ as A,aa as o,ba as s,ca as v,dc as Q,ea as S,fa as y,ga as E,ka as k,la as T,ma as z,oc as j,pc as N,qa as b,rb as R,s as c,sa as u,t as m,ta as V,ua as B}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as g}from"./chunk-LNJ3S2LQ.js";var J=["map"];function X(l,i){if(l&1&&(o(0,"div",11)(1,"div",12),u(2),s()()),l&2){let e=i.$implicit;b("left",e.x+"px")("top",e.y+"px"),d("title",e.label),a(2),V(e.label)}}function Y(l,i){if(l&1&&v(0,"div",13),l&2){let e=E();b("left",e.pin.x+"px")("top",e.pin.y+"px"),d("title",e.pin.label)}}var p=class p{constructor(i,e,t){this.api=i;this.sanitizer=e;this.location=t;this.artItem={name:"",category:"",description:"",pin:"",id:void 0,contact_email:"",art_type:""};this.mapUri="";this.pt={x:0,y:0};this.pins=[];this.art=[]}ionViewWillEnter(){return g(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.artItem=yield this.api.getArt(this.id);let i=yield this.api.getMap();i.base64?this.mapUri=this.sanitizer.bypassSecurityTrustUrl(i.base64):this.mapUri=this.api.imageURL(`${this.vanity}/${i.filename}`),this.art=yield this.api.art({cached:!0})})}onResize(){this.pins=this.getPins(this.art)}onMapLoad(){this.pins=this.getPins(this.art)}mapPoint(i){let e=i.clientX,t=i.clientY,r=this.map.nativeElement.getBoundingClientRect(),f=(e-r.x)*1e4/r.width,q=(t-r.y)*1e4/r.height;return this.pt={x:Math.ceil(f),y:Math.ceil(q)},this.pin={x:this.pt.x*this.width()/1e4,y:this.pt.y*this.height()/1e4,label:this.artItem.name},!1}width(){return this.map.nativeElement.getBoundingClientRect().width}height(){return this.map.nativeElement.getBoundingClientRect().height}getPins(i){let e=[];for(let t of i)if(t.pin&&t.pin.trim()!=""){let n=JSON.parse(t.pin);e.push({x:n.x*this.width()/1e4,y:n.y*this.height()/1e4,label:t.name})}return e}save(){return g(this,null,function*(){yield this.api.placeArt(this.id,this.pt),this.api.clearCache(),this.location.back()})}};p.\u0275fac=function(e){return new(e||p)(h($),h(O),h(L))},p.\u0275cmp=w({type:p,selectors:[["app-art-map"]],viewQuery:function(e,t){if(e&1&&k(J,5),e&2){let n;T(n=z())&&(t.map=n.first)}},inputs:{vanity:"vanity",id:"id"},decls:17,vars:4,consts:[["map",""],["color","primary"],["slot","start"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"page2"],[1,"map"],[1,"pin",3,"title","left","top"],[1,"placed","pin",3,"title","left","top"],[3,"resize","load","click","src"],[1,"pin",3,"title"],[1,"label"],[1,"placed","pin",3,"title"]],template:function(e,t){if(e&1){let n=S();o(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),v(3,"ion-back-button"),s(),o(4,"ion-title"),u(5),s(),o(6,"ion-buttons",3)(7,"ion-button",4),y("click",function(){return c(n),m(t.save())}),u(8,"Save"),s()()()(),o(9,"ion-content",5)(10,"div",6)(11,"div",7),I(12,X,3,6,"div",8,C),x(14,Y,1,5,"div",9),s(),o(15,"img",10,0),y("resize",function(){return c(n),m(t.onResize())},P)("load",function(){return c(n),m(t.onMapLoad())})("click",function(f){return c(n),m(t.mapPoint(f))}),s()()()}e&2&&(a(5),B("Place ",t.artItem.name," on Map"),a(4),d("fullscreen",!0),a(3),A(t.pins),a(2),M(t.pin?14:-1),a(),d("src",t.mapUri,_))},dependencies:[R,Q,N,F,U,j,D,H],styles:["img[_ngcontent-%COMP%]{user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-drag:none;-webkit-user-select:none;-ms-user-select:none}.placed[_ngcontent-%COMP%]{background-color:red!important;border:2px solid white!important;width:15px;height:15px;border-radius:15px}.pin[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:10px;background-color:#fff;border:2px solid red;position:absolute}.pin[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{visibility:hidden;width:200px;margin-left:10px;margin-top:-5px}.pin[_ngcontent-%COMP%]:hover   .label[_ngcontent-%COMP%]{visibility:visible}.map[_ngcontent-%COMP%]{position:absolute}"]});var W=p;export{W as ArtMapPage};
