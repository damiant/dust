import{a as Te}from"./chunk-LYUQCJHP.js";import{a as Ee}from"./chunk-5GN327OO.js";import{b as F}from"./chunk-QTBNLBDF.js";import{a as we}from"./chunk-JZDWCQD5.js";import{a as Pe}from"./chunk-PEIKAUDK.js";import{a as Se}from"./chunk-ISEFS2E5.js";import{a as be}from"./chunk-IZLYP3IF.js";import{a as ve}from"./chunk-ROJXBKDX.js";import{b as xe}from"./chunk-OZ2IKH4J.js";import"./chunk-NBGQYW5Y.js";import"./chunk-HTUMMCB5.js";import"./chunk-I4H34LCA.js";import"./chunk-GDAPN2EF.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-STA5XHHU.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-3QBWF6TQ.js";import"./chunk-MCRJI3T3.js";import"./chunk-GTAO53MO.js";import"./chunk-JEOCIQEZ.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-W4BNGQYG.js";import{A as fe,H as ge,J as _e,Y as ye,a as Ce}from"./chunk-IKEGAJLW.js";import{D as V,F as he,G as T,e as ue}from"./chunk-YDFKN7Z7.js";import"./chunk-XMQYHBKU.js";import{$ as r,$a as Q,Ea as v,G as a,I as _,Ia as K,Kb as W,L as $,Qa as q,Rb as J,Sb as X,Tb as Z,Ua as Y,Ub as ee,V as h,Vb as ie,W as C,Xb as te,Z as R,Zb as ne,_ as A,_a as D,aa as s,ba as c,ca as m,cb as z,dc as ae,ea as M,ec as oe,fa as P,ga as l,gc as re,ic as se,ka as N,l as U,la as j,ma as G,nc as ce,oc as pe,p as b,pc as le,rb as H,s as S,sa as f,t as w,ua as E,vc as me,w as O,zc as de}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as u}from"./chunk-LNJ3S2LQ.js";var g=class g{constructor(){this.api=b(T)}exportCampsToCSV(t,e){let n=[];for(let p of e)n.push({id:p.id,name:p.name,description:p.description,email:p.contact_email,placed:p.pin!=""?"Yes":"No"});let o=V(t.toLowerCase()," ","-");F(`${o}-camps.csv`,n)}exportCampsEmail(t,e){let n=[];for(let p of e)ue(p.contact_email)||n.push({email:p.contact_email});if(n.length==0){this.api.sendMessage("No Camps have email addresses to be exported.");return}let o=V(t.toLowerCase()," ","-");F(`${o}-camp-email.txt`,n,{stripQuotes:!0,hideHeaders:!0})}};g.\u0275fac=function(e){return new(e||g)},g.\u0275prov=U({token:g,factory:g.\u0275fac,providedIn:"root"});var I=g;var Me=["kmlUpload"],Ve=i=>[i],k=i=>({camp:i}),ke=(i,t)=>t.id;function Fe(i,t){if(i&1){let e=M();s(0,"ion-toolbar")(1,"ion-searchbar",13),P("ionInput",function(o){S(e);let p=l();return w(p.handleSearch(o))}),c(),s(2,"ion-button",14),P("click",function(){S(e);let o=l();return w(o.toggleGrid())}),m(3,"ion-icon",15),c()()}if(i&2){let e=l();a(),r("debounce",600)("placeholder","Search camps at "+e.title),a(2),r("name",e.isGrid?"list-outline":"grid-outline")}}function Be(i,t){if(i&1&&m(0,"ion-progress-bar",9),i&2){let e=l();r("value",e.progress)}}function Ue(i,t){if(i&1&&m(0,"app-card",17),i&2){let e=l(3);r("title",e.filteredBySearch?"No Camps Found":"No Camps")("description",e.filteredBySearch?"No camps found matching that search":"There are no theme camps registered for "+e.festivalTitle)}}function Oe(i,t){if(i&1&&h(0,Ue,1,2,"app-card",17),i&2){let e=l(2);C(e.camps.length===0?0:-1)}}function $e(i,t){if(i&1&&(s(0,"app-card",18),m(1,"app-img",20),s(2,"ion-button",21),f(3," Register Camp "),c()()),i&2){let e=l(3);r("description","Camp registration for "+e.festivalTitle+" is open."),a(),r("width","100px")("height","100px")("src",e.imageUrl),a(),r("routerLink",e.newRoute())}}function Ne(i,t){if(i&1&&m(0,"app-card",19),i&2){let e=l(3);r("description",e.camps.length===0?"Registration for camps at "+e.festivalTitle+" have been disabled. You cannot register a camp at this time.":"Changes to camps at "+e.festivalTitle+" have been disabled. You cannot make any changes at this time.")}}function je(i,t){if(i&1&&h(0,$e,4,5,"app-card",18)(1,Ne,1,1,"app-card",19),i&2){let e=l(2);C(e.camps.length===0&&e.api.campRegistration()?0:!e.api.campRegistration()&&!e.api.campEditing()?1:-1)}}function Ge(i,t){i&1&&(s(0,"ion-button",27),m(1,"ion-icon",31),c())}function Ke(i,t){if(i&1&&(s(0,"div",23)(1,"ion-card",24),m(2,"app-img",25),s(3,"ion-card-header",26)(4,"ion-card-title"),f(5),h(6,Ge,2,0,"ion-button",27),c()(),s(7,"ion-card-content"),f(8),s(9,"div",28)(10,"ion-button",29),f(11,"Edit"),c(),s(12,"ion-button",30),f(13,"Events"),c(),s(14,"ion-button",30),f(15,"Music"),c()()()()()),i&2){let e=t.$implicit,n=l(4);a(2),r("routerLink",n.editRoute(e))("src",n.image(e)),a(),r("routerLink",n.editRoute(e)),a(2),E("",e.name," "),a(),C(e.pin?6:-1),a(2),E(" ",e.description," "),a(2),r("disabled",!n.canEditCamp)("routerLink","../camp/"+v(14,Ve,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",v(16,k,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../music")("queryParams",v(18,k,e.id))}}function qe(i,t){if(i&1&&(s(0,"div",22),R(1,Ke,16,20,"div",23,ke),c()),i&2){let e=l(3);r("ngClass",e.camps.length>1?"grid":"grid1"),a(),A(e.camps)}}function Ye(i,t){i&1&&m(0,"ion-icon",31)}function De(i,t){if(i&1&&(s(0,"ion-item"),m(1,"app-img",34),s(2,"ion-text",35),f(3),h(4,Ye,1,0,"ion-icon",31),c(),s(5,"div",4)(6,"ion-button",30),f(7,"Events"),c(),s(8,"ion-button",30),f(9,"Music"),c()()()),i&2){let e=t.$implicit,n=l(4);a(),r("width","45px")("height","45px")("routerLink",n.editRoute(e))("src",n.image(e)),a(),r("routerLink",n.editRoute(e)),a(),E(" ",e.name," "),a(),C(e.pin?4:-1),a(2),r("disabled",!n.canEditEvent)("routerLink","../events")("queryParams",v(13,k,e.id)),a(2),r("disabled",!n.canEditEvent)("routerLink","../music")("queryParams",v(15,k,e.id))}}function Qe(i,t){if(i&1&&(s(0,"div",32)(1,"ion-card")(2,"ion-list"),R(3,De,10,17,"ion-item",null,ke),c()()(),m(5,"div",33)(6,"div",33)),i&2){let e=l(3);a(3),A(e.camps)}}function ze(i,t){if(i&1&&h(0,qe,3,1,"div",22)(1,Qe,7,0),i&2){let e=l(2);C(e.isGrid?0:1)}}function He(i,t){if(i&1&&(s(0,"div",10)(1,"div",16),h(2,Oe,1,1)(3,je,2,1),c(),h(4,ze,2,1),c()),i&2){let e=l();a(),r("ngClass",e.camps.length>0?"":"pad-vertical"),a(),C(e.isAdmin?2:3),a(2),C(e.camps.length>0?4:-1)}}function We(i,t){i&1&&m(0,"app-spinner")}function Je(i,t){if(i&1&&m(0,"app-footer",11),i&2){let e=l();r("routeTo",e.newRoute())}}var x=class x{constructor(t,e,n,o,p){this.api=t;this.router=e;this.campService=n;this.store=o;this.kml=p;this.camps=[];this.busy=!0;this.isAdmin=!1;this.title="";this.festivalTitle="";this.canRegister=!1;this.canEditCamp=!1;this.canAddCamp=!1;this.canEditEvent=!1;this.filteredBySearch=!1;this.imageUrl="";this.isGrid=!1;this.buttons=[];this.alert=b(be);this.mapChanges=O({camps:[],art:[],pins:[],newCamps:[],newArt:[]});ye({add:Ce,locationSharp:_e,listOutline:ge,gridOutline:fe}),K(()=>u(this,null,function*(){let d=this.mapChanges();if(d.camps.length==0&&d.newCamps.length==0&&d.pins.length==0)return;this.busy=!0;let y=d.camps.length,B=0;for(let L of d.camps)B++,yield this.api.addCamp(L,!0),this.progress=B/y;if(d.pins.length>0){let L=yield this.api.getPins();yield this.api.placePins(this.deduplicate(L,d.pins))}this.busy=!1,console.log(d);let Le=yield this.importNewCamps(d.newCamps);this.message(`${d.camps.length} camp changes made. ${d.pins.length} restrooms added. ${Le} new camps added.`),this.api.clearCache(),this.ionViewDidEnter()}))}deduplicate(t,e){let n=t;for(let o of e)t.find(p=>p.label==o.label&&p.gpsLat==o.gpsLat&&p.gpsLng==o.gpsLng)||n.push(o);return n}message(t){setTimeout(()=>{this.api.sendMessage(t)},1)}importCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.router.navigateByUrl("./import")})}importKML(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.kmlUpload.nativeElement.click()})}exportCSV(){return()=>u(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.exportToCSV()})}toggleGrid(){this.isGrid=!this.isGrid,this.store.set("isGrid",`${!this.isGrid}`)}ngOnInit(){return u(this,null,function*(){var t;yield this.api.setFestivalByVanity(this.vanity,!0),this.title=`${this.api.festivalTitle()}`,this.festivalTitle=this.api.festivalTitle(),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.imageUrl=(t=this.api.imageURL(this.api.festivalImage()))!=null?t:"",this.canAddCamp=this.api.campRegistration()||this.isAdmin,this.canEditCamp=this.api.campRegistration()||this.api.campEditing()||this.isAdmin,this.canEditEvent=this.api.campRegistration()||this.api.eventEditing()||this.isAdmin,this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"},{title:"Export Email Addresses",method:this.exportEmail(),icon:"mail-outline"},{title:"Import KML",method:this.importKML(),icon:"cloud-upload-outline"}]:[],this.isGrid=this.store.get("isGrid")!=="true"})}exportEmail(){return()=>u(this,null,function*(){this.campService.exportCampsEmail(this.festivalTitle,this.camps)})}ionViewDidEnter(){return u(this,null,function*(){this.camps=yield this.api.camps({cached:!0}),this.filteredBySearch=!1,this.busy=!1})}handleSearch(t){return u(this,null,function*(){let e=t.target.value.toLowerCase(),n=yield this.api.camps({cached:!0});this.camps=n.filter(o=>o.name.toLowerCase().includes(e)),this.filteredBySearch=e.length>0})}editRoute(t){return this.canEditCamp?"../camp/"+t.id:void 0}newRoute(){return this.canEditCamp?"../camp/new":void 0}image(t){return t.imageUrl?this.api.imageURL(t.imageUrl):"./assets/camp.svg"}exportToCSV(){this.campService.exportCampsToCSV(this.festivalTitle,this.camps)}onKMLSelected(t){return u(this,null,function*(){if(!this.isAdmin){this.api.sendMessage("You do not have access rights to this feature.");return}let e=t.target.files[0];if(!e)return;let n=new FileReader;n.onload=o=>u(this,null,function*(){var y;let p=(y=o.target)==null?void 0:y.result,d=this.kml.parse(p,this.camps);this.mapChanges.set(d)}),n.readAsText(e)})}importNewCamps(t){return u(this,null,function*(){let e=0;if(t.length==0)return 0;for(let n of t){let o=yield xe(this.alert,`Create Camp "${n.name}" ?`,"Create");if(o=="Create"&&(yield this.api.addCamp(n,!0),e++),o=="Cancel")return e}return e})}};x.\u0275fac=function(e){return new(e||x)(_(T),_(D),_(I),_(he),_(Te))},x.\u0275cmp=$({type:x,selectors:[["app-camps"]],viewQuery:function(e,n){if(e&1&&N(Me,7),e&2){let o;j(o=G())&&(n.kmlUpload=o.first)}},inputs:{vanity:"vanity"},decls:18,vars:7,consts:[["kmlUpload",""],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../camp/new",3,"hidden"],["name","add"],[3,"buttons"],[3,"fullscreen"],[3,"value"],[1,"large-border"],["title","Add Camp",3,"routeTo"],["type","file",1,"file-input",3,"change"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],["color","dark","fill","clear","slot","end",3,"click"],[3,"name"],[1,"ion-text-center",3,"ngClass"],[3,"title","description"],["title","Registration",3,"description"],["title","Camp Registration",3,"description"],["logo","",1,"logo","ion-padding",3,"width","height","src"],["shape","round",3,"routerLink"],[1,"pad-below",3,"ngClass"],[1,"grid-item"],[1,"clickable"],[3,"routerLink","src"],[3,"routerLink"],["fill","clear","color","light",2,"position","absolute","margin-top","-3px"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["color","secondary",3,"disabled","routerLink"],["color","secondary",3,"disabled","routerLink","queryParams"],["size","small","name","location-sharp",1,"pin"],[1,"border"],[1,"ion-padding"],[1,"clickable",2,"min-width","45px",3,"width","height","routerLink","src"],[1,"clickable",2,"width","100%","padding","1rem",3,"routerLink"]],template:function(e,n){if(e&1){let o=M();s(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),m(3,"ion-back-button"),c(),s(4,"ion-title",3),f(5,"Camps"),c(),s(6,"ion-buttons",4)(7,"ion-button",5),m(8,"ion-icon",6),c(),m(9,"app-side",7),c()()(),s(10,"ion-content",8),h(11,Fe,4,3,"ion-toolbar"),h(12,Be,1,1,"ion-progress-bar",9),h(13,He,5,3,"div",10)(14,We,1,0,"app-spinner"),h(15,Je,1,1,"app-footer",11),s(16,"input",12,0),P("change",function(d){return S(o),w(n.onKMLSelected(d))}),c()()}e&2&&(a(7),r("hidden",!n.canAddCamp),a(2),r("buttons",n.buttons),a(),r("fullscreen",!0),a(),C(n.camps.length>1||n.filteredBySearch?11:-1),a(),C(n.progress?12:-1),a(),C(n.busy?14:13),a(2),C(n.isAdmin?15:-1))},dependencies:[ce,de,se,Se,Y,q,H,z,Q,ae,le,X,W,pe,J,ne,me,Z,ie,te,ee,Ee,re,oe,ve,Pe,we],styles:["ion-card-title[_ngcontent-%COMP%]{font-size:1.5rem!important}ion-card-content[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:var(--fs4)}h1[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.pin[_ngcontent-%COMP%]{color:var(--ion-color-primary);opacity:.5}.logo[_ngcontent-%COMP%]{--app-background-color: transparent;--border-radius: .5rem}app-img[_ngcontent-%COMP%]{--border-radius: 5px}ion-text[_ngcontent-%COMP%]{font-size:var(--fs4)}"]});var Ie=x;export{Ie as CampsPage};
