import{a as pe}from"./chunk-HEIPDGQ7.js";import{a as he}from"./chunk-FMJXCHDZ.js";import{a as _e}from"./chunk-TTWNFMJ5.js";import{a as ue}from"./chunk-YZZAMJVJ.js";import{a as le}from"./chunk-LADCEZG6.js";import"./chunk-5Z4O26VQ.js";import"./chunk-FJQ4E5GO.js";import"./chunk-7FPDBCWT.js";import"./chunk-JYXYGJZQ.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-YRQXWVV7.js";import"./chunk-NPRM7GGH.js";import"./chunk-52VTL4OE.js";import"./chunk-VBU7NMPV.js";import"./chunk-2GEO6OXL.js";import"./chunk-MCRJI3T3.js";import"./chunk-74YXDZAV.js";import"./chunk-YYXGO6RB.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import{R as de,b as ce,m as me}from"./chunk-OAPJ7RFL.js";import{a as oe,j as A,k as M,m as D,n as re,q as ae,y as se}from"./chunk-KCTXO3XO.js";import{$ as b,A as d,Aa as p,B as u,Ba as V,Fa as w,Ga as C,Ha as y,Kb as J,Pb as R,Qb as Z,Rb as $,S as c,Sa as L,Sb as H,T,X as W,Xb as U,ab as z,bc as G,cc as K,da as h,ec as Q,ga as S,gb as B,ha as N,ia as P,ja as O,jc as X,ka as a,la as s,lb as F,ma as k,mb as j,mc as Y,nc as ee,oa as x,pa as _,qa as l,rb as q,tc as te,uc as ie,zc as ne}from"./chunk-PNZTRGP7.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as g}from"./chunk-LNJ3S2LQ.js";var fe=(m,t)=>t.id;function Te(m,t){if(m&1&&(a(0,"ion-select-option",10),p(1),s()),m&2){let e=t.$implicit;h("value",e.id),c(),V(e.name)}}function we(m,t){if(m&1){let e=x();a(0,"div",12)(1,"ion-item",18)(2,"ion-input",19),y("ngModelChange",function(i){let o=d(e).$implicit;return C(o.who,i)||(o.who=i),u(i)}),s(),a(3,"app-tooltip",20)(4,"ion-button",21),_("click",function(){let i=d(e).$implicit,o=l(2);return u(o.deleteItem(i))}),k(5,"ion-icon",22),s()()(),a(6,"app-date-range",23),_("endChanged",function(i){let o=d(e).$implicit,r=l(2);return u(r.endChanged(o,i))})("startChanged",function(i){let o=d(e).$implicit,r=l(2);return u(r.startChanged(o,i))}),s()()}if(m&2){let e=t.$implicit,n=l(2);c(2),w("ngModel",e.who),c(2),h("hidden",n.occurrences.length===1),c(2),h("minTime",n.minTime)("maxTime",n.maxTime)("id",e.id)("startTime",e.startTime)("endTime",e.endTime)}}function Ce(m,t){if(m&1){let e=x();a(0,"ion-button",17),_("click",function(){d(e);let i=l(2);return u(i.deleteParty())}),p(1,"Delete"),s()}}function ye(m,t){m&1&&(a(0,"ion-button",15),p(1,"\xA0"),s())}function Ie(m,t){if(m&1){let e=x();a(0,"div",5)(1,"ion-card")(2,"ion-card-content")(3,"ion-list")(4,"ion-item",6)(5,"ion-input",7),y("ngModelChange",function(i){d(e);let o=l();return C(o.music.title,i)||(o.music.title=i),u(i)}),s()(),a(6,"ion-item",8)(7,"ion-select",9),y("ngModelChange",function(i){d(e);let o=l();return C(o.music.campId,i)||(o.music.campId=i),u(i)}),P(8,Te,2,2,"ion-select-option",10,N),s()(),a(10,"ion-item",6)(11,"app-emails",11),y("emailsChange",function(i){d(e);let o=l();return C(o.music.contact,i)||(o.music.contact=i),u(i)}),s()(),P(12,we,7,7,"div",12,fe),s(),a(14,"div",13),b(15,Ce,2,0,"ion-button",14)(16,ye,2,0,"ion-button",15),a(17,"ion-button",3),_("click",function(){d(e);let i=l();return u(i.save())}),p(18,"Save"),s(),a(19,"app-tooltip",16)(20,"ion-button",17),_("click",function(){d(e);let i=l();return u(i.addItem())}),p(21,"Add time slot"),s()()()()()()}if(m&2){let e=l();c(5),w("ngModel",e.music.title),c(2),h("value",e.music.campId),w("ngModel",e.music.campId),c(),O(e.camps),c(3),h("isAdmin",e.isAdmin)("isOwner",e.isOwner)("label","Party Owner")("placeholder","Email address"),w("emails",e.music.contact),c(),O(e.occurrences),c(3),S((e.isAdmin||e.isOwner)&&e.music.id?15:16)}}var f=class f{constructor(t,e,n,i){this.api=t;this.route=e;this.alert=n;this.location=i;this.busy=!0;this.camps=[];this.minTime=new Date().toISOString();this.maxTime=new Date().toISOString();this.isOwner=!1;this.isAdmin=!1;this.timezone=this.api.currentTimeZone();this.music={id:void 0,camp:"",location:"",day:"",occurrences:"[]"};this.occurrences=[];this.isNew=!1;de({closeOutline:me,addOutline:ce})}ionViewWillEnter(){return g(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.id=A(this.id),this.isNew=!this.id;let t=yield this.api.getFestival(this.api.festivalId,{cached:!0});this.isNew?(this.music=yield this.api.newMusic(),console.log("new music with camp",this.route.snapshot.queryParams.camp),this.music.campId=A(this.route.snapshot.queryParams.camp)):this.music=yield this.api.getMusic(this.id);let e=this.api.getAccessInfo(t.id);this.isOwner=this.music&&e.music.includes(this.music.id)||this.isNew,this.isAdmin=this.api.isAdmin(t.id),this.timezone=t.timezone,this.timezone||(this.timezone=this.api.currentTimeZone()),this.minTime=t.start_time,this.maxTime=t.end_time,this.occurrences=JSON.parse(this.music.occurrences),this.occurrences.length==0&&this.occurrences.push({who:"",id:"1",startTime:this.minTime,endTime:D(M(this.minTime),1).toISOString()});for(let n of this.occurrences)n.startTime=this.fixDate(n.startTime),n.endTime=this.fixDate(n.endTime);this.busy=!1})}fixDate(t){return t.endsWith("Z")?t.replace("Z",""):t}ngOnInit(){return g(this,null,function*(){this.camps=yield this.api.camps({cached:!0})})}lastTime(){let t=this.minTime;for(let e of this.occurrences)t=e.endTime;return t}deleteParty(){return g(this,null,function*(){(yield le(this.alert,"Are you sure you want to delete this party?"))&&(yield this.api.deleteParty(this.music.id),this.api.clearCache(),this.location.back())})}deleteItem(t){this.occurrences.length!=1&&(this.occurrences=this.occurrences.filter(e=>e.id!==t.id))}addItem(){let t=this.lastTime();this.occurrences.push({who:"",id:(this.occurrences.length+1).toString(),startTime:t,endTime:D(M(t),1).toISOString()})}getDayName(t){return new Date(t).toLocaleDateString(void 0,{weekday:"long"})}save(){return g(this,null,function*(){var i,o;if(!this.music.title||((i=this.music.title)==null?void 0:i.trim())==""){this.api.sendMessage("The name of the party must be set");return}let t=this.camps.find(r=>r.id==this.music.campId);this.music.camp=t?t.name:"Unknown";let e;for(let r of this.occurrences){if(r.who.trim()==""){this.api.sendMessage("The DJ/Musician must be set");return}r.startTime=this.fixDate(r.startTime),r.endTime=this.fixDate(r.endTime);let v=new Date(r.startTime),I=new Date(r.endTime);r.timeRange=(o=oe(v,I,void 0,this.api.currentTimeZone()))==null?void 0:o.brief,r.who.trim()==this.music.title.trim()&&(e=r.who)}if(e){let r=this.getDayName(this.occurrences[0].startTime);this.api.sendMessage(`The name of the party should not be the same as a DJ/Musician. A better name for a party might be "${this.music.camp} ${r}"`);return}let n=yield this.badTimeSlot(this.music,this.occurrences);if(n){this.api.sendMessage(n);return}ae(this.music),yield this.api.addMusic(this.music,this.occurrences),this.location.back()})}startChanged(t,e){t.startTime=e,t.endTime=re(M(e),60).toISOString()}endChanged(t,e){t.endTime=e}badTimeSlot(t,e){return g(this,null,function*(){let n=(yield this.api.music()).filter(i=>i.campId==t.campId);if(!t.campId&&!t.artCar)return"The party needs a location selected";for(let i of n){let o=JSON.parse(i.occurrences),r=o[o.length-1],v=e[e.length-1];if(this.music.id!=i.id){if(this.isEqual(r==null?void 0:r.endTime,v.startTime)&&(console.log("this.music.id",this.music.id),this.isNew))return`It looks like you are creating a party for a DJ timeslot instead of adding another timeslot to "${i.title}". Please add your DJ to the other party`;if(this.music.title==i.title)return`The party ${this.music.title} already exists. Please create a unique name for the party`;for(let I of o)for(let E of e)if(this.isEqual(E.startTime,I.startTime)&&this.isEqual(E.endTime,I.endTime))return`There is a conflict with "${i.title}" which has a time slot at the same time.`}}})}isEqual(t,e){return t.replace(".000","")==e.replace(".000","")}};f.\u0275fac=function(e){return new(e||f)(T(se),T(z),T(he),T(L))},f.\u0275cmp=W({type:f,selectors:[["app-music-item"]],inputs:{id:"id",vanity:"vanity"},decls:11,vars:3,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"border"],["lines","none"],["label","Party Title","labelPlacement","stacked","placeholder","Title of the theme camp or party",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["label","Location","labelPlacement","stacked","interface","popover","placeholder","Select location of event",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["helperText","The party owner can login and alter this lineup. This is a comma separated list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],[1,"horizontal","bottom-line"],[1,"horizontal"],["color","secondary"],["fill","clear"],["position","right","text","Add a time slot"],["color","secondary",3,"click"],["lines","none",1,"dj"],["labelPlacement","stacked","label","DJ / Musician",3,"ngModelChange","ngModel"],["position","right","text","Remove this time slot",2,"margin-top","32px"],["slot","end","color","secondary",3,"click","hidden"],["size","small","name","close-outline"],["size","wide",3,"endChanged","startChanged","minTime","maxTime","id","startTime","endTime"]],template:function(e,n){e&1&&(a(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),k(3,"ion-back-button"),s(),a(4,"ion-title"),p(5),s(),a(6,"ion-buttons",2)(7,"ion-button",3),_("click",function(){return n.save()}),p(8,"Save"),s()()()(),a(9,"ion-content",4),b(10,Ie,22,9,"div",5),s()),e&2&&(c(5),V(n.id?"Party":"Add Party"),c(4),h("fullscreen",!0),c(),S(n.busy?-1:10))},dependencies:[q,F,j,B,G,ee,Z,J,Y,U,$,H,Q,K,ie,ne,X,R,te,ue,pe,_e],styles:["ion-card[_ngcontent-%COMP%]{cursor:auto}.vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:end;justify-content:center}.horizontal[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.bottom-line[_ngcontent-%COMP%]{border-bottom:1px solid var(--ion-color-light)}.dj[_ngcontent-%COMP%]{padding-left:.5rem;margin-top:-1rem}ion-item[_ngcontent-%COMP%]{--padding-start: 0px;--padding-end: 0px}"]});var ge=f;export{ge as MusicItemPage};
