import{a as he}from"./chunk-XCQPYVZE.js";import{a as pe}from"./chunk-5CHPG7GP.js";import{a as fe}from"./chunk-EYEKT4OR.js";import{a as _e}from"./chunk-XVGYSCA6.js";import{a as ge}from"./chunk-TRRH6YG6.js";import"./chunk-2G3SQA7K.js";import{H as ce,e as M,m as de,o as me,u as V}from"./chunk-FZZYZTAK.js";import"./chunk-XMQYHBKU.js";import{$ as g,$b as J,Aa as h,Cc as le,D as F,Dc as re,G as c,L as I,Lb as R,Mb as Z,P as T,Qa as O,Sb as A,Tb as Q,Ub as Y,V as y,Vb as j,W as x,Y as k,Z as W,_ as E,_b as H,aa as a,ba as s,ca as v,ea as b,ec as K,fa as u,fc as X,ga as l,gc as $,hc as ee,ib as q,ka as L,la as B,lb as N,ma as D,mc as te,p as S,pa as z,pc as ie,qc as ne,s as d,sa as U,sb as G,t as m,ta as _,ua as P,uc as ae,vc as se,xc as oe,ya as f,za as p}from"./chunk-LVKFIXIJ.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as w}from"./chunk-LNJ3S2LQ.js";var Ce=["gps"];function we(r,o){if(r&1&&v(0,"img",12),r&2){let t=l(2);g("src",t.imageUrl,F)}}function ye(r,o){r&1&&(a(0,"p"),_(1,"Click to choose an image"),s())}function xe(r,o){if(r&1){let t=b();a(0,"ion-datetime",28),h("ngModelChange",function(e){d(t);let i=l(2);return p(i.festival.start_time,e)||(i.festival.start_time=e),m(e)}),u("ionChange",function(){d(t);let e=l(2);return m(e.startChanged())}),s()}if(r&2){let t=l(2);g("showDefaultButtons",!0),f("ngModel",t.festival.start_time)}}function be(r,o){if(r&1){let t=b();a(0,"ion-datetime",29),h("ngModelChange",function(e){d(t);let i=l(2);return p(i.festival.end_time,e)||(i.festival.end_time=e),m(e)}),u("ionChange",function(){d(t);let e=l(2);return m(e.endChanged())}),s()}if(r&2){let t=l(2);g("showDefaultButtons",!0),f("ngModel",t.festival.end_time)}}function Me(r,o){if(r&1&&(a(0,"ion-select-option",21),_(1),s()),r&2){let t=o.$implicit;g("value",t),c(),P(t)}}function Se(r,o){if(r&1){let t=b();a(0,"ion-button",30),u("click",function(){d(t);let e=l(2);return m(e.delete())}),_(1,"Delete"),s()}r&2&&g("disabled",!0)}function Te(r,o){if(r&1){let t=b();a(0,"div",7)(1,"ion-card")(2,"ion-card-content")(3,"ion-list",8)(4,"ion-item")(5,"ion-input",9),h("ngModelChange",function(e){d(t);let i=l();return p(i.festival.name,e)||(i.festival.name=e),m(e)}),s()(),a(6,"ion-item")(7,"ion-textarea",10),h("ngModelChange",function(e){d(t);let i=l();return p(i.festival.description,e)||(i.festival.description=e),m(e)}),s()(),a(8,"div",11),u("click",function(){d(t);let e=z(50);return m(e.click())}),y(9,we,1,1,"img",12),y(10,ye,2,0,"p"),s(),a(11,"ion-item")(12,"app-emails",13),h("emailsChange",function(e){d(t);let i=l();return p(i.festival.admins,e)||(i.festival.admins=e),m(e)}),s()(),a(13,"ion-item")(14,"ion-input",14),h("ngModelChange",function(e){d(t);let i=l();return p(i.festival.region,e)||(i.festival.region=e),m(e)}),s()(),a(15,"ion-item")(16,"ion-input",15),h("ngModelChange",function(e){d(t);let i=l();return p(i.festival.website,e)||(i.festival.website=e),m(e)}),s()(),a(17,"ion-item")(18,"ion-checkbox",16),h("ngModelChange",function(e){d(t);let i=l();return p(i.festival.unknown_dates,e)||(i.festival.unknown_dates=e),m(e)}),_(19,"Dates are not known yet"),s()(),a(20,"ion-item")(21,"ion-label"),_(22,"Start"),s(),v(23,"ion-datetime-button",17),s(),a(24,"ion-modal",18),T(25,xe,1,2,"ng-template"),s(),a(26,"ion-item")(27,"ion-label"),_(28,"End"),s(),v(29,"ion-datetime-button",19),s(),a(30,"ion-modal",18),T(31,be,1,2,"ng-template"),s(),a(32,"ion-item")(33,"ion-select",20),h("ngModelChange",function(e){d(t);let i=l();return p(i.festival.timezone,e)||(i.festival.timezone=e),m(e)}),W(34,Me,2,2,"ion-select-option",21,k),s()(),a(36,"ion-item")(37,"ion-checkbox",16),h("ngModelChange",function(e){d(t);let i=l();return p(i.festival.active,e)||(i.festival.active=e),m(e)}),_(38,"Display in the Dust app"),s()(),a(39,"ion-item")(40,"ion-label",22),u("click",function(){d(t);let e=l();return m(e.openLocation())}),a(41,"app-tooltip",23),_(42," Location "),s()(),a(43,"app-gps",24,0),h("latChange",function(e){d(t);let i=l();return p(i.festival.gpsLat,e)||(i.festival.gpsLat=e),m(e)})("lngChange",function(e){d(t);let i=l();return p(i.festival.gpsLng,e)||(i.festival.gpsLng=e),m(e)}),u("gpsChange",function(e){d(t);let i=l();return m(i.gpsChanged(e))}),s()()(),a(45,"div",25),y(46,Se,2,1,"ion-button",26),a(47,"ion-button",5),u("click",function(){d(t);let e=l();return m(e.save())}),_(48,"Save"),s()(),a(49,"input",27,1),u("change",function(e){d(t);let i=l();return m(i.onFileSelected(e))}),s()()()()}if(r&2){let t=l();c(5),f("ngModel",t.festival.name),c(2),g("spellcheck",!0)("rows",6)("autoGrow",!0),f("ngModel",t.festival.description),c(),U(t.uploading?"disabled":""),c(),x(t.imageUrl?9:-1),c(),x(t.imageUrl?-1:10),c(2),g("isAdmin",!0)("isOwner",!0)("label","Administrator Emails")("placeholder","Comma delimited list of email addresses"),f("emails",t.festival.admins),c(2),f("ngModel",t.festival.region),c(2),f("ngModel",t.festival.website),c(2),f("ngModel",t.festival.unknown_dates),c(6),g("keepContentsMounted",!0),c(6),g("keepContentsMounted",!0),c(3),g("value",t.festival.timezone),f("ngModel",t.festival.timezone),c(),E(t.timezones),c(3),f("ngModel",t.festival.active),c(6),f("lat",t.festival.gpsLat)("lng",t.festival.gpsLng),c(3),x(t.canDelete?46:-1)}}function Pe(r,o){r&1&&v(0,"app-spinner")}var C=class C{constructor(){this.busy=!0;this.canDelete=!1;this.uploading=!1;this.endModified=!1;this.timezones=[];this.imageChanged=!1;this.location=S(O);this.api=S(ce);this.festival={name:"",vanity:"",admins:"",contact:"",description:"",mastodon_handle:"",inbox_email:"",region:"",website:"",pin_size_multiplier:1,max_music_types:2,start_time:new Date().toISOString(),end_time:new Date().toISOString(),music_registration:!1,camp_registration:!1,gpsLat:0,gpsLng:0,camp_editing:!1,music_types:"",event_registration:!1,placement_form_art:"",placement_form_camps:"",approved:!1,event_editing:!1,art_editing:!1,archived:!1,map_direction:0,event_types:"",max_event_types:2,pin:void 0,directions:void 0,unknown_dates:!1,placement_form_cars:"",volunteeripate_domain:"",volunteeripate_identifier:"",rss_feed:"",id:void 0,active:!1,timezone:this.api.currentTimeZone()}}ionViewWillEnter(){return w(this,null,function*(){let o=this.api.festivalId;this.vanity?yield this.api.setFestivalByVanity(this.vanity):o=void 0,this.festival=yield this.api.getFestival(o,{cached:!1}),this.canDelete=!!this.festival.id,this.festival.timezone||(this.festival.timezone=this.api.currentTimeZone()),this.imageUrl=this.api.imageURL(this.festival.imageUrl),this.busy=!1,this.timezones=Intl.supportedValuesOf("timeZone")})}ionViewWillLeave(){this.gps&&this.gps.cleanup()}startChanged(){this.endModified||(this.festival.end_time=me(de(this.festival.start_time),24).toISOString())}endChanged(){this.endModified=!0}delete(){}gpsChanged(o){this.festival.gpsLat=o.lat,this.festival.gpsLng=o.lng}fixUniqueId(){this.festival.id||(this.festival.vanity=this.festival.name.toLowerCase().trim().replace(/\s+/g,"-").replace(/[.,]/g,""))}onFileSelected(o){return w(this,null,function*(){let t=o.target.files[0];if(!t)return;let n={width:0,height:0};if(this.blob=yield pe(t,{quality:90,width:500},n),n.width!==n.height){this.api.sendMessage("The image needs to be square (width and height must be equal)");return}let e=URL.createObjectURL(this.blob);this.imageUrl=e,this.imageChanged=!0})}setTime(o,t){return o.substring(0,10)+t}save(){return w(this,null,function*(){this.festival.start_time=this.setTime(this.festival.start_time,"T00:00:00"),this.festival.end_time=this.setTime(this.festival.end_time,"T23:59:59");let o=new Date(this.festival.start_time+V(this.festival.timezone)),t=new Date(this.festival.end_time+V(this.festival.timezone)),n=Math.round((t-o)/1e3/60/60);if(isNaN(n)){this.api.sendMessage("The start and end time must be set");return}if(n<0){this.api.sendMessage("The end time must be after the start time");return}if(n<24){this.api.sendMessage("The event must be at least 1 day long");return}if(n>24*30){this.api.sendMessage("The event cannot be longer than 30 days");return}if(this.festival.name.length<4){this.api.sendMessage("The event name must be set");return}let e=new Date().getFullYear();if((this.festival.name.includes(e.toString())||this.festival.name.includes((e+1).toString())||this.festival.name.includes((e-1).toString()))&&!this.festival.archived){this.api.sendMessage("The event name cannot include the year in it");return}if(this.fixUniqueId(),this.festival.vanity.length<4){this.api.sendMessage("The unique identifier must be set");return}if(this.festival.vanity.includes(" ")){this.api.sendMessage("The unique identifier cannot contain spaces");return}if(this.festival.description.length<4){this.api.sendMessage("The event description must be set");return}if(this.festival.timezone||(this.festival.timezone=this.api.currentTimeZone()),this.festival.active){if(M(this.festival.imageUrl)&&M(this.imageUrl)){this.api.sendMessage("You need an image to display the event in the dust app");return}if(this.festival.gpsLat==0||this.festival.gpsLng==0){this.api.sendMessage("You need to set the GPS location to display the event in the dust app");return}if(M(this.festival.region)){this.api.sendMessage("You need to set the region to display the event in the dust app");return}}if(!M(this.festival.website)&&!this.festival.website.startsWith("https://")){this.api.sendMessage("The website must start with https://");return}this.busy=!0;try{let i=yield this.api.addFestival(this.festival);if(i.message&&i.message!=""){this.api.sendMessage(i.message),this.busy=!1;return}else if(i.id&&this.imageChanged){let ve=yield this.api.getFestival(i.id,{cached:!1});this.api.setFestival(ve),yield this.uploadImage(i.id)}this.api.clearCache(),this.busy=!1,this.location.back()}catch(i){console.error(i),this.busy=!1;return}})}uploadImage(o){return w(this,null,function*(){if(this.blob)try{this.uploading=!0,this.festival.imageUrl=yield this.api.setImage(this.blob,o);let t=yield this.api.addFestival(this.festival);t.message&&this.api.sendMessage(t.message),this.imageChanged=!1}finally{this.uploading=!1}})}openLocation(){let o=`https://www.google.com/maps/search/?api=1&query=${this.festival.gpsLat},${this.festival.gpsLng}`;window.open(o,"_blank")}};C.\u0275fac=function(t){return new(t||C)},C.\u0275cmp=I({type:C,selectors:[["app-festival"]],viewQuery:function(t,n){if(t&1&&L(Ce,5),t&2){let e;B(e=D())&&(n.gps=e.first)}},inputs:{vanity:"vanity"},decls:13,vars:3,consts:[["gps",""],["fileUpload",""],["color","primary"],["slot","start"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"border"],["lines","none"],["label","Burn Name","labelPlacement","stacked","placeholder","Name of the burn",3,"ngModelChange","ngModel"],["labelPlacement","stacked","label","Description","placeholder","Description of the burn",3,"ngModelChange","spellcheck","rows","autoGrow","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],["helperText","",1,"emails",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["label","Region","labelPlacement","stacked","placeholder","City, State/Country",3,"ngModelChange","ngModel"],["label","Website","labelPlacement","stacked","placeholder","eg https://myburn.com",3,"ngModelChange","ngModel"],["labelPlacement","start",3,"ngModelChange","ngModel"],["datetime","datetime"],[3,"keepContentsMounted"],["datetime","datetimeEnd"],["label","Timezone","interface","popover","placeholder","Select the timezone of the event",3,"ngModelChange","value","ngModel"],[3,"value"],[2,"width","100%",3,"click"],["position","left","text","This is used for the directions button in the app. Right click in Google Maps to copy lat/long and paste here."],[3,"latChange","lngChange","gpsChange","lat","lng"],[1,"center"],["color","secondary",3,"disabled"],["type","file",1,"file-input",3,"change"],["presentation","date","minuteValues","0,15,30,45","id","datetime",3,"ngModelChange","ionChange","showDefaultButtons","ngModel"],["presentation","date","minuteValues","0,15,30,45","id","datetimeEnd",3,"ngModelChange","ionChange","showDefaultButtons","ngModel"],["color","secondary",3,"click","disabled"]],template:function(t,n){t&1&&(a(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-buttons",3),v(4,"ion-back-button"),s()(),a(5,"ion-title"),_(6),s(),a(7,"ion-buttons",4)(8,"ion-button",5),u("click",function(){return n.save()}),_(9,"Save"),s()()()(),a(10,"ion-content",6),y(11,Te,51,25,"div",7)(12,Pe,1,0,"app-spinner"),s()),t&2&&(c(6),P(n.vanity?"Edit Burn":"New Burn"),c(4),g("fullscreen",!0),c(),x(n.busy?12:11))},dependencies:[G,q,N,K,ne,Q,R,ae,ie,H,Y,j,ee,X,oe,re,$,J,Z,se,_e,le,te,A,he,ge,fe],styles:[".emails[_ngcontent-%COMP%]{width:100%;padding-right:.5rem}"]});var ue=C;export{ue as FestivalPage};
