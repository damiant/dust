import{a as M,b as D}from"./chunk-2HF6EJ75.js";import"./chunk-PNKDLQP2.js";import"./chunk-KCPLCCSF.js";import{a as ve}from"./chunk-SAXSOE4W.js";import{a as be}from"./chunk-GKO5FLMM.js";import{a as fe}from"./chunk-5EUBO754.js";import{c as C}from"./chunk-OZ2IKH4J.js";import{N as ge,O as Ce,aa as ye}from"./chunk-TF5OT4X3.js";import{I as he,e as E,l as de,r as ue,v as _e}from"./chunk-CXIDEVKY.js";import"./chunk-PFLI22GG.js";import{$ as B,$b as $,Aa as V,Ac as se,D as F,Dc as ce,Ea as b,Fa as v,G as a,Ga as w,Ic as pe,Jc as me,La as N,O as A,Ra as L,Rb as H,W as _,Wa as R,Wb as K,X as h,Yb as Y,Z as W,Zb as X,_ as U,_b as Z,aa as p,ba as l,ca as r,da as y,ec as ee,gb as Q,ia as I,jb as j,ka as g,kc as ie,lc as te,ma as s,nc as ne,ob as q,p as P,qa as T,ra as S,rb as z,s as m,sa as k,sc as ae,t as d,vc as oe,wb as G,wc as le,ya as O,yb as J,yc as re,za as u}from"./chunk-GPCT4GNB.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as f}from"./chunk-LNJ3S2LQ.js";var xe=t=>[t];function Ie(t,n){if(t&1&&(l(0,"ion-select-option",11),u(1),r()),t&2){let e=n.$implicit;p("value",e),a(),V(e)}}function Pe(t,n){if(t&1){let e=I();l(0,"ion-item",12)(1,"ion-checkbox",21),w("ngModelChange",function(i){m(e);let c=s(2);return v(c.camp.publicEvents,i)||(c.camp.publicEvents=i),d(i)}),u(2,"Accept event submissions from the public"),r()()}if(t&2){let e=s(2);a(),b("ngModel",e.camp.publicEvents)}}function Te(t,n){if(t&1&&y(0,"img",16),t&2){let e=s(2);p("src",e.imageUrl,F)}}function Se(t,n){t&1&&(l(0,"p"),u(1,"Click to choose an optional image for your camp"),r())}function ke(t,n){if(t&1){let e=I();l(0,"ion-item",7)(1,"app-emails",22),w("emailsChange",function(i){m(e);let c=s(2);return v(c.camp.contact_email,i)||(c.camp.contact_email=i),d(i)}),r()()}if(t&2){let e=s(2);a(),p("isAdmin",e.isAdmin)("isOwner",e.isOwner)("label","Camp Owner(s)")("placeholder","Email address of camp owner"),b("emails",e.camp.contact_email)}}function Ve(t,n){if(t&1){let e=I();l(0,"app-tooltip",19)(1,"ion-button",23),g("click",function(){m(e);let i=s(2);return d(i.invite())}),u(2,"Invite"),r()()}if(t&2){let e=s(2);a(),p("disabled",e.inviting)}}function Ee(t,n){if(t&1&&(l(0,"app-tooltip",24)(1,"ion-button",25),u(2," Place "),r()(),l(3,"ion-button",26),u(4," Delete "),r(),u(5,"\xA0 "),y(6,"ion-alert",27)),t&2){let e=s(2);a(),p("routerLink","../../map/"+N(2,xe,e.camp.id)),a(5),p("buttons",e.deleteButtons)}}function Me(t,n){if(t&1){let e=I();l(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),w("ngModelChange",function(i){m(e);let c=s();return v(c.camp.name,i)||(c.camp.name=i),d(i)}),r()(),l(6,"ion-item",9)(7,"ion-select",10),w("ngModelChange",function(i){m(e);let c=s();return v(c.camp.camp_type,i)||(c.camp.camp_type=i),d(i)}),U(8,Ie,2,2,"ion-select-option",11,W),r()(),_(10,Pe,3,1,"ion-item",12),l(11,"ion-item",13),g("dblclick",function(){m(e);let i=s();return d(i.fillDescription())}),l(12,"ion-textarea",14),w("ngModelChange",function(i){m(e);let c=s();return v(c.camp.description,i)||(c.camp.description=i),d(i)}),r()(),l(13,"div",15),g("click",function(){m(e);let i=s();return d(i.upload.click())}),_(14,Te,1,1,"img",16),_(15,Se,2,0,"p"),r(),_(16,ke,2,5,"ion-item",7),y(17,"app-internal-fields",17),r(),l(18,"div",18),_(19,Ve,3,1,"app-tooltip",19),_(20,Ee,7,4),l(21,"ion-button",3),g("click",function(){m(e);let i=s();return d(i.save())}),u(22,"Save"),r()(),l(23,"app-upload",20),g("upload",function(i){m(e);let c=s();return d(c.uploaded(i))}),r()()()()}if(t&2){let e=s();a(5),b("ngModel",e.camp.name),a(2),p("value",e.camp.camp_type),b("ngModel",e.camp.camp_type),a(),B(e.campTypes),a(2),h(e.isAdmin||e.isOwner?10:-1),a(2),p("spellcheck",!0)("rows",6)("maxlength",1e3)("autoGrow",!0),b("ngModel",e.camp.description),a(),O(e.uploading?"disabled":""),a(),h(e.imageUrl?14:-1),a(),h(e.imageUrl?-1:15),a(),h(e.isAdmin||e.isOwner?16:-1),a(),p("schemaType","camps")("entityId",e.camp.id||0)("currentData",e.internalFieldData),a(2),h(e.id&&e.isAdmin?19:-1),a(),h(e.id&&e.canPlace?20:-1),a(),p("disabled",e.busy)}}function De(t,n){t&1&&y(0,"app-spinner")}var x=class x{constructor(){this.api=P(he);this.alert=P(re);this.location=P(R);this.vanity=L();this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.isOwner=!1;this.canPlace=!1;this.isNew=!1;this.inviting=!1;this.campTypes=["Theme Camp","Sound Camp","Art Support Camp","Village Camp","Infrastructure"];this.internalFieldData=[];this.camp={name:"",pin:"",description:"",id:void 0,contact_email:"",camp_type:this.campTypes[0],publicEvents:!1};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];ye({mapOutline:Ce,mailOutline:ge})}uploaded(n){console.log(n),this.imageUrl=n.url,this.imageChanged=!0,this.blob=n.blob}ionViewWillEnter(){return f(this,null,function*(){if(yield this.api.setFestivalByVanity(this.vanity()),this.id=de(this.id),this.isNew=!this.id,this.camp=yield this.api.getCamp(this.id),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.isOwner=!!this.id&&this.api.getAccessInfo(this.api.festivalId).camps.includes(this.id),this.imageUrl=this.api.imageURL(this.camp.imageUrl),this.camp.internalData)try{this.internalFieldData=JSON.parse(this.camp.internalData)}catch(n){console.error("Failed to parse internal data:",n),this.internalFieldData=[]}this.busy=!1})}delete(){return f(this,null,function*(){this.busy=!0,yield this.api.deleteCamp(this.camp),this.api.clearCache(),this.busy=!1,this.location.back()})}fillDescription(){console.log("fillDescription"),E(this.camp.description)&&!E(this.camp.name)&&(this.camp.description=`${this.camp.name} does not have a description yet.`)}save(n=!0){return f(this,null,function*(){this.busy=!0,_e(this.camp);try{if(this.internalFields){if(!this.internalFields.validate()){this.busy=!1;return}this.internalFieldData=this.internalFields.fieldValues(),this.internalFieldData.length>0&&(this.camp.internalData=JSON.stringify(this.internalFieldData))}this.camp.description=ue(this.camp.description);let e=yield this.api.addCamp(this.camp);if(this.busy=!1,e.message)C(this.alert,e.message);else{if(e.id&&this.imageChanged){console.log(`Uploaded image for camp ${e.id}`),this.busy=!0;try{yield this.uploadImage(e.id)}finally{this.busy=!1,this.imageChanged=!1}}if(!this.isAdmin){let o=this.isNew?`Thank you for registering your camp at ${this.api.festivalTitle()}.`:`The changes you have made will be reviewed by ${this.api.festivalTitle()} prior to publishing in the app.`;C(this.alert,o,"Note"),yield this.api.setKey()}this.api.clearCache(),n&&this.location.back()}}finally{this.busy=!1}})}invite(){return f(this,null,function*(){if(!this.camp.contact_email){yield C(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let n=yield this.api.inviteCamp(this.camp);n.message?C(this.alert,n.message):C(this.alert,"The camp owner has been invited to manage their camp.","Invitation")})}uploadImage(n){return f(this,null,function*(){if(this.blob)try{this.uploading=!0,this.camp.imageUrl=yield this.api.setImage(this.blob,n);let e=yield this.api.addCamp(this.camp,!0);e.message&&C(this.alert,e.message)}finally{this.uploading=!1}})}};x.\u0275fac=function(e){return new(e||x)},x.\u0275cmp=A({type:x,selectors:[["app-camp"]],viewQuery:function(e,o){if(e&1&&(T(M,5),T(D,5)),e&2){let i;S(i=k())&&(o.upload=i.first),S(i=k())&&(o.internalFields=i.first)}},inputs:{id:"id",vanity:[1,"vanity"]},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["label","Camp Name","labelPlacement","stacked","placeholder","Name of the theme camp",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["label","Type","labelPlacement","stacked","interface","popover","placeholder","Select the type of camp",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["lines","none",1,"ion-padding-start"],[3,"dblclick"],["labelPlacement","stacked","label","Description","placeholder","Description of the theme camp",3,"ngModelChange","spellcheck","rows","maxlength","autoGrow","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[3,"schemaType","entityId","currentData"],[1,"center"],["text","Invite camp owner via email to manage their camp"],[3,"upload"],["justify","start","labelPlacement","end",3,"ngModelChange","ngModel"],["helperText",`The camp owner(s) can login and alter their camp
              events and details. This is a list of email addresses.`,3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["color","secondary",3,"click","disabled"],["text","Place the camp on the map"],["color","secondary",3,"routerLink"],["id","deleteCamp","color","secondary"],["trigger","deleteCamp","header","Delete Camp?",3,"buttons"]],template:function(e,o){e&1&&(l(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),y(3,"ion-back-button"),r(),l(4,"ion-title"),u(5),r(),l(6,"ion-buttons",2)(7,"ion-button",3),g("click",function(){return o.save()}),u(8,"Save"),r()()()(),l(9,"ion-content",4),_(10,Me,24,20,"div",5)(11,De,1,0,"app-spinner"),r()),e&2&&(a(5),V(o.id||o.camp.id?"Edit Camp":o.isAdmin?"Add Camp":"Register Camp"),a(2),p("disabled",o.busy),a(2),p("fullscreen",!0),a(),h(o.busy?11:10))},dependencies:[K,be,M,J,q,G,z,fe,j,Q,ie,le,X,H,oe,Y,ee,Z,$,ne,te,ce,me,pe,ae,ve,se,D],encapsulation:2});var we=x;export{we as CampPage};
