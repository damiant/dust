import{a as Ve}from"./chunk-Z4V6D4N6.js";import{a as $}from"./chunk-IZLYP3IF.js";import{a as Ae}from"./chunk-6LIHCZ7J.js";import{a as ke}from"./chunk-TM3WTZXM.js";import{a as De,c as g}from"./chunk-OZ2IKH4J.js";import"./chunk-NBGQYW5Y.js";import"./chunk-HTUMMCB5.js";import"./chunk-I4H34LCA.js";import"./chunk-GDAPN2EF.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-STA5XHHU.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-3QBWF6TQ.js";import"./chunk-MCRJI3T3.js";import"./chunk-GTAO53MO.js";import"./chunk-JEOCIQEZ.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import{Y as Ee,b as Se,m as Oe,q as Pe}from"./chunk-IKEGAJLW.js";import{F as be,a as Ie,b as X,e as J,l as Y,m as O,o as R,p as xe,q as ve,r as ee,t as f,v as Me}from"./chunk-MPA3GIYF.js";import"./chunk-XMQYHBKU.js";import{$ as h,Bc as ye,Cc as Te,G as c,I as S,Ja as ae,Kb as pe,L as E,La as ce,Lb as N,Ma as le,P as ne,Pa as me,Rb as W,Sb as F,Tb as he,Ub as _e,V as Q,W as Z,Y as oe,Ya as de,Z as U,Zb as z,_ as G,aa as a,ba as r,ca as w,cb as ue,dc as B,ea as x,ec as L,fa as p,ga as l,gc as fe,hb as k,kb as V,lc as ge,na as re,oa as se,oc as q,p as ie,pc as j,rb as A,s as d,sa as _,t as u,ta as K,vc as Ce,w as D,wc as we,xa as y,ya as T,za as I}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as C}from"./chunk-LNJ3S2LQ.js";function Be(m,i){if(m&1){let e=x();a(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),p("click",function(){d(e);let t=l();return u(t.cancel())}),_(4,"Cancel"),r()(),a(5,"ion-title"),_(6,"Import"),r(),a(7,"ion-buttons",4)(8,"ion-button",5),p("click",function(){d(e);let t=l();return u(t.confirm())}),_(9,"Convert"),r()()()(),a(10,"ion-content",6)(11,"ion-item")(12,"ion-textarea",7),I("ngModelChange",function(t){d(e);let n=l();return T(n.text,t)||(n.text=t),u(t)}),r()(),a(13,"ion-item"),w(14,"ion-textarea",8),r()()}if(m&2){let e=l();c(8),h("strong",!0),c(4),y("ngModel",e.text),c(2),h("value",e.prompt)}}var v=class v{constructor(){this.text="";this.modal=ce.required(N);this.isOpen=le(!1);this.occurrences=D([]);this.imported=ae();this.alert=ie($);this.prompt="Convert this to a JSON array an artist, startDate in iso date format, endDate in iso date format where endDate is 1 hour after startDate if the endDate is missing. Thursday is February 13 2025. Also convert the artist to title case. Finally, only list items that are on thursday"}cancel(){this.modal().dismiss(null,"cancel")}confirm(){this.validate(this.text)&&this.modal().dismiss(this.text,"confirm")}onWillDismiss(i){i.detail.role==="confirm"&&this.imported.emit(this.occurrences()),this.isOpen.set(!1)}validate(i){let e=JSON.parse(i);if(!Array.isArray(e))return g(this.alert,"Data is not an array"),!1;if(e.length===0)return g(this.alert,"Data is empty"),!1;let o=[],t=1;for(let n of e){if(J(n.artist))return g(this.alert,"Artist is required"),!1;if(J(n.startDate))return g(this.alert,"Start date is required"),!1;if(!X(n.startDate))return g(this.alert,`Invalid start date "${n.startDate}"`),!1;if(J(n.endDate))return g(this.alert,"End date is required"),!1;if(!X(n.endDate))return g(this.alert,`Invalid end date "${n.endDate}"`),!1;o.push({id:t.toString(),who:n.artist,startTime:f(n.startDate),endTime:f(n.endDate)}),t++}return this.occurrences.set(o),!0}};v.\u0275fac=function(e){return new(e||v)},v.\u0275cmp=E({type:v,selectors:[["app-music-import"]],viewQuery:function(e,o){e&1&&re(o.modal,N,5),e&2&&se()},inputs:{isOpen:[1,"isOpen"]},outputs:{isOpen:"isOpenChange",imported:"imported"},decls:2,vars:1,consts:[[3,"willDismiss","isOpen"],["color","primary"],["slot","start"],[3,"click"],["slot","end"],[3,"click","strong"],[1,"ion-padding"],["rows","15","placeholder","",3,"ngModelChange","ngModel"],["rows","4",3,"value"]],template:function(e,o){e&1&&(a(0,"ion-modal",0),p("willDismiss",function(n){return o.onWillDismiss(n)}),ne(1,Be,15,3,"ng-template"),r()),e&2&&h("isOpen",o.isOpen())},dependencies:[z,W,N,B,F,q,j,Te,L,A,k,V],encapsulation:2});var H=v;var Le=(m,i)=>i.id;function qe(m,i){if(m&1&&(a(0,"ion-select-option",13),_(1),r()),m&2){let e=i.$implicit;h("value",e.id),c(),K(e.name)}}function je(m,i){if(m&1){let e=x();a(0,"div",15)(1,"div",21)(2,"ion-input",22),I("ngModelChange",function(t){let n=d(e).$implicit;return T(n.who,t)||(n.who=t),u(t)}),r(),w(3,"app-tooltip",23),r(),a(4,"app-date-range",24),p("endChanged",function(t){let n=d(e).$implicit,s=l(2);return u(s.endChanged(n,t))})("startChanged",function(t){let n=d(e).$implicit,s=l(2);return u(s.startChanged(n,t))}),r(),a(5,"div",25)(6,"ion-button",26),p("click",function(){let t=d(e).$implicit,n=l(2);return u(n.deleteItem(t))}),w(7,"ion-icon",27),r()()()}if(m&2){let e=i.$implicit,o=l(2);c(2),y("ngModel",e.who),c(2),h("minTime",o.minTime)("maxTime",o.maxTime)("id",e.id)("startTime",e.startTime)("endTime",e.endTime),c(2),h("hidden",o.occurrences.length===1)}}function Je(m,i){if(m&1){let e=x();a(0,"ion-button",20),p("click",function(){d(e);let t=l(2);return u(t.deleteParty())}),_(1,"Delete"),r()}}function Re(m,i){m&1&&(a(0,"ion-button",18),_(1,"\xA0"),r())}function $e(m,i){if(m&1){let e=x();a(0,"div",7)(1,"app-music-import",8),p("imported",function(t){d(e);let n=l();return u(n.imported(t))}),r(),a(2,"ion-card")(3,"ion-card-content")(4,"ion-list")(5,"ion-item",9)(6,"ion-input",10),I("ngModelChange",function(t){d(e);let n=l();return T(n.music.title,t)||(n.music.title=t),u(t)}),r()(),a(7,"ion-item",11)(8,"ion-select",12),I("ngModelChange",function(t){d(e);let n=l();return T(n.music.campId,t)||(n.music.campId=t),u(t)}),U(9,qe,2,2,"ion-select-option",13,oe),r()(),a(11,"ion-item",9)(12,"app-emails",14),I("emailsChange",function(t){d(e);let n=l();return T(n.music.contact,t)||(n.music.contact=t),u(t)}),r()(),U(13,je,8,7,"div",15,Le),r(),a(15,"div",16),Q(16,Je,2,0,"ion-button",17)(17,Re,2,0,"ion-button",18),a(18,"ion-button",5),p("click",function(){d(e);let t=l();return u(t.save())}),_(19,"Save"),r(),a(20,"app-tooltip",19)(21,"ion-button",20),p("click",function(){d(e);let t=l();return u(t.addItem())}),_(22,"Add time slot"),r()()()()()()}if(m&2){let e=l();c(),h("isOpen",e.showImport()),c(5),y("ngModel",e.music.title),c(2),h("value",e.music.campId),y("ngModel",e.music.campId),c(),G(e.camps),c(3),h("isAdmin",e.isAdmin)("isOwner",e.isOwner)("label","Party Owner")("placeholder","Email address"),y("emails",e.music.contact),c(),G(e.occurrences),c(3),Z((e.isAdmin||e.isOwner)&&e.music.id?16:17)}}var M=class M{constructor(i,e,o,t){this.api=i;this.route=e;this.alert=o;this.location=t;this.busy=!0;this.showImport=D(!1);this.camps=[];this.minTime=new Date().toISOString();this.maxTime=new Date().toISOString();this.isOwner=!1;this.isAdmin=!1;this.timezone=this.api.currentTimeZone();this.music={id:void 0,camp:"",location:"",day:"",occurrences:"[]"};this.occurrences=[];this.isNew=!1;Ee({closeOutline:Pe,addOutline:Se,chevronDown:Oe})}ionViewWillEnter(){return C(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.id=Y(this.id),this.isNew=!this.id;let i=yield this.api.getFestival(this.api.festivalId,{cached:!0});this.isNew?(this.music=yield this.api.newMusic(),console.log("new music with camp",this.route.snapshot.queryParams.camp),this.music.campId=Y(this.route.snapshot.queryParams.camp)):this.music=yield this.api.getMusic(this.id);let e=this.api.getAccessInfo(i.id);this.isOwner=this.music&&e.music.includes(this.music.id)||this.isNew,this.isAdmin=this.api.isAdmin(i.id),this.timezone=i.timezone,this.timezone||(this.timezone=this.api.currentTimeZone()),this.minTime=i.start_time,this.maxTime=f(R(O(i.end_time),12).toISOString()),this.occurrences=JSON.parse(this.music.occurrences),this.occurrences.length==0&&this.occurrences.push({who:"",id:"1",startTime:this.minTime,endTime:f(R(O(this.minTime),1).toISOString())});for(let o of this.occurrences)o.startTime=f(o.startTime),o.endTime=f(o.endTime);this.busy=!1})}ngOnInit(){return C(this,null,function*(){this.camps=yield this.api.camps({cached:!0})})}lastTime(){let i=this.minTime;for(let e of this.occurrences)i=e.endTime;return i}deleteParty(){return C(this,null,function*(){(yield De(this.alert,"Are you sure you want to delete this party?"))&&(yield this.api.deleteParty(this.music.id),this.api.clearCache(),this.location.back())})}deleteItem(i){this.occurrences.length!=1&&(this.occurrences=this.occurrences.filter(e=>e.id!==i.id))}addItem(){let i=this.lastTime();this.occurrences.push({who:"",id:(this.occurrences.length+1).toString(),startTime:i,endTime:f(R(O(i),1).toISOString())})}getDayName(i){return new Date(i).toLocaleDateString(void 0,{weekday:"long"})}sortableTime(i){return new Date(i).getTime()}save(){return C(this,null,function*(){var t,n;if(!this.music.title||((t=this.music.title)==null?void 0:t.trim())==""){this.api.sendMessage("The name of the party must be set");return}this.music.title=ee(this.music.title);let i=this.camps.find(s=>s.id==this.music.campId);this.music.camp=i?i.name:"Unknown";let e;for(let s of this.occurrences){if(s.who.trim()==""){this.api.sendMessage("The DJ/Musician must be set");return}s.startTime=f(s.startTime),s.endTime=f(s.endTime),s.who=ee(s.who);let b=new Date(s.startTime),P=new Date(s.endTime);s.timeRange=(n=Ie(b,P,void 0,this.api.currentTimeZone()))==null?void 0:n.brief,s.who.trim()==this.music.title.trim()&&(e=s.who)}if(this.occurrences=this.occurrences.sort((s,b)=>this.sortableTime(s.startTime)-this.sortableTime(b.startTime)),e){let s=this.getDayName(this.occurrences[0].startTime);this.api.sendMessage(`The name of the party should not be the same as a DJ/Musician. A better name for a party might be "${this.music.camp} ${s}"`);return}let o=yield this.badTimeSlot(this.music,this.occurrences);if(o){this.api.sendMessage(o);return}Me(this.music),yield this.api.addMusic(this.music,this.occurrences),this.location.back()})}startChanged(i,e){i.startTime=e,i.endTime=ve(xe(O(e),60))}endChanged(i,e){i.endTime=e}badTimeSlot(i,e){return C(this,null,function*(){let o=(yield this.api.music()).filter(t=>t.campId==i.campId);if(!i.campId&&!i.artCar)return"The party needs a location selected";for(let t of o){let n=JSON.parse(t.occurrences),s=n[n.length-1],b=e[e.length-1];if(this.music.id!=t.id){if(this.isEqual(s==null?void 0:s.endTime,b.startTime)&&(console.log("this.music.id",this.music.id),this.isNew))return`It looks like you are creating a party for a DJ timeslot instead of adding another timeslot to "${t.title}". Please add your DJ to the other party`;if(this.music.title==t.title)return`The party ${this.music.title} already exists. Please create a unique name for the party`;for(let P of n)for(let te of e)if(this.isEqual(te.startTime,P.startTime)&&this.isEqual(te.endTime,P.endTime))return`There is a conflict with "${t.title}" which has a time slot at the same time.`}}})}imported(i){return C(this,null,function*(){console.log("before",this.occurrences),console.log("imported",i),this.occurrences=i})}isEqual(i,e){return i.replace(".000","")==e.replace(".000","")}};M.\u0275fac=function(e){return new(e||M)(S(be),S(de),S($),S(me))},M.\u0275cmp=E({type:M,selectors:[["app-music-item"]],inputs:{id:"id",vanity:"vanity"},decls:13,vars:3,consts:[["color","primary"],["slot","start"],["slot","end"],["fill","clear",3,"click"],["size","small","name","chevron-down"],[3,"click"],[3,"fullscreen"],[1,"border"],[3,"imported","isOpen"],["lines","none"],["label","Party Title","labelPlacement","stacked","placeholder","Title of the theme camp or party",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["label","Location","labelPlacement","stacked","interface","popover","placeholder","Select location of event",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["helperText","The party owner can login and alter this lineup. This is a list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],[1,"horizontal","bottom-line"],[1,"horizontal"],["color","secondary"],["fill","clear"],["position","right","text","Add a time slot"],["color","secondary",3,"click"],["lines","none",1,"dj","vcenter"],["mode","ios","labelPlacement","stacked","label","DJ / Musician",3,"ngModelChange","ngModel"],["position","right","text","Remove this time slot",2,"margin-top","32px"],["size","wide","label","",3,"endChanged","startChanged","minTime","maxTime","id","startTime","endTime"],[1,"vcenter","del"],["slot","end","color","secondary",3,"click","hidden"],["size","small","name","close-outline"]],template:function(e,o){e&1&&(a(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),w(3,"ion-back-button"),r(),a(4,"ion-title"),_(5),r(),a(6,"ion-buttons",2)(7,"ion-button",3),p("click",function(){return o.showImport.set(!0)}),w(8,"ion-icon",4),r(),a(9,"ion-button",5),p("click",function(){return o.save()}),_(10,"Save"),r()()()(),a(11,"ion-content",6),Q(12,$e,23,10,"div",7),r()),e&2&&(c(5),K(o.id?"Party":"Add Party"),c(6),h("fullscreen",!0),c(),Z(o.busy?-1:12))},dependencies:[A,k,V,ue,B,j,F,pe,q,z,he,_e,fe,L,we,ye,ge,W,Ce,ke,Ve,Ae,H],styles:["ion-card[_ngcontent-%COMP%]{cursor:auto}.vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:end;justify-content:center}.horizontal[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;padding-right:5px;padding-left:5px}ion-item.app-select[_ngcontent-%COMP%]{--padding-start: 0 !important;--padding-end: 0rem}.bottom-line[_ngcontent-%COMP%]{border-bottom:1px solid var(--ion-color-light)}.dj[_ngcontent-%COMP%]{padding-left:.5rem;margin-top:-1rem;margin-bottom:.5rem}.del[_ngcontent-%COMP%]{margin-top:10px;max-width:50px}.vcenter[_ngcontent-%COMP%]{align-self:center}ion-input[_ngcontent-%COMP%]{color:var(--ion-color-dark)}ion-item[_ngcontent-%COMP%]{--padding-start: 0px;--padding-end: 0px}"]});var Ne=M;export{Ne as MusicItemPage};
