import{K as Z}from"./chunk-OQVFSD37.js";import"./chunk-PFLI22GG.js";import{$ as h,Aa as g,Ac as V,Bc as G,Ca as T,Db as k,Ec as H,Fc as q,H as l,Kc as J,Nc as K,P as S,Rc as Q,Sc as U,Tc as X,Ua as I,Wb as B,Za as w,aa as y,ba as o,ca as a,cc as R,da as r,dc as W,ea as N,ec as x,fc as F,la as d,lc as A,p as b,rc as $,sc as z,tb as P,uc as L,vc as Y,w as u,wb as D}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{a as M,b as j,d as E,h as f}from"./chunk-LNJ3S2LQ.js";var te=(m,i)=>i.id,ie=(m,i)=>i.value;function ne(m,i){if(m&1&&(a(0,"ion-select-option",12),g(1),r()),m&2){let e=i.$implicit;o("value",e.id),l(),T(" ",e.label," ")}}function se(m,i){if(m&1&&(a(0,"ion-select-option",12),g(1),r()),m&2){let e=i.$implicit;o("value",e.value),l(),T(" ",e.label," ")}}var c=class c{constructor(){this.vanity=I();this.api=b(Z);this.location=b(w);this.triggerOptions=[{id:"camp-register",label:"When a Camp is Registered",helper:"Sent when a camp is registered"},{id:"art-register",label:"When Art is Registered",helper:"Sent when art is registered"},{id:"music-register",label:"When Music is Registered",helper:"Sent when music is registered"},{id:"burn-register",label:"When a Burn is Registered",helper:"Sent when a burn is registered"},{id:"camp-event-register",label:"When a Camp Event is Registered",helper:"Sent when a camp event is registered"},{id:"art-event-register",label:"When an Art Event is Registered",helper:"Sent when an art event is registered"},{id:"start-burn-time",label:"When a Burn Starts",helper:"Sent at a specified time after the burn starts",afterOnly:!0},{id:"end-burn-time",label:"When a Burn Ends",helper:"Sent at a specified time after the burn ends",afterOnly:!0},{id:"manual",label:"Manual",helper:"Sent manually by an administrator"}];this.selectedTrigger=u("camp-register");this.selectedType=u("email");this.selectedOffset=u("15m");this.templates=u([]);this.timingOptions=[{label:"7 days before",value:"-7d"},{label:"3 days before",value:"-3d"},{label:"2 days before",value:"-2d"},{label:"1 day before",value:"-1d"},{label:"15 minutes after",value:"15m"},{label:"30 minutes after",value:"30m"},{label:"1 hour after",value:"1h"},{label:"2 hours after",value:"2h"},{label:"5 hours after",value:"5h"},{label:"12 hours after",value:"12h"},{label:"1 day after",value:"1d"},{label:"2 days after",value:"2d"},{label:"3 days after",value:"3d"},{label:"7 days after",value:"7d"}]}ngOnInit(){this.loadTemplates()}ionViewWillEnter(){return f(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity(),!0)})}getDefaultData(i,e){var n;return((n={"camp-register":{email:{subject:"Camp Registration Confirmation",body:`Your camp "{{campName}}" has been registered successfully. We'll review your submission.`},notification:{subject:"Camp Registered",body:'Camp "{{campName}}" registered successfully!'}},"art-register":{email:{subject:"Art Registration Confirmation",body:'Your art piece "{{artName}}" has been registered for {{burn}}.'},notification:{subject:"Art Registered",body:'"{{artName}}" registration complete!'}},"music-register":{email:{subject:"Music Registration Confirmation",body:'Thank you for registering "{{musicName}}".'},notification:{subject:"Music Registered",body:'Music "{{musicName}}" registered successfully!'}},"burn-register":{email:{subject:"Burn Registration Confirmation",body:'Your burn event "{{burnName}}" has been registered.'},notification:{subject:"Burn Registered",body:'Burn "{{burnName}}" registration submitted!'}},"camp-event-register":{email:{subject:"Event Registration Confirmation",body:'Your event "{{eventName}}" hosted by {{campName}} has been added to the schedule.'},notification:{subject:"Event Added",body:'Event "{{eventName}}" added to schedule!'}},"art-event-register":{email:{subject:"Art Event Registration Confirmation",body:'The event "{{eventName}}" has been registered.'},notification:{subject:"Art Event Registered",body:'Art event "{{eventName}}" registered!'}},"start-burn-time":{email:{subject:"Burn Starting Soon",body:'The burn "{{burnName}}" is starting.'},notification:{subject:"Burn Starting",body:'"{{burnName}}" starting!'}},"end-burn-time":{email:{subject:"Burn Completed",body:'"{{burnName}}" has concluded.'},notification:{subject:"Burn Ended",body:'"{{burnName}}" burn has ended.'}},manual:{email:{subject:"Manual Notification",body:"Welcome to {{burnName}}."},notification:{subject:"Manual Notification",body:"Welcome to {{burnName}}."}}}[i])==null?void 0:n[e])||{subject:`${i} ${e}`,body:`Template for ${i} (${e})`}}loadTemplates(){return f(this,null,function*(){try{let i=yield this.api.getTemplates();if(i&&i.length>0){let e=i.map(t=>{var O,_,C;let v=t,{["trigger-offset"]:n}=v,s=E(v,["trigger-offset"]),p=(_=(O=t.timeOffset)!=null?O:n)!=null?_:"15m";return j(M({},s),{timeOffset:p,enabled:(C=t.enabled)!=null?C:!0})});this.templates.set(e)}else{let e=[];this.triggerOptions.forEach(t=>{let n=this.getDefaultData(t.id,"email"),s=this.getDefaultData(t.id,"notification");e.push({trigger:t.id,type:"email",timeOffset:"15m",subject:n.subject,body:n.body,from:"[burn]",enabled:!0}),e.push({trigger:t.id,type:"notification",timeOffset:"15m",subject:s.subject,body:s.body,from:"[burn]",enabled:!0})}),this.templates.set(e)}}catch(i){console.error("Failed to load templates:",i);let e=[];this.triggerOptions.forEach(t=>{let n=this.getDefaultData(t.id,"email"),s=this.getDefaultData(t.id,"notification");e.push({trigger:t.id,type:"email",timeOffset:"15m",subject:n.subject,body:n.body,from:"[burn]",enabled:!0}),e.push({trigger:t.id,type:"notification",timeOffset:"15m",subject:s.subject,body:s.body,from:"[burn]",enabled:!0})}),this.templates.set(e)}})}get currentTemplate(){let i=this.templates().find(e=>e.trigger===this.selectedTrigger()&&e.type===this.selectedType());return i||{trigger:this.selectedTrigger(),type:this.selectedType(),timeOffset:this.selectedOffset(),subject:"",body:"",from:"[burn]",enabled:!0}}get currentTriggerLabel(){var e;let i=this.triggerOptions.find(t=>t.id===this.selectedTrigger());return(e=i==null?void 0:i.label)!=null?e:""}get currentTypeLabel(){return this.selectedType()==="email"?"Email":"Notification"}get currentTriggerHelper(){var e;let i=this.triggerOptions.find(t=>t.id===this.selectedTrigger());return(e=i==null?void 0:i.helper)!=null?e:""}selectTrigger(i,e){this.selectedTrigger.set(i),this.selectedType.set(e)}onSelectChange(i){let e=i.detail.value;this.selectedTrigger.set(e);let t=this.templates().find(s=>s.trigger===e&&s.type===this.selectedType());if(!t){let s={trigger:e,type:this.selectedType(),timeOffset:"15m",subject:"",body:"",from:"[burn]",enabled:!0};this.templates.update(p=>[...p,s]),t=s}let n=this.normalizeOffsetForTrigger(e,t.timeOffset);t.timeOffset!==n&&(t.timeOffset=n),this.selectedOffset.set(n)}getTimingOptionsForCurrentTrigger(){let i=this.triggerOptions.find(e=>e.id===this.selectedTrigger());return i?i.afterOnly?this.timingOptions:this.timingOptions.filter(e=>!e.value.startsWith("-")):this.timingOptions}isTriggerWithTiming(){let i=this.triggerOptions.find(e=>e.id===this.selectedTrigger());return(i==null?void 0:i.afterOnly)===!0}onTypeChange(i){let e=i.detail.value;this.selectedType.set(e);let t=this.templates().find(s=>s.trigger===this.selectedTrigger()&&s.type===e);if(!t){let s={trigger:this.selectedTrigger(),type:e,timeOffset:"15m",subject:"",body:"",from:"[burn]",enabled:!0};this.templates.update(p=>[...p,s]),t=s}let n=this.normalizeOffsetForTrigger(this.selectedTrigger(),t.timeOffset);t.timeOffset!==n&&(t.timeOffset=n),this.selectedOffset.set(n)}updateSubject(i){let e=this.templates(),t=e.findIndex(n=>n.trigger===this.selectedTrigger()&&n.type===this.selectedType());if(t===-1){let n={trigger:this.selectedTrigger(),type:this.selectedType(),timeOffset:this.selectedOffset(),subject:i,body:"",from:"[burn]",enabled:!0};this.templates.update(s=>[...s,n])}else e[t].subject=i,this.templates.set([...e])}updateBody(i){let e=this.templates(),t=e.findIndex(n=>n.trigger===this.selectedTrigger()&&n.type===this.selectedType());if(t===-1){let n={trigger:this.selectedTrigger(),type:this.selectedType(),timeOffset:this.selectedOffset(),subject:"",body:i,from:"[burn]",enabled:!0};this.templates.update(s=>[...s,n])}else e[t].body=i,this.templates.set([...e])}updateEnabled(i){let e=this.templates(),t=e.findIndex(n=>n.trigger===this.selectedTrigger()&&n.type===this.selectedType());if(t===-1){let n={trigger:this.selectedTrigger(),type:this.selectedType(),timeOffset:this.selectedOffset(),subject:"",body:"",from:"[burn]",enabled:i};this.templates.update(s=>[...s,n])}else e[t].enabled=i,this.templates.set([...e])}updateOffset(i){let e=this.normalizeOffsetForTrigger(this.selectedTrigger(),i);this.selectedOffset.set(e);let t=this.templates(),n=t.findIndex(s=>s.trigger===this.selectedTrigger()&&s.type===this.selectedType());n!==-1&&t[n].timeOffset!==e&&(t[n].timeOffset=e,this.templates.set([...t]))}save(){return f(this,null,function*(){try{yield this.api.saveTemplates(this.templates()),this.location.back()}catch(i){console.error("Failed to save templates:",i),this.api.sendMessage("Failed to save messages")}})}normalizeOffsetForTrigger(i,e){let n=this.triggerOptions.find(s=>s.id===i);return!e||n!=null&&n.afterOnly&&e.startsWith("-")?"15m":e}};c.\u0275fac=function(e){return new(e||c)},c.\u0275cmp=S({type:c,selectors:[["app-message-triggers"]],inputs:{vanity:[1,"vanity"]},decls:39,vars:14,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],[1,"trigger-type-row"],["lines","none",1,"app-select","trigger-select"],["label","","labelPlacement","stacked","interface","popover",1,"app-select","no-label",3,"ionChange","value"],[3,"value"],[1,"type-segment"],["mode","ios",3,"ionChange","value"],["value","email"],["value","notification"],["lines","none",1,"app-select"],["labelPlacement","stacked",3,"ngModelChange","label","placeholder","ngModel"],[3,"ionChange","checked"],[1,"label-padding-left"],["labelPlacement","stacked",3,"ngModelChange","spellcheck","rows","autoGrow","label","placeholder","ngModel"]],template:function(e,t){e&1&&(a(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),N(3,"ion-back-button"),r(),a(4,"ion-title",2),g(5,"Messages"),r(),a(6,"ion-buttons",3)(7,"ion-button",4),d("click",function(){return t.save()}),g(8,"Save"),r()()()(),a(9,"ion-content",5)(10,"div",6)(11,"ion-card",7)(12,"ion-card-content",7)(13,"ion-list",8)(14,"div",9)(15,"ion-item",10)(16,"ion-select",11),d("ionChange",function(s){return t.onSelectChange(s)}),h(17,ne,2,2,"ion-select-option",12,te),r()(),a(19,"ion-item",13)(20,"ion-segment",14),d("ionChange",function(s){return t.onTypeChange(s)}),a(21,"ion-segment-button",15)(22,"ion-label"),g(23,"Email"),r()(),a(24,"ion-segment-button",16)(25,"ion-label"),g(26,"Notification"),r()()()()(),a(27,"ion-item",17)(28,"ion-select",11),d("ionChange",function(s){return t.updateOffset(s.detail.value)}),h(29,se,2,2,"ion-select-option",12,ie),r()(),a(31,"ion-item")(32,"ion-input",18),d("ngModelChange",function(s){return t.updateSubject(s)}),r()(),a(33,"ion-item",8)(34,"ion-checkbox",19),d("ionChange",function(s){return t.updateEnabled(s.detail.checked)}),r(),a(35,"ion-label",20),g(36,"Enabled"),r()(),a(37,"ion-item")(38,"ion-textarea",21),d("ngModelChange",function(s){return t.updateBody(s)}),r()()()()()()()),e&2&&(l(9),o("fullscreen",!0),l(7),o("value",t.selectedTrigger()),l(),y(t.triggerOptions),l(3),o("value",t.selectedType()),l(8),o("value",t.currentTemplate.timeOffset||t.selectedOffset()),l(),y(t.getTimingOptionsForCurrentTrigger()),l(3),o("label",t.selectedType()==="email"?"Subject":"Title")("placeholder",t.selectedType()==="email"?"Email subject":"Notification message")("ngModel",t.currentTemplate.subject),l(2),o("checked",t.currentTemplate.enabled),l(4),o("spellcheck",!0)("rows",10)("autoGrow",!0)("label",t.selectedType()==="email"?"Body":"Message")("placeholder",t.selectedType()==="email"?"Email body":"Notification body")("ngModel",t.currentTemplate.body))},dependencies:[F,x,z,Y,R,B,K,W,A,$,X,H,q,U,G,Q,V,L,J,k,P,D],styles:[".trigger-type-row[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-lg);align-items:flex-start}.trigger-select-wrapper[_ngcontent-%COMP%], .trigger-select[_ngcontent-%COMP%]{flex:1}.type-segment[_ngcontent-%COMP%]{flex:0 0 auto}ion-segment[_ngcontent-%COMP%]{margin-top:var(--spacing-lg);width:250px}ion-segment-button[_ngcontent-%COMP%]{padding-top:var(--spacing-xs);padding-bottom:var(--spacing-xs)}"]});var ee=c;export{ee as MessageTriggersPage};
