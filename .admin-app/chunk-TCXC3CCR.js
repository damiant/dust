import{a as T}from"./chunk-VSRM7UBH.js";import"./chunk-5CHPG7GP.js";import{a as fe}from"./chunk-ROJXBKDX.js";import{a as xe}from"./chunk-XS7NHT5I.js";import{a as Ce}from"./chunk-TM3WTZXM.js";import{c as I}from"./chunk-OZ2IKH4J.js";import{M as ge,N as he,Y as ye}from"./chunk-IKEGAJLW.js";import{G as ue,l as me,v as _e}from"./chunk-YDFKN7Z7.js";import"./chunk-XMQYHBKU.js";import{$ as c,$a as Q,Bc as ce,Cc as pe,D as V,Ea as j,G as a,I as b,Kb as Y,L as k,Pa as F,Pb as J,Rb as X,Sb as Z,Tb as $,Ub as ee,V as g,W as h,Y as E,Ya as N,Z as W,Zb as te,_ as L,aa as r,ba as l,ca as w,cb as q,dc as ie,ea as A,ec as ne,fa as f,ga as d,gc as ae,hb as G,ka as U,kb as z,la as B,lc as oe,ma as O,oc as re,p as M,pb as H,pc as le,ra as R,rb as K,rc as se,s as p,sa as _,t as m,ta as P,ua as D,w as S,wc as de,xa as y,ya as C,za as x}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as u}from"./chunk-LNJ3S2LQ.js";var we=n=>[n];function be(n,i){if(n&1&&(r(0,"ion-select-option",13),_(1),l()),n&2){let e=i.$implicit;c("value",e),a(),P(e)}}function Ae(n,i){if(n&1&&w(0,"img",16),n&2){let e=d(2);c("src",e.imageUrl,V)}}function Ie(n,i){if(n&1&&(r(0,"p"),_(1),l()),n&2){let e=d(2);a(),D("Click to choose an optional image for your ",e.title())}}function Pe(n,i){if(n&1){let e=A();r(0,"ion-item")(1,"app-emails",20),x("emailsChange",function(t){p(e);let s=d(2);return C(s.art.contact_email,t)||(s.art.contact_email=t),m(t)}),l()()}if(n&2){let e=d(2);a(),c("isAdmin",e.isAdmin)("isOwner",!1)("label","Art Owner(s)")("placeholder","Email address of Art owner"),y("emails",e.art.contact_email)}}function Te(n,i){if(n&1){let e=A();r(0,"app-tooltip",18)(1,"ion-button",21),f("click",function(){p(e);let t=d(2);return m(t.invite())}),_(2,"Invite"),l()()}if(n&2){let e=d(2);a(),c("disabled",e.inviting)}}function Me(n,i){if(n&1&&(r(0,"app-tooltip",22)(1,"ion-button",23),_(2," Place "),l()(),r(3,"ion-button",24),_(4," Delete "),l(),_(5,"\xA0 "),w(6,"ion-alert",25)),n&2){let e=d(2);a(),c("routerLink","../../map/art/"+j(2,we,e.art.id)),a(5),c("buttons",e.deleteButtons)}}function Se(n,i){if(n&1){let e=A();r(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.name,t)||(s.art.name=t),m(t)}),l()(),r(6,"ion-item")(7,"ion-input",9),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.artist,t)||(s.art.artist=t),m(t)}),l()(),r(8,"ion-item")(9,"ion-input",10),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.url,t)||(s.art.url=t),m(t)}),l()(),r(10,"ion-item",11)(11,"ion-select",12),f("ngModelChange",function(){p(e);let t=d();return m(t.artTypeChanged())}),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.art_type,t)||(s.art.art_type=t),m(t)}),W(12,be,2,2,"ion-select-option",13,E),l()(),r(14,"ion-item")(15,"ion-textarea",14),x("ngModelChange",function(t){p(e);let s=d();return C(s.art.description,t)||(s.art.description=t),m(t)}),l()(),r(16,"div",15),f("click",function(){p(e);let t=d();return m(t.upload.click())}),g(17,Ae,1,1,"img",16),g(18,Ie,2,1,"p"),l(),g(19,Pe,2,5,"ion-item"),l(),r(20,"div",17),g(21,Te,3,1,"app-tooltip",18),g(22,Me,7,4),r(23,"ion-button",3),f("click",function(){p(e);let t=d();return m(t.save())}),_(24,"Save"),l()(),r(25,"app-upload",19),f("upload",function(t){p(e);let s=d();return m(s.uploaded(t))}),l()()()()}if(n&2){let e=d();a(5),c("label",e.title()+" Title")("placeholder","Title of the "+e.title()),y("ngModel",e.art.name),a(2),y("ngModel",e.art.artist),a(2),c("placeholder","URL for the "+e.art.art_type+" project"),y("ngModel",e.art.url),a(2),c("value",e.art.art_type),y("ngModel",e.art.art_type),a(),L(e.artTypes),a(3),c("spellcheck",!0)("rows",6)("autoGrow",!0)("maxlength",1e3),y("ngModel",e.art.description),a(),R(e.uploading?"disabled":""),a(),h(e.imageUrl?17:-1),a(),h(e.imageUrl?-1:18),a(),h(e.isAdmin?19:-1),a(2),h(e.id&&e.isAdmin?21:-1),a(),h(e.id&&e.canPlace?22:-1),a(),c("disabled",e.busy)}}function Ve(n,i){n&1&&w(0,"app-spinner")}var v=class v{constructor(i,e,o){this.api=i;this.alert=e;this.location=o;this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.inviting=!1;this.canPlace=!1;this.title=S("Art");this.artTypes=["Art","Mutant Vehicle"];this.route=M(N);this.art={name:"",pin:"",description:"",category:"Open Playa Art",id:void 0,contact_email:"",art_type:this.artTypes[0]};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];ye({mapOutline:he,mailOutline:ge})}uploaded(i){this.imageUrl=i.url,this.imageChanged=!0,this.blob=i.blob}ionViewWillEnter(){return u(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.id=me(this.id),this.art=yield this.api.getArt(this.id),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.imageUrl=this.api.imageURL(this.art.imageUrl);let i=this.route.snapshot.queryParams.type;!this.art.id&&i&&(this.art.art_type=i,this.title.set(i)),this.busy=!1})}artTypeChanged(){setTimeout(()=>{this.title.set(this.art.art_type)},10)}presentAlert(i){return u(this,null,function*(){yield(yield this.alert.create({header:"Message",message:i,buttons:["OK"]})).present()})}delete(){return u(this,null,function*(){this.busy=!0,yield this.api.deleteArt(this.art),this.api.clearCache(),this.busy=!1,this.location.back()})}save(i=!0){return u(this,null,function*(){this.busy=!0,_e(this.art);try{let e=yield this.api.addArt(this.art);if(this.busy=!1,e.message)this.presentAlert(e.message);else{if(e.id&&this.imageChanged){console.log(`Uploaded image for art ${e.id}`),this.busy=!0;try{yield this.uploadImage(e.id)}finally{this.busy=!1,this.imageChanged=!1}}this.art.id||(yield this.presentAlert("Thank you for your Art submission.")),this.api.clearCache(),i&&this.location.back()}}finally{this.busy=!1}})}uploadImage(i){return u(this,null,function*(){if(this.blob)try{this.uploading=!0,this.art.imageUrl=yield this.api.setImage(this.blob,i);let e=yield this.api.addArt(this.art);e.message&&this.presentAlert(e.message)}finally{this.uploading=!1}})}invite(){return u(this,null,function*(){if(!this.art.contact_email){yield I(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let i=yield this.api.inviteArt(this.art);i.message?I(this.alert,i.message):I(this.alert,"The art owner has been invited to manage their art.","Invitation")})}};v.\u0275fac=function(e){return new(e||v)(b(ue),b(se),b(F))},v.\u0275cmp=k({type:v,selectors:[["app-art"]],viewQuery:function(e,o){if(e&1&&U(T,5),e&2){let t;B(t=O())&&(o.upload=t.first)}},inputs:{id:"id",vanity:"vanity"},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["labelPlacement","stacked",3,"ngModelChange","label","placeholder","ngModel"],["label","Artist","labelPlacement","stacked","placeholder","Name of the artist",3,"ngModelChange","ngModel"],["label","URL","labelPlacement","stacked",3,"ngModelChange","placeholder","ngModel"],["lines","none",1,"app-select"],["labelPlacement","stacked","label","Type","interface","popover","placeholder","Select the type of art",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["labelPlacement","stacked","label","Description","placeholder","Description of the art",3,"ngModelChange","spellcheck","rows","autoGrow","maxlength","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[1,"center"],["text","Invite art owner via email to manage their art"],[3,"upload"],["helperText","The art owner(s) can login and alter the description and events at the art. This is a list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["color","secondary",3,"click","disabled"],["text","Place the art on the map"],["color","secondary",3,"routerLink"],["id","deleteArt","color","secondary"],["trigger","deleteArt","header","Delete Art?",3,"buttons"]],template:function(e,o){e&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),w(3,"ion-back-button"),l(),r(4,"ion-title"),_(5),l(),r(6,"ion-buttons",2)(7,"ion-button",3),f("click",function(){return o.save()}),_(8,"Save"),l()()()(),r(9,"ion-content",4),g(10,Se,26,21,"div",5)(11,Ve,1,0,"app-spinner"),l()),e&2&&(a(5),P(o.id||o.art.id?"Edit "+o.title():"Add "+o.title()),a(2),c("disabled",o.busy),a(2),c("fullscreen",!0),a(),h(o.busy?11:10))},dependencies:[J,Ce,T,K,G,H,z,fe,q,Q,ie,le,Z,Y,re,X,te,$,ee,ae,xe,ne,de,pe,ce,oe],encapsulation:2});var ve=v;export{ve as ArtItemPage};
