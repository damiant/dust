import{a as it}from"./chunk-YNP25RQU.js";import{a as et}from"./chunk-MTPZGFQA.js";import{c as l}from"./chunk-OZ2IKH4J.js";import"./chunk-NBGQYW5Y.js";import"./chunk-HTUMMCB5.js";import"./chunk-I4H34LCA.js";import"./chunk-GDAPN2EF.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-STA5XHHU.js";import"./chunk-NPRM7GGH.js";import"./chunk-SFJBRZ2Y.js";import"./chunk-I5V6RRU4.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-3QBWF6TQ.js";import"./chunk-MCRJI3T3.js";import"./chunk-GTAO53MO.js";import"./chunk-JEOCIQEZ.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import"./chunk-W4BNGQYG.js";import{K as X,Y as Z,Z as tt,g as Q}from"./chunk-2G3SQA7K.js";import{H as J,g as j,l as q}from"./chunk-5TGYAYRP.js";import{b as w}from"./chunk-XMQYHBKU.js";import{$ as d,G as r,L as E,Lb as V,Sb as $,Tb as L,Ub as O,V as k,Va as A,Vb as z,W as C,Wb as D,Yb as F,Za as N,_b as U,aa as o,ab as B,ac as W,ba as a,bc as G,ca as m,db as T,ea as v,ec as K,fa as g,ga as c,p as _,pc as R,qc as H,s as h,sb as M,t as f,ta as u,ua as P,w as I,wc as Y}from"./chunk-LVKFIXIJ.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as p}from"./chunk-LNJ3S2LQ.js";var x=w("Geolocation",{web:()=>import("./chunk-HLKWCBAN.js").then(i=>new i.GeolocationWeb)});var y=w("Network",{web:()=>import("./chunk-VU2VAKQR.js").then(i=>new i.NetworkWeb)});var S=w("KeepAwake",{web:()=>import("./chunk-OVPTEZJ5.js").then(i=>new i.KeepAwakeWeb)});function ot(i,t){if(i&1){let e=v();o(0,"ion-fab",9)(1,"ion-buttons")(2,"ion-fab-button",13),g("click",function(){h(e);let s=c();return f(s.checkLocation())}),m(3,"ion-icon",14),a(),o(4,"ion-fab-button",13),g("click",function(){h(e);let s=c();return f(s.checkNetwork())}),m(5,"ion-icon",15),a(),o(6,"ion-fab-button",13),g("click",function(){h(e);let s=c();return f(s.checkAwake())}),m(7,"ion-icon",16),a()()()}if(i&2){let e=c();r(2),d("disabled",!e.running)("color",e.location?"tertiary":e.running?"warning":"light"),r(2),d("disabled",!e.running)("color",e.wifi?"tertiary":e.running?"warning":"light"),r(2),d("disabled",!e.running)("color",e.awake?"tertiary":e.running?"warning":"light")}}function at(i,t){i&1&&(o(0,"ion-button",12),u(1,"Connecting"),a())}function rt(i,t){if(i&1){let e=v();o(0,"ion-button",18),g("click",function(){h(e);let s=c(2);return f(s.start())}),u(1,"Start"),a()}}function st(i,t){if(i&1){let e=v();o(0,"ion-button",18),g("click",function(){h(e);let s=c(2);return f(s.stop())}),u(1,"Stop"),a()}}function ct(i,t){if(i&1&&k(0,rt,2,0,"ion-button",17)(1,st,2,0,"ion-button",17),i&2){let e=c();C(e.running?1:0)}}var b=class b{constructor(){this.running=!1;this.processing=!1;this.wifi=!1;this.location=!1;this.apiError=!1;this.awake=!1;this.message=I("");this.route=_(N);this.api=_(J);this.alert=_(et);tt({locationSharp:X,wifiSharp:Z,cafeSharp:Q})}ngOnInit(){return p(this,null,function*(){this.artId=q(this.route.snapshot.queryParams.art),this.art=this.artId?yield this.api.getArt(this.artId):void 0,this.setMessage(),y.addListener("networkStatusChange",t=>{this.processNetwork(t)}),yield j(500),this.start()})}start(){return p(this,null,function*(){try{this.processing=!0,this.watchId=yield x.watchPosition({},t=>{if(!t){this.location=!1,console.error("No position");return}this.processPosition(t)}),this.processPosition(yield x.getCurrentPosition()),this.running=!0,this.processNetwork(yield y.getStatus()),yield this.keepAwake(!0)}catch(t){yield l(this.alert,`Unable to start geolocation watching: ${JSON.stringify(t)}`,"Error")}finally{this.processing=!1}})}checkNetwork(){var n;if(!this.connectionStatus){l(this.alert,"Network is disabled.");return}let t="";switch(this.connectionStatus.connectionType){case"wifi":t="WiFi ";break;case"cellular":t="Cellular ";break;case"none":t="";break;default:t="";break}let e=`${t}Network is ${this.connectionStatus.connected?"connected":"disconnected"}.`;this.apiError&&this.connectionStatus.connected&&(e+=`Network appears to be connected but unable to broadcast ${(n=this.art)==null?void 0:n.name}'s location. Possible bad cell service or backend error.`),l(this.alert,e,"Network Status")}checkAwake(){return p(this,null,function*(){(yield S.isSupported()).isSupported?l(this.alert,"Your device supports keeping the screen awake.","Awake Status"):l(this.alert,"Your device does not support keeping the screen awake.","Error")})}checkLocation(){if(!this.position){l(this.alert,"Location is disabled.");return}l(this.alert,`Last location was ${this.position.coords.latitude}, ${this.position.coords.longitude} at ${this.timeStamp()}.`,"Location Status")}image(){let t=this.art;return t?t.imageUrl?this.api.imageURL(t.imageUrl):`./assets/${t.art_type?`${t.art_type}`.toLowerCase().replace(/ /g,"-"):"unknown"}.svg`:"./assets/mutant-vehicle.svg"}processPosition(t){console.log(`Processing position ${t}`),this.position=t,this.broadcast(t),this.setMessage()}processNetwork(t){this.wifi=t.connected,this.connectionStatus=t}timeStamp(){var e;return new Date(((e=this.position)==null?void 0:e.timestamp)||0).toLocaleTimeString()}setMessage(){var t,e,n;this.apiError&&this.message.set(`Error: Unable to broadcast ${(t=this.art)==null?void 0:t.name}'s location to the dust app.`),this.position?(this.message.set(`${(e=this.art)==null?void 0:e.name}'s location is being broadcast to the dust app.`),this.location=!0):(this.message.set(`This will broadcast the location of ${(n=this.art)==null?void 0:n.name} so that users of the dust app can find it on the map.`),this.location=!1)}broadcast(t){return p(this,null,function*(){if(!this.art){console.error("No art");return}try{yield this.api.broadcast(this.art,t),this.apiError=!1,this.setMessage()}catch{this.wifi=!1,this.apiError=!0,this.setMessage()}})}keepAwake(t){return p(this,null,function*(){t?(this.awake=!1,yield S.keepAwake(),this.awake=!0):this.awake&&(yield S.allowSleep(),this.awake=!1)})}stop(){return p(this,null,function*(){this.watchId&&(yield x.clearWatch({id:this.watchId})),this.position=void 0,this.running=!1,this.setMessage(),yield this.keepAwake(!1)})}};b.\u0275fac=function(e){return new(e||b)},b.\u0275cmp=E({type:b,selectors:[["app-broadcast"]],decls:22,vars:7,consts:[[3,"translucent"],["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],[3,"fullscreen"],[1,"pad-below","grid1"],[1,"grid-item"],[3,"src"],["horizontal","center",2,"margin-top","-60px"],[1,"message"],[1,"dim",2,"text-align","center","padding-top","0.5rem"],["shape","round","size","large","color","light"],[3,"click","disabled","color"],["name","location-sharp"],["name","wifi-sharp"],["name","cafe-sharp"],["shape","round","size","large","color","primary"],["shape","round","size","large","color","primary",3,"click"]],template:function(e,n){e&1&&(o(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),m(3,"ion-back-button"),a(),o(4,"ion-title",3),u(5,"Broadcast Location"),a(),m(6,"ion-buttons",4),a()(),o(7,"ion-content",5)(8,"div",6)(9,"div",7)(10,"ion-card"),m(11,"app-img",8),o(12,"ion-card-header"),k(13,ot,8,6,"ion-fab",9),o(14,"ion-card-title"),u(15),a()(),o(16,"ion-card-content")(17,"div",10),u(18),a(),o(19,"div",11),k(20,at,2,0,"ion-button",12)(21,ct,2,1),a()()()()()()),e&2&&(d("translucent",!0),r(7),d("fullscreen",!0),r(4),d("src",n.image()),r(2),C((n.running,13)),r(2),P(n.art==null?null:n.art.name),r(3),P(n.message()),r(2),C(n.processing?20:21))},dependencies:[W,G,V,Y,$,T,B,L,D,F,z,it,O,U,K,R,H,A,M],styles:[".message[_ngcontent-%COMP%]{min-height:6rem}ion-fab-button[_ngcontent-%COMP%]{margin:.5rem}.img[_ngcontent-%COMP%]{min-height:14rem}ion-card-title[_ngcontent-%COMP%]{text-align:center;font-size:var(--fs2)}ion-card-content[_ngcontent-%COMP%]{font-size:var(--fs3);text-align:center}"]});var nt=b;export{nt as BroadcastPage};
