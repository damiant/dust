import{a as fe}from"./chunk-KHCCSUXA.js";import{a as ce}from"./chunk-5CHPG7GP.js";import{a as ge}from"./chunk-WENQGBHZ.js";import{a as _e}from"./chunk-7JOWX4HZ.js";import{a as pe}from"./chunk-62UAFX4O.js";import"./chunk-2QPEVPNK.js";import{E as me,e as M,m as re,o as de,u as P}from"./chunk-GUYT2OMO.js";import"./chunk-MIGJGGKJ.js";import{$b as j,A as d,B as m,Ba as z,Ca as _,Da as T,Dc as oe,Ec as le,Ha as f,Ia as g,Ja as h,Mb as G,Nb as R,P as V,S as c,Tb as Z,Ua as U,Ub as A,Vb as Q,Wb as Y,Y as F,aa as v,ac as H,ea as p,fc as J,ga as I,gc as K,ha as x,hc as X,ia as k,ic as $,ja as W,ka as E,la as a,ma as s,na as C,nb as O,nc as ee,ob as q,pa as b,qa as u,qc as te,ra as l,rc as ie,tb as N,vc as ne,w as S,wa as L,wc as ae,xa as B,ya as D,yc as se}from"./chunk-6CV35SS5.js";import"./chunk-ATW7DGUS.js";import"./chunk-7KGURMOZ.js";import"./chunk-UXWCR2YA.js";import"./chunk-QYFQMV2H.js";import"./chunk-ORVKXEJA.js";import"./chunk-KBMMZLX2.js";import"./chunk-5J6JP6Q2.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as y}from"./chunk-LNJ3S2LQ.js";var ve=["gps"];function Ce(r,o){if(r&1&&C(0,"img",12),r&2){let t=l(2);p("src",t.imageUrl,V)}}function we(r,o){r&1&&(a(0,"p"),_(1,"Click to choose an image"),s())}function ye(r,o){if(r&1){let t=b();a(0,"ion-datetime",28),h("ngModelChange",function(e){d(t);let i=l(2);return g(i.festival.start_time,e)||(i.festival.start_time=e),m(e)}),u("ionChange",function(){d(t);let e=l(2);return m(e.startChanged())}),s()}if(r&2){let t=l(2);p("showDefaultButtons",!0),f("ngModel",t.festival.start_time)}}function xe(r,o){if(r&1){let t=b();a(0,"ion-datetime",29),h("ngModelChange",function(e){d(t);let i=l(2);return g(i.festival.end_time,e)||(i.festival.end_time=e),m(e)}),u("ionChange",function(){d(t);let e=l(2);return m(e.endChanged())}),s()}if(r&2){let t=l(2);p("showDefaultButtons",!0),f("ngModel",t.festival.end_time)}}function be(r,o){if(r&1&&(a(0,"ion-select-option",21),_(1),s()),r&2){let t=o.$implicit;p("value",t),c(),T(t)}}function Me(r,o){if(r&1){let t=b();a(0,"ion-button",30),u("click",function(){d(t);let e=l(2);return m(e.delete())}),_(1,"Delete"),s()}r&2&&p("disabled",!0)}function Se(r,o){if(r&1){let t=b();a(0,"div",7)(1,"ion-card")(2,"ion-card-content")(3,"ion-list",8)(4,"ion-item")(5,"ion-input",9),h("ngModelChange",function(e){d(t);let i=l();return g(i.festival.name,e)||(i.festival.name=e),m(e)}),s()(),a(6,"ion-item")(7,"ion-textarea",10),h("ngModelChange",function(e){d(t);let i=l();return g(i.festival.description,e)||(i.festival.description=e),m(e)}),s()(),a(8,"div",11),u("click",function(){d(t);let e=z(50);return m(e.click())}),v(9,Ce,1,1,"img",12)(10,we,2,0,"p"),s(),a(11,"ion-item")(12,"app-emails",13),h("emailsChange",function(e){d(t);let i=l();return g(i.festival.admins,e)||(i.festival.admins=e),m(e)}),s()(),a(13,"ion-item")(14,"ion-input",14),h("ngModelChange",function(e){d(t);let i=l();return g(i.festival.region,e)||(i.festival.region=e),m(e)}),s()(),a(15,"ion-item")(16,"ion-input",15),h("ngModelChange",function(e){d(t);let i=l();return g(i.festival.website,e)||(i.festival.website=e),m(e)}),s()(),a(17,"ion-item")(18,"ion-checkbox",16),h("ngModelChange",function(e){d(t);let i=l();return g(i.festival.unknown_dates,e)||(i.festival.unknown_dates=e),m(e)}),_(19,"Dates are not known yet"),s()(),a(20,"ion-item")(21,"ion-label"),_(22,"Start"),s(),C(23,"ion-datetime-button",17),s(),a(24,"ion-modal",18),v(25,ye,1,2,"ng-template"),s(),a(26,"ion-item")(27,"ion-label"),_(28,"End"),s(),C(29,"ion-datetime-button",19),s(),a(30,"ion-modal",18),v(31,xe,1,2,"ng-template"),s(),a(32,"ion-item")(33,"ion-select",20),h("ngModelChange",function(e){d(t);let i=l();return g(i.festival.timezone,e)||(i.festival.timezone=e),m(e)}),W(34,be,2,2,"ion-select-option",21,k),s()(),a(36,"ion-item")(37,"ion-checkbox",16),h("ngModelChange",function(e){d(t);let i=l();return g(i.festival.active,e)||(i.festival.active=e),m(e)}),_(38,"Display in the Dust app"),s()(),a(39,"ion-item")(40,"ion-label",22),u("click",function(){d(t);let e=l();return m(e.openLocation())}),a(41,"app-tooltip",23),_(42," Location "),s()(),a(43,"app-gps",24,0),h("latChange",function(e){d(t);let i=l();return g(i.festival.gpsLat,e)||(i.festival.gpsLat=e),m(e)})("lngChange",function(e){d(t);let i=l();return g(i.festival.gpsLng,e)||(i.festival.gpsLng=e),m(e)}),u("gpsChange",function(e){d(t);let i=l();return m(i.gpsChanged(e))}),s()()(),a(45,"div",25),v(46,Me,2,1,"ion-button",26),a(47,"ion-button",5),u("click",function(){d(t);let e=l();return m(e.save())}),_(48,"Save"),s()(),a(49,"input",27,1),u("change",function(e){d(t);let i=l();return m(i.onFileSelected(e))}),s()()()()}if(r&2){let t=l();c(5),f("ngModel",t.festival.name),c(2),p("spellcheck",!0)("rows",6)("autoGrow",!0),f("ngModel",t.festival.description),c(),I(t.uploading?"disabled":""),c(),x(t.imageUrl?9:-1),c(),x(t.imageUrl?-1:10),c(2),p("isAdmin",!0)("isOwner",!0)("label","Administrator Emails")("placeholder","Comma delimited list of email addresses"),f("emails",t.festival.admins),c(2),f("ngModel",t.festival.region),c(2),f("ngModel",t.festival.website),c(2),f("ngModel",t.festival.unknown_dates),c(6),p("keepContentsMounted",!0),c(6),p("keepContentsMounted",!0),c(3),p("value",t.festival.timezone),f("ngModel",t.festival.timezone),c(),E(t.timezones),c(3),f("ngModel",t.festival.active),c(6),f("lat",t.festival.gpsLat)("lng",t.festival.gpsLng),c(3),x(t.canDelete?46:-1)}}function Te(r,o){r&1&&C(0,"app-spinner")}var w=class w{constructor(){this.busy=!0;this.canDelete=!1;this.uploading=!1;this.endModified=!1;this.timezones=[];this.imageChanged=!1;this.location=S(U);this.api=S(me);this.festival={name:"",vanity:"",admins:"",contact:"",description:"",mastodon_handle:"",inbox_email:"",region:"",website:"",start_time:new Date().toISOString(),end_time:new Date().toISOString(),camp_registration:!1,gpsLat:0,gpsLng:0,camp_editing:!1,event_registration:!1,approved:!1,event_editing:!1,art_editing:!1,archived:!1,map_direction:0,event_types:"",max_event_types:2,pin:void 0,directions:void 0,unknown_dates:!1,volunteeripate_domain:"",volunteeripate_identifier:"",rss_feed:"",id:void 0,active:!1,timezone:this.api.currentTimeZone()}}ionViewWillEnter(){return y(this,null,function*(){let o=this.api.festivalId;this.vanity?yield this.api.setFestivalByVanity(this.vanity):o=void 0,this.festival=yield this.api.getFestival(o,{cached:!1}),this.canDelete=!!this.festival.id,this.festival.timezone||(this.festival.timezone=this.api.currentTimeZone()),this.imageUrl=this.api.imageURL(this.festival.imageUrl),this.busy=!1,this.timezones=Intl.supportedValuesOf("timeZone")})}ionViewWillLeave(){this.gps&&this.gps.cleanup()}startChanged(){this.endModified||(this.festival.end_time=de(re(this.festival.start_time),24).toISOString())}endChanged(){this.endModified=!0}delete(){}gpsChanged(o){this.festival.gpsLat=o.lat,this.festival.gpsLng=o.lng}fixUniqueId(){this.festival.id||(this.festival.vanity=this.festival.name.toLowerCase().trim().replace(/\s+/g,"-"))}onFileSelected(o){return y(this,null,function*(){let t=o.target.files[0];if(!t)return;let n={width:0,height:0};if(this.blob=yield ce(t,{quality:75,width:300},n),n.width!==n.height){this.api.sendMessage("The image needs to be square (width and height must be equal)");return}let e=URL.createObjectURL(this.blob);this.imageUrl=e,this.imageChanged=!0})}setTime(o,t){return o.substring(0,10)+t}save(){return y(this,null,function*(){this.festival.start_time=this.setTime(this.festival.start_time,"T00:00:00"),this.festival.end_time=this.setTime(this.festival.end_time,"T23:59:59");let o=new Date(this.festival.start_time+P(this.festival.timezone)),t=new Date(this.festival.end_time+P(this.festival.timezone)),n=Math.round((t-o)/1e3/60/60);if(isNaN(n)){this.api.sendMessage("The start and end time must be set");return}if(n<0){this.api.sendMessage("The end time must be after the start time");return}if(n<24){this.api.sendMessage("The event must be at least 1 day long");return}if(n>24*30){this.api.sendMessage("The event cannot be longer than 30 days");return}if(this.festival.name.length<4){this.api.sendMessage("The event name must be set");return}let e=new Date().getFullYear();if((this.festival.name.includes(e.toString())||this.festival.name.includes((e+1).toString())||this.festival.name.includes((e-1).toString()))&&!this.festival.archived){this.api.sendMessage("The event name cannot include the year in it");return}if(this.fixUniqueId(),this.festival.vanity.length<4){this.api.sendMessage("The unique identifier must be set");return}if(this.festival.vanity.includes(" ")){this.api.sendMessage("The unique identifier cannot contain spaces");return}if(this.festival.description.length<4){this.api.sendMessage("The event description must be set");return}if(this.festival.timezone||(this.festival.timezone=this.api.currentTimeZone()),this.festival.active){if(M(this.festival.imageUrl)&&M(this.imageUrl)){this.api.sendMessage("You need an image to display the event in the dust app");return}if(this.festival.gpsLat==0||this.festival.gpsLng==0){this.api.sendMessage("You need to set the GPS location to display the event in the dust app");return}if(M(this.festival.region)){this.api.sendMessage("You need to set the region to display the event in the dust app");return}}if(!M(this.festival.website)&&!this.festival.website.startsWith("https://")){this.api.sendMessage("The website must start with https://");return}this.busy=!0;try{let i=yield this.api.addFestival(this.festival);if(i.message&&i.message!=""){this.api.sendMessage(i.message),this.busy=!1;return}else if(i.id&&this.imageChanged){let ue=yield this.api.getFestival(i.id,{cached:!1});this.api.setFestival(ue),yield this.uploadImage(i.id)}this.api.clearCache(),this.busy=!1,this.location.back()}catch(i){console.error(i),this.busy=!1;return}})}uploadImage(o){return y(this,null,function*(){if(this.blob)try{this.uploading=!0,this.festival.imageUrl=yield this.api.setImage(this.blob,o);let t=yield this.api.addFestival(this.festival);t.message&&this.api.sendMessage(t.message),this.imageChanged=!1}finally{this.uploading=!1}})}openLocation(){let o=`https://www.google.com/maps/search/?api=1&query=${this.festival.gpsLat},${this.festival.gpsLng}`;window.open(o,"_blank")}};w.\u0275fac=function(t){return new(t||w)},w.\u0275cmp=F({type:w,selectors:[["app-festival"]],viewQuery:function(t,n){if(t&1&&L(ve,5),t&2){let e;B(e=D())&&(n.gps=e.first)}},inputs:{vanity:"vanity"},decls:13,vars:3,consts:[["gps",""],["fileUpload",""],["color","primary"],["slot","start"],["slot","end"],[3,"click"],[3,"fullscreen"],[1,"border"],["lines","none"],["label","Burn Name","labelPlacement","stacked","placeholder","Name of the burn",3,"ngModelChange","ngModel"],["labelPlacement","stacked","label","Description","placeholder","Description of the burn",3,"ngModelChange","spellcheck","rows","autoGrow","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],["helperText","",1,"emails",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["label","Region","labelPlacement","stacked","placeholder","City, State/Country",3,"ngModelChange","ngModel"],["label","Website","labelPlacement","stacked","placeholder","eg https://myburn.com",3,"ngModelChange","ngModel"],["labelPlacement","start",3,"ngModelChange","ngModel"],["datetime","datetime"],[3,"keepContentsMounted"],["datetime","datetimeEnd"],["label","Timezone","interface","popover","placeholder","Select the timezone of the event",3,"ngModelChange","value","ngModel"],[3,"value"],[2,"width","100%",3,"click"],["position","left","text","This is used for the directions button in the app. Right click in Google Maps to copy lat/long and paste here."],[3,"latChange","lngChange","gpsChange","lat","lng"],[1,"center"],["color","secondary",3,"disabled"],["type","file",1,"file-input",3,"change"],["presentation","date","minuteValues","0,15,30,45","id","datetime",3,"ngModelChange","ionChange","showDefaultButtons","ngModel"],["presentation","date","minuteValues","0,15,30,45","id","datetimeEnd",3,"ngModelChange","ionChange","showDefaultButtons","ngModel"],["color","secondary",3,"click","disabled"]],template:function(t,n){t&1&&(a(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-buttons",3),C(4,"ion-back-button"),s()(),a(5,"ion-title"),_(6),s(),a(7,"ion-buttons",4)(8,"ion-button",5),u("click",function(){return n.save()}),_(9,"Save"),s()()()(),a(10,"ion-content",6),v(11,Se,51,25,"div",7)(12,Te,1,0,"app-spinner"),s()),t&2&&(c(6),T(n.vanity?"Edit Burn":"New Burn"),c(4),p("fullscreen",!0),c(),x(n.busy?12:11))},dependencies:[N,O,q,J,ie,A,G,ne,te,j,Q,Y,$,K,se,le,X,H,R,ae,pe,oe,ee,Z,fe,ge,_e],styles:[".emails[_ngcontent-%COMP%]{width:100%;padding-right:.5rem}"]});var he=w;export{he as FestivalPage};
