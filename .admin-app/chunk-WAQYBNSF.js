import{a as T}from"./chunk-2HWEYTHE.js";import"./chunk-OF25KEPG.js";import{a as ue}from"./chunk-S6IHJUHU.js";import{a as he}from"./chunk-45ZNVKGK.js";import{a as ge}from"./chunk-YZZAMJVJ.js";import{c as I}from"./chunk-LADCEZG6.js";import{F as me,G as pe,R as _e}from"./chunk-OAPJ7RFL.js";import{j as se,r as de,z as ce}from"./chunk-3H2U6HXL.js";import{$ as b,A as m,Aa as u,Ac as le,B as p,Ba as P,Fa as h,Ga as f,Ha as y,Ka as O,Kb as q,Nb as z,P as S,Pb as H,Qb as K,Rb as Y,S as a,Sa as D,Sb as J,T as v,X as M,Xb as X,bc as Z,cc as $,da as c,db as R,ec as ee,fa as k,ga as g,gb as j,ha as V,ia as E,ja as W,jc as te,ka as o,la as r,lb as F,ma as w,mb as N,mc as ie,nc as ne,oa as A,pa as C,pb as Q,pc as ae,qa as d,rb as G,uc as oe,wa as L,xa as U,ya as B,zc as re}from"./chunk-PNZTRGP7.js";import"./chunk-35XJAIHY.js";import"./chunk-7KGURMOZ.js";import"./chunk-W5R2B4OG.js";import"./chunk-SDKY465T.js";import"./chunk-45ASMX5N.js";import"./chunk-KM5AR3OJ.js";import"./chunk-XCRBEL2Y.js";import"./chunk-4U6PRYVA.js";import"./chunk-HJX2WMCX.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var ye=n=>[n];function Ce(n,i){if(n&1&&(o(0,"ion-select-option",13),u(1),r()),n&2){let e=i.$implicit;c("value",e),a(),P(e)}}function xe(n,i){if(n&1&&w(0,"img",16),n&2){let e=d(2);c("src",e.imageUrl,S)}}function be(n,i){n&1&&(o(0,"p"),u(1,"Click to choose an optional image for your art"),r())}function we(n,i){if(n&1){let e=A();o(0,"ion-item")(1,"app-emails",20),y("emailsChange",function(t){m(e);let l=d(2);return f(l.art.contact_email,t)||(l.art.contact_email=t),p(t)}),r()()}if(n&2){let e=d(2);a(),c("isAdmin",e.isAdmin)("isOwner",!1)("label","Art Owner(s)")("placeholder","Email address of Art owner"),h("emails",e.art.contact_email)}}function ve(n,i){if(n&1){let e=A();o(0,"app-tooltip",18)(1,"ion-button",21),C("click",function(){m(e);let t=d(2);return p(t.invite())}),u(2,"Invite"),r()()}if(n&2){let e=d(2);a(),c("disabled",e.inviting)}}function Ae(n,i){if(n&1&&(o(0,"app-tooltip",22)(1,"ion-button",23),u(2," Place "),r()(),o(3,"ion-button",24),u(4," Delete "),r(),u(5,"\xA0 "),w(6,"ion-alert",25)),n&2){let e=d(2);a(),c("routerLink","../../map/art/"+O(2,ye,e.art.id)),a(5),c("buttons",e.deleteButtons)}}function Ie(n,i){if(n&1){let e=A();o(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),y("ngModelChange",function(t){m(e);let l=d();return f(l.art.name,t)||(l.art.name=t),p(t)}),r()(),o(6,"ion-item")(7,"ion-input",9),y("ngModelChange",function(t){m(e);let l=d();return f(l.art.artist,t)||(l.art.artist=t),p(t)}),r()(),o(8,"ion-item")(9,"ion-input",10),y("ngModelChange",function(t){m(e);let l=d();return f(l.art.url,t)||(l.art.url=t),p(t)}),r()(),o(10,"ion-item",11)(11,"ion-select",12),y("ngModelChange",function(t){m(e);let l=d();return f(l.art.art_type,t)||(l.art.art_type=t),p(t)}),E(12,Ce,2,2,"ion-select-option",13,V),r()(),o(14,"ion-item")(15,"ion-textarea",14),y("ngModelChange",function(t){m(e);let l=d();return f(l.art.description,t)||(l.art.description=t),p(t)}),r()(),o(16,"div",15),C("click",function(){m(e);let t=d();return p(t.upload.click())}),b(17,xe,1,1,"img",16)(18,be,2,0,"p"),r(),b(19,we,2,5,"ion-item"),r(),o(20,"div",17),b(21,ve,3,1,"app-tooltip",18)(22,Ae,7,4),o(23,"ion-button",3),C("click",function(){m(e);let t=d();return p(t.save())}),u(24,"Save"),r()(),o(25,"app-upload",19),C("upload",function(t){m(e);let l=d();return p(l.uploaded(t))}),r()()()()}if(n&2){let e=d();a(5),h("ngModel",e.art.name),a(2),h("ngModel",e.art.artist),a(2),h("ngModel",e.art.url),a(2),c("value",e.art.art_type),h("ngModel",e.art.art_type),a(),W(e.artTypes),a(3),c("spellcheck",!0)("rows",6)("autoGrow",!0)("maxlength",1e3),h("ngModel",e.art.description),a(),k(e.uploading?"disabled":""),a(),g(e.imageUrl?17:-1),a(),g(e.imageUrl?-1:18),a(),g(e.isAdmin?19:-1),a(2),g(e.id&&e.isAdmin?21:-1),a(),g(e.id&&e.canPlace?22:-1),a(),c("disabled",e.busy)}}function Pe(n,i){n&1&&w(0,"app-spinner")}var x=class x{constructor(i,e,s){this.api=i;this.alert=e;this.location=s;this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.inviting=!1;this.canPlace=!1;this.artTypes=["Art","Mutant Vehicle"];this.art={name:"",pin:"",description:"",category:"Open Playa Art",id:void 0,contact_email:"",art_type:this.artTypes[0]};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];_e({mapOutline:pe,mailOutline:me})}uploaded(i){this.imageUrl=i.url,this.imageChanged=!0,this.blob=i.blob}ionViewWillEnter(){return _(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.id=se(this.id),this.art=yield this.api.getArt(this.id),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.imageUrl=this.api.imageURL(this.art.imageUrl),this.busy=!1})}presentAlert(i){return _(this,null,function*(){yield(yield this.alert.create({header:"Message",message:i,buttons:["OK"]})).present()})}delete(){return _(this,null,function*(){this.busy=!0,yield this.api.deleteArt(this.art),this.api.clearCache(),this.busy=!1,this.location.back()})}save(i=!0){return _(this,null,function*(){this.busy=!0,de(this.art);try{let e=yield this.api.addArt(this.art);if(this.busy=!1,e.message)this.presentAlert(e.message);else{if(e.id&&this.imageChanged){console.log(`Uploaded image for art ${e.id}`),this.busy=!0;try{yield this.uploadImage(e.id)}finally{this.busy=!1,this.imageChanged=!1}}this.art.id||(yield this.presentAlert("Thank you for your Art submission.")),this.api.clearCache(),i&&this.location.back()}}finally{this.busy=!1}})}uploadImage(i){return _(this,null,function*(){if(this.blob)try{this.uploading=!0,this.art.imageUrl=yield this.api.setImage(this.blob,i);let e=yield this.api.addArt(this.art);e.message&&this.presentAlert(e.message)}finally{this.uploading=!1}})}invite(){return _(this,null,function*(){if(!this.art.contact_email){yield I(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let i=yield this.api.inviteArt(this.art);i.message?I(this.alert,i.message):I(this.alert,"The art owner has been invited to manage their art.","Invitation")})}};x.\u0275fac=function(e){return new(e||x)(v(ce),v(ae),v(D))},x.\u0275cmp=M({type:x,selectors:[["app-art"]],viewQuery:function(e,s){if(e&1&&L(T,5),e&2){let t;U(t=B())&&(s.upload=t.first)}},inputs:{id:"id",vanity:"vanity"},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["label","Art Title","labelPlacement","stacked","placeholder","Title of the art piece",3,"ngModelChange","ngModel"],["label","Artist","labelPlacement","stacked","placeholder","Name of the artist",3,"ngModelChange","ngModel"],["label","URL","labelPlacement","stacked","placeholder","URL for the art project",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["labelPlacement","stacked","label","Type","interface","popover","placeholder","Select the type of art",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["labelPlacement","stacked","label","Description","placeholder","Description of the art",3,"ngModelChange","spellcheck","rows","autoGrow","maxlength","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[1,"center"],["text","Invite art owner via email to manage their art"],[3,"upload"],["helperText","The art owner(s) can login and alter the description and events at the art. This is a comma separated list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["color","secondary",3,"click","disabled"],["text","Place the art on the map"],["color","secondary",3,"routerLink"],["id","deleteArt","color","secondary"],["trigger","deleteArt","header","Delete Art?",3,"buttons"]],template:function(e,s){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),w(3,"ion-back-button"),r(),o(4,"ion-title"),u(5),r(),o(6,"ion-buttons",2)(7,"ion-button",3),C("click",function(){return s.save()}),u(8,"Save"),r()()()(),o(9,"ion-content",4),b(10,Ie,26,18,"div",5)(11,Pe,1,0,"app-spinner"),r()),e&2&&(a(5),P(s.id||s.art.id?"Edit Art":"Add Art"),a(2),c("disabled",s.busy),a(2),c("fullscreen",!0),a(),g(s.busy?11:10))},dependencies:[z,ge,T,G,F,Q,N,ue,j,R,Z,ne,K,q,ie,H,X,Y,J,ee,he,$,oe,le,re,te],encapsulation:2});var fe=x;export{fe as ArtItemPage};
