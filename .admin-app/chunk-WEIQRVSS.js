import{a as T}from"./chunk-5LL66565.js";import"./chunk-5CHPG7GP.js";import{a as fe}from"./chunk-IWMP2PAE.js";import{a as xe}from"./chunk-33V37WPV.js";import{a as Ce}from"./chunk-5HINJLXJ.js";import{c as I}from"./chunk-KVSZYKJC.js";import{M as ge,N as he,Y as ye}from"./chunk-IKEGAJLW.js";import{F as _e,l as me,v as ue}from"./chunk-CP2LIZQM.js";import"./chunk-MIGJGGKJ.js";import{A as p,B as m,Ca as u,Cc as de,Da as P,Ea as D,Ha as h,Hc as ce,Ia as f,Ic as pe,Ja as y,L as M,Ma as j,P as k,Qb as Y,S as a,T as w,Ua as F,Vb as J,Xb as X,Y as V,Yb as Z,Zb as $,_b as ee,aa as b,cb as N,dc as te,ea as c,fb as Q,ga as E,ha as g,ia as W,ib as q,ja as L,jc as ie,ka as U,kc as ne,la as r,ma as l,mc as ae,na as v,nb as G,pa as A,qa as C,qb as z,ra as d,rc as oe,uc as re,vb as H,vc as le,w as S,wa as B,xa as O,xb as K,xc as se,ya as R}from"./chunk-PHUHKYQ4.js";import"./chunk-ATW7DGUS.js";import"./chunk-7KGURMOZ.js";import"./chunk-UXWCR2YA.js";import"./chunk-QYFQMV2H.js";import"./chunk-ORVKXEJA.js";import"./chunk-KBMMZLX2.js";import"./chunk-5J6JP6Q2.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var ve=n=>[n];function we(n,i){if(n&1&&(r(0,"ion-select-option",13),u(1),l()),n&2){let e=i.$implicit;c("value",e),a(),P(e)}}function Ae(n,i){if(n&1&&v(0,"img",16),n&2){let e=d(2);c("src",e.imageUrl,k)}}function Ie(n,i){if(n&1&&(r(0,"p"),u(1),l()),n&2){let e=d(2);a(),D("Click to choose an optional image for your ",e.title(),"")}}function Pe(n,i){if(n&1){let e=A();r(0,"ion-item")(1,"app-emails",20),y("emailsChange",function(t){p(e);let s=d(2);return f(s.art.contact_email,t)||(s.art.contact_email=t),m(t)}),l()()}if(n&2){let e=d(2);a(),c("isAdmin",e.isAdmin)("isOwner",!1)("label","Art Owner(s)")("placeholder","Email address of Art owner"),h("emails",e.art.contact_email)}}function Te(n,i){if(n&1){let e=A();r(0,"app-tooltip",18)(1,"ion-button",21),C("click",function(){p(e);let t=d(2);return m(t.invite())}),u(2,"Invite"),l()()}if(n&2){let e=d(2);a(),c("disabled",e.inviting)}}function Se(n,i){if(n&1&&(r(0,"app-tooltip",22)(1,"ion-button",23),u(2," Place "),l()(),r(3,"ion-button",24),u(4," Delete "),l(),u(5,"\xA0 "),v(6,"ion-alert",25)),n&2){let e=d(2);a(),c("routerLink","../../map/art/"+j(2,ve,e.art.id)),a(5),c("buttons",e.deleteButtons)}}function Me(n,i){if(n&1){let e=A();r(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),y("ngModelChange",function(t){p(e);let s=d();return f(s.art.name,t)||(s.art.name=t),m(t)}),l()(),r(6,"ion-item")(7,"ion-input",9),y("ngModelChange",function(t){p(e);let s=d();return f(s.art.artist,t)||(s.art.artist=t),m(t)}),l()(),r(8,"ion-item")(9,"ion-input",10),y("ngModelChange",function(t){p(e);let s=d();return f(s.art.url,t)||(s.art.url=t),m(t)}),l()(),r(10,"ion-item",11)(11,"ion-select",12),y("ngModelChange",function(t){p(e);let s=d();return f(s.art.art_type,t)||(s.art.art_type=t),m(t)}),L(12,we,2,2,"ion-select-option",13,W),l()(),r(14,"ion-item")(15,"ion-textarea",14),y("ngModelChange",function(t){p(e);let s=d();return f(s.art.description,t)||(s.art.description=t),m(t)}),l()(),r(16,"div",15),C("click",function(){p(e);let t=d();return m(t.upload.click())}),b(17,Ae,1,1,"img",16)(18,Ie,2,1,"p"),l(),b(19,Pe,2,5,"ion-item"),l(),r(20,"div",17),b(21,Te,3,1,"app-tooltip",18)(22,Se,7,4),r(23,"ion-button",3),C("click",function(){p(e);let t=d();return m(t.save())}),u(24,"Save"),l()(),r(25,"app-upload",19),C("upload",function(t){p(e);let s=d();return m(s.uploaded(t))}),l()()()()}if(n&2){let e=d();a(5),c("label",e.title()+" Title")("placeholder","Title of the "+e.title()),h("ngModel",e.art.name),a(2),h("ngModel",e.art.artist),a(2),h("ngModel",e.art.url),a(2),c("value",e.art.art_type),h("ngModel",e.art.art_type),a(),U(e.artTypes),a(3),c("spellcheck",!0)("rows",6)("autoGrow",!0)("maxlength",1e3),h("ngModel",e.art.description),a(),E(e.uploading?"disabled":""),a(),g(e.imageUrl?17:-1),a(),g(e.imageUrl?-1:18),a(),g(e.isAdmin?19:-1),a(2),g(e.id&&e.isAdmin?21:-1),a(),g(e.id&&e.canPlace?22:-1),a(),c("disabled",e.busy)}}function ke(n,i){n&1&&v(0,"app-spinner")}var x=class x{constructor(i,e,o){this.api=i;this.alert=e;this.location=o;this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.inviting=!1;this.canPlace=!1;this.title=M("Art");this.artTypes=["Art","Mutant Vehicle"];this.route=S(N);this.art={name:"",pin:"",description:"",category:"Open Playa Art",id:void 0,contact_email:"",art_type:this.artTypes[0]};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];ye({mapOutline:he,mailOutline:ge})}uploaded(i){this.imageUrl=i.url,this.imageChanged=!0,this.blob=i.blob}ionViewWillEnter(){return _(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.id=me(this.id),this.art=yield this.api.getArt(this.id),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.imageUrl=this.api.imageURL(this.art.imageUrl);let i=this.route.snapshot.queryParams.type;console.log(i),!this.art.id&&i&&(this.art.art_type=i,this.title.set(i)),this.busy=!1})}presentAlert(i){return _(this,null,function*(){yield(yield this.alert.create({header:"Message",message:i,buttons:["OK"]})).present()})}delete(){return _(this,null,function*(){this.busy=!0,yield this.api.deleteArt(this.art),this.api.clearCache(),this.busy=!1,this.location.back()})}save(i=!0){return _(this,null,function*(){this.busy=!0,ue(this.art);try{let e=yield this.api.addArt(this.art);if(this.busy=!1,e.message)this.presentAlert(e.message);else{if(e.id&&this.imageChanged){console.log(`Uploaded image for art ${e.id}`),this.busy=!0;try{yield this.uploadImage(e.id)}finally{this.busy=!1,this.imageChanged=!1}}this.art.id||(yield this.presentAlert("Thank you for your Art submission.")),this.api.clearCache(),i&&this.location.back()}}finally{this.busy=!1}})}uploadImage(i){return _(this,null,function*(){if(this.blob)try{this.uploading=!0,this.art.imageUrl=yield this.api.setImage(this.blob,i);let e=yield this.api.addArt(this.art);e.message&&this.presentAlert(e.message)}finally{this.uploading=!1}})}invite(){return _(this,null,function*(){if(!this.art.contact_email){yield I(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let i=yield this.api.inviteArt(this.art);i.message?I(this.alert,i.message):I(this.alert,"The art owner has been invited to manage their art.","Invitation")})}};x.\u0275fac=function(e){return new(e||x)(w(_e),w(se),w(F))},x.\u0275cmp=V({type:x,selectors:[["app-art"]],viewQuery:function(e,o){if(e&1&&B(T,5),e&2){let t;O(t=R())&&(o.upload=t.first)}},inputs:{id:"id",vanity:"vanity"},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["labelPlacement","stacked",3,"ngModelChange","label","placeholder","ngModel"],["label","Artist","labelPlacement","stacked","placeholder","Name of the artist",3,"ngModelChange","ngModel"],["label","URL","labelPlacement","stacked","placeholder","URL for the art project",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["labelPlacement","stacked","label","Type","interface","popover","placeholder","Select the type of art",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["labelPlacement","stacked","label","Description","placeholder","Description of the art",3,"ngModelChange","spellcheck","rows","autoGrow","maxlength","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[1,"center"],["text","Invite art owner via email to manage their art"],[3,"upload"],["helperText","The art owner(s) can login and alter the description and events at the art. This is a list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["color","secondary",3,"click","disabled"],["text","Place the art on the map"],["color","secondary",3,"routerLink"],["id","deleteArt","color","secondary"],["trigger","deleteArt","header","Delete Art?",3,"buttons"]],template:function(e,o){e&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),v(3,"ion-back-button"),l(),r(4,"ion-title"),u(5),l(),r(6,"ion-buttons",2)(7,"ion-button",3),C("click",function(){return o.save()}),u(8,"Save"),l()()()(),r(9,"ion-content",4),b(10,Me,26,20,"div",5)(11,ke,1,0,"app-spinner"),l()),e&2&&(a(5),P(o.id||o.art.id?"Edit "+o.title():"Add "+o.title()),a(2),c("disabled",o.busy),a(2),c("fullscreen",!0),a(),g(o.busy?11:10))},dependencies:[J,Ce,T,K,G,H,z,fe,q,Q,ie,le,Z,Y,re,X,te,$,ee,ae,xe,ne,de,pe,ce,oe],encapsulation:2});var be=x;export{be as ArtItemPage};
