import{a as yt}from"./chunk-LSC52AIM.js";import{a as Et}from"./chunk-MPEOIHCZ.js";import"./chunk-QTBNLBDF.js";import{a as wt}from"./chunk-4IGEIIOR.js";import{a as Ct}from"./chunk-67ONBALU.js";import{a as xt}from"./chunk-ALTFHMWK.js";import{a as vt}from"./chunk-A7RCF4AZ.js";import{a as ft}from"./chunk-GLPG6IXG.js";import"./chunk-DUKSTT3K.js";import{Y as _t,a as ut,ea as gt}from"./chunk-MQOPPKG3.js";import{J as ht,a as dt,g as mt,l as g,n as V,t as k,w as pt}from"./chunk-2K4NO5ZT.js";import"./chunk-PFLI22GG.js";import{$ as M,Aa as b,Ba as I,Ca as D,Cb as j,Cc as ot,Dc as at,Ea as U,Ec as rt,Fa as B,G as r,Ga as L,Kc as st,La as F,O as A,Oc as lt,Pc as ct,Ta as R,Vb as G,W as h,X as u,Za as Z,_ as O,aa as p,ba as s,bc as H,ca as l,cb as $,cc as K,da as f,gb as N,ia as S,ib as J,jb as q,ka as y,kc as Q,ma as c,mb as z,p as E,qc as X,rc as tt,s as C,sb as W,t as x,tc as et,uc as it,vb as Y,za as d,zc as nt}from"./chunk-OCTOJKK3.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var bt=i=>[i],It=(i,e)=>e.id,Tt=(i,e)=>e.name;function Pt(i,e){if(i&1){let t=S();s(0,"ion-toolbar")(1,"ion-searchbar",11),y("ionInput",function(n){C(t);let a=c();return x(a.handleSearch(n))}),l()()}if(i&2){let t=c();r(),p("debounce",600)("placeholder","Search events at "+t.title)}}function Ot(i,e){i&1&&f(0,"app-spinner")}function Mt(i,e){if(i&1&&(s(0,"div",12)(1,"app-card",15),f(2,"app-img",16),s(3,"ion-button",17),d(4," Register Event "),l()()()),i&2){let t=c(2);p("ngClass",t.events.length>0?"":"pad-vertical"),r(),p("description","You can register your event for "+t.title+"."),r(),p("width","100px")("height","100px")("src",t.imageUrl),r(),p("routerLink",t.newRoute())}}function Vt(i,e){if(i&1&&(s(0,"ion-segment-button",20)(1,"ion-label"),d(2),l()()),i&2){let t=e.$implicit;p("value",t.name),r(2),b(t.title)}}function kt(i,e){if(i&1){let t=S();s(0,"ion-toolbar")(1,"ion-buttons",1)(2,"ion-segment",19),L("ngModelChange",function(n){C(t);let a=c(3);return B(a.showing,n)||(a.showing=n),x(n)}),y("ionChange",function(){C(t);let n=c(3);return x(n.refresh())}),O(3,Vt,3,2,"ion-segment-button",20,Tt),l()()()}if(i&2){let t=c(3);r(2),U("ngModel",t.showing),p("value",t.showing),r(),M(t.filters)}}function At(i,e){i&1&&(s(0,"ion-item"),d(1," There are no events matching your search. "),l())}function Dt(i,e){if(i&1){let t=S();s(0,"ion-item",21)(1,"h2"),d(2,"Getting Started"),l()(),s(3,"ion-item"),d(4," Click \xA0"),s(5,"a",22),y("click",function(){C(t);let n=c(5);return x(n.newEvent())}),d(6,"Add Event"),l(),d(7),l()}if(i&2){let t=c(5);r(7),I("\xA0 to create your first event at ",t.title,". ")}}function Ut(i,e){if(i&1&&h(0,Dt,8,1),i&2){let t=c(4);u(t.isAdmin?0:-1)}}function Bt(i,e){if(i&1&&h(0,At,2,0,"ion-item")(1,Ut,1,1),i&2){let t=c(3);u(t.filteredBySearch?0:1)}}function Lt(i,e){if(i&1&&(s(0,"ion-item")(1,"ion-text",23),d(2),l()()),i&2){let t=c(3);r(2),I("Time Zone ",t.diffTimeZone)}}function Ft(i,e){if(i&1&&(s(0,"p",29),d(1),l(),s(2,"p",30),d(3),l()),i&2){let t=c().$implicit;r(),D("",t.camp,"",t.art),r(2),b(t.other_location)}}function Rt(i,e){if(i&1&&(s(0,"ion-item",18),f(1,"app-img",24),s(2,"ion-label",25),h(3,Ft,4,3),d(4),l(),s(5,"ion-label",26)(6,"p",27),d(7),l(),s(8,"p",28),d(9),l()()()),i&2){let t=e.$implicit,o=c(3);p("routerLink","../events/"+F(8,bt,t.id)),r(),p("width","45px")("height","45px")("src",o.image(t)),r(2),u(!o.campId&&!o.artId?3:-1),r(),I(" ",t.title," "),r(3),b(t.event_type),r(2),b(t.timeString)}}function Zt(i,e){if(i&1&&(s(0,"app-image-card",13),h(1,kt,5,2,"ion-toolbar"),s(2,"ion-list"),h(3,Bt,2,1)(4,Lt,3,1,"ion-item"),O(5,Rt,10,10,"ion-item",18,It),l()()),i&2){let t=c(2);p("url",t.getImageUrl()),r(),u(!t.campId&&!t.artId?1:-1),r(2),u(t.events.length===0?3:t.diffTimeZone?4:-1),r(2),M(t.events)}}function $t(i,e){if(i&1&&(h(0,Mt,5,6,"div",12)(1,Zt,7,3,"app-image-card",13),f(2,"div",14)(3,"div",14)),i&2){let t=c();u(t.events.length===0&&!t.filteredBySearch&&!t.isAdmin?0:1)}}function Nt(i,e){if(i&1){let t=S();s(0,"app-footer",31),y("press",function(){C(t);let n=c();return x(n.newEvent())}),l()}}var w=class w{constructor(){this.api=E(ht);this.router=E(J);this.eventService=E(Et);this.route=E(N);this.vanity=R();this.events=[];this.title="Events";this.busy=!0;this.isAdmin=!1;this.imageUrl="";this.newEventUrl="../events/new";this.description="";this.diffTimeZone="";this.showing="all";this.showSearch=!0;this.canEditEvent=!1;this.buttons=[];this.filteredBySearch=!1;this.filters=[];gt({add:ut,printOutline:_t})}filtered(e,t,o,n,a){var v;let m=!0;return e=="mine"?(v=n.contact)!=null&&v.startsWith("***")&&(m=!1):e!=="all"&&(m=this.hasDay(n,e,a)),t&&g(n.hosted_by_camp)!==g(t)&&(m=!1),o&&g(n.located_at_art)!==g(o)&&(m=!1),m}importCSV(){return()=>_(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.router.navigateByUrl("./import-events")})}exportCSV(){return()=>_(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.exportToCSV()})}ngOnInit(){return _(this,null,function*(){var e;try{this.busy=!0,yield this.api.setFestivalByVanity(this.vanity(),!0),this.campId=g(this.route.snapshot.queryParams.camp),this.artId=g(this.route.snapshot.queryParams.art),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.imageUrl=(e=this.api.imageURL(this.api.festivalImage()))!=null?e:"",this.camp=this.campId?yield this.api.getCamp(this.campId):void 0,this.art=this.artId?yield this.api.getArt(this.artId):void 0,this.title=this.camp?this.camp.name:this.api.festivalTitle(),this.canEditEvent=this.api.eventEditing()||this.isAdmin,this.buttons=this.isAdmin?[{title:"Import CSV",method:this.importCSV(),icon:"cloud-upload-outline"},{title:"Export CSV",method:this.exportCSV(),icon:"cloud-download-outline"}]:[],this.art&&(this.title=this.art.name),this.diffTimeZone=this.api.currentTimeZone()==this.api.festivalTimeZone()?"":this.api.festivalTimeZone(),yield this.api.setFestivalByVanity(this.vanity()),yield this.refresh(),this.showSearch=this.events.length>1,this.description=this.events.length==0?`There are no events yet for ${this.title}`:`Events for ${this.title}`}finally{this.busy=!1}})}ionViewDidEnter(){return _(this,null,function*(){for(;this.busy;)yield mt(500);yield this.refresh()})}newRoute(){return this.canEditEvent?"../events/new":void 0}message(e){setTimeout(()=>{this.api.sendMessage(e)},1)}handleSearch(e){return _(this,null,function*(){let t=e.target.value.toLowerCase().trim(),o=this.cleanEvents(yield this.api.events({cached:!0}),!1);this.events=o.filter(n=>{var a;return n.title.toLowerCase().includes(t)||((a=n.camp)==null?void 0:a.toLowerCase().includes(t))}),this.filteredBySearch=t.length>0})}image(e){return this.api.imageURL(e.imageUrl)}newEvent(){this.router.navigate(["./new"],{queryParams:{camp:this.campId,art:this.artId},relativeTo:this.route})}festivalImage(){return this.api.imageURL(this.api.festivalImage())}refresh(){return _(this,null,function*(){this.filters=[],this.events=this.cleanEvents(yield this.api.events({cached:!0}),!1),this.filteredBySearch=!1,this.filters.find(e=>e.name=="mine")||this.filters.unshift({title:"All",name:"all"},{title:"Mine",name:"mine"})})}exportToCSV(){return _(this,null,function*(){let e=this.showing!=="all",t=this.cleanEvents(yield this.api.events({cached:!0}),e);yield this.eventService.exportEventsToCSV(this.api.festivalTitle(),t,this.api.currentTimeZone(),this.showing)})}getImageUrl(){var e;return this.camp&&this.camp.imageUrl?this.api.imageURL(this.camp.imageUrl):this.art&&((e=this.art)!=null&&e.imageUrl)?this.api.imageURL(this.art.imageUrl):this.festivalImage()}addFiltersForDays(e){let t=new Date(e.start_time),o=`${t.getDate()} (${pt[t.getDay()]})`;this.filters.find(a=>a.title==o)||(this.filters.push({title:o,name:this.nameOf(t)}),this.filters.sort((a,m)=>a.name>m.name?1:-1))}hasDay(e,t,o){let n=JSON.parse(e.occurrence_set);if(o){let a=[];for(let m of n)t==this.nameOf(new Date(m.start_time))&&a.push(m);if(a.length>0)return e.occurrence_set=JSON.stringify(a),!0}else for(let a of n)if(t==this.nameOf(new Date(a.start_time)))return!0;return!1}nameOf(e){return`${e.getDate()}-${e.getMonth()}-${e.getFullYear()}`}cleanEvents(e,t){var o;for(let n of e){let a=JSON.parse(n.occurrence_set);this.goodDates(a)||console.error(`${n.title} has bad dates`);let m=V(a[0].start_time),v=V(a[0].end_time),T=this.api.currentTimeZone();n.timeString=(o=dt(m,v,void 0,T))==null?void 0:o.long,a.length>1&&(n.timeString+=` (+${a.length-1} other occurrence)`);for(let P of a)this.addFiltersForDays(P)}return e.sort((n,a)=>{let m=JSON.parse(n.occurrence_set),v=JSON.parse(a.occurrence_set),T=new Date(m[0].start_time),P=new Date(v[0].start_time);return T-P}),e.filter(n=>this.filtered(this.showing,this.campId,this.artId,n,t))}signOut(){return _(this,null,function*(){this.api.signOut(),this.router.navigateByUrl("/auth")})}goodDates(e){for(let t of e)if(k(t.start_time)!=t.start_time||k(t.end_time)!=t.end_time)return!1;return!0}};w.\u0275fac=function(t){return new(t||w)},w.\u0275cmp=A({type:w,selectors:[["app-events"]],inputs:{vanity:[1,"vanity"]},decls:17,vars:7,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../events/new"],["name","add"],[3,"buttons"],[3,"fullscreen"],[1,"border"],["title","Add Event"],["title","Add Event",3,"click"],["mode","ios","search-icon","none","show-clear-button","always",3,"ionInput","debounce","placeholder"],[1,"ion-text-center",3,"ngClass"],["routeTo","../events/new",3,"url"],[1,"ion-padding"],["title","Event Registration",3,"description"],["logo","",1,"logo","ion-padding",3,"width","height","src"],["shape","round",3,"routerLink"],[3,"routerLink"],["mode","ios",2,"float","right","margin-right","0.5rem","margin-top","0.5rem","width","100%",3,"ngModelChange","ionChange","ngModel","value"],[3,"value"],["lines","none"],[3,"click"],["color","medium","slot","end",2,"text-transform","uppercase","font-size","small"],[1,"clickable","pad-right",3,"width","height","src"],[1,"ion-text-wrap"],[1,"ion-text-right","ion-text-wrap","last-col"],[1,"one-line","sz-large"],["color","medium",1,"time"],[1,"title"],[1,"title","highlight"],["title","Add Event",3,"press"]],template:function(t,o){t&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),f(3,"ion-back-button"),l(),s(4,"ion-title",2),d(5),l(),s(6,"ion-buttons",3)(7,"ion-button",4),f(8,"ion-icon",5),l(),f(9,"app-side",6),l()()(),s(10,"ion-content",7),h(11,Pt,2,2,"ion-toolbar"),h(12,Ot,1,0,"app-spinner"),s(13,"div",8),h(14,$t,4,1),h(15,Nt,1,0,"app-footer",9),l(),s(16,"app-footer",10),y("click",function(){return o.newEvent()}),l()()),t&2&&(r(5),I("Events at ",o.title),r(4),p("buttons",o.buttons),r(),p("fullscreen",!0),r(),u(o.showSearch?11:-1),r(),u(o.busy?12:-1),r(2),u(o.busy?-1:14),r(),u(o.events.length!==0&&!o.filteredBySearch?15:-1))},dependencies:[ot,lt,wt,ft,ct,nt,$,Z,j,W,Y,z,q,X,rt,K,G,at,H,Q,st,it,tt,et,xt,Ct,vt,yt],styles:["ion-fab[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:20px}ion-fab-button[_ngcontent-%COMP%]{margin-top:-35px;padding:5px}ion-item[_ngcontent-%COMP%]{cursor:pointer}.title[_ngcontent-%COMP%]{font-size:var(--fs4)}.highlight[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.one-line[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}app-img[_ngcontent-%COMP%]{--border-radius: 5px}.last-col[_ngcontent-%COMP%]{max-width:25%}@media (width < 500px){.sz-large[_ngcontent-%COMP%]{display:none}}.pad-right[_ngcontent-%COMP%]{width:55px}"]});var St=w;export{St as EventsPage};
