import{a as zt}from"./chunk-Q7SRVC5Z.js";import{a as Vt}from"./chunk-NIJZXRAZ.js";import{a as $t}from"./chunk-WRLAXAJB.js";import{b as Oe}from"./chunk-OZ2IKH4J.js";import{C as Lt,L as Nt,Q as kt,X as Bt,e as Dt,ha as Kt,i as Ft,ja as Rt,z as Tt}from"./chunk-LIWDDRYP.js";import{K as Ce}from"./chunk-OQVFSD37.js";import"./chunk-PFLI22GG.js";import{$,Aa as _,Ba as y,Ca as T,Cc as Et,Da as pe,Db as lt,Dc as Pt,Ec as Mt,Fa as Ze,Fc as bt,Ga as qe,H as p,Ha as et,Ic as Ot,Mc as St,P as ce,Pa as Q,Qa as X,Ta as oe,Ua as be,Va as he,Wa as tt,X as S,Y as D,Zb as ct,_b as ut,aa as V,ba as F,bc as mt,ca as h,cb as nt,cc as dt,da as d,db as ge,dc as pt,ea as ue,ec as ht,fc as gt,gc as ft,hb as it,ic as Ct,ja as re,jb as rt,jc as _t,l as le,la as Y,lc as fe,na as x,p as R,qb as ot,rc as vt,s as G,sc as wt,t as H,tb as st,ua as me,uc as At,va as de,vc as xt,w as N,wb as at,wc as It,xc as yt}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{a as K,b as Je,h as L}from"./chunk-LNJ3S2LQ.js";function jt(i){let e=ln(i).split(`
`),n=[];for(let r of e){let o=r.split(",");o.length>=2&&n.push({lat:parseFloat(o[1].trim()),lng:parseFloat(o[0].trim())})}return n.length==0?{lat:-1,lng:-1}:(n[n.length-1].lng==n[0].lng&&n[n.length-1].lat==n[0].lat&&n.length>1&&n.pop(),n.length==1?n[0]:an(n))}function Wt(i,t){let e=t.map(s=>i=="lat"?s.lat:s.lng),n=Math.min(...e),r=Math.max(...e);i==="lng"&&r-n>180&&(e=e.map(s=>s<r-180?s+360:s),n=Math.min(...e),r=Math.max(...e));let o=(n+r)/2;return i==="lng"&&o>180&&(o-=360),o}function an(i){return{lat:Wt("lat",i),lng:Wt("lng",i)}}function ln(i){let t=i.trim();if(!t.includes(`
`)&&t.includes(" "))return t.split(/\s+/).filter(e=>e.length>0).join(`
`);if(t.includes(`
`)&&t.includes(" ")){let e=t.split(`
`),n=[];for(let r of e){let o=r.trim();if(o.length!==0)if(o.includes(" ")&&(o.match(/,/g)||[]).length>2){let s=o.split(/\s+/).filter(a=>a.length>0);n.push(...s)}else n.push(o)}return n.join(`
`)}return t}function z(i){return Array.isArray?Array.isArray(i):qt(i)==="[object Array]"}var cn=1/0;function un(i){if(typeof i=="string")return i;let t=i+"";return t=="0"&&1/i==-cn?"-0":t}function mn(i){return i==null?"":un(i)}function k(i){return typeof i=="string"}function Jt(i){return typeof i=="number"}function dn(i){return i===!0||i===!1||pn(i)&&qt(i)=="[object Boolean]"}function Zt(i){return typeof i=="object"}function pn(i){return Zt(i)&&i!==null}function M(i){return i!=null}function Se(i){return!i.trim().length}function qt(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}var hn="Incorrect 'index' type",gn=i=>`Invalid value for key ${i}`,fn=i=>`Pattern length exceeds max of ${i}.`,Cn=i=>`Missing ${i} property in key`,_n=i=>`Property 'weight' in key '${i}' must be a positive integer`,Ut=Object.prototype.hasOwnProperty,De=class{constructor(t){this._keys=[],this._keyMap={};let e=0;t.forEach(n=>{let r=en(n);this._keys.push(r),this._keyMap[r.id]=r,e+=r.weight}),this._keys.forEach(n=>{n.weight/=e})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function en(i){let t=null,e=null,n=null,r=1,o=null;if(k(i)||z(i))n=i,t=Gt(i),e=Fe(i);else{if(!Ut.call(i,"name"))throw new Error(Cn("name"));let s=i.name;if(n=s,Ut.call(i,"weight")&&(r=i.weight,r<=0))throw new Error(_n(s));t=Gt(s),e=Fe(s),o=i.getFn}return{path:t,id:e,weight:r,src:n,getFn:o}}function Gt(i){return z(i)?i:i.split(".")}function Fe(i){return z(i)?i.join("."):i}function vn(i,t){let e=[],n=!1,r=(o,s,a)=>{if(M(o))if(!s[a])e.push(o);else{let l=s[a],c=o[l];if(!M(c))return;if(a===s.length-1&&(k(c)||Jt(c)||dn(c)))e.push(mn(c));else if(z(c)){n=!0;for(let u=0,g=c.length;u<g;u+=1)r(c[u],s,a+1)}else s.length&&r(c,s,a+1)}};return r(i,k(t)?t.split("."):t,0),n?e:e[0]}var wn={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},An={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(i,t)=>i.score===t.score?i.idx<t.idx?-1:1:i.score<t.score?-1:1},xn={location:0,threshold:.6,distance:100},In={useExtendedSearch:!1,getFn:vn,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},f=K(K(K(K({},An),wn),xn),In),yn=/[^ ]+/g;function En(i=1,t=3){let e=new Map,n=Math.pow(10,t);return{get(r){let o=r.match(yn).length;if(e.has(o))return e.get(o);let s=1/Math.pow(o,.5*i),a=parseFloat(Math.round(s*n)/n);return e.set(o,a),a},clear(){e.clear()}}}var se=class{constructor({getFn:t=f.getFn,fieldNormWeight:e=f.fieldNormWeight}={}){this.norm=En(e,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((e,n)=>{this._keysMap[e.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,k(this.docs[0])?this.docs.forEach((t,e)=>{this._addString(t,e)}):this.docs.forEach((t,e)=>{this._addObject(t,e)}),this.norm.clear())}add(t){let e=this.size();k(t)?this._addString(t,e):this._addObject(t,e)}removeAt(t){this.records.splice(t,1);for(let e=t,n=this.size();e<n;e+=1)this.records[e].i-=1}getValueForItemAtKeyId(t,e){return t[this._keysMap[e]]}size(){return this.records.length}_addString(t,e){if(!M(t)||Se(t))return;let n={v:t,i:e,n:this.norm.get(t)};this.records.push(n)}_addObject(t,e){let n={i:e,$:{}};this.keys.forEach((r,o)=>{let s=r.getFn?r.getFn(t):this.getFn(t,r.path);if(M(s)){if(z(s)){let a=[],l=[{nestedArrIndex:-1,value:s}];for(;l.length;){let{nestedArrIndex:c,value:u}=l.pop();if(M(u))if(k(u)&&!Se(u)){let g={v:u,i:c,n:this.norm.get(u)};a.push(g)}else z(u)&&u.forEach((g,C)=>{l.push({nestedArrIndex:C,value:g})})}n.$[o]=a}else if(k(s)&&!Se(s)){let a={v:s,n:this.norm.get(s)};n.$[o]=a}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}};function Ht(i,t,{getFn:e=f.getFn,fieldNormWeight:n=f.fieldNormWeight}={}){let r=new se({getFn:e,fieldNormWeight:n});return r.setKeys(i.map(en)),r.setSources(t),r.create(),r}function Pn(i,{getFn:t=f.getFn,fieldNormWeight:e=f.fieldNormWeight}={}){let{keys:n,records:r}=i,o=new se({getFn:t,fieldNormWeight:e});return o.setKeys(n),o.setIndexRecords(r),o}function _e(i,{errors:t=0,currentLocation:e=0,expectedLocation:n=0,distance:r=f.distance,ignoreLocation:o=f.ignoreLocation}={}){let s=t/i.length;if(o)return s;let a=Math.abs(n-e);return r?s+a/r:a?1:s}function Mn(i=[],t=f.minMatchCharLength){let e=[],n=-1,r=-1,o=0;for(let s=i.length;o<s;o+=1){let a=i[o];a&&n===-1?n=o:!a&&n!==-1&&(r=o-1,r-n+1>=t&&e.push([n,r]),n=-1)}return i[o-1]&&o-n>=t&&e.push([n,o-1]),e}var J=32;function bn(i,t,e,{location:n=f.location,distance:r=f.distance,threshold:o=f.threshold,findAllMatches:s=f.findAllMatches,minMatchCharLength:a=f.minMatchCharLength,includeMatches:l=f.includeMatches,ignoreLocation:c=f.ignoreLocation}={}){if(t.length>J)throw new Error(fn(J));let u=t.length,g=i.length,C=Math.max(0,Math.min(n,g)),m=o,v=C,w=a>1||l,I=w?Array(g):[],A;for(;(A=i.indexOf(t,v))>-1;){let b=_e(t,{currentLocation:A,expectedLocation:C,distance:r,ignoreLocation:c});if(m=Math.min(b,m),v=A+u,w){let W=0;for(;W<u;)I[A+W]=1,W+=1}}v=-1;let E=[],P=1,U=u+g,sn=1<<u-1;for(let b=0;b<u;b+=1){let W=0,j=U;for(;W<j;)_e(t,{errors:b,currentLocation:C+j,expectedLocation:C,distance:r,ignoreLocation:c})<=m?W=j:U=j,j=Math.floor((U-W)/2+W);U=j;let Qe=Math.max(1,C-j+1),Me=s?g:Math.min(C+j,g)+u,ee=Array(Me+2);ee[Me+1]=(1<<b)-1;for(let O=Me;O>=Qe;O-=1){let ae=O-1,Xe=e[i.charAt(ae)];if(w&&(I[ae]=+!!Xe),ee[O]=(ee[O+1]<<1|1)&Xe,b&&(ee[O]|=(E[O+1]|E[O])<<1|1|E[O+1]),ee[O]&sn&&(P=_e(t,{errors:b,currentLocation:ae,expectedLocation:C,distance:r,ignoreLocation:c}),P<=m)){if(m=P,v=ae,v<=C)break;Qe=Math.max(1,2*C-v)}}if(_e(t,{errors:b+1,currentLocation:C,expectedLocation:C,distance:r,ignoreLocation:c})>m)break;E=ee}let Pe={isMatch:v>=0,score:Math.max(.001,P)};if(w){let b=Mn(I,a);b.length?l&&(Pe.indices=b):Pe.isMatch=!1}return Pe}function On(i){let t={};for(let e=0,n=i.length;e<n;e+=1){let r=i.charAt(e);t[r]=(t[r]||0)|1<<n-e-1}return t}var ve=String.prototype.normalize?i=>i.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):i=>i,we=class{constructor(t,{location:e=f.location,threshold:n=f.threshold,distance:r=f.distance,includeMatches:o=f.includeMatches,findAllMatches:s=f.findAllMatches,minMatchCharLength:a=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreDiacritics:c=f.ignoreDiacritics,ignoreLocation:u=f.ignoreLocation}={}){if(this.options={location:e,threshold:n,distance:r,includeMatches:o,findAllMatches:s,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:c,ignoreLocation:u},t=l?t:t.toLowerCase(),t=c?ve(t):t,this.pattern=t,this.chunks=[],!this.pattern.length)return;let g=(m,v)=>{this.chunks.push({pattern:m,alphabet:On(m),startIndex:v})},C=this.pattern.length;if(C>J){let m=0,v=C%J,w=C-v;for(;m<w;)g(this.pattern.substr(m,J),m),m+=J;if(v){let I=C-J;g(this.pattern.substr(I),I)}}else g(this.pattern,0)}searchIn(t){let{isCaseSensitive:e,ignoreDiacritics:n,includeMatches:r}=this.options;if(t=e?t:t.toLowerCase(),t=n?ve(t):t,this.pattern===t){let w={isMatch:!0,score:0};return r&&(w.indices=[[0,t.length-1]]),w}let{location:o,distance:s,threshold:a,findAllMatches:l,minMatchCharLength:c,ignoreLocation:u}=this.options,g=[],C=0,m=!1;this.chunks.forEach(({pattern:w,alphabet:I,startIndex:A})=>{let{isMatch:E,score:P,indices:U}=bn(t,w,I,{location:o+A,distance:s,threshold:a,findAllMatches:l,minMatchCharLength:c,includeMatches:r,ignoreLocation:u});E&&(m=!0),C+=P,E&&U&&(g=[...g,...U])});let v={isMatch:m,score:m?C/this.chunks.length:1};return m&&r&&(v.indices=g),v}},B=class{constructor(t){this.pattern=t}static isMultiMatch(t){return Yt(t,this.multiRegex)}static isSingleMatch(t){return Yt(t,this.singleRegex)}search(){}};function Yt(i,t){let e=i.match(t);return e?e[1]:null}var Te=class extends B{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){let e=t===this.pattern;return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}},Le=class extends B{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){let n=t.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}},Ne=class extends B{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){let e=t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,this.pattern.length-1]}}},ke=class extends B{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){let e=!t.startsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}},Be=class extends B{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){let e=t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[t.length-this.pattern.length,t.length-1]}}},Ke=class extends B{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){let e=!t.endsWith(this.pattern);return{isMatch:e,score:e?0:1,indices:[0,t.length-1]}}},Ae=class extends B{constructor(t,{location:e=f.location,threshold:n=f.threshold,distance:r=f.distance,includeMatches:o=f.includeMatches,findAllMatches:s=f.findAllMatches,minMatchCharLength:a=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreDiacritics:c=f.ignoreDiacritics,ignoreLocation:u=f.ignoreLocation}={}){super(t),this._bitapSearch=new we(t,{location:e,threshold:n,distance:r,includeMatches:o,findAllMatches:s,minMatchCharLength:a,isCaseSensitive:l,ignoreDiacritics:c,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}},xe=class extends B{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let e=0,n,r=[],o=this.pattern.length;for(;(n=t.indexOf(this.pattern,e))>-1;)e=n+o,r.push([n,e-1]);let s=!!r.length;return{isMatch:s,score:s?0:1,indices:r}}},Re=[Te,xe,Ne,ke,Ke,Be,Le,Ae],Qt=Re.length,Sn=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Dn="|";function Fn(i,t={}){return i.split(Dn).map(e=>{let n=e.trim().split(Sn).filter(o=>o&&!!o.trim()),r=[];for(let o=0,s=n.length;o<s;o+=1){let a=n[o],l=!1,c=-1;for(;!l&&++c<Qt;){let u=Re[c],g=u.isMultiMatch(a);g&&(r.push(new u(g,t)),l=!0)}if(!l)for(c=-1;++c<Qt;){let u=Re[c],g=u.isSingleMatch(a);if(g){r.push(new u(g,t));break}}}return r})}var Tn=new Set([Ae.type,xe.type]),$e=class{constructor(t,{isCaseSensitive:e=f.isCaseSensitive,ignoreDiacritics:n=f.ignoreDiacritics,includeMatches:r=f.includeMatches,minMatchCharLength:o=f.minMatchCharLength,ignoreLocation:s=f.ignoreLocation,findAllMatches:a=f.findAllMatches,location:l=f.location,threshold:c=f.threshold,distance:u=f.distance}={}){this.query=null,this.options={isCaseSensitive:e,ignoreDiacritics:n,includeMatches:r,minMatchCharLength:o,findAllMatches:a,ignoreLocation:s,location:l,threshold:c,distance:u},t=e?t:t.toLowerCase(),t=n?ve(t):t,this.pattern=t,this.query=Fn(this.pattern,this.options)}static condition(t,e){return e.useExtendedSearch}searchIn(t){let e=this.query;if(!e)return{isMatch:!1,score:1};let{includeMatches:n,isCaseSensitive:r,ignoreDiacritics:o}=this.options;t=r?t:t.toLowerCase(),t=o?ve(t):t;let s=0,a=[],l=0;for(let c=0,u=e.length;c<u;c+=1){let g=e[c];a.length=0,s=0;for(let C=0,m=g.length;C<m;C+=1){let v=g[C],{isMatch:w,indices:I,score:A}=v.search(t);if(w){if(s+=1,l+=A,n){let E=v.constructor.type;Tn.has(E)?a=[...a,...I]:a.push(I)}}else{l=0,s=0,a.length=0;break}}if(s){let C={isMatch:!0,score:l/s};return n&&(C.indices=a),C}}return{isMatch:!1,score:1}}},Ve=[];function Ln(...i){Ve.push(...i)}function ze(i,t){for(let e=0,n=Ve.length;e<n;e+=1){let r=Ve[e];if(r.condition(i,t))return new r(i,t)}return new we(i,t)}var Ie={AND:"$and",OR:"$or"},We={PATH:"$path",PATTERN:"$val"},je=i=>!!(i[Ie.AND]||i[Ie.OR]),Nn=i=>!!i[We.PATH],kn=i=>!z(i)&&Zt(i)&&!je(i),Xt=i=>({[Ie.AND]:Object.keys(i).map(t=>({[t]:i[t]}))});function tn(i,t,{auto:e=!0}={}){let n=r=>{let o=Object.keys(r),s=Nn(r);if(!s&&o.length>1&&!je(r))return n(Xt(r));if(kn(r)){let l=s?r[We.PATH]:o[0],c=s?r[We.PATTERN]:r[l];if(!k(c))throw new Error(gn(l));let u={keyId:Fe(l),pattern:c};return e&&(u.searcher=ze(c,t)),u}let a={children:[],operator:o[0]};return o.forEach(l=>{let c=r[l];z(c)&&c.forEach(u=>{a.children.push(n(u))})}),a};return je(i)||(i=Xt(i)),n(i)}function Bn(i,{ignoreFieldNorm:t=f.ignoreFieldNorm}){i.forEach(e=>{let n=1;e.matches.forEach(({key:r,norm:o,score:s})=>{let a=r?r.weight:null;n*=Math.pow(s===0&&a?Number.EPSILON:s,(a||1)*(t?1:o))}),e.score=n})}function Kn(i,t){let e=i.matches;t.matches=[],M(e)&&e.forEach(n=>{if(!M(n.indices)||!n.indices.length)return;let{indices:r,value:o}=n,s={indices:r,value:o};n.key&&(s.key=n.key.src),n.idx>-1&&(s.refIndex=n.idx),t.matches.push(s)})}function Rn(i,t){t.score=i.score}function $n(i,t,{includeMatches:e=f.includeMatches,includeScore:n=f.includeScore}={}){let r=[];return e&&r.push(Kn),n&&r.push(Rn),i.map(o=>{let{idx:s}=o,a={item:t[s],refIndex:s};return r.length&&r.forEach(l=>{l(o,a)}),a})}var Ue=(()=>{class i{constructor(e,n={},r){this.options=K(K({},f),n),this.options.useExtendedSearch,this._keyStore=new De(this.options.keys),this.setCollection(e,r)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof se))throw new Error(hn);this._myIndex=n||Ht(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){M(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){let n=[];for(let r=0,o=this._docs.length;r<o;r+=1){let s=this._docs[r];e(s,r)&&(this.removeAt(r),r-=1,o-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){let{includeMatches:r,includeScore:o,shouldSort:s,sortFn:a,ignoreFieldNorm:l}=this.options,c=k(e)?k(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Bn(c,{ignoreFieldNorm:l}),s&&c.sort(a),Jt(n)&&n>-1&&(c=c.slice(0,n)),$n(c,this._docs,{includeMatches:r,includeScore:o})}_searchStringList(e){let n=ze(e,this.options),{records:r}=this._myIndex,o=[];return r.forEach(({v:s,i:a,n:l})=>{if(!M(s))return;let{isMatch:c,score:u,indices:g}=n.searchIn(s);c&&o.push({item:s,idx:a,matches:[{score:u,value:s,norm:l,indices:g}]})}),o}_searchLogical(e){let n=tn(e,this.options),r=(l,c,u)=>{if(!l.children){let{keyId:C,searcher:m}=l,v=this._findMatches({key:this._keyStore.get(C),value:this._myIndex.getValueForItemAtKeyId(c,C),searcher:m});return v&&v.length?[{idx:u,item:c,matches:v}]:[]}let g=[];for(let C=0,m=l.children.length;C<m;C+=1){let v=l.children[C],w=r(v,c,u);if(w.length)g.push(...w);else if(l.operator===Ie.AND)return[]}return g},o=this._myIndex.records,s={},a=[];return o.forEach(({$:l,i:c})=>{if(M(l)){let u=r(n,l,c);u.length&&(s[c]||(s[c]={idx:c,item:l,matches:[]},a.push(s[c])),u.forEach(({matches:g})=>{s[c].matches.push(...g)}))}}),a}_searchObjectList(e){let n=ze(e,this.options),{keys:r,records:o}=this._myIndex,s=[];return o.forEach(({$:a,i:l})=>{if(!M(a))return;let c=[];r.forEach((u,g)=>{c.push(...this._findMatches({key:u,value:a[g],searcher:n}))}),c.length&&s.push({idx:l,item:a,matches:c})}),s}_findMatches({key:e,value:n,searcher:r}){if(!M(n))return[];let o=[];if(z(n))n.forEach(({v:s,i:a,n:l})=>{if(!M(s))return;let{isMatch:c,score:u,indices:g}=r.searchIn(s);c&&o.push({score:u,key:e,value:s,idx:a,norm:l,indices:g})});else{let{v:s,n:a}=n,{isMatch:l,score:c,indices:u}=r.searchIn(s);l&&o.push({score:c,key:e,value:s,norm:a,indices:u})}return o}}return i.version="7.1.0",i.createIndex=Ht,i.parseIndex=Pn,i.config=f,i})();Ue.parseQuery=tn;Ln($e);function nn(i,t){let e=[],n=[],r=0;if(!i||i.trim().length===0)return e.push({type:"EMPTY_FILE",message:"The selected file is empty.",details:"Please select a KML file that contains geographic data."}),{isValid:!1,errors:e,warnings:n,placemarkCount:r};if(t!==void 0&&t>10485760)return e.push({type:"FILE_TOO_LARGE",message:"The file is too large to process.",details:`Maximum file size is ${10485760/(1024*1024)}MB. Your file is ${(t/(1024*1024)).toFixed(2)}MB.`}),{isValid:!1,errors:e,warnings:n,placemarkCount:r};let o=i.includes("<kml")||i.includes("<KML"),s=i.includes("<Document")||i.includes("<Folder")||i.includes("<document")||i.includes("<folder");if(!o&&!s)return i.includes("<?xml")&&!o?e.push({type:"INVALID_FORMAT",message:"The file appears to be XML but not a valid KML file.",details:"Please ensure you are uploading a KML file with geographic placemarks."}):e.push({type:"INVALID_FORMAT",message:"The file does not appear to be a valid KML file.",details:"KML files should contain <kml> or <Document> tags."}),{isValid:!1,errors:e,warnings:n,placemarkCount:r};let a=i.match(/<(?:\w+:)?Placemark[\s>]/gi);return r=a?a.length:0,r===0?(e.push({type:"NO_PLACEMARKS",message:"No placemarks found in the KML file.",details:"The file must contain at least one <Placemark> element with coordinates."}),{isValid:!1,errors:e,warnings:n,placemarkCount:r}):{isValid:!0,errors:e,warnings:n,placemarkCount:r}}function rn(i){if(!i||i.trim().length===0)return;let e=i.trim().split(`
`);for(let n of e){let r=n.split(",");if(r.length>=2){let o=parseFloat(r[0].trim()),s=parseFloat(r[1].trim());if(!isNaN(s)&&!isNaN(o)&&isFinite(s)&&isFinite(o)&&s>=-90&&s<=90&&o>=-180&&o<=180)return{lat:s,lng:o}}}}var Z=class Z{constructor(){}validate(t,e){return nn(t,e)}parseWithValidation(t,e,n=!1,r){let o=[],s=[],a={camps:[],art:[],pins:[],newCamps:[],newArt:[]},l=this.validate(t,r);if(!l.isValid)return{changes:a,validation:l,errors:l.errors,warnings:l.warnings,success:!1};if(!e)return o.push({type:"DATA_UNAVAILABLE",message:"Unable to load existing data for comparison.",details:"Please try again or contact support if the issue persists."}),{changes:a,validation:l,errors:o,warnings:s,success:!1};try{let c=this.parse(t,e,n),g=t.replace(/<([\w]+:)?placemark[^>]*>/gi,"<Placemark>").replace(/<\/([\w]+:)?placemark>/gi,"</Placemark>").split("<Placemark>");for(let C of g){let m=this.extractBetweenTags(C,"name").replace("<![CDATA[","").replace("]]>","").trim();if(m.length>0){let v=this.extractBetweenTags(C,"coordinates");!rn(v)&&v.trim().length>0&&s.push({type:"MALFORMED_COORDINATES",message:`Coordinates could not be parsed for "${m}".`,placemarkName:m,details:"This placemark will be skipped."})}}return{changes:c,validation:l,errors:o,warnings:s,success:!0}}catch(c){return o.push({type:"INVALID_FORMAT",message:"An error occurred while parsing the KML file.",details:c instanceof Error?c.message:"Unknown error"}),{changes:a,validation:l,errors:o,warnings:s,success:!1}}}parse(t,e,n=!1){var u;let r={camps:[],art:[],pins:[],newCamps:[],newArt:[]},s=t.replace(/<([\w]+:)?placemark[^>]*>/gi,"<Placemark>").replace(/<\/([\w]+:)?placemark>/gi,"</Placemark>").split("<Placemark>"),a=0,l=[],c=0;for(let g of s){c++;let C=this.extractBetweenTags(g,"name").replace(" sc","").replace("<![cdata[","").replace("<![CDATA[","").replace("]]>","").replace(/\r/g,"").replace(/\n/g,"").trim(),m=C.toLowerCase(),v=this.extractBetweenTags(g,"description").replace(" sc","").replace("<![CDATA[","").replace("]]>","").replace(/\r/g,"").replace(/\n/g,"").replace(/<br>/g,`\r
`).trim(),w=jt(this.extractBetweenTags(g,"coordinates")),I;for(let A of e){if(A.externalId&&m.endsWith(A.externalId)){I=A;break}if(this.campNameMatch(m,A.name)){I=A;break}if(this.matchWithoutNumbers(m,A.name)){I=A;break}A.ref=this.cleanString(A.name)}if(I==null){let E=new Ue(e,{keys:["ref"],ignoreLocation:!0,includeScore:!0}).search(this.cleanString(m),{limit:1});if(E.length>0){I=E[0].item;let P=(u=E[0].score)!=null?u:0;P<.2?console.warn(`"${m}" close match is ${E[0].item.name} score ${P}`):I=void 0}}if(I){let A=Je(K({},I),{pin:JSON.stringify(w)});(n?r.art.find(P=>P.id==A.id):r.camps.find(P=>P.id==A.id))||(n?r.art.push(A):r.camps.push(A)),a++}else m.includes("shuttle stop")?r.pins.push({label:"Shuttle Stop",gpsLat:w.lat,gpsLng:w.lng,x:0,y:0}):m.includes("porto")||m.includes("restroom")||m.includes("toilet")||m.includes("potty")||m.includes("potties")||m.includes("port-o")?r.pins.push({label:"Restrooms",gpsLat:w.lat,gpsLng:w.lng,x:0,y:0}):(l.push(`"${m}" at ${JSON.stringify(w)} does not match. (${this.withoutCamp(m)})`),v==""&&(v=`${C} does not have a description.`),C.length>0&&(n?r.newArt.push({id:void 0,contact_email:"",art_type:"Art",category:"Art",name:C,description:v,pin:JSON.stringify(w),imageUrl:void 0,externalId:void 0}):r.newCamps.push({id:void 0,contact_email:"",camp_type:"Theme Camp",name:C,description:v,pin:JSON.stringify(w),imageUrl:void 0,externalId:void 0,publicEvents:!1})))}console.log(`Found ${a} of ${c} matches`,r);for(let g of l)console.error(g);return r}withoutCamp(t){return this.cleanString(t).replace("camp ","").replace(" camp","")}cleanString(t){let e=this.noEmojis(t.toLowerCase()).trim();return e=e.replace(" - ","-"),e=e.replace(/[^\x00-\x7F]/g,""),e=e.replace(/[-.]/g,""),e=e.replace(/\d/g,"").trim(),e}noEmojis(t){return t.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"").replace(/'/g,"").replace(/`/g,"").replace(/&/g,"and").replace("/-/g","").replace(/the/g,"")}campNameMatch(t,e){return this.withoutCamp(t)===this.withoutCamp(e)}matchWithoutNumbers(t,e){return t===e?!0:e?!isNaN(parseInt(t.charAt(0)))&&this.removeFirstWord(t).trim().toLowerCase()===e.trim().toLowerCase():!1}removeFirstWord(t){let e=t.trim().split(/\s+/);return e.shift(),e.join(" ")}extractBetweenTags(t,e){let n=`<${e}>`,r=`</${e}>`,o=t.indexOf(n);if(o===-1)return"";let s=t.indexOf(r,o);return s===-1?"":t.substring(o+n.length,s)}};Z.\u0275fac=function(e){return new(e||Z)},Z.\u0275prov=le({token:Z,factory:Z.\u0275fac,providedIn:"root"});var ye=Z;var zn=1e3,q=class q{constructor(){this.COORDINATE_PRECISION=6}categorizeResultsWithValidation(t,e,n){let r=[],o=[],s={locationChanges:[],noChanges:[],newItems:[],unmatchedItems:[],specialPins:[],summary:{totalPlacemarks:0,locationChanges:0,noChanges:0,newItems:0,unmatchedItems:0,specialPins:0}};if(!e)return r.push({type:"DATA_UNAVAILABLE",message:`Unable to load existing ${n} data.`,details:"The preview cannot be generated without existing data to compare against."}),{data:s,errors:r,warnings:o,success:!1};e.length===0&&o.push({type:"DATA_UNAVAILABLE",message:`No existing ${n} found.`,details:"All placemarks will be treated as new items."});try{let a=this.categorizeResults(t,e,n),l=a.summary.totalPlacemarks+a.summary.unmatchedItems;l>zn&&o.push({type:"FILE_TOO_LARGE",message:`Large file detected (${l} items).`,details:"Processing may take longer than usual."});let c=n==="camps"?t.camps:t.art;for(let u of c)!this.parseCoordinates(u.pin)&&u.pin&&u.pin!==""&&u.pin!=="undefined"&&o.push({type:"MALFORMED_COORDINATES",message:`Could not parse coordinates for "${u.name}" (${u.pin}).`,placemarkName:u.name});return{data:a,errors:r,warnings:o,success:!0}}catch(a){return r.push({type:"INVALID_FORMAT",message:"An error occurred while categorizing the import results.",details:a instanceof Error?a.message:"Unknown error"}),{data:s,errors:r,warnings:o,success:!1}}}categorizeResults(t,e,n){let r=[],o=[],s=[],a=[],l=n==="camps"?t.camps:t.art,c=n==="camps"?t.newCamps:t.newArt,u=new Set;for(let m of l){m.id!==void 0&&u.add(m.id);let v=e.find(E=>E.id===m.id),w=v?this.parseCoordinates(v.pin):void 0,I=this.parseCoordinates(m.pin),A={id:m.id,name:m.name,type:n==="camps"?"camp":"art",currentCoordinates:w,newCoordinates:I};w&&I?this.compareCoordinates(w,I)?o.push(A):r.push(A):I?r.push(A):o.push(A)}for(let m of c){let v=this.parseCoordinates(m.pin);s.push({id:void 0,name:m.name,type:n==="camps"?"camp":"art",newCoordinates:v,description:m.description})}for(let m of t.pins)a.push({id:void 0,name:m.label,type:"pin",newCoordinates:m.gpsLat!==void 0&&m.gpsLng!==void 0?{lat:m.gpsLat,lng:m.gpsLng}:void 0,pinType:m.label});let g=this.identifyUnmatchedItems(e,u,n),C=this.calculateSummary(r,o,s,g,a);return{locationChanges:r,noChanges:o,newItems:s,unmatchedItems:g,specialPins:a,summary:C}}compareCoordinates(t,e){let n=this.roundToPrecision(t.lat),r=this.roundToPrecision(t.lng),o=this.roundToPrecision(e.lat),s=this.roundToPrecision(e.lng);return n===o&&r===s}formatCoordinates(t){let e=t.lat.toFixed(this.COORDINATE_PRECISION),n=t.lng.toFixed(this.COORDINATE_PRECISION);return`${e}, ${n}`}identifyUnmatchedItems(t,e,n){let r=[];for(let o of t)if(o.id!==void 0&&!e.has(o.id)){let s=this.parseCoordinates(o.pin);r.push({id:o.id,name:o.name,type:n==="camps"?"camp":"art",currentCoordinates:s})}return r}parseCoordinates(t){if(!(!t||t===""||t==="undefined"))try{let e=JSON.parse(t);return typeof e.lat=="number"&&typeof e.lng=="number"?e.lat===-1&&e.lng===-1||!this.isValidCoordinate(e.lat,e.lng)?void 0:{lat:e.lat,lng:e.lng}:void 0}catch{return}}isValidCoordinate(t,e){return!isFinite(t)||!isFinite(e)||isNaN(t)||isNaN(e)?!1:t>=-90&&t<=90&&e>=-180&&e<=180}roundToPrecision(t){let e=Math.pow(10,this.COORDINATE_PRECISION);return Math.round(t*e)/e}calculateSummary(t,e,n,r,o){return{totalPlacemarks:t.length+e.length+n.length+o.length,locationChanges:t.length,noChanges:e.length,newItems:n.length,unmatchedItems:r.length,specialPins:o.length}}};q.\u0275fac=function(e){return new(e||q)},q.\u0275prov=le({token:q,factory:q.\u0275fac,providedIn:"root"});var Ee=q;var jn=["fileInput"],He=(i,t)=>{var e;return(e=t.id)!=null?e:t.name},Un=(i,t)=>{var e,n;return(n=t.id)!=null?n:t.name+((e=t.newCoordinates==null?null:t.newCoordinates.lat)!=null?e:0)},Gn=(i,t)=>{var e;return t.name+((e=t.newCoordinates==null?null:t.newCoordinates.lat)!=null?e:0)},Ye=(i,t)=>t.message;function Hn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),d(),h(3,"ion-note",14),_(4),d()()),i&2){let e=t.$implicit,n=x(4);p(2),y(e.name),p(2),y(n.formatCoordinates(e))}}function Yn(i,t){if(i&1&&(h(0,"p",22),_(1),Q(2,"lowercase"),d(),h(3,"ion-list",23),$(4,Hn,5,2,"ion-item",null,He),d()),i&2){let e=x(),n=x(2);p(),T(" These ",X(2,2,n.getItemTypeLabelPlural())," were found in the KML file with updated locations. "),p(2),F("inset",!0),p(),V(e.locationChanges)}}function Qn(i,t){if(i&1&&(h(0,"p"),_(1),Q(2,"lowercase"),d()),i&2){let e=x(3);p(),T(" No location changes for ",X(2,1,e.getItemTypeLabelPlural())," were found. ")}}function Xn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),d(),h(3,"ion-note",14),_(4),d()()),i&2){let e=t.$implicit,n=x(4);p(2),y(e.name),p(2),y(n.formatCoordinates(e))}}function Jn(i,t){if(i&1&&(h(0,"ion-accordion",17)(1,"ion-item",24)(2,"ion-label"),_(3,"No Changes"),d(),h(4,"ion-note",14),_(5),d()(),h(6,"div",15)(7,"p",22),_(8),Q(9,"lowercase"),d(),h(10,"ion-list",23),$(11,Xn,5,2,"ion-item",null,He),d()()()),i&2){let e=x(),n=x(2);p(5),y(e.noChanges.length),p(3),T(" These are ",X(9,3,n.getItemTypeLabelPlural())," were found in the KML file but had no changes to location. "),p(2),F("inset",!0),p(),V(e.noChanges)}}function Zn(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),d(),h(3,"ion-note",14),_(4),d()()),i&2){let e=t.$implicit,n=x(4);p(2),T(" ",e.name," "),p(2),y(n.formatCoordinates(e))}}function qn(i,t){if(i&1){let e=re();h(0,"ion-accordion",18)(1,"ion-item",25)(2,"ion-label"),_(3),d(),h(4,"ion-badge",26),_(5),d()(),h(6,"div",15)(7,"p",22),_(8),Q(9,"lowercase"),h(10,"app-tooltip",27)(11,"ion-button",28),Y("click",function(){G(e);let r=x(3);return H(r.copyNewItemNamesToClipboard())}),ue(12,"ion-icon",29),d()()(),h(13,"div")(14,"ion-item")(15,"ion-label")(16,"input",30),et("ngModelChange",function(r){G(e);let o=x(3);return qe(o.importNewItems,r)||(o.importNewItems=r),H(r)}),d(),_(17),d()()(),h(18,"ion-list",23),$(19,Zn,5,2,"ion-item",null,Un),d()()()}if(i&2){let e=x(),n=x(2);p(3),y(n.getNewItemsLabel()),p(2),y(e.newItems.length),p(3),T(" These are placemarks in the KML that do not match existing ",X(9,6,n.getItemTypeLabelPlural()),". They may be named differently (in which case you should fix Google Maps to match). "),p(8),Ze("ngModel",n.importNewItems),p(),T(" Import as New ",n.getItemTypeLabelPlural()),p(),F("inset",!0),p(),V(e.newItems)}}function ei(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),h(3,"p"),_(4),d()(),h(5,"ion-note",14),_(6),d()()),i&2){let e=t.$implicit,n=x(4);p(2),T(" ",e.name," "),p(2),y(n.getUnmatchedDescription()),p(2),y(n.formatCoordinates(e))}}function ti(i,t){if(i&1&&(h(0,"ion-accordion",19)(1,"ion-item",31)(2,"ion-label"),_(3),d(),h(4,"ion-note",14),_(5),d()(),h(6,"div",15)(7,"p",22),_(8),Q(9,"lowercase"),d(),h(10,"ion-list",23),$(11,ei,7,3,"ion-item",null,He),d()()()),i&2){let e=x(),n=x(2);p(3),y(n.getUnmatchedItemsLabel()),p(2),y(e.unmatchedItems.length),p(3),T(" These are ",X(9,4,n.getItemTypeLabelPlural())," that were not found in the KML file. These may be missing from your Google Map or may need to be removed from dust because they have cancelled. They may also be unplaced or their location deliberately not shown. They may also have different names from what is in Google Maps in which case you should fix the name in Google Maps. "),p(2),F("inset",!0),p(),V(e.unmatchedItems)}}function ni(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-label"),_(2),d(),h(3,"ion-note",14),_(4),d()()),i&2){let e=t.$implicit,n=x(4);p(2),T(" ",e.name||n.getPinTypeLabel(e.pinType)," "),p(2),y(n.formatCoordinates(e))}}function ii(i,t){if(i&1&&(h(0,"ion-accordion",20)(1,"ion-item",32)(2,"ion-label"),_(3,"Restrooms and Other Placemarks"),d(),h(4,"ion-badge",33),_(5),d()(),h(6,"div",15)(7,"p",22),_(8," These are special location markers found in the KML file such as restrooms and shuttle stops. "),d(),h(9,"ion-list",23),$(10,ni,5,2,"ion-item",null,Gn),d()()()),i&2){let e=x();p(5),y(e.specialPins.length),p(4),F("inset",!0),p(),V(e.specialPins)}}function ri(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-chip",34),_(2),d()()),i&2){let e=t.$implicit;p(2),pe(" ",e.message," ",e.details," ")}}function oi(i,t){if(i&1&&(h(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),_(3,"Errors"),d()(),$(4,ri,3,2,"ion-item",null,Ye),d()),i&2){let e=x(3);p(4),V(e.errors())}}function si(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-chip",35),_(2),d()()),i&2){let e=t.$implicit;p(2),pe(" ",e.message," ",e.details," ")}}function ai(i,t){if(i&1&&(h(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),_(3,"Warnings"),d()(),$(4,si,3,2,"ion-item",null,Ye),d()),i&2){let e=x(3);p(4),V(e.warnings())}}function li(i,t){if(i&1){let e=re();h(0,"div",6)(1,"ion-card",9)(2,"ion-card-header")(3,"ion-card-title"),_(4," Import KML "),d(),h(5,"p",10),_(6),Q(7,"lowercase"),d()(),h(8,"ion-card-content")(9,"ion-accordion-group",11)(10,"ion-accordion",12)(11,"ion-item",13)(12,"ion-label"),_(13,"Total Placemarks"),d(),h(14,"ion-note",14),_(15),d()(),h(16,"div",15)(17,"p"),_(18," This is the total number of placemarks found in the KML file. "),d()()(),h(19,"ion-accordion",16)(20,"ion-item",13)(21,"ion-label"),_(22,"Location Changes"),d(),h(23,"ion-note",14),_(24),d()(),h(25,"div",15),S(26,Yn,6,4)(27,Qn,3,3,"p"),d()(),S(28,Jn,13,5,"ion-accordion",17),S(29,qn,21,8,"ion-accordion",18),S(30,ti,13,6,"ion-accordion",19),S(31,ii,12,2,"ion-accordion",20),d(),S(32,oi,6,0,"ion-list"),S(33,ai,6,0,"ion-list"),d()()(),h(34,"app-footer",21),Y("press",function(){G(e);let r=x(2);return H(r.confirmImport())}),d()}if(i&2){let e=t,n=x(2);p(6),T(" The KML file contains the following placemarks and matching ",X(7,12,n.getItemTypeLabelPlural()),'. Review and click "Begin Import" to apply the map locations. '),p(3),F("multiple",!0),p(6),y(e.summary.totalPlacemarks),p(9),y(e.locationChanges.length),p(2),D(e.locationChanges.length>0?26:27),p(2),D(e.noChanges.length>0?28:-1),p(),D(e.newItems.length>0?29:-1),p(),D(e.unmatchedItems.length>0?30:-1),p(),D(e.specialPins.length>0?31:-1),p(),D(n.errors().length>0?32:-1),p(),D(n.warnings().length>0?33:-1),p(),F("icon","arrow-forward-outline")}}function ci(i,t){if(i&1&&(h(0,"ion-item")(1,"ion-chip",34),_(2),d()()),i&2){let e=t.$implicit;p(2),pe(" ",e.message," ",e.details," ")}}function ui(i,t){if(i&1&&(h(0,"div",6)(1,"ion-card",9)(2,"ion-card-header")(3,"ion-card-title"),_(4," Import KML "),d(),h(5,"p",10),_(6," The KML file could not be processed due to validation errors. "),d()(),h(7,"ion-card-content")(8,"ion-list")(9,"ion-list-header")(10,"ion-label"),_(11,"Errors"),d()(),$(12,ci,3,2,"ion-item",null,Ye),d()()()()),i&2){let e=x(2);p(12),V(e.errors())}}function mi(i,t){i&1&&(h(0,"div",7),ue(1,"ion-spinner",36),h(2,"ion-text",37),_(3,"Loading preview data..."),d()())}function di(i,t){if(i&1&&ue(0,"app-progress-overlay",8),i&2){let e=x(2);F("title","Importing...")("progress",e.progress())}}function pi(i,t){if(i&1){let e=re();h(0,"ion-header")(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-button",4),Y("click",function(){G(e);let r=x();return H(r.cancelImport())}),_(4," Cancel "),d()(),h(5,"ion-title"),_(6),d()()(),h(7,"ion-content",5),S(8,li,35,14)(9,ui,14,0,"div",6)(10,mi,4,0,"div",7),S(11,di,1,2,"app-progress-overlay",8),d()}if(i&2){let e,n=x();p(6),y(n.getTitle()),p(2),D((e=n.previewData())?8:n.hasErrors()?9:10,e),p(3),D(n.isImporting()?11:-1)}}var te=class te{constructor(){this.fileInput=he.required("fileInput");this.type=be.required();this.existingItems=be.required();this.isOpen=tt(!1);this.previewData=N(null);this.importType=N("camps");this.originalChanges=N(null);this.importComplete=oe();this.cancelled=oe();this.fileError=oe();this.progressChange=oe();this.errors=N([]);this.warnings=N([]);this.hasErrors=N(!1);this.isImporting=N(!1);this.progress=N(0);this.importNewItems=N(!1);this.previewService=R(Ee);this.kmlService=R(ye);this.api=R(Ce);this.alert=R(Ot);Rt({locationOutline:kt,busOutline:Ft,waterOutline:Kt,arrowDown:Dt,navigate:Bt,homeOutline:Nt,colorPaletteOutline:Tt,copyOutline:Lt})}openFilePicker(){this.isOpen.set(!0),this.fileInput().nativeElement.click()}onFileSelected(t){var e;try{let n=t.target,r=(e=n.files)==null?void 0:e[0];if(!r){this.cancelled.emit();return}let o=r.size,s=new FileReader;s.onload=a=>{var c;let l=(c=a.target)==null?void 0:c.result;this.processKmlFile(l,o)},s.onerror=()=>{this.fileError.emit("Failed to read the file. Please try again.")},s.readAsText(r),n.value=""}catch(n){console.error("Error in onFileSelected:",n),this.fileError.emit("An error occurred while processing the file.")}}onFileSelectionCancelled(){this.cancelled.emit()}processKmlFile(t,e){let n=this.type(),r=this.existingItems(),o=this.kmlService.validate(t,e);if(!o.isValid){this.showError(o.errors,n);return}let s=n==="art",a=this.kmlService.parse(t,r,s);this.showPreview(a,r,n)}showPreview(t,e,n){this.originalChanges.set(t),this.importType.set(n);let r=this.previewService.categorizeResultsWithValidation(t,e,n);this.previewData.set(r.data),this.errors.set(r.errors),this.warnings.set(r.warnings),this.hasErrors.set(!r.success),this.isOpen.set(!0)}showError(t,e){this.originalChanges.set(null),this.importType.set(e),this.previewData.set(null),this.errors.set(t),this.warnings.set([]),this.hasErrors.set(!0),this.isOpen.set(!0)}confirmImport(){return L(this,null,function*(){let t=this.originalChanges();if(t){this.isImporting.set(!0),this.progress.set(0),this.progressChange.emit(0);try{this.importType()==="camps"?yield this.processCampChanges(t):yield this.processArtChanges(t)}finally{this.isImporting.set(!1),this.progress.set(0),this.progressChange.emit(void 0),this.isOpen.set(!1),this.onWillDismiss()}}})}processCampChanges(t){return L(this,null,function*(){let e=this.previewData(),n=new Set((e==null?void 0:e.locationChanges.map(l=>l.id).filter(l=>l!==void 0))||[]),r=t.camps.filter(l=>!!(l.id!==void 0&&n.has(l.id)||l.id===void 0)),o=r.length+(t.pins.length>0?1:0),s=0;for(let l of r){yield this.api.addCamp(l,!0),s++;let c=o>0?s/o:0;this.progress.set(c),this.progressChange.emit(c)}if(t.pins.length>0){let l=yield this.api.getPins();yield this.api.placePins(this.deduplicatePins(l,t.pins)),s++;let c=o>0?s/o:0;this.progress.set(c),this.progressChange.emit(c)}let a=yield this.importNewCamps(t.newCamps);this.api.clearCache(),this.importComplete.emit(`${r.length} camp changes made. ${t.pins.length} restrooms added. ${a} new camps added.`)})}processArtChanges(t){return L(this,null,function*(){let e=this.previewData(),n=new Set((e==null?void 0:e.locationChanges.map(l=>l.id).filter(l=>l!==void 0))||[]),r=t.art.filter(l=>!!(l.id!==void 0&&n.has(l.id)||l.id===void 0)),o=r.length,s=0;for(let l of r){try{yield this.api.addArt(l)}catch(u){throw console.error(`Unable to apply art change ${l.name}`,l),u}s++;let c=o>0?s/o:0;this.progress.set(c),this.progressChange.emit(c)}let a=yield this.importNewArt(t.newArt);this.api.clearCache(),this.importComplete.emit(`${r.length} art changes made. ${a} art added.`)})}deduplicatePins(t,e){let n=t;for(let r of e)t.find(o=>o.label===r.label&&o.gpsLat===r.gpsLat&&o.gpsLng===r.gpsLng)||n.push(r);return n}importNewCamps(t){return L(this,null,function*(){let e=0;if(t.length===0||!this.importNewItems())return 0;for(let n of t){let r=yield Oe(this.alert,`Create Camp "${n.name}" ?`,"Create");if(r==="Create"&&(yield this.api.addCamp(n,!0),e++),r==="Cancel")return e}return e})}importNewArt(t){return L(this,null,function*(){let e=0;if(t.length===0||!this.importNewItems())return 0;for(let n of t)if(n.pin.includes("lat")){let r=yield Oe(this.alert,`Add Art "${n.name}" ?`,"Add");if(r==="Add"&&((!n.description||n.description.length<5)&&(n.description=`No description provided for ${n.name}.`),yield this.api.addArt(n),e++),r==="Cancel")return e}return e})}cancelImport(){this.cancelled.emit(),this.isOpen.set(!1),this.onWillDismiss()}onWillDismiss(){this.isOpen.set(!1),this.previewData.set(null),this.originalChanges.set(null),this.errors.set([]),this.warnings.set([]),this.hasErrors.set(!1),this.importNewItems.set(!1)}getTitle(){return this.importType()==="camps"?"Import Camp Locations":"Import Art Locations"}getItemTypeLabel(){return this.importType()==="camps"?"Camp":"Art"}getItemTypeLabelPlural(){return this.importType()==="camps"?"Camps":"Art"}getNewItemsLabel(){return this.importType()==="camps"?"New or Mismatching Camps":"New or Mismatching Art"}getUnmatchedItemsLabel(){return this.importType()==="camps"?"Camps not in File":"Art not in File"}getUnmatchedDescription(){return`This ${this.importType()==="camps"?"camp":"art item"} was not found in the KML file`}getItemIcon(){return this.importType()==="camps"?"home-outline":"color-palette-outline"}formatCoordinates(t){return t.newCoordinates?this.previewService.formatCoordinates(t.newCoordinates):t.currentCoordinates?this.previewService.formatCoordinates(t.currentCoordinates):"No coordinates"}formatCurrentCoordinates(t){return t.currentCoordinates?this.previewService.formatCoordinates(t.currentCoordinates):"No previous location"}formatNewCoordinates(t){return t.newCoordinates?this.previewService.formatCoordinates(t.newCoordinates):"No new location"}getPinIcon(t){if(!t)return"pin-outline";let e=t.toLowerCase();return e.includes("restroom")||e.includes("porto")||e.includes("toilet")||e.includes("potty")?"water-outline":e.includes("shuttle")?"bus-outline":"pin-outline"}getPinTypeLabel(t){if(!t)return"Pin";let e=t.toLowerCase();return e.includes("restroom")||e.includes("porto")||e.includes("toilet")||e.includes("potty")?"Restrooms":e.includes("shuttle")?"Shuttle Stop":t}copyNewItemNamesToClipboard(){return L(this,null,function*(){let t=this.previewData();if(!t||t.newItems.length===0)return;let e=t.newItems.map(n=>n.name).join(`
`);try{yield navigator.clipboard.writeText(e),this.api.sendMessage("Names copied to clipboard")}catch(n){console.error("Failed to copy to clipboard:",n),this.api.sendMessage("Failed to copy to clipboard")}})}};te.\u0275fac=function(e){return new(e||te)},te.\u0275cmp=ce({type:te,selectors:[["app-kml-preview"]],viewQuery:function(e,n){e&1&&me(n.fileInput,jn,5),e&2&&de()},inputs:{type:[1,"type"],existingItems:[1,"existingItems"],isOpen:[1,"isOpen"]},outputs:{isOpen:"isOpenChange",importComplete:"importComplete",cancelled:"cancelled",fileError:"fileError",progressChange:"progressChange"},decls:3,vars:1,consts:[["fileInput",""],["type","file","accept",".kml,.kmz",2,"display","none",3,"change","cancel"],["color","primary"],["slot","start"],[3,"click"],[1,"ion-padding"],[1,"border"],[1,"loading-placeholder"],[3,"title","progress"],[1,"summary-card"],[1,"summary-description"],[3,"multiple"],["value","total-placemarks"],["slot","header",1,"category-header"],["slot","end"],["slot","content",1,"category-content"],["value","location-changes"],["value","no-changes"],["value","new-items"],["value","unmatched"],["value","special-pins"],["title","Begin Import",3,"press","icon"],[2,"margin-right","2rem"],[3,"inset"],["slot","header",1,"category-header","no-changes"],["slot","header",1,"category-header","new-items"],["mode","ios","slot","end","color","danger"],["position","left-aside","text","Copy names to clipboard"],["size","small","color","medium","fill","clear",3,"click"],["slot","icon-only","name","copy-outline"],["type","checkbox",3,"ngModelChange","ngModel"],["slot","header",1,"category-header","unmatched"],["slot","header",1,"category-header","special-pins"],["slot","end","color","secondary"],["color","danger"],["color","warning"],["name","crescent"],["color","medium"]],template:function(e,n){if(e&1){let r=re();h(0,"input",1,0),Y("change",function(s){return G(r),H(n.onFileSelected(s))})("cancel",function(){return G(r),H(n.onFileSelectionCancelled())}),d(),S(2,pi,12,3)}e&2&&(p(2),D(n.isOpen()?2:-1))},dependencies:[It,_t,St,ge,lt,ot,st,at,fe,dt,vt,bt,pt,Mt,wt,At,mt,ct,ut,ht,gt,ft,Ct,Pt,yt,Et,xt,Vt,zt,$t,nt],styles:["@media (min-width: 801px){ion-modal[_ngcontent-%COMP%]{--width: 80vw;--max-width: 900px;--min-height: 80vh}}p[_ngcontent-%COMP%]{margin-left:var(--spacing-lg);font-size:var(--font-size-base)}ion-accordion[_ngcontent-%COMP%]   ion-item[slot=header][_ngcontent-%COMP%]{--background: transparent}ion-accordion[_ngcontent-%COMP%]{border:1px solid var(--ion-color-light-shade);border-radius:var(--br-3xl);margin-bottom:var(--spacing-sm)}ion-accordion[_ngcontent-%COMP%]   ion-item[slot=content][_ngcontent-%COMP%]{--background: transparent}.summary-card[_ngcontent-%COMP%]{margin-bottom:var(--spacing-lg)}.summary-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:var(--font-size-xl)}input[type=checkbox][_ngcontent-%COMP%]{transform:scale(1.5);margin-left:var(--spacing-base);margin-right:var(--spacing-base)}ion-list-header[_ngcontent-%COMP%]{font-size:var(--font-size-medium);font-weight:700}.category-header[_ngcontent-%COMP%]{--background: var(--ion-color-light);--padding-start: var(--spacing-md)}.category-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--font-size-base);margin-right:var(--spacing-base)}.category-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:var(--font-size-xl);padding:var(--spacing-sm) var(--spacing-base);margin-right:0}.category-header.location-changes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary)}.category-header.no-changes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-tertiary)}.category-header.new-items[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-warning-shade)}.category-header.unmatched[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.category-header.special-pins[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#8a2be2}.category-content[_ngcontent-%COMP%]{padding:var(--spacing-base)}.preview-item-card[_ngcontent-%COMP%]{margin:var(--spacing-base) 0}.preview-item-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:var(--spacing-md)}.item-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-base);margin-bottom:var(--spacing-base)}.item-header[_ngcontent-%COMP%]   .item-type-icon[_ngcontent-%COMP%]{font-size:var(--font-size-xl);color:var(--ion-color-primary)}.item-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{flex:1;font-size:var(--font-size-xl);word-break:break-word}.item-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:var(--font-size-xl);padding:var(--spacing-xs) var(--spacing-sm);margin-right:0;white-space:nowrap}.coordinates-display[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-base);color:var(--ion-color-medium);font-size:var(--font-size-xl);padding:var(--spacing-sm);background:var(--ion-color-light);border-radius:var(--spacing-sm)}.coordinates-display[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--font-size-base);color:var(--ion-color-primary)}.coordinates-change[_ngcontent-%COMP%]{font-size:var(--font-size-xl);background:var(--ion-color-light);border-radius:var(--spacing-sm);padding:var(--spacing-base)}.coordinates-change[_ngcontent-%COMP%]   .coord-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);padding:var(--spacing-xs) 0}.coordinates-change[_ngcontent-%COMP%]   .coord-row[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{min-width:45px}.coordinates-change[_ngcontent-%COMP%]   .coord-row.old[_ngcontent-%COMP%]{color:var(--ion-color-medium);text-decoration:line-through;opacity:.7}.coordinates-change[_ngcontent-%COMP%]   .coord-row.new[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:500}.coordinates-change[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:var(--font-size-base);margin:var(--spacing-xs) 0;display:block}.special-pin-card[_ngcontent-%COMP%]{border-left:3px solid #8a2be2}.special-pin-card[_ngcontent-%COMP%]   .pin-name-with-icon[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);flex:1}.special-pin-card[_ngcontent-%COMP%]   .pin-name-with-icon[_ngcontent-%COMP%]   .pin-type-icon[_ngcontent-%COMP%]{color:#8a2be2;font-size:var(--font-size-xl)}.loading-placeholder[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:150px;flex-direction:column;gap:var(--spacing-md)}@media (max-width: 500px){.category-header[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--font-size-xl)}.category-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:var(--font-size-xl)}}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:var(--spacing-sm) 0 0 0;font-size:var(--font-size-xl);color:var(--ion-color-medium);font-weight:400}"],changeDetection:0});var ne=te;var ie=class ie{constructor(){this.api=R(Ce);this.router=R(rt);this.route=R(it);this.kmlPreview=he.required(ne);this.importType="camps";this.existingItems=[];this.isOpen=!0}ngOnInit(){return L(this,null,function*(){this.route.params.subscribe(t=>L(this,null,function*(){this.importType=t.type==="art"?"art":"camps",this.importType==="camps"?this.existingItems=yield this.api.camps({cached:!0}):this.existingItems=yield this.api.art({cached:!0}),setTimeout(()=>{let e=this.kmlPreview();e&&e.openFilePicker()},100)}))})}onImportComplete(t){this.api.sendMessage(t),this.navigateBack()}onPreviewCancelled(){console.log("Preview cancelled, navigating back"),this.navigateBack()}onPreviewError(t){this.api.sendMessage(t)}navigateBack(){let e=this.router.url.split("/")[1];this.importType==="camps"?this.router.navigateByUrl(`/${e}/camps`):this.router.navigateByUrl(`/${e}/art`)}};ie.\u0275fac=function(e){return new(e||ie)},ie.\u0275cmp=ce({type:ie,selectors:[["app-import-kml"]],viewQuery:function(e,n){e&1&&me(n.kmlPreview,ne,5),e&2&&de()},decls:2,vars:3,consts:[[3,"importComplete","cancelled","fileError","type","existingItems","isOpen"]],template:function(e,n){e&1&&(h(0,"ion-content")(1,"app-kml-preview",0),Y("importComplete",function(o){return n.onImportComplete(o)})("cancelled",function(){return n.onPreviewCancelled()})("fileError",function(o){return n.onPreviewError(o)}),d()()),e&2&&(p(),F("type",n.importType)("existingItems",n.existingItems)("isOpen",n.isOpen))},dependencies:[ge,fe,ne],encapsulation:2});var on=ie;export{on as ImportKmlPage};
