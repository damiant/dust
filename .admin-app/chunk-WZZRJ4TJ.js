import{a as Pt}from"./chunk-3GPRSYYX.js";import{a as Dt}from"./chunk-VBSH35Y7.js";import{a as Lt}from"./chunk-3XK6QQO3.js";import"./chunk-YNP25RQU.js";import{a as k}from"./chunk-NKS2ICHJ.js";import"./chunk-W4BNGQYG.js";import{Z as bt,a as wt}from"./chunk-2G3SQA7K.js";import{H as A,e as J,x as It,y as W,z as G}from"./chunk-FZZYZTAK.js";import"./chunk-XMQYHBKU.js";import{$ as S,$a as mt,Aa as nt,Bc as Tt,Fa as ot,G as a,I as V,Ia as rt,L as b,La as at,Lb as ht,Sb as gt,Tb as yt,V as _,Va as st,W as v,Y as D,Z as L,Za as ct,_ as P,_b as _t,aa as s,ab as ut,ba as c,ca as h,db as lt,ea as X,ec as vt,fa as Y,fc as N,ga as d,gc as R,hc as E,ib as pt,ic as B,l as w,lb as dt,lc as St,p as l,pc as xt,qc as Ct,s as j,sb as ft,t as U,ta as p,ua as O,va as I,wc as Mt,xa as tt,ya as et,za as it}from"./chunk-LVKFIXIJ.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as f}from"./chunk-LNJ3S2LQ.js";var x=class x{constructor(){this.api=l(A)}occurrences(e){let t=JSON.parse(e!=null?e:"[]");for(let i of t)i.timeRange=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(i.startTime)),i.time=It[new Date(i.startTime).getDay()],i.startTime=W(new Date(i.startTime),this.api.currentTimeZone()),i.endTime=W(new Date(i.endTime),this.api.currentTimeZone());return t}occurrencesRSL(e){let t=JSON.parse(e!=null?e:"[]");return{date:G(new Date(t[0].startTime)),start_date:G(new Date(t[0].startTime)),end_date:G(new Date(t[t.length-1].endTime)),start_time:new Date(t[0].startTime).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),end_time:new Date(t[t.length-1].endTime).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}}dayTitle(e){let t=this.occurrences(e);return t.length>0&&t[0].timeRange?`${t[0].time} ${t[0].timeRange} ${t[0].startTime}`:""}};x.\u0275fac=function(t){return new(t||x)},x.\u0275prov=w({token:x,factory:x.\u0275fac,providedIn:"root"});var g=x;function Rt(n,e){if(n&1&&(s(0,"ion-item")(1,"ion-label"),p(2),c(),s(3,"ion-note",1),p(4),c()()),n&2){let t=e.$implicit;a(2),I(" ",t.who," "),a(2),tt(" ",t.time," ",t.startTime,"-",t.endTime," ")}}var M=class M{constructor(){this.music=at();this.party=l(g);this.occurrences=rt(()=>{var e;return this.party.occurrences((e=this.music())==null?void 0:e.occurrences)})}};M.\u0275fac=function(t){return new(t||M)},M.\u0275cmp=b({type:M,selectors:[["app-party-list"]],inputs:{music:[1,"music"]},decls:3,vars:0,consts:[["lines","inset"],["slot","end"]],template:function(t,i){t&1&&(s(0,"ion-list",0),L(1,Rt,5,4,"ion-item",null,D),c()),t&2&&(a(),P(i.occurrences()))},dependencies:[B,E,N,R],encapsulation:2});var $=M;var C=class C{constructor(){this.ttitdService=l(k);this.partyService=l(g)}exportMusicJSON(e){return f(this,null,function*(){let t=yield this.exportMusic(e);this.exportJSON("rsl.json",t)})}exportMusicRSL(e){return f(this,null,function*(){let t=yield this.exportRSLStyle(e);this.exportJSON("raw-event-data.json",t)})}exportJSON(e,t){let i=JSON.stringify(t,null,2),o=new Blob([i],{type:"text/json;charset=utf-8;"}),r=document.createElement("a");if(r.download!==void 0){let u=URL.createObjectURL(o);r.setAttribute("href",u),r.setAttribute("download",e),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}isMutantVehicle(e){var t,i;return(i=(t=e.musicType)==null?void 0:t.includes("Mutant Vehicle"))!=null?i:!1}exportRSLStyle(e){return f(this,null,function*(){return yield this.ttitdService.init(),e.map(t=>{var i,o,r,u,m,y,Z,H,z,K;return{location_name:this.extractTitle(t),address:this.extractLocation(t),attributes:{wcf:(o=(i=t.musicType)==null?void 0:i.includes("Wheelchair Accessible"))!=null?o:!1,mv:this.isMutantVehicle(t),bpal:(u=(r=t.musicType)==null?void 0:r.includes("_BIPOC"))!=null?u:!1,lm:(y=(m=t.musicType)==null?void 0:m.includes("Live Music"))!=null?y:!1,rr:(H=(Z=t.musicType)==null?void 0:Z.includes("_Recommended"))!=null?H:!1},camp_uuid:this.extractLocationUid(t),theme:(z=t.title)!=null?z:"",date:this.extractDates(t).date,start_date:this.extractDates(t).start_date,end_date:this.extractDates(t).end_date,start_time:this.extractDates(t).start_time,end_time:this.extractDates(t).end_time,performances:JSON.parse((K=t.occurrences)!=null?K:[]).map(Q=>({time:Q.time,artists:[{name:Q.who||""}]}))||[]}})})}exportMusic(e){return f(this,null,function*(){yield this.ttitdService.init();let t="-07:00";return e.map((i,o)=>{var r,u;return{id:`rsl-${o+1}`,uid:`rsl-${o+1}`,title:(r=i.title)!=null?r:`${i.camp} (${new Date(i.day).toLocaleDateString("en-US",{weekday:"short"})})`,camp:i.camp||"",day:i.day||"",location:this.extractLocation(i),wa:i.wa||!1,waNotes:i.waNotes||void 0,distance:0,distanceInfo:"",artCar:this.extractLocationArtCar(i),campId:this.extractLocationUid(i),occurrences:JSON.parse((u=i.occurrences)!=null?u:[]).map((m,y)=>({who:m.who||"",startTime:m.startTime+t||"",endTime:m.endTime+t||"",timeRange:m.timeRange||m.time||"",time:m.time||m.timeRange||"",id:y.toString()}))||[]}})})}extractLocationArtCar(e){try{let t=JSON.parse(e.location);return t.type==="mutant"?t.artCar:void 0}catch{return}}extractDates(e){return this.partyService.occurrencesRSL(e.occurrences)}extractTitle(e){let t=JSON.parse(e.location);return t.type==="mutant"||this.isMutantVehicle(e)||!J(t.artCar)?t.artCar:t.name}extractLocation(e){var t,i;try{let o=JSON.parse(e.location),r=this.ttitdService.camps.find(m=>m.uid==o.uid);if(r)return(t=r.location)!=null?t:"";let u=this.ttitdService.art.find(m=>m.uid==o.uid);return u?(i=u.location)!=null?i:"":o.type==="mutant"?o.name:""}catch{return""}}extractLocationUid(e){try{let t=JSON.parse(e.location);return t.type!=="mutant"?t.uid:void 0}catch{return}}};C.\u0275fac=function(t){return new(t||C)},C.\u0275prov=w({token:C,factory:C.\u0275fac,providedIn:"root"});var F=C;var Et=n=>[n];function Bt(n,e){if(n&1&&(h(0,"ion-item"),s(1,"ion-item",19)(2,"h3"),p(3),c()()),n&2){let t=d().$implicit;a(3),O(t.group)}}function Jt(n,e){if(n&1&&p(0),n&2){let t=d().$implicit;I(" ",t.dayTitle,"\xA0 ")}}function Gt(n,e){if(n&1&&(s(0,"div",17)(1,"ion-note",3),p(2),c()()),n&2){let t=d().$implicit;a(2),O(t.dayTitle)}}function At(n,e){if(n&1&&(s(0,"div",18),h(1,"app-party-list",20),c()),n&2){let t=d().$implicit;a(),S("music",t)}}function kt(n,e){if(n&1&&(_(0,Bt,4,1),s(1,"ion-item",16)(2,"ion-label"),p(3),s(4,"p"),_(5,Jt,1,1),s(6,"i"),p(7),c()()(),_(8,Gt,3,1,"div",17),c(),_(9,At,2,1,"div",18)),n&2){let t=e.$implicit,i=d(3);v(t.group?0:-1),a(),S("routerLink","../music/"+ot(7,Et,t.id)),a(2),I("",t.viewTitle," "),a(2),v(i.groupBy==="location"?5:-1),a(2),O(t.title),a(),v(i.groupBy!=="location"?8:-1),a(),v(i.groupBy==="location"?9:-1)}}function $t(n,e){if(n&1&&(s(0,"ion-list"),L(1,kt,10,9,null,null,D),c()),n&2){let t=d(2);a(),P(t.music)}}function Ft(n,e){n&1&&h(0,"ion-item")}function jt(n,e){if(n&1){let t=X();s(0,"div",9)(1,"ion-buttons",10)(2,"ion-segment",11),nt("ngModelChange",function(o){j(t);let r=d();return it(r.groupBy,o)||(r.groupBy=o),U(o)}),Y("ionChange",function(){j(t);let o=d();return U(o.refresh())}),s(3,"ion-segment-button",12)(4,"ion-label"),p(5,"Summary"),c()(),s(6,"ion-segment-button",13)(7,"ion-label"),p(8,"Details"),c()()()(),s(9,"app-image-card",14),_(10,$t,3,0,"ion-list")(11,Ft,1,0,"ion-item"),c()(),h(12,"div",15)}if(n&2){let t=d();a(2),et("ngModel",t.groupBy),S("value",t.groupBy),a(7),S("url",t.camp?t.image(t.camp):t.festivalImage())("title",t.title)("description",t.description),a(),v(t.music.length>0?10:11)}}var T=class T{constructor(e,t){this.router=e;this.route=t;this.music=[];this.busy=!0;this.groupBy="title";this.title="";this.description="";this.isAdmin=!1;this.buttons=[];this.ttitdService=l(k);this.rslService=l(F);this.partyService=l(g);this.api=l(A);bt({add:wt})}image(e){return this.api.imageURL(e.imageUrl)}festivalImage(){return this.api.imageURL(this.api.festivalImage())}getTitle(e,t){let i=t.length>0?t[0].location:"",o=!0;for(let r of t)if(r.location!=i){o=!1;break}if(o)try{return JSON.parse(i).name}catch{return e}return e}ionViewWillEnter(){return f(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.campId=this.route.snapshot.queryParams.camp,this.camp=this.campId?yield this.api.getCamp(this.campId):void 0,this.title=this.camp?`${this.camp.name}`:`${this.api.festivalTitle()}`,this.music=this.filter(yield this.api.music()),this.title=this.getTitle(this.title,this.music),this.music.map(e=>{e.camp=="Unknown"?e.viewTitle=this.extractLocation(e):e.viewTitle=e.camp}),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.description=this.music.length>0?"":`There are no parties for ${this.title}.`,this.buttons=this.isAdmin?[{title:"Export JSON",method:this.exportJSON(),icon:"cloud-download-outline"},{title:"Export RSL JSON",method:this.exportRSLStyle(),icon:"cloud-download-outline"}]:[],this.refresh(),this.busy=!1})}refresh(){if(this.groupBy=="location"){this.music.sort((t,i)=>t.location&&i.location?i.location.localeCompare(t.location):0);let e="";for(let t of this.music)t.camp!=e&&(t.group=t.camp,e=t.camp),t.dayTitle=this.partyService.dayTitle(t.occurrences)}else{this.music.sort((e,t)=>e.camp&&t.camp?e.camp.localeCompare(t.camp):0);for(let e of this.music)e.group=void 0,e.dayTitle=this.partyService.dayTitle(e.occurrences)}}filter(e){return this.campId?e.filter(t=>t.campId==this.campId):e}extractLocation(e){try{let t=JSON.parse(e.location);return J(t.artCar)||(t.type="mutant",console.warn(`Corrected music item ${e.location} to mutant vehicle type`)),t.type=="mutant"?`${t.artCar} (@ ${t.name})`:t.name}catch{return"Unknown"}}exportJSON(){return()=>f(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.rslService.exportMusicJSON(this.exportPrep(this.music))})}exportPrep(e){return JSON.parse(JSON.stringify(e))}exportRSLStyle(){return()=>f(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.rslService.exportMusicRSL(this.exportPrep(this.music))})}message(e){setTimeout(()=>{this.api.sendMessage(e)},1)}newMusic(){this.router.navigate(["./new"],{queryParams:{camp:this.campId,nextDay:this.nextDay(this.music)},relativeTo:this.route})}nextDay(e){try{if(e.length==0)return;let t;for(let r of e){let u=JSON.parse(r.occurrences);for(let m of u){let y=new Date(m.startTime);(!t||y>t)&&(t=y)}}if(!t)return;let i=new Date(t);i.setDate(i.getDate()+1);let o=i.toISOString().split("T")[0];return console.log(o),o}catch{return}}};T.\u0275fac=function(t){return new(t||T)(V(mt),V(ct))},T.\u0275cmp=b({type:T,selectors:[["app-music"]],inputs:{vanity:"vanity"},decls:13,vars:3,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../music/new"],["name","add"],[3,"buttons"],[3,"fullscreen"],["title","Add Party",3,"press"],[1,"border"],["slot","start",2,"position","absolute","margin-left","2rem","margin-top","2rem"],["mode","ios",3,"ngModelChange","ionChange","ngModel","value"],["value","title"],["value","location"],["routeTo","../music/new",3,"url","title","description"],[1,"ion-padding"],["lines","none",3,"routerLink"],[1,"indent1"],[1,"indent2"],["lines","none"],[3,"music"]],template:function(t,i){t&1&&(s(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),h(3,"ion-back-button"),c(),s(4,"ion-title",2),p(5,"Music"),c(),s(6,"ion-buttons",3)(7,"ion-button",4),h(8,"ion-icon",5),c(),h(9,"app-side",6),c()()(),s(10,"ion-content",7),_(11,jt,13,6),s(12,"app-footer",8),Y("press",function(){return i.newMusic()}),c()()),t&2&&(a(9),S("buttons",i.buttons),a(),S("fullscreen",!0),a(),v(i.busy?-1:11))},dependencies:[st,Pt,ft,pt,dt,lt,ut,vt,Ct,yt,R,B,ht,xt,gt,_t,Mt,E,N,Dt,Tt,St,$,Lt],styles:["ion-fab[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:20px}ion-fab-button[_ngcontent-%COMP%]{margin-top:-35px;padding:5px}ion-item[_ngcontent-%COMP%]{cursor:pointer}.indent1[_ngcontent-%COMP%]{margin-left:1rem}.indent2[_ngcontent-%COMP%]{margin-left:2rem}h3[_ngcontent-%COMP%]{font-family:Gelion Bold}"]});var Ot=T;export{Ot as MusicPage};
