import{a as E,b as M}from"./chunk-V6XBM4R7.js";import"./chunk-WHEYUZEY.js";import"./chunk-LKPHKBDT.js";import"./chunk-KCPLCCSF.js";import{a as Ie}from"./chunk-SVNDKX5K.js";import{a as Pe}from"./chunk-WRLAXAJB.js";import{a as we}from"./chunk-5B2MUMUK.js";import{c as f}from"./chunk-OZ2IKH4J.js";import{U as ve,V as be,ja as Te,p as ye,u as xe}from"./chunk-LIWDDRYP.js";import{E as ge,K as fe,e as A,l as ue,r as he,v as Ce}from"./chunk-OQVFSD37.js";import"./chunk-PFLI22GG.js";import{$ as O,$b as K,Aa as d,Ba as V,Bb as G,Bc as oe,Db as J,E as D,Ec as le,Fa as v,Fc as re,Ga as b,H as a,Ha as w,Ic as se,Kc as pe,Ma as L,Mc as ce,Nc as de,P as F,Sc as me,Tc as _e,Ua as N,Wb as H,X as u,Y as h,Za as R,_ as U,aa as W,ba as c,ca as o,cc as Y,da as r,dc as X,ea as g,ec as Z,fc as $,ja as x,jc as ee,kb as Q,la as C,lc as ie,na as s,nb as j,p as P,ra as I,rc as te,s as m,sa as k,sc as ne,t as _,ta as S,tb as q,vc as ae,wb as z,za as B}from"./chunk-FDEJMFAU.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-UT2PGJWE.js";import"./chunk-6Y2ASLSF.js";import"./chunk-XRJ4SE6F.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-LLZYEWEK.js";import"./chunk-Z2GS73PT.js";import"./chunk-LF5XB4YN.js";import{h as y}from"./chunk-LNJ3S2LQ.js";var Se=i=>[i];function Ve(i,n){if(i&1&&(o(0,"ion-select-option",11),d(1),r()),i&2){let e=n.$implicit;c("value",e),a(),V(e)}}function Ae(i,n){if(i&1){let e=x();o(0,"ion-item",12)(1,"ion-checkbox",21),w("ngModelChange",function(t){m(e);let p=s(2);return b(p.camp.publicEvents,t)||(p.camp.publicEvents=t),_(t)}),d(2,"Accept event submissions from the public"),r()()}if(i&2){let e=s(2);a(),v("ngModel",e.camp.publicEvents)}}function Ee(i,n){if(i&1&&g(0,"img",16),i&2){let e=s(2);c("src",e.imageUrl,D)}}function Me(i,n){i&1&&(o(0,"p"),d(1,"Click to choose an optional image for your camp"),r())}function De(i,n){if(i&1){let e=x();o(0,"ion-item",7)(1,"app-emails",22),w("emailsChange",function(t){m(e);let p=s(2);return b(p.camp.contact_email,t)||(p.camp.contact_email=t),_(t)}),r()()}if(i&2){let e=s(2);a(),c("isAdmin",e.isAdmin)("isOwner",e.isOwner)("label","Camp Owner(s)")("placeholder","Email address of camp owner"),v("emails",e.camp.contact_email)}}function Fe(i,n){i&1&&(o(0,"app-tooltip",23)(1,"ion-chip",25),g(2,"ion-icon",26),d(3," This theme camp is approved "),r()())}function Ue(i,n){i&1&&(o(0,"app-tooltip",24)(1,"ion-chip",0),g(2,"ion-icon",27),d(3," This theme camp is not yet approved "),r()())}function Oe(i,n){if(i&1&&u(0,Fe,4,0,"app-tooltip",23)(1,Ue,4,0,"app-tooltip",24),i&2){let e=s(2);h(e.isApproved()?0:1)}}function We(i,n){if(i&1){let e=x();o(0,"app-tooltip",19)(1,"ion-button",28),C("click",function(){m(e);let t=s(2);return _(t.invite())}),d(2,"Invite"),r()()}if(i&2){let e=s(2);a(),c("disabled",e.inviting)}}function Be(i,n){if(i&1){let e=x();o(0,"app-tooltip",29)(1,"ion-button",28),C("click",function(){m(e);let t=s(3);return _(t.approve(!1))}),d(2,"Unapprove"),r()()}if(i&2){let e=s(3);a(),c("disabled",e.busy)}}function Le(i,n){if(i&1){let e=x();o(0,"app-tooltip",30)(1,"ion-button",31),C("click",function(){m(e);let t=s(3);return _(t.approve(!0))}),d(2,"Approve"),r()()}if(i&2){let e=s(3);a(),c("disabled",e.busy)}}function Ne(i,n){if(i&1&&u(0,Be,3,1,"app-tooltip",29)(1,Le,3,1,"app-tooltip",30),i&2){let e=s(2);h(e.isApproved()?0:1)}}function Re(i,n){if(i&1&&(o(0,"app-tooltip",32)(1,"ion-button",33),d(2," Place "),r()(),o(3,"ion-button",34),d(4," Delete "),r(),d(5,"\xA0 "),g(6,"ion-alert",35)),i&2){let e=s(2);a(),c("routerLink","../../map/"+L(2,Se,e.camp.id)),a(5),c("buttons",e.deleteButtons)}}function Qe(i,n){if(i&1){let e=x();o(0,"div",5)(1,"ion-card",6)(2,"ion-card-content",6)(3,"ion-list",7)(4,"ion-item")(5,"ion-input",8),w("ngModelChange",function(t){m(e);let p=s();return b(p.camp.name,t)||(p.camp.name=t),_(t)}),r()(),o(6,"ion-item",9)(7,"ion-select",10),w("ngModelChange",function(t){m(e);let p=s();return b(p.camp.camp_type,t)||(p.camp.camp_type=t),_(t)}),O(8,Ve,2,2,"ion-select-option",11,U),r()(),u(10,Ae,3,1,"ion-item",12),o(11,"ion-item",13),C("dblclick",function(){m(e);let t=s();return _(t.fillDescription())}),o(12,"ion-textarea",14),w("ngModelChange",function(t){m(e);let p=s();return b(p.camp.description,t)||(p.camp.description=t),_(t)}),r()(),o(13,"div",15),C("click",function(){m(e);let t=s();return _(t.upload.click())}),u(14,Ee,1,1,"img",16),u(15,Me,2,0,"p"),r(),u(16,De,2,5,"ion-item",7),g(17,"app-internal-fields",17),r(),u(18,Oe,2,1),o(19,"div",18),u(20,We,3,1,"app-tooltip",19),u(21,Ne,2,1),u(22,Re,7,4),o(23,"ion-button",3),C("click",function(){m(e);let t=s();return _(t.save())}),d(24,"Save"),r()(),o(25,"app-upload",20),C("upload",function(t){m(e);let p=s();return _(p.uploaded(t))}),r()()()()}if(i&2){let e=s();a(5),v("ngModel",e.camp.name),a(2),c("value",e.camp.camp_type),v("ngModel",e.camp.camp_type),a(),W(e.campTypes),a(2),h(e.isAdmin||e.isOwner?10:-1),a(2),c("spellcheck",!0)("rows",6)("maxlength",1e3)("autoGrow",!0),v("ngModel",e.camp.description),a(),B(e.uploading?"disabled":""),a(),h(e.imageUrl?14:-1),a(),h(e.imageUrl?-1:15),a(),h(e.isAdmin||e.isOwner?16:-1),a(),c("schemaType","camps")("entityId",e.camp.id||0)("currentData",e.internalFieldData),a(),h(e.id&&!e.isAdmin?18:-1),a(2),h(e.id&&e.isAdmin?20:-1),a(),h(e.id&&e.isAdmin?21:-1),a(),h(e.id&&e.canPlace?22:-1),a(),c("disabled",e.busy)}}function je(i,n){i&1&&g(0,"app-spinner")}var T=class T{constructor(){this.api=P(fe);this.alert=P(se);this.location=P(R);this.vanity=N();this.busy=!0;this.uploading=!1;this.imageChanged=!1;this.isAdmin=!1;this.isOwner=!1;this.canPlace=!1;this.isNew=!1;this.inviting=!1;this.campTypes=["Theme Camp","Sound Camp","Art Support Camp","Village Camp","Infrastructure"];this.internalFieldData=[];this.camp={name:"",pin:"",description:"",id:void 0,contact_email:"",camp_type:this.campTypes[0],publicEvents:!1};this.deleteButtons=[{text:"Delete",role:"destructive",handler:()=>{this.delete()}},{text:"Cancel",role:"cancel",handler:()=>{}}];Te({mapOutline:be,mailOutline:ve,checkmarkCircleOutline:ye,closeCircleOutline:xe})}uploaded(n){console.log(n),this.imageUrl=n.url,this.imageChanged=!0,this.blob=n.blob}ionViewWillEnter(){return y(this,null,function*(){if(yield this.api.setFestivalByVanity(this.vanity()),this.id=ue(this.id),this.isNew=!this.id,this.camp=yield this.api.getCamp(this.id),this.canPlace=this.api.getAccessInfo(this.api.festivalId).hasAdmin,this.isAdmin=this.api.lastRoleResponse=="festival",this.isOwner=!!this.id&&this.api.getAccessInfo(this.api.festivalId).camps.includes(this.id),this.imageUrl=this.api.imageURL(this.camp.imageUrl),this.camp.internalData)try{this.internalFieldData=JSON.parse(this.camp.internalData)}catch(n){console.error("Failed to parse internal data:",n),this.internalFieldData=[]}this.busy=!1})}delete(){return y(this,null,function*(){this.busy=!0,yield this.api.deleteCamp(this.camp),this.api.clearCache(),this.busy=!1,this.location.back()})}fillDescription(){console.log("fillDescription"),A(this.camp.description)&&!A(this.camp.name)&&(this.camp.description=`${this.camp.name} does not have a description yet.`)}save(n=!0){return y(this,null,function*(){this.busy=!0,Ce(this.camp);try{if(this.internalFields){if(!this.internalFields.validate()){this.busy=!1;return}this.internalFieldData=this.internalFields.fieldValues(),this.internalFieldData.length>0&&(this.camp.internalData=JSON.stringify(this.internalFieldData))}this.camp.description=he(this.camp.description);let e=yield this.api.addCamp(this.camp);if(this.busy=!1,e.message)f(this.alert,e.message);else{if(e.id&&this.imageChanged){console.log(`Uploaded image for camp ${e.id}`),this.busy=!0;try{yield this.uploadImage(e.id)}finally{this.busy=!1,this.imageChanged=!1}}if(!this.isAdmin){let l=this.isNew?`Thank you for registering your camp at ${this.api.festivalTitle()}.`:`The changes you have made will be reviewed by ${this.api.festivalTitle()} prior to publishing in the app.`;f(this.alert,l,"Note"),yield this.api.setKey()}this.api.clearCache(),n&&this.location.back()}}finally{this.busy=!1}})}invite(){return y(this,null,function*(){if(!this.camp.contact_email){yield f(this.alert,"You must specify an email address","Error");return}this.inviting=!0,yield this.save(!1);let n=yield this.api.inviteCamp(this.camp);n.message?f(this.alert,n.message):f(this.alert,"The camp owner has been invited to manage their camp.","Invitation")})}uploadImage(n){return y(this,null,function*(){if(this.blob)try{this.uploading=!0,this.camp.imageUrl=yield this.api.setImage(this.blob,n);let e=yield this.api.addCamp(this.camp,!0);e.message&&f(this.alert,e.message)}finally{this.uploading=!1}})}approve(n){return y(this,null,function*(){this.busy=!0,this.camp.status=n?2:1;let e=yield this.api.approveCamp(this.camp);e.message&&f(this.alert,e.message),this.api.clearCache(),this.busy=!1})}isApproved(){let n=this.camp.status===2||this.camp.status===0||ge(this.camp.status);return console.log(`isApproved: ${n} (status=${this.camp.status})`),n}};T.\u0275fac=function(e){return new(e||T)},T.\u0275cmp=F({type:T,selectors:[["app-camp"]],viewQuery:function(e,l){if(e&1&&(I(E,5),I(M,5)),e&2){let t;k(t=S())&&(l.upload=t.first),k(t=S())&&(l.internalFields=t.first)}},inputs:{id:"id",vanity:[1,"vanity"]},decls:12,vars:4,consts:[["color","primary"],["slot","start"],["slot","end"],[3,"click","disabled"],[3,"fullscreen"],[1,"border"],[1,"form"],["lines","none"],["label","Camp Name","labelPlacement","stacked","placeholder","Name of the theme camp",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["label","Type","labelPlacement","stacked","interface","popover","placeholder","Select the type of camp",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["lines","none",1,"ion-padding-start"],[3,"dblclick"],["labelPlacement","stacked","label","Description","placeholder","Description of the theme camp",3,"ngModelChange","spellcheck","rows","maxlength","autoGrow","ngModel"],[1,"image-container","center",3,"click"],[3,"src"],[3,"schemaType","entityId","currentData"],[1,"center"],["text","Invite camp owner via email to manage their camp"],[3,"upload"],["justify","start","labelPlacement","end",3,"ngModelChange","ngModel"],["helperText",`The camp owner(s) can login and alter their camp
              events and details. This is a list of email addresses.`,3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],["text","It will be displayed in the dust app"],["text","This theme camp will not appear in the dust app until approved"],["color","secondary"],["name","checkmark-circle-outline"],["name","close-circle-outline"],["color","secondary",3,"click","disabled"],["text","Mark this theme camp as unapproved so that it does not appear in the dust app"],["text","Approve the theme camp to allow it to be visible in the dust app"],["color","primary",3,"click","disabled"],["text","Place the camp on the map"],["color","secondary",3,"routerLink"],["id","deleteCamp","color","secondary"],["trigger","deleteCamp","header","Delete Camp?",3,"buttons"]],template:function(e,l){e&1&&(o(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),g(3,"ion-back-button"),r(),o(4,"ion-title"),d(5),r(),o(6,"ion-buttons",2)(7,"ion-button",3),C("click",function(){return l.save()}),d(8,"Save"),r()()()(),o(9,"ion-content",4),u(10,Qe,26,22,"div",5)(11,je,1,0,"app-spinner"),r()),e&2&&(a(5),V(l.id||l.camp.id?"Edit Camp":l.isAdmin?"Add Camp":"Register Camp"),a(2),c("disabled",l.busy),a(2),c("fullscreen",!0),a(),h(l.busy?11:10))},dependencies:[K,Pe,E,J,q,G,z,we,j,Q,te,re,X,H,le,Y,ie,Z,$,ae,ne,de,_e,me,oe,Ie,pe,M,ee,ce],encapsulation:2});var ke=T;export{ke as CampPage};
