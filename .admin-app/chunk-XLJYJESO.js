import{a as Ct}from"./chunk-WRGGOKAP.js";import{a as _t}from"./chunk-JZDWCQD5.js";import{a as vt}from"./chunk-PEIKAUDK.js";import"./chunk-ISEFS2E5.js";import{a as ht}from"./chunk-TKZA435V.js";import"./chunk-W4BNGQYG.js";import{Y as gt,a as ft}from"./chunk-IKEGAJLW.js";import{G as O,x as dt,y as F}from"./chunk-YDFKN7Z7.js";import"./chunk-XMQYHBKU.js";import{$ as f,$a as Q,Ac as ut,Ea as q,G as o,Ha as Z,I as x,Ka as H,Kb as nt,L as M,Rb as ot,Sb as rt,Ua as Y,V as h,W as _,Y as I,Ya as z,Z as b,Zb as at,_ as S,_a as K,aa as r,ba as a,ca as u,cb as X,dc as st,ea as G,ec as w,fa as D,fc as P,ga as p,gc as L,hb as tt,hc as E,kb as et,kc as ct,l as j,oc as mt,p as y,pc as lt,rb as it,s as R,sa as m,t as k,ta as T,ua as J,vc as pt,wa as $,xa as U,ya as V,za as W}from"./chunk-A5SCVZG7.js";import"./chunk-JORYF43P.js";import"./chunk-7KGURMOZ.js";import"./chunk-R7LHOHUY.js";import"./chunk-HUOLUIW7.js";import"./chunk-CCK7OWI7.js";import"./chunk-LIBYTRNP.js";import"./chunk-3MK77LPM.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as A}from"./chunk-LNJ3S2LQ.js";function bt(n,e){if(n&1&&(r(0,"ion-item")(1,"ion-label"),m(2),a(),r(3,"ion-note",1),m(4),a()()),n&2){let t=e.$implicit;o(2),J(" ",t.who," "),o(2),$(" ",t.time," ",t.startTime,"-",t.endTime," ")}}var v=class v{constructor(){this.music=H();this.api=y(O);this.occurrences=Z(()=>{var t,i;let e=JSON.parse((i=(t=this.music())==null?void 0:t.occurrences)!=null?i:"[]");for(let s of e)s.time=dt[new Date(s.startTime).getDay()],s.startTime=F(new Date(s.startTime),this.api.currentTimeZone()),s.endTime=F(new Date(s.endTime),this.api.currentTimeZone());return e})}};v.\u0275fac=function(t){return new(t||v)},v.\u0275cmp=M({type:v,selectors:[["app-party-list"]],inputs:{music:[1,"music"]},decls:3,vars:0,consts:[["lines","inset"],["slot","end"]],template:function(t,i){t&1&&(r(0,"ion-list",0),b(1,bt,5,4,"ion-item",null,I),a()),t&2&&(o(),S(i.occurrences()))},dependencies:[E,L,w,P],encapsulation:2});var B=v;var g=class g{exportMusicJSON(e){let t=this.exportMusic(e),i=JSON.stringify(t,null,2),s="rsl.json",d=new Blob([i],{type:"text/json;charset=utf-8;"}),c=document.createElement("a");if(c.download!==void 0){let l=URL.createObjectURL(d);c.setAttribute("href",l),c.setAttribute("download",s),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c)}}exportMusic(e){let t="-07:00";return e.map((i,s)=>{var d,c;return{id:`rsl-${s+1}`,uid:`rsl-${s+1}`,title:(d=i.title)!=null?d:`${i.camp} (${new Date(i.day).toLocaleDateString("en-US",{weekday:"short"})})`,camp:i.camp||"",day:i.day||"",location:"",wa:i.wa||!1,waNotes:i.waNotes||void 0,distance:0,distanceInfo:"",artCar:this.extractLocationArtCar(i),campId:this.extractLocationUid(i),occurrences:JSON.parse((c=i.occurrences)!=null?c:[]).map((l,Mt)=>({who:l.who||"",startTime:l.startTime+t||"",endTime:l.endTime+t||"",timeRange:l.timeRange||l.time||"",time:l.time||l.timeRange||"",id:Mt.toString()}))||[]}})}extractLocationArtCar(e){try{let t=JSON.parse(e.location);return t.type==="mutant"?t.name:void 0}catch{return}}extractLocationUid(e){try{let t=JSON.parse(e.location);return t.type!=="mutant"?t.uid:void 0}catch{return}}};g.\u0275fac=function(t){return new(t||g)},g.\u0275prov=j({token:g,factory:g.\u0275fac,providedIn:"root"});var N=g;var St=n=>[n];function Tt(n,e){if(n&1&&(u(0,"ion-item"),r(1,"ion-item",19)(2,"h3"),m(3),a()()),n&2){let t=p().$implicit;o(3),T(t.group)}}function wt(n,e){if(n&1&&(r(0,"div",17)(1,"ion-note",3),m(2),a()()),n&2){let t=p().$implicit;o(2),T(t.camp)}}function Pt(n,e){if(n&1&&(r(0,"div",18),u(1,"app-party-list",20),a()),n&2){let t=p().$implicit;o(),f("music",t)}}function Lt(n,e){if(n&1&&(h(0,Tt,4,1),r(1,"ion-item",16)(2,"ion-label"),m(3),a(),h(4,wt,3,1,"div",17),a(),h(5,Pt,2,1,"div",18)),n&2){let t=e.$implicit,i=p(3);_(t.group?0:-1),o(),f("routerLink","../music/"+q(5,St,t.id)),o(2),T(t.title),o(),_(i.groupBy!=="location"?4:-1),o(),_(i.groupBy==="location"?5:-1)}}function Et(n,e){if(n&1&&(r(0,"ion-list"),b(1,Lt,6,7,null,null,I),a()),n&2){let t=p(2);o(),S(t.music)}}function Ot(n,e){n&1&&u(0,"ion-item")}function Bt(n,e){if(n&1){let t=G();r(0,"div",9)(1,"ion-buttons",10)(2,"ion-segment",11),W("ngModelChange",function(s){R(t);let d=p();return V(d.groupBy,s)||(d.groupBy=s),k(s)}),D("ionChange",function(){R(t);let s=p();return k(s.refresh())}),r(3,"ion-segment-button",12)(4,"ion-label"),m(5,"Title"),a()(),r(6,"ion-segment-button",13)(7,"ion-label"),m(8,"Location"),a()()()(),r(9,"app-image-card",14),h(10,Et,3,0,"ion-list")(11,Ot,1,0,"ion-item"),a()(),u(12,"div",15)}if(n&2){let t=p();o(2),U("ngModel",t.groupBy),f("value",t.groupBy),o(7),f("url",t.camp?t.image(t.camp):t.festivalImage())("title",t.title)("description",t.description),o(),_(t.music.length>0?10:11)}}var C=class C{constructor(e,t,i){this.api=e;this.router=t;this.route=i;this.music=[];this.busy=!0;this.groupBy="title";this.title="";this.description="";this.isAdmin=!1;this.buttons=[];this.ttitdService=y(ht);this.rslService=y(N);gt({add:ft})}image(e){return this.api.imageURL(e.imageUrl)}festivalImage(){return this.api.imageURL(this.api.festivalImage())}ionViewWillEnter(){return A(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.campId=this.route.snapshot.queryParams.camp,this.camp=this.campId?yield this.api.getCamp(this.campId):void 0,this.title=this.camp?`${this.camp.name}`:`${this.api.festivalTitle()}`,this.music=this.filter(yield this.api.music()),this.music.map(e=>{e.camp=="Unknown"&&(e.camp=this.extractLocation(e))}),this.isAdmin=this.api.isAdmin(this.api.festivalId),this.description=this.music.length>0?`Parties at ${this.title}`:`There are no parties for ${this.title}.`,this.buttons=this.isAdmin?[{title:"Export JSON",method:this.exportJSON(),icon:"cloud-download-outline"}]:[],this.refresh(),this.busy=!1})}refresh(){if(this.groupBy=="location"){this.music.sort((t,i)=>t.location&&i.location?i.location.localeCompare(t.location):0);let e="";for(let t of this.music)t.camp!=e&&(t.group=t.camp,e=t.camp)}else{this.music.sort((e,t)=>e.title&&t.title?e.title.localeCompare(t.title):0);for(let e of this.music)e.group=void 0}}filter(e){return this.campId?e.filter(t=>t.campId==this.campId):e}extractLocation(e){try{return JSON.parse(e.location).name}catch{return"Unknown"}}exportJSON(){return()=>A(this,null,function*(){if(!this.isAdmin){this.message("You do not have access rights to this feature.");return}this.rslService.exportMusicJSON(this.music)})}message(e){setTimeout(()=>{this.api.sendMessage(e)},1)}newMusic(){this.router.navigate(["./new"],{queryParams:{camp:this.campId},relativeTo:this.route})}};C.\u0275fac=function(t){return new(t||C)(x(O),x(K),x(z))},C.\u0275cmp=M({type:C,selectors:[["app-music"]],inputs:{vanity:"vanity"},decls:13,vars:3,consts:[["color","primary"],["slot","start"],["routerLink","../"],["slot","end"],["routerLink","../music/new"],["name","add"],[3,"buttons"],[3,"fullscreen"],["title","Add Party",3,"press"],[1,"border"],["slot","start",2,"position","absolute","margin-left","2rem","margin-top","2rem"],["mode","ios",3,"ngModelChange","ionChange","ngModel","value"],["value","title"],["value","location"],["routeTo","../music/new",3,"url","title","description"],[1,"ion-padding"],["lines","none",3,"routerLink"],[1,"indent1"],[1,"indent2"],["lines","none"],[3,"music"]],template:function(t,i){t&1&&(r(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),u(3,"ion-back-button"),a(),r(4,"ion-title",2),m(5,"Music"),a(),r(6,"ion-buttons",3)(7,"ion-button",4),u(8,"ion-icon",5),a(),u(9,"app-side",6),a()()(),r(10,"ion-content",7),h(11,Bt,13,6),r(12,"app-footer",8),D("press",function(){return i.newMusic()}),a()()),t&2&&(o(9),f("buttons",i.buttons),o(),f("fullscreen",!0),o(),_(i.busy?-1:11))},dependencies:[Y,Ct,it,tt,et,X,Q,st,lt,rt,P,E,nt,mt,ot,at,pt,L,w,_t,ut,ct,B,vt],styles:["ion-fab[_ngcontent-%COMP%]{padding-top:20px;padding-bottom:20px}ion-fab-button[_ngcontent-%COMP%]{margin-top:-35px;padding:5px}ion-item[_ngcontent-%COMP%]{cursor:pointer}.indent1[_ngcontent-%COMP%]{margin-left:1rem}.indent2[_ngcontent-%COMP%]{margin-left:2rem}h3[_ngcontent-%COMP%]{font-family:Gelion Bold}"]});var xt=C;export{xt as MusicPage};
