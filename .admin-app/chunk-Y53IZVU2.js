import{a as ke}from"./chunk-Q6SMMGIZ.js";import{a as H}from"./chunk-L3JJEUF3.js";import{a as Ve}from"./chunk-33V37WPV.js";import{a as Ee}from"./chunk-5HINJLXJ.js";import{a as Pe,c as g}from"./chunk-KVSZYKJC.js";import"./chunk-5W5FH4VE.js";import"./chunk-2RWSG5RW.js";import"./chunk-G3CKXV7X.js";import"./chunk-5FZVM2DH.js";import"./chunk-HC6MZPB3.js";import"./chunk-YMI2B6JE.js";import"./chunk-4JPLRTL2.js";import"./chunk-NPRM7GGH.js";import"./chunk-52VTL4OE.js";import"./chunk-VBU7NMPV.js";import"./chunk-2EOHHFOF.js";import"./chunk-JXIEZMHN.js";import"./chunk-3GGVU3XB.js";import"./chunk-MCRJI3T3.js";import"./chunk-5ZNPFCKO.js";import"./chunk-46PQVYTJ.js";import"./chunk-MM5QLNJM.js";import"./chunk-3573TPBU.js";import{Y as De,b as be,m as Se,q as Oe}from"./chunk-IKEGAJLW.js";import{F as Me,a as Te,b as X,e as R,l as Y,m as P,o as $,p as Ie,q as xe,r as ee,t as f,v as ve}from"./chunk-CP2LIZQM.js";import"./chunk-MIGJGGKJ.js";import{A as d,Aa as ce,B as u,Bc as ge,Ca as _,Cc as we,Da as K,H as ne,Ha as y,Hc as Ce,Ia as T,Ic as ye,Ja as I,L as E,Qb as ue,Rb as W,S as c,T as S,Ua as le,W as oe,X as re,Xb as F,Y as k,Yb as z,Zb as pe,_b as he,aa as O,cb as me,dc as B,ea as h,ha as Z,ia as se,ib as de,ja as U,jc as L,ka as G,kc as q,la as a,ma as r,mc as _e,na as C,nb as V,pa as x,qa as p,qb as A,ra as l,rc as fe,uc as j,vc as J,w as ie,xb as N,za as ae}from"./chunk-PHUHKYQ4.js";import"./chunk-ATW7DGUS.js";import"./chunk-7KGURMOZ.js";import"./chunk-UXWCR2YA.js";import"./chunk-QYFQMV2H.js";import"./chunk-ORVKXEJA.js";import"./chunk-KBMMZLX2.js";import"./chunk-5J6JP6Q2.js";import"./chunk-4U6PRYVA.js";import"./chunk-CZ4AHVKD.js";import"./chunk-Z4V4M3ZT.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{h as w}from"./chunk-LNJ3S2LQ.js";function ze(m,i){if(m&1){let e=x();a(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2)(3,"ion-button",3),p("click",function(){d(e);let t=l();return u(t.cancel())}),_(4,"Cancel"),r()(),a(5,"ion-title"),_(6,"Import"),r(),a(7,"ion-buttons",4)(8,"ion-button",5),p("click",function(){d(e);let t=l();return u(t.confirm())}),_(9,"Convert"),r()()()(),a(10,"ion-content",6)(11,"ion-item")(12,"ion-textarea",7),I("ngModelChange",function(t){d(e);let n=l();return T(n.text,t)||(n.text=t),u(t)}),r()(),a(13,"ion-item"),C(14,"ion-textarea",8),r()()}if(m&2){let e=l();c(8),h("strong",!0),c(4),y("ngModel",e.text),c(2),h("value",e.prompt)}}var v=class v{constructor(){this.text="";this.modal=oe.required(W);this.isOpen=re(!1);this.occurrences=E([]);this.imported=ne();this.alert=ie(H);this.prompt="Convert this to a JSON array an artist, startDate in iso date format, endDate in iso date format where endDate is 1 hour after startDate if the endDate is missing. Thursday is February 13 2025. Also convert the artist to title case. Finally, only list items that are on thursday"}cancel(){this.modal().dismiss(null,"cancel")}confirm(){this.validate(this.text)&&this.modal().dismiss(this.text,"confirm")}onWillDismiss(i){i.detail.role==="confirm"&&this.imported.emit(this.occurrences()),this.isOpen.set(!1)}validate(i){let e=JSON.parse(i);if(!Array.isArray(e))return g(this.alert,"Data is not an array"),!1;if(e.length===0)return g(this.alert,"Data is empty"),!1;let o=[],t=1;for(let n of e){if(R(n.artist))return g(this.alert,"Artist is required"),!1;if(R(n.startDate))return g(this.alert,"Start date is required"),!1;if(!X(n.startDate))return g(this.alert,`Invalid start date "${n.startDate}"`),!1;if(R(n.endDate))return g(this.alert,"End date is required"),!1;if(!X(n.endDate))return g(this.alert,`Invalid end date "${n.endDate}"`),!1;o.push({id:t.toString(),who:n.artist,startTime:f(n.startDate),endTime:f(n.endDate)}),t++}return this.occurrences.set(o),!0}};v.\u0275fac=function(e){return new(e||v)},v.\u0275cmp=k({type:v,selectors:[["app-music-import"]],viewQuery:function(e,o){e&1&&ae(o.modal,W,5),e&2&&ce()},inputs:{isOpen:[1,"isOpen"]},outputs:{isOpen:"isOpenChange",imported:"imported"},decls:2,vars:1,consts:[[3,"willDismiss","isOpen"],["color","primary"],["slot","start"],[3,"click"],["slot","end"],[3,"click","strong"],[1,"ion-padding"],["rows","15","placeholder","",3,"ngModelChange","ngModel"],["rows","4",3,"value"]],template:function(e,o){e&1&&(a(0,"ion-modal",0),p("willDismiss",function(n){return o.onWillDismiss(n)}),O(1,ze,15,3,"ng-template"),r()),e&2&&h("isOpen",o.isOpen())},dependencies:[B,F,W,L,z,j,J,ye,q,N,V,A],encapsulation:2});var Q=v;var Be=(m,i)=>i.id;function Le(m,i){if(m&1&&(a(0,"ion-select-option",13),_(1),r()),m&2){let e=i.$implicit;h("value",e.id),c(),K(e.name)}}function qe(m,i){if(m&1){let e=x();a(0,"div",15)(1,"div",21)(2,"ion-input",22),I("ngModelChange",function(t){let n=d(e).$implicit;return T(n.who,t)||(n.who=t),u(t)}),r(),C(3,"app-tooltip",23),r(),a(4,"app-date-range",24),p("endChanged",function(t){let n=d(e).$implicit,s=l(2);return u(s.endChanged(n,t))})("startChanged",function(t){let n=d(e).$implicit,s=l(2);return u(s.startChanged(n,t))}),r(),a(5,"div",25)(6,"ion-button",26),p("click",function(){let t=d(e).$implicit,n=l(2);return u(n.deleteItem(t))}),C(7,"ion-icon",27),r()()()}if(m&2){let e=i.$implicit,o=l(2);c(2),y("ngModel",e.who),c(2),h("minTime",o.minTime)("maxTime",o.maxTime)("id",e.id)("startTime",e.startTime)("endTime",e.endTime),c(2),h("hidden",o.occurrences.length===1)}}function je(m,i){if(m&1){let e=x();a(0,"ion-button",20),p("click",function(){d(e);let t=l(2);return u(t.deleteParty())}),_(1,"Delete"),r()}}function Je(m,i){m&1&&(a(0,"ion-button",18),_(1,"\xA0"),r())}function Re(m,i){if(m&1){let e=x();a(0,"div",7)(1,"app-music-import",8),p("imported",function(t){d(e);let n=l();return u(n.imported(t))}),r(),a(2,"ion-card")(3,"ion-card-content")(4,"ion-list")(5,"ion-item",9)(6,"ion-input",10),I("ngModelChange",function(t){d(e);let n=l();return T(n.music.title,t)||(n.music.title=t),u(t)}),r()(),a(7,"ion-item",11)(8,"ion-select",12),I("ngModelChange",function(t){d(e);let n=l();return T(n.music.campId,t)||(n.music.campId=t),u(t)}),U(9,Le,2,2,"ion-select-option",13,se),r()(),a(11,"ion-item",9)(12,"app-emails",14),I("emailsChange",function(t){d(e);let n=l();return T(n.music.contact,t)||(n.music.contact=t),u(t)}),r()(),U(13,qe,8,7,"div",15,Be),r(),a(15,"div",16),O(16,je,2,0,"ion-button",17)(17,Je,2,0,"ion-button",18),a(18,"ion-button",5),p("click",function(){d(e);let t=l();return u(t.save())}),_(19,"Save"),r(),a(20,"app-tooltip",19)(21,"ion-button",20),p("click",function(){d(e);let t=l();return u(t.addItem())}),_(22,"Add time slot"),r()()()()()()}if(m&2){let e=l();c(),h("isOpen",e.showImport()),c(5),y("ngModel",e.music.title),c(2),h("value",e.music.campId),y("ngModel",e.music.campId),c(),G(e.camps),c(3),h("isAdmin",e.isAdmin)("isOwner",e.isOwner)("label","Party Owner")("placeholder","Email address"),y("emails",e.music.contact),c(),G(e.occurrences),c(3),Z((e.isAdmin||e.isOwner)&&e.music.id?16:17)}}var M=class M{constructor(i,e,o,t){this.api=i;this.route=e;this.alert=o;this.location=t;this.busy=!0;this.showImport=E(!1);this.camps=[];this.minTime=new Date().toISOString();this.maxTime=new Date().toISOString();this.isOwner=!1;this.isAdmin=!1;this.timezone=this.api.currentTimeZone();this.music={id:void 0,camp:"",location:"",day:"",occurrences:"[]"};this.occurrences=[];this.isNew=!1;De({closeOutline:Oe,addOutline:be,chevronDown:Se})}ionViewWillEnter(){return w(this,null,function*(){yield this.api.setFestivalByVanity(this.vanity),this.id=Y(this.id),this.isNew=!this.id;let i=yield this.api.getFestival(this.api.festivalId,{cached:!0});this.isNew?(this.music=yield this.api.newMusic(),console.log("new music with camp",this.route.snapshot.queryParams.camp),this.music.campId=Y(this.route.snapshot.queryParams.camp)):this.music=yield this.api.getMusic(this.id);let e=this.api.getAccessInfo(i.id);this.isOwner=this.music&&e.music.includes(this.music.id)||this.isNew,this.isAdmin=this.api.isAdmin(i.id),this.timezone=i.timezone,this.timezone||(this.timezone=this.api.currentTimeZone()),this.minTime=i.start_time,this.maxTime=f($(P(i.end_time),12).toISOString()),this.occurrences=JSON.parse(this.music.occurrences),this.occurrences.length==0&&this.occurrences.push({who:"",id:"1",startTime:this.minTime,endTime:f($(P(this.minTime),1).toISOString())});for(let o of this.occurrences)o.startTime=f(o.startTime),o.endTime=f(o.endTime);this.busy=!1})}ngOnInit(){return w(this,null,function*(){this.camps=yield this.api.camps({cached:!0})})}lastTime(){let i=this.minTime;for(let e of this.occurrences)i=e.endTime;return i}deleteParty(){return w(this,null,function*(){(yield Pe(this.alert,"Are you sure you want to delete this party?"))&&(yield this.api.deleteParty(this.music.id),this.api.clearCache(),this.location.back())})}deleteItem(i){this.occurrences.length!=1&&(this.occurrences=this.occurrences.filter(e=>e.id!==i.id))}addItem(){let i=this.lastTime();this.occurrences.push({who:"",id:(this.occurrences.length+1).toString(),startTime:i,endTime:f($(P(i),1).toISOString())})}getDayName(i){return new Date(i).toLocaleDateString(void 0,{weekday:"long"})}sortableTime(i){return new Date(i).getTime()}save(){return w(this,null,function*(){var t,n;if(!this.music.title||((t=this.music.title)==null?void 0:t.trim())==""){this.api.sendMessage("The name of the party must be set");return}this.music.title=ee(this.music.title);let i=this.camps.find(s=>s.id==this.music.campId);this.music.camp=i?i.name:"Unknown";let e;for(let s of this.occurrences){if(s.who.trim()==""){this.api.sendMessage("The DJ/Musician must be set");return}s.startTime=f(s.startTime),s.endTime=f(s.endTime),s.who=ee(s.who);let b=new Date(s.startTime),D=new Date(s.endTime);s.timeRange=(n=Te(b,D,void 0,this.api.currentTimeZone()))==null?void 0:n.brief,s.who.trim()==this.music.title.trim()&&(e=s.who)}if(this.occurrences=this.occurrences.sort((s,b)=>this.sortableTime(s.startTime)-this.sortableTime(b.startTime)),e){let s=this.getDayName(this.occurrences[0].startTime);this.api.sendMessage(`The name of the party should not be the same as a DJ/Musician. A better name for a party might be "${this.music.camp} ${s}"`);return}let o=yield this.badTimeSlot(this.music,this.occurrences);if(o){this.api.sendMessage(o);return}ve(this.music),yield this.api.addMusic(this.music,this.occurrences),this.location.back()})}startChanged(i,e){i.startTime=e,i.endTime=xe(Ie(P(e),60))}endChanged(i,e){i.endTime=e}badTimeSlot(i,e){return w(this,null,function*(){let o=(yield this.api.music()).filter(t=>t.campId==i.campId);if(!i.campId&&!i.artCar)return"The party needs a location selected";for(let t of o){let n=JSON.parse(t.occurrences),s=n[n.length-1],b=e[e.length-1];if(this.music.id!=t.id){if(this.isEqual(s==null?void 0:s.endTime,b.startTime)&&(console.log("this.music.id",this.music.id),this.isNew))return`It looks like you are creating a party for a DJ timeslot instead of adding another timeslot to "${t.title}". Please add your DJ to the other party`;if(this.music.title==t.title)return`The party ${this.music.title} already exists. Please create a unique name for the party`;for(let D of n)for(let te of e)if(this.isEqual(te.startTime,D.startTime)&&this.isEqual(te.endTime,D.endTime))return`There is a conflict with "${t.title}" which has a time slot at the same time.`}}})}imported(i){return w(this,null,function*(){console.log("before",this.occurrences),console.log("imported",i),this.occurrences=i})}isEqual(i,e){return i.replace(".000","")==e.replace(".000","")}};M.\u0275fac=function(e){return new(e||M)(S(Me),S(me),S(H),S(le))},M.\u0275cmp=k({type:M,selectors:[["app-music-item"]],inputs:{id:"id",vanity:"vanity"},decls:13,vars:3,consts:[["color","primary"],["slot","start"],["slot","end"],["fill","clear",3,"click"],["size","small","name","chevron-down"],[3,"click"],[3,"fullscreen"],[1,"border"],[3,"imported","isOpen"],["lines","none"],["label","Party Title","labelPlacement","stacked","placeholder","Title of the theme camp or party",3,"ngModelChange","ngModel"],["lines","none",1,"app-select"],["label","Location","labelPlacement","stacked","interface","popover","placeholder","Select location of event",1,"app-select",3,"ngModelChange","value","ngModel"],[3,"value"],["helperText","The party owner can login and alter this lineup. This is a list of email addresses.",3,"emailsChange","isAdmin","isOwner","label","placeholder","emails"],[1,"horizontal","bottom-line"],[1,"horizontal"],["color","secondary"],["fill","clear"],["position","right","text","Add a time slot"],["color","secondary",3,"click"],["lines","none",1,"dj","vcenter"],["mode","ios","labelPlacement","stacked","label","DJ / Musician",3,"ngModelChange","ngModel"],["position","right","text","Remove this time slot",2,"margin-top","32px"],["size","wide","label","",3,"endChanged","startChanged","minTime","maxTime","id","startTime","endTime"],[1,"vcenter","del"],["slot","end","color","secondary",3,"click","hidden"],["size","small","name","close-outline"]],template:function(e,o){e&1&&(a(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),C(3,"ion-back-button"),r(),a(4,"ion-title"),_(5),r(),a(6,"ion-buttons",2)(7,"ion-button",3),p("click",function(){return o.showImport.set(!0)}),C(8,"ion-icon",4),r(),a(9,"ion-button",5),p("click",function(){return o.save()}),_(10,"Save"),r()()()(),a(11,"ion-content",6),O(12,Re,23,10,"div",7),r()),e&2&&(c(5),K(o.id?"Party":"Add Party"),c(6),h("fullscreen",!0),c(),Z(o.busy?-1:12))},dependencies:[N,V,A,de,L,J,z,ue,j,B,pe,he,_e,q,we,Ce,fe,F,ge,Ee,ke,Ve,Q],styles:["ion-card[_ngcontent-%COMP%]{cursor:auto}.vertical[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:end;justify-content:center}.horizontal[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;padding-right:5px;padding-left:5px}ion-item.app-select[_ngcontent-%COMP%]{--padding-start: 0 !important;--padding-end: 0rem}.bottom-line[_ngcontent-%COMP%]{border-bottom:1px solid var(--ion-color-light)}.dj[_ngcontent-%COMP%]{padding-left:.5rem;margin-top:-1rem;margin-bottom:.5rem}.del[_ngcontent-%COMP%]{margin-top:10px;max-width:50px}.vcenter[_ngcontent-%COMP%]{align-self:center}ion-input[_ngcontent-%COMP%]{color:var(--ion-color-dark)}ion-item[_ngcontent-%COMP%]{--padding-start: 0px;--padding-end: 0px}"]});var Ae=M;export{Ae as MusicItemPage};
