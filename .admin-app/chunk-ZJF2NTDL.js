import{b as D}from"./chunk-QTBNLBDF.js";import{D as T,G as P,a as S,n as b,z as O}from"./chunk-YDFKN7Z7.js";import{l as w,p as E}from"./chunk-A5SCVZG7.js";import{h as _}from"./chunk-LNJ3S2LQ.js";var f=class f{constructor(){this.api=E(P)}exportEventsToCSV(d,l,o,a){return _(this,null,function*(){var h,v,t,s;let m=[],u=yield this.api.camps({cached:!1}),r=yield this.api.art({cached:!1});for(let n of l){let i="",p=JSON.parse(n.occurrence_set);if(n.hosted_by_camp!==null){let e=u.find(c=>c.id==n.hosted_by_camp);i=e?e.name:""}else if(n.located_at_art!==null){let e=r.find(c=>c.id==n.located_at_art);i=(h=e==null?void 0:e.name)!=null?h:""}else i=(v=n.other_location)!=null?v:"";for(let e of p){let c=new Date(e.start_time),y=new Date(e.end_time),N=(t=S(c,y,void 0,o))==null?void 0:t.long,U=c.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),x=(s=S(c,y,void 0,o))==null?void 0:s.short,L=O(c,o),$=O(y,o);m.push({id:n.id,title:n.title,description:n.description,type:n.event_type,location:i,startTime:e.start_time,endTime:e.end_time,time:N,shortDay:U,shortTime:x,start24:L,end24:$})}}m.sort((n,i)=>new Date(n.startTime).getTime()-new Date(i.startTime).getTime());let g=T(d.toLowerCase()," ","-");D(`${g}-${a}.csv`,m)})}getPrintableEvents(d,l,o,a){return _(this,null,function*(){var h,v;let m=yield this.api.camps({cached:!1}),u=a?a.split(","):[],r=[];for(let t of l){let s=JSON.parse(t.occurrence_set);for(let n of s){let i=JSON.parse(JSON.stringify(t));i.occurrence_set=JSON.stringify([n]);let p=i.event_type.split(","),e=!1;for(let c of u)p.includes(c)&&(e=!0);e||r.push(i)}}for(let t of r){let s=JSON.parse(t.occurrence_set),n=b(s[0].start_time),i=b(s[0].end_time),p=this.api.currentTimeZone();t.image=void 0;let e=m.find(c=>c.id==t.hosted_by_camp);t.imageUrl?t.image=this.api.imageURL(t.imageUrl):e&&e.imageUrl&&(t.image=this.api.imageURL(e.imageUrl)),t.campUrl=e?`https://${d}.dust.events/camp/u-${e.id}`:"",t.timeString=(h=S(n,i,void 0,p))==null?void 0:h.long}r.sort((t,s)=>{let n=JSON.parse(t.occurrence_set),i=JSON.parse(s.occurrence_set),p=new Date(n[0].start_time),e=new Date(i[0].start_time);return p-e});let g;if(!o)for(let t of r){let s=(v=t.timeString)==null?void 0:v.split(" ");s&&s[0]!==g&&(g=s[0],t.heading=g)}return o?r.filter(t=>{var s;return(s=t.timeString)==null?void 0:s.startsWith(o+" ")}):r})}getEventDays(d,l){return _(this,null,function*(){var m;let o=yield this.getPrintableEvents(d,l),a=[];for(let u of o){let r=(m=u.timeString)==null?void 0:m.split(" ");r&&r[0]&&!a.includes(r[0])&&a.push(r[0])}return a})}};f.\u0275fac=function(l){return new(l||f)},f.\u0275prov=w({token:f,factory:f.\u0275fac,providedIn:"root"});var J=f;export{J as a};
