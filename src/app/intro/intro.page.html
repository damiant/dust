<ion-content color="primary" [fullscreen]="true">
  <app-message
    (dismissed)="launch()"
    [show]="vm.showMessage"
    [title]="vm.selected ? 'About '+vm.selected.year : ''"
    [message]="vm.message"
  ></app-message>
  <div [class.full]="vm.eventAlreadySelected" class="vcenter rows">
    <h1 (click)="clear()">dust.</h1>
    <ion-text role="text"><strong>dust</strong> is a guide for burners to find events, camps and art.</ion-text>
    <!-- <div style="min-height: 40px">
      <ion-spinner [hidden]="!vm.downloading" name="dots" color="light"></ion-spinner>
    </div> -->
  </div>

  @if (vm.list && !vm.eventAlreadySelected) {
  <app-burn-card [cards]="vm.cards" [selected]="vm.selected" (clicked)="open($event, true)"></app-burn-card>
  } @else {
  <app-carousel
    [enabled]="vm.enableCarousel"
    [hidden]="vm.eventAlreadySelected"
    (slideChanged)="slideChanged($event)"
    #carousel
  >
    @for (card of vm.cards; track card.id) {
    <app-carousel-item (click)="open(card, true)">
      <app-cached-img
        errorImage="./assets/error-img.png"
        (loaded)="vm.cardLoaded[card.id] = true"
        [loading]="'eager'"
        [ngClass]="(vm.selected?.id === card.id) ? 'select ' + vm.selected?.class : 'unselect'"
        [src]="card.imageUrl"
      />
      <p [hidden]="!vm.cardLoaded[card.id]" aria-hidden="true">{{card.title}}</p>
      <p class="region" [hidden]="!vm.cardLoaded[card.id]" aria-hidden="true">{{card.region}}</p>
    </app-carousel-item>
    }
  </app-carousel>
  }

  <!-- <ion-fab #fab [hidden]="vm.eventAlreadySelected" slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (ionBlur)="selectedFilter(undefined)" id="click-trigger">
      <ion-icon [name]="vm.showing === 'all' ? 'chevron-up-outline' : 'chevron-up-circle-sharp'"></ion-icon>
    </ion-fab-button>
    <ion-fab-list class="fab-list" side="top">
      <ion-content class="ion-padding">
        <ion-radio-group (ionChange)="selectedFilter($event)" [value]="vm.showing">
          <ion-radio value="all">All</ion-radio><br />
          <ion-radio value="past">Past Events</ion-radio><br />
          <ion-radio value="regional">Regionals</ion-radio><br />
          <ion-radio value="bm">Burning Man</ion-radio><br />
        </ion-radio-group>        
        <ion-checkbox style="padding: 0.2rem;" (ionChange)="toggleList()">List</ion-checkbox>
      </ion-content>
    </ion-fab-list>
  </ion-fab> -->

  <!-- @if (vm.downloading) {
  <ion-fab #fab slot="fixed" vertical="bottom" horizontal="start">
    <ion-fab-button>
      <ion-spinner name="crescent"></ion-spinner>      
    </ion-fab-button>
  </ion-fab>
  } -->

  <ion-fab slot="fixed" vertical="top" horizontal="start">
    <ion-fab-button>
      <ion-icon (click)="toggleList()" [name]="vm.list ? 'albums-outline' : 'list-outline'"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <app-pin-entry
    [correctPin]="vm.selected ? vm.selected.pin : ''"
    (dismissed)="closePin()"
    [show]="vm.showPinModal"
  ></app-pin-entry>
  <p class="subtitle">{{subtitle()}}</p>
  <div [hidden]="vm.eventAlreadySelected" class="footer">
    @if (vm.ready && !vm.downloading) {
    <app-bar [selection]="vm.showing" (selected)="selectedFilter($event)"></app-bar>
    } @else {
    <ion-button [disabled]="!vm.ready" (click)="go()" size="large" shape="round">
      <ion-spinner color="light" name="circular"></ion-spinner>
    </ion-button>
    }
  </div>

</ion-content>
